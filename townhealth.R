###load the packages###
library(sf)
library(SpatialEpi)
library(hrbrthemes)
library(Hmisc)
library(GGally)
library(ggstance)
library(jtools)
library(lme4)
library(plyr)
library(rgdal)
library(maptools)
library(raster)
library(dplyr)
library(sp)
library(tmaptools)
library(base)
library(lattice)
library(spatial)
library(classInt)
library(spatialEco)
library(RColorBrewer)
library(ggplot2)
library(tibble)
library(broom)
library(margins)
library(Ecdat)
library(readr)
library(rgeos)
library(colorspace)
library(ggplot2)
library(latticeExtra)
library(rMaps)
library(leaflet)
library(spatstat)
library(tidyverse)
library(ggrepel)
library(coefplot)
library(gcookbook)
library(ggthemes)
library(vcd)
library(graphics)
library(corrplot)
library(corrgram)
library(foreign)
library(plm)
library(clubSandwich)
library(ggeffects)
library(ggiraph)
library(ggiraphExtra)
library(stargazer)
library(ggmap)
library(feisr)
library(pglm)
library(survival)
library(sampling)
library(pscyho)
library(reshape2)
library(ggpubr)
library(bife)
library(psych)
library(grid)
library(lubridate)
library(snakecase)
library(sjPlot)
library(mapview)
library(PHEindicatormethods)
### download the data###

buas <- readShapeSpatial("bua")
buasd <- readShapeSpatial("buasd")

names(buanames)[names(buanames)=="bua11cd"] <- "BUA11CD"
names(buas)[names(buas)=="bua11cd"] <- "BUA11CD"
ukcrs <- CRS("+init=epsg:27700")
lsoapop <- read_csv("lsoapop18.csv")
msoapop <- read_csv("msoapop18.csv")
names(lsoapop)[names(lsoapop)=="mid2018pop"] <- "lsoa18pop"
names(msoapop)[names(msoapop)=="All Ages"] <- "msoa18pop"
lsoabualookup <- read_csv("lsoabualookup.csv")
msoabualookup <- read_csv("msoabualookup.csv")
lsoabuasdlookup <- read_csv("lsoabualookup2.csv")
msoabuasdlookup <- read_csv("msoabualookup2.csv")
buabuasdlistlsoa <- lsoabuasdlookup
buabuasdlistmsoa <- msoabuasdlookup
buabuasdlistmsoa$BUASD11CD[is.na(buabuasdlistmsoa$BUASD11CD)] <- as.character(buabuasdlistmsoa$BUA11CD[is.na(buabuasdlistmsoa$BUASD11CD)])
buabuasdlistmsoa$BUASD11NM[is.na(buabuasdlistmsoa$BUASD11NM)] <- as.character(buabuasdlistmsoa$BUA11NM[is.na(buabuasdlistmsoa$BUASD11NM)])

buabuasdlistlsoa$BUASD11CD[is.na(buabuasdlistlsoa$BUASD11CD)] <- as.character(buabuasdlistlsoa$BUA11CD[is.na(buabuasdlistlsoa$BUASD11CD)])
buabuasdlistlsoa$BUASD11NM[is.na(buabuasdlistlsoa$BUASD11NM)] <- as.character(buabuasdlistlsoa$BUA11NM[is.na(buabuasdlistlsoa$BUASD11NM)])

lsoalookup <- buabuasdlistlsoa[-c(4,5)]
msoalookup <- buabuasdlistmsoa[-c(4,5)]

buanames <- buabuasdlistlsoa[-c(1,4,5)]
buanames <- buanames[!duplicated(buanames$BUASD11CD),]
townclass <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\townclass.csv")
townclass <- townclass[!duplicated(townclass),]

lsoatobuapop <- merge(lsoapop, lsoalookup, by="LSOA11CD", all.x=TRUE)
lsoatobuapop <- lsoatobuapop[complete.cases(lsoatobuapop$BUASD11CD),]
lsoatobuapop <- lsoatobuapop[-c(1)]
lsoatobuapop <- aggregate(lsoatobuapop[-c(2,3)],lsoatobuapop["BUASD11CD"], sum)
msoatobuapop <- merge(msoapop, msoalookup, by="MSOA11CD", all.x=TRUE)
msoatobuapop <- msoatobuapop[complete.cases(msoatobuapop$BUASD11CD),]
msoatobuapop <- msoatobuapop[-c(1)]
msoatobuapop <- aggregate(msoatobuapop[-c(2,3)],msoatobuapop["BUASD11CD"], sum)
names(msoatobuapop)[names(msoatobuapop)=="msoa18pop"] <- "msoa18popbestfit"
names(lsoatobuapop)[names(lsoatobuapop)=="lsoa18pop"] <- "lsoa18popbestfit"



####obesitydata####
# msoachildobesity <- read.csv("mosachildobesity.csv")
# msoachildobesity <- msoachildobesity[which(msoachildobesity$Time.period=="2015/16 - 17/18"), ]
# msoachildobesity <- msoachildobesity[which(msoachildobesity$Area.Type=="MSOA"), ]
#  write.csv(msoachildobesity, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\msoachildobesity.csv")
Townhealth <- read.csv("msoachildobesity.csv")
names(Townhealth)[names(Townhealth)=="Area.Code"] <- "MSOA11CD"
year6obesity <- Townhealth[which(Townhealth$Indicator.Name =="Obese children Year 6, three year average"), ]
names(year6obesity)[names(year6obesity)=="Value"] <- "Obese children Year 6"
year6obesity <- year6obesity %>% mutate(partialdatayear6obesity = ifelse(is.na(year6obesity$`Obese children Year 6`), 1,0))
year6obesitybua <- merge(year6obesity, msoalookup, by="MSOA11CD", all.x=TRUE)
year6obesitybua <- merge(year6obesitybua, msoapop, by="MSOA11CD", all.x=TRUE)
year6obesitypartial<- year6obesitybua[-c(1:27, 30,31)]
year6obesitypartial <- aggregate(year6obesitypartial[-2], year6obesitypartial["BUASD11CD"], sum)
year6obesitybua <- year6obesitybua[complete.cases(year6obesitybua$`Obese children Year 6`),]
year6obesitybua <- year6obesitybua[-c(2:13, 17:27)]

yr6pop <- year6obesitybua[-c(1:5,7)]
yr6pop <- aggregate(yr6pop[-c(1)], yr6pop["BUASD11CD"], sum)
names(yr6pop)[names(yr6pop)=="msoa18pop"] <- "msoa18popbestfit"

year6obesitybua <- merge(year6obesitybua, yr6pop, by="BUASD11CD", all.x=TRUE)
year6obesitybua$Obesechildrenyear6per <- year6obesitybua$`Obese children Year 6`*(year6obesitybua$msoa18pop/year6obesitybua$msoa18popbestfit)
year6obesitybua$lower95yr6obesity <- year6obesitybua$Lower.CI.95.0.limit*(year6obesitybua$msoa18pop/year6obesitybua$msoa18popbestfit)
year6obesitybua$upper95yr6obesity <- year6obesitybua$Upper.CI.95.0.limit*(year6obesitybua$msoa18pop/year6obesitybua$msoa18popbestfit)
year6obesitybua <- year6obesitybua[-c(2:6, 7,8,9)]
year6obesitybua <- aggregate(year6obesitybua[-c(1)], year6obesitybua["BUASD11CD"], sum)
year6obesitybua <- merge(year6obesitybua,year6obesitypartial, by="BUASD11CD", all.x=TRUE )


Townhealthmaster <- year6obesitybua
Townhealthmaster <- merge(Townhealthmaster, msoatobuapop, by="BUASD11CD", all.x=TRUE)
Townhealthmaster <- merge(Townhealthmaster, lsoatobuapop, by="BUASD11CD", all.x=TRUE)
Townhealthmaster <- merge(Townhealthmaster, buanames, by="BUASD11CD", all.x=TRUE)
Townhealthmaster <- Townhealthmaster[which(Townhealthmaster$lsoa18popbestfit>=5000&Townhealthmaster$lsoa18popbestfit<=230000), ]

receptionobesity <- Townhealth[which(Townhealth$Indicator.Name =="Obese children Reception Year, three year average"), ]
names(receptionobesity)[names(receptionobesity)=="Value"] <- "Obese children Recpetion"
receptionobesity <- receptionobesity %>% mutate(partialdatareceptionobesity = ifelse(is.na(receptionobesity$`Obese children Recpetion`), 1,0))

receptionobesitybua <- merge(receptionobesity, msoalookup, by="MSOA11CD", all.x=TRUE)
receptionobesitybua <- merge(receptionobesitybua, msoapop, by="MSOA11CD", all.x=TRUE)
receptionobesitypartial<- receptionobesitybua[-c(1:27, 30,31)]
receptionobesitypartial <- aggregate(receptionobesitypartial[-2], receptionobesitypartial["BUASD11CD"], sum)
receptionobesitybua <- receptionobesitybua[complete.cases(receptionobesitybua$`Obese children Recpetion`),]

receptionobesitybua <- receptionobesitybua[-c(2:13, 17:27)]

recpop <- receptionobesitybua[-c(1:5,7)]
recpop <- aggregate(recpop[-c(1)], recpop["BUASD11CD"], sum)
names(recpop)[names(recpop)=="msoa18pop"] <- "msoa18popbestfit"

receptionobesitybua <- merge(receptionobesitybua, msoatobuapop, by="BUASD11CD", all.x=TRUE)
receptionobesitybua$Obesechildrenreceptionper <- receptionobesitybua$`Obese children Recpetion`*(receptionobesitybua$msoa18pop/receptionobesitybua$msoa18popbestfit)
receptionobesitybua$lower95receptionobesity <- receptionobesitybua$Lower.CI.95.0.limit*(receptionobesitybua$msoa18pop/receptionobesitybua$msoa18popbestfit)
receptionobesitybua$upper95receptionobesity <- receptionobesitybua$Upper.CI.95.0.limit*(receptionobesitybua$msoa18pop/receptionobesitybua$msoa18popbestfit)
receptionobesitybua <- receptionobesitybua[-c(2:6, 7,8,9)]
receptionobesitybua <- aggregate(receptionobesitybua[-c(1)], receptionobesitybua["BUASD11CD"], sum)
receptionobesitybua <- merge(receptionobesitybua,receptionobesitypartial, by="BUASD11CD", all.x=TRUE )

Townhealthmaster <- merge(Townhealthmaster, receptionobesitybua, by="BUASD11CD", all.x=TRUE)


####towndealdata####

towndeals <- read_csv("towndeals.csv")

towndeals$BUASD11CD[is.na(towndeals$BUASD11CD)] <- as.character(towndeals$BUA11CD[is.na(towndeals$BUASD11CD)])
towndeals$BUASD11NM[is.na(towndeals$BUASD11NM)] <- as.character(towndeals$BUA11NM[is.na(towndeals$BUASD11NM)])

towndeals <- towndeals[-c(2,3,4)]

Townhealthmaster <- merge(Townhealthmaster, towndeals, by="BUASD11CD", all.x=TRUE)


Townhealthmaster <- Townhealthmaster %>% mutate(towndeal = ifelse(is.na(Townhealthmaster$`Town Name`), 0, 1))
Townhealthmaster$towndeal <- factor(Townhealthmaster$towndeal)


alldata <- read_csv("msoaalldata.csv")
MSOAdata <- alldata[which(alldata$`Area Type`=="MSOA"), ]
names(MSOAdata)[names(MSOAdata)=="Area Code"] <- "MSOA11CD"
MSOAdata <- MSOAdata %>% mutate(partialdata = ifelse(is.na(MSOAdata$Value), 1,0))
MSOAdatabua <- merge(MSOAdata, msoalookup, by="MSOA11CD", all.x=TRUE)
MSOAdatabua <- merge(MSOAdatabua, msoapop, by="MSOA11CD", all.x=TRUE)




####lifeexpectancydata####

le <- MSOAdatabua[which(MSOAdatabua$`Indicator Name`=="Life expectancy at birth, (upper age band 90+)"), ]
lemale <- le[which(le$Sex=="Male"),]
lemalepartial<- lemale[-c(1:26, 29)]
lemalepartial <- aggregate(lemalepartial[-2], lemalepartial["BUASD11CD"], sum)
names(lemalepartial)[names(lemalepartial)=="partialdata"] <- "partialdatalemale"
lemale <- lemale[complete.cases(lemale$Value),]
lemale <- lemale[-c(1:12, 16:26, 29)]

lepop <- lemale[-c(1:4)]
lepop <- aggregate(lepop[-c(1)], lepop["BUASD11CD"], sum)
names(lepop)[names(lepop)=="msoa18pop"] <- "msoa18popbestfit"



lemale <- merge(lemale, lepop, by="BUASD11CD", all.x=TRUE)
lemale$lemale <- lemale$Value*(lemale$msoa18pop/lemale$msoa18popbestfit)
lemale$lower95lemale <- lemale$`Lower CI 95.0 limit`*(lemale$msoa18pop/lemale$msoa18popbestfit)
lemale$upper95lemale <- lemale$`Upper CI 95.0 limit`*(lemale$msoa18pop/lemale$msoa18popbestfit)
lemale <- lemale[-c(2:7)]
lemale <- aggregate(lemale[-c(1)], lemale["BUASD11CD"], sum)
lemale <- merge(lemale,lemalepartial, by="BUASD11CD", all.x=TRUE )
lemale <- lemale[-c(6)]

Townhealthmaster <- merge(Townhealthmaster, lemale, by="BUASD11CD", all.x=TRUE)


lefemale <- le[which(le$Sex=="Female"),]
lefemalepartial<- lefemale[-c(1:26, 29)]
lefemalepartial <- aggregate(lefemalepartial[-2], lefemalepartial["BUASD11CD"], sum)
names(lefemalepartial)[names(lefemalepartial)=="partialdata"] <- "partialdatalefemale"
lefemale <- lefemale[complete.cases(lefemale$Value),]
lefemale <- lefemale[-c(1:12, 16:26, 29)]

lepop <- lefemale[-c(1:4)]
lepop <- aggregate(lepop[-c(1)], lepop["BUASD11CD"], sum)
names(lepop)[names(lepop)=="msoa18pop"] <- "msoa18popbestfit"



lefemale <- merge(lefemale, lepop, by="BUASD11CD", all.x=TRUE)
lefemale$lefemale <- lefemale$Value*(lefemale$msoa18pop/lefemale$msoa18popbestfit)
lefemale$lower95lefemale <- lefemale$`Lower CI 95.0 limit`*(lefemale$msoa18pop/lefemale$msoa18popbestfit)
lefemale$upper95lefemale <- lefemale$`Upper CI 95.0 limit`*(lefemale$msoa18pop/lefemale$msoa18popbestfit)
lefemale <- lefemale[-c(2:7)]
lefemale <- aggregate(lefemale[-c(1)], lefemale["BUASD11CD"], sum)
lefemale <- merge(lefemale,lefemalepartial, by="BUASD11CD", all.x=TRUE )
lefemale <- lefemale[-c(6)]

Townhealthmaster <- merge(Townhealthmaster, lefemale, by="BUASD11CD", all.x=TRUE)

####healthylife data####

hle <- MSOAdatabua[which(MSOAdatabua$`Indicator Name`=="Healthy life expectancy, (upper age band 85+)"), ]
hlemale <- hle[which(hle$Sex=="Male"),]
hlemalepartial<- hlemale[-c(1:26, 29)]
hlemalepartial <- aggregate(hlemalepartial[-2], hlemalepartial["BUASD11CD"], sum)
names(hlemalepartial)[names(hlemalepartial)=="partialdata"] <- "partialdatahlemale"
hlemale <- hlemale[complete.cases(hlemale$Value),]
hlemale <- hlemale[-c(1:12, 16:26, 29)]

hlepop <- hlemale[-c(1:4)]
hlepop <- aggregate(hlepop[-c(1)], hlepop["BUASD11CD"], sum)
names(hlepop)[names(hlepop)=="msoa18pop"] <- "msoa18popbestfit"



hlemale <- merge(hlemale, lepop, by="BUASD11CD", all.x=TRUE)
hlemale$hlemale <- hlemale$Value*(hlemale$msoa18pop/hlemale$msoa18popbestfit)
hlemale$lower95hlemale <- hlemale$`Lower CI 95.0 limit`*(hlemale$msoa18pop/hlemale$msoa18popbestfit)
hlemale$upper95hlemale <- hlemale$`Upper CI 95.0 limit`*(hlemale$msoa18pop/hlemale$msoa18popbestfit)
hlemale <- hlemale[-c(2:7)]
hlemale <- aggregate(hlemale[-c(1)], hlemale["BUASD11CD"], sum)
hlemale <- merge(hlemale,hlemalepartial, by="BUASD11CD", all.x=TRUE )
hlemale <- hlemale[-c(6)]

Townhealthmaster <- merge(Townhealthmaster, hlemale, by="BUASD11CD", all.x=TRUE)


hle <- MSOAdatabua[which(MSOAdatabua$`Indicator Name`=="Healthy life expectancy, (upper age band 85+)"), ]
hlefemale <- hle[which(hle$Sex=="Female"),]
hlefemalepartial<- hlefemale[-c(1:26, 29)]
hlefemalepartial <- aggregate(hlefemalepartial[-2], hlefemalepartial["BUASD11CD"], sum)
names(hlefemalepartial)[names(hlefemalepartial)=="partialdata"] <- "partialdatahlefemale"
hlefemale <- hlefemale[complete.cases(hlefemale$Value),]
hlefemale <- hlefemale[-c(1:12, 16:26, 29)]

hlepop <- hlefemale[-c(1:4)]
hlepop <- aggregate(hlepop[-c(1)], hlepop["BUASD11CD"], sum)
names(hlepop)[names(hlepop)=="msoa18pop"] <- "msoa18popbestfit"



hlefemale <- merge(hlefemale, lepop, by="BUASD11CD", all.x=TRUE)
hlefemale$hlefemale <- hlefemale$Value*(hlefemale$msoa18pop/hlefemale$msoa18popbestfit)
hlefemale$lower95hlefemale <- hlefemale$`Lower CI 95.0 limit`*(hlefemale$msoa18pop/hlefemale$msoa18popbestfit)
hlefemale$upper95hlefemale <- hlefemale$`Upper CI 95.0 limit`*(hlefemale$msoa18pop/hlefemale$msoa18popbestfit)
hlefemale <- hlefemale[-c(2:7)]
hlefemale <- aggregate(hlefemale[-c(1)], hlefemale["BUASD11CD"], sum)
hlefemale <- merge(hlefemale,hlefemalepartial, by="BUASD11CD", all.x=TRUE )
hlefemale <- hlefemale[-c(6)]

Townhealthmaster <- merge(Townhealthmaster, hlefemale, by="BUASD11CD", all.x=TRUE)


####selfharm data####


selfharm <- MSOAdatabua[which(MSOAdatabua$`Indicator Name`=="Hospital stays for self harm, standardised admission ratio"), ]
selfharmpartial<- selfharm[-c(1:26, 29)]
selfharmpartial <- aggregate(selfharmpartial[-2], selfharmpartial["BUASD11CD"], sum)
names(selfharmpartial)[names(selfharmpartial)=="partialdata"] <- "partialdataselfharm"
selfharm <- selfharm[complete.cases(selfharm$Value),]
selfharm <- selfharm[-c(1:12, 16:26, 29)]

selfharmpop <- selfharm[-c(1:4)]
selfharmpop <- aggregate(selfharmpop[-c(1)], selfharmpop["BUASD11CD"], sum)
names(selfharmpop)[names(selfharmpop)=="msoa18pop"] <- "msoa18popbestfit"



selfharm <- merge(selfharm, selfharmpop, by="BUASD11CD", all.x=TRUE)
selfharm$selfharm <- selfharm$Value*(selfharm$msoa18pop/selfharm$msoa18popbestfit)
selfharm$lower95selfharm <- selfharm$`Lower CI 95.0 limit`*(selfharm$msoa18pop/selfharm$msoa18popbestfit)
selfharm$upper95selfharm <- selfharm$`Upper CI 95.0 limit`*(selfharm$msoa18pop/selfharm$msoa18popbestfit)
selfharm <- selfharm[-c(2:7)]
selfharm <- aggregate(selfharm[-c(1)], selfharm["BUASD11CD"], sum)
selfharm <- merge(selfharm,selfharmpartial, by="BUASD11CD", all.x=TRUE )
selfharm <- selfharm[-c(6)]

Townhealthmaster <- merge(Townhealthmaster, selfharm, by="BUASD11CD", all.x=TRUE)

###alcohol data####

alcohol <- MSOAdatabua[which(MSOAdatabua$`Indicator Name`=="Hospital stays for alcohol-related harm (Broad definition), standardised admission ratio"), ]
alcoholpartial<- alcohol[-c(1:26, 29)]
alcoholpartial <- aggregate(alcoholpartial[-2], alcoholpartial["BUASD11CD"], sum)
names(alcoholpartial)[names(alcoholpartial)=="partialdata"] <- "partialdataalcohol"
alcohol <- alcohol[complete.cases(alcohol$Value),]
alcohol <- alcohol[-c(1:12, 16:26, 29)]

alcoholpop <- alcohol[-c(1:4)]
alcoholpop <- aggregate(alcoholpop[-c(1)], alcoholpop["BUASD11CD"], sum)
names(alcoholpop)[names(alcoholpop)=="msoa18pop"] <- "msoa18popbestfit"



alcohol <- merge(alcohol, alcoholpop, by="BUASD11CD", all.x=TRUE)
alcohol$alcohol <- alcohol$Value*(alcohol$msoa18pop/alcohol$msoa18popbestfit)
alcohol$lower95alcohol <- alcohol$`Lower CI 95.0 limit`*(alcohol$msoa18pop/alcohol$msoa18popbestfit)
alcohol$upper95alcohol <- alcohol$`Upper CI 95.0 limit`*(alcohol$msoa18pop/alcohol$msoa18popbestfit)
alcohol <- alcohol[-c(2:7)]
alcohol <- aggregate(alcohol[-c(1)], alcohol["BUASD11CD"], sum)
alcohol <- merge(alcohol,alcoholpartial, by="BUASD11CD", all.x=TRUE )
alcohol <- alcohol[-c(6)]

Townhealthmaster <- merge(Townhealthmaster, alcohol, by="BUASD11CD", all.x=TRUE)

###lungcancer data####

lungcancer <- MSOAdatabua[which(MSOAdatabua$`Indicator Name`=="Incidence of lung cancer, standardised incidence ratio"), ]
lungcancerpartial<- lungcancer[-c(1:26, 29)]
lungcancerpartial <- aggregate(lungcancerpartial[-2], lungcancerpartial["BUASD11CD"], sum)
names(lungcancerpartial)[names(lungcancerpartial)=="partialdata"] <- "partialdatalungcancer"
lungcancer <- lungcancer[complete.cases(lungcancer$Value),]
lungcancer <- lungcancer[-c(1:12, 16:26, 29)]

lungcancerpop <- lungcancer[-c(1:4)]
lungcancerpop <- aggregate(lungcancerpop[-c(1)], lungcancerpop["BUASD11CD"], sum)
names(lungcancerpop)[names(lungcancerpop)=="msoa18pop"] <- "msoa18popbestfit"



lungcancer <- merge(lungcancer, lungcancerpop, by="BUASD11CD", all.x=TRUE)
lungcancer$lungcancer <- lungcancer$Value*(lungcancer$msoa18pop/lungcancer$msoa18popbestfit)
lungcancer$lower95lungcancer <- lungcancer$`Lower CI 95.0 limit`*(lungcancer$msoa18pop/lungcancer$msoa18popbestfit)
lungcancer$upper95lungcancer <- lungcancer$`Upper CI 95.0 limit`*(lungcancer$msoa18pop/lungcancer$msoa18popbestfit)
lungcancer <- lungcancer[-c(2:7)]
lungcancer <- aggregate(lungcancer[-c(1)], lungcancer["BUASD11CD"], sum)
lungcancer <- merge(lungcancer,lungcancerpartial, by="BUASD11CD", all.x=TRUE )
lungcancer <- lungcancer[-c(6)]

Townhealthmaster <- merge(Townhealthmaster, lungcancer, by="BUASD11CD", all.x=TRUE)

####subjective data####
subjective <- read_csv("subjectivehealth.csv")
subjective <- merge(subjective, msoalookup, by="MSOA11CD", all.x=TRUE)
subjective <- subjective[complete.cases(subjective$BUASD11CD), ]
subjective <- subjective[-c(1,9)]
subjective <- aggregate(subjective[-c(7)], subjective["BUASD11CD"], sum)
subjective$perverygoodhealth <- subjective$`Very good health`/subjective$`All categories: General health`
subjective$pergoodhealth <- subjective$`Good health`/subjective$`All categories: General health`
subjective$perfairhealth <- subjective$`Fair health`/subjective$`All categories: General health`
subjective$perbadhealth <- subjective$`Bad health`/subjective$`All categories: General health`
subjective$perverybadhealth <- subjective$`Very bad health`/subjective$`All categories: General health`

subjective <- subjective[-c(2:7)]

Townhealthmaster <- merge(Townhealthmaster, subjective, by="BUASD11CD", all.x=TRUE)

townhealthsubjectiveplot <- rbind(
  data.frame(subjective$BUASD11CD, "per" = subjective$perverybadhealth, "type" = "Very Bad Health"),
  data.frame(subjective$BUASD11CD, "per" = subjective$perbadhealth, "type" = "Bad Health"),
  data.frame(subjective$BUASD11CD, "per" = subjective$perfairhealth, "type" = "Fair Health"),
  data.frame(subjective$BUASD11CD, "per" = subjective$pergoodhealth, "type" = "Good Health"),
  data.frame(subjective$BUASD11CD, "per" = subjective$perverygoodhealth, "type" = "Very Good Health")
)
names(townhealthsubjectiveplot)[names(townhealthsubjectiveplot)=="subjective.BUASD11CD"] <- "BUASD11CD"


###smoking15 data####

smoking15 <- MSOAdatabua[which(MSOAdatabua$`Indicator Name`=="Smoking prevalence at age 15 - regular or occasional smokers (modelled estimates)"), ]
smoking15partial<- smoking15[-c(1:26, 29)]
smoking15partial <- aggregate(smoking15partial[-2], smoking15partial["BUASD11CD"], sum)
names(smoking15partial)[names(smoking15partial)=="partialdata"] <- "partialdatasmoking15"
smoking15 <- smoking15[complete.cases(smoking15$Value),]
smoking15 <- smoking15[-c(1:12, 16:26, 29)]

smoking15pop <- smoking15[-c(1:4)]
smoking15pop <- aggregate(smoking15pop[-c(1)], smoking15pop["BUASD11CD"], sum)
names(smoking15pop)[names(smoking15pop)=="msoa18pop"] <- "msoa18popbestfit"



smoking15 <- merge(smoking15, smoking15pop, by="BUASD11CD", all.x=TRUE)
smoking15$smoking15 <- smoking15$Value*(smoking15$msoa18pop/smoking15$msoa18popbestfit)
smoking15$lower95smoking15 <- smoking15$`Lower CI 95.0 limit`*(smoking15$msoa18pop/smoking15$msoa18popbestfit)
smoking15$upper95smoking15 <- smoking15$`Upper CI 95.0 limit`*(smoking15$msoa18pop/smoking15$msoa18popbestfit)
smoking15 <- smoking15[-c(2:7)]
smoking15 <- aggregate(smoking15[-c(1)], smoking15["BUASD11CD"], sum)
smoking15 <- merge(smoking15,smoking15partial, by="BUASD11CD", all.x=TRUE )
smoking15 <- smoking15[-c(3,4,6)]

Townhealthmaster <- merge(Townhealthmaster, smoking15, by="BUASD11CD", all.x=TRUE)



####deprivation ranking####

imd <- read_csv("imd2019.csv")
imd <- imd[which(imd$Measurement=="Rank"), ]
imd <- imd[which(imd$`Indices of Deprivation`=="a. Index of Multiple Deprivation (IMD)"), ]
names(imd)[names(imd)=="FeatureCode"] <- "LSOA11CD"
imdbua <- merge(imd, lsoalookup, by="LSOA11CD", all.x=TRUE)
imdbua <- merge(imdbua, lsoapop, by="LSOA11CD", all.x=TRUE)

imdpop <- imdbua[-c(1:6, 8)]
imdpop <- aggregate(imdpop[-c(1)], imdpop["BUASD11CD"], sum)
names(imdpop)[names(imdpop)=="lsoa18pop"] <- "lsoa18popbestfit"

imdbua <- merge(imdbua, imdpop, by="BUASD11CD", all.x=TRUE)
imdbua$imdrank <- imdbua$Value*(imdbua$lsoa18pop/imdbua$lsoa18popbestfit)
imdbua <- imdbua[-c(2:10)]
imdbua <- aggregate(imdbua[-c(1)], imdbua["BUASD11CD"], sum)
imdbua <- imdbua[order(imdbua$imdrank),]
imdbua$imdrank <- 1:nrow(imdbua)

Townhealthmaster <- merge(Townhealthmaster, imdbua, by="BUASD11CD", all.x=TRUE)
Townhealthmaster <- Townhealthmaster[order(Townhealthmaster$imdrank),]
Townhealthmaster$imdrank <- 1:nrow(Townhealthmaster)

townname <- read_csv("townname.csv")

Townhealthmaster <- Townhealthmaster[-c(13)]
Townhealthmaster <- merge(Townhealthmaster, townname, by="BUASD11CD", all.x=TRUE)


# tapply(Townhealthmaster$Obesechildrenyear6per, factor(Townhealthmaster$towndeal), mean)
# 
# tapply(Townhealthmaster$Obesechildrenreceptionper, factor(Townhealthmaster$towndeal), mean)



towndealsample <- Townhealthmaster[which(Townhealthmaster$towndeal==1),]
deprivedtownsample <- Townhealthmaster[which(Townhealthmaster$imdrank<101),]

yep <- Townhealthmaster[complete.cases(Townhealthmaster$Obesechildrenreceptionper),]
mean(yep$Obesechildrenreceptionper)
Townhealthmaster$all <- 1

# interestgrays <- Townhealthmaster[which(Townhealthmaster$`Town Name`=="Grays"), ]

Townhealthmaster <-Townhealthmaster %>% mutate(Grays = ifelse(Townhealthmaster$`Town Name`=="Grays", "Grays", NA))
Townhealthmaster <-Townhealthmaster %>% mutate(Mablethorpe = ifelse(Townhealthmaster$`Town Name`=="Mablethorpe", "Mablethorpe", NA))
Townhealthmaster <-Townhealthmaster %>% mutate(Workington = ifelse(Townhealthmaster$`Town Name`=="Workington", "Workington", NA))
Townhealthmaster <-Townhealthmaster %>% mutate(StIvesCornwall = ifelse(Townhealthmaster$`Town Name`=="St Ives (Cornwall)", "St Ives", NA))
Townhealthmaster <-Townhealthmaster %>% mutate(KingsLynn = ifelse(Townhealthmaster$`Town Name`=="King's Lynn", "King's Lynn", NA))
Townhealthmaster <-Townhealthmaster %>% mutate(Nelson = ifelse(Townhealthmaster$`Town Name`=="Nelson (Pendle)", "Nelson", NA))
Townhealthmaster <-Townhealthmaster %>% mutate(Blyth = ifelse(Townhealthmaster$`Town Name`=="Blyth (Northumberland)", "Blyth", NA))
Townhealthmaster <-Townhealthmaster %>% mutate(Sale = ifelse(Townhealthmaster$`Town Name`=="Sale", "Sale", ifelse(Townhealthmaster$`Town Name`=="Altrincham", "Altrincham", NA)))
Townhealthmaster <-Townhealthmaster %>% mutate(Altrincham = ifelse(Townhealthmaster$`Town Name`=="Altrincham", "Altrincham", NA))

Townhealthmaster <- merge(Townhealthmaster, townclass, by="BUASD11CD", all.x=TRUE)
Townhealthmaster[is.na(Townhealthmaster)] <- 0
Townhealthmaster <- Townhealthmaster[which(Townhealthmaster$citytownclassification!="Core City (London)"), ]
Townhealthmaster <- Townhealthmaster[which(Townhealthmaster$citytownclassification!="Other City"), ]
Townhealthmaster <- Townhealthmaster[which(Townhealthmaster$citytownclassification!="Core City (outside London)"), ]
Townhealthmaster <- Townhealthmaster[which(Townhealthmaster$citytownclassification!="Village or Small Community"), ]
Townhealthmaster <- Townhealthmaster[which(Townhealthmaster$citytownclassification!="Village or Small Community in Conurbation"), ]

towns <- Townhealthmaster[c(1,8)]

Townhealthmaster <- Townhealthmaster[order(Townhealthmaster$imdrank),]
Townhealthmaster$imdrank <- 1:nrow(Townhealthmaster)

####plots####


####towndeallollipops####

# obesityplot1 <- ggplot(data = towndealsample, aes(x=reorder(`Town Name`, -Obesechildrenyear6per), y=Obesechildrenyear6per))+
#   geom_bar(stat="identity", color = "lightgrey")+
#   geom_errorbar(aes(ymin=lower95yr6obesity, ymax=upper95yr6obesity))+
#   geom_hline(yintercept = 17.38003, linetype="dashed", color="white", size=1)+
#   geom_label(aes(x=50, y=18.38003, label="English Place Average"), color = "black", fill="white")+
#   geom_hline(yintercept = 20.1, linetype="dashed", color="white", size=1)+
#   geom_label(aes(x=50, y=21.1, label="English Average"), color = "black", fill="white")+
#   labs(x = "Town", y = "Obesity at Year 6 (%, 2015/16-2017/18)", title = "Child Obesity at Year 6 in the Town Deal Towns")+
#   theme_nice()+
#   theme(axis.text.x = element_text(angle = 90, hjust=1))+
#   geom_text(aes(x=94, y= 25, label="*"), color = "black")+
#   geom_text(aes(x=95, y= 25, label="*"), color = "black")+
#   geom_text(aes(x=101, y= 25, label="*"), color = "black")

# obesityplot2 <- ggplot(data = towndealsample, aes(x=reorder(`Town Name`, -Obesechildrenreceptionper), y=Obesechildrenreceptionper))+
#   geom_bar(stat="identity", color = "lightgrey")+
#   geom_errorbar(aes(ymin=lower95receptionobesity, ymax=upper95receptionobesity))+
#   geom_hline(yintercept = 8.652214, linetype="dashed", color="white", size=1)+
#   geom_label(aes(x=50, y=7.64, label="English Place Average"), color = "black", fill="white")+
#   geom_hline(yintercept = 9.5, linetype="dashed", color="white", size=1)+
#   geom_label(aes(x=50, y=10.5, label="English Average"), color = "black", fill="white")+
#   labs(x = "Town", y = "Obesity at Reception (%, 2015/16-2017/18)", title = "Child Obesity at Reception in the Town Deal Towns")+
#   theme_nice()+
#   theme(axis.text.x = element_text(angle = 90, hjust=1))+
#   geom_text(aes(x=78, y= 15, label="*"), color = "black")+
#   geom_text(aes(x=85, y= 15, label="*"), color = "black")+
#   geom_text(aes(x=86, y= 15, label="*"), color = "black")
  
obesityplot1attempt2 <- ggplot(data = towndealsample, aes(x=reorder(`Town Name`, -Obesechildrenyear6per), y=Obesechildrenyear6per))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=Obesechildrenyear6per), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 17.78253, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=16.88003, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 20.1, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=19.5, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Obesity at Year 6 (%, 2015/16-2017/18)", title = "Child Obesity at Year 6 in the Town Deal Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )+
  geom_text(aes(x=94, y= 25, label="*"), color = "black")+
  geom_text(aes(x=95, y= 25, label="*"), color = "black")+
  geom_text(aes(x=101, y= 25, label="*"), color = "black")
#ggsave("Figure1health.png", plot=obesityplot1attempt2, width=8, height=15, dpi=600)

  


obesityplot2attempt2 <- ggplot(data = towndealsample, aes(x=reorder(`Town Name`, -Obesechildrenreceptionper), y=Obesechildrenreceptionper))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=Obesechildrenreceptionper), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 8.708197, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=8.4, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 9.5, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=9.25, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Obesity at Reception (%, 2015/16-2017/18)", title = "Child Obesity at Reception in the Town Deal Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )+
  geom_text(aes(x=78, y= 15, label="*"), color = "black")+
  geom_text(aes(x=85, y= 15, label="*"), color = "black")+
  geom_text(aes(x=86, y= 15, label="*"), color = "black")
#ggsave("Figure2health.png", plot=obesityplot2attempt2, width=8, height=15, dpi=600)


selfharmplot <- ggplot(data = towndealsample, aes(x=reorder(`Town Name`, -selfharm), y=selfharm))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=selfharm), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 106.3085, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=108, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 100, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=98, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Hospital Stays for Self Harm (Standardised Admission Ratio, 2013/14-2017/18)", title = "Hospital Stays for Self Harm in the Town Deal Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure3health.png", plot=selfharmplot, width=8, height=15, dpi=600)

alcoholplot <- ggplot(data = towndealsample, aes(x=reorder(`Town Name`, -alcohol), y=alcohol))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=alcohol), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 96.63672, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=94, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 100, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=102, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Hospital Stays for Alcohol-related Harm (broad definiton) (Standardised Admission Ratio, 2013/14-2017/18)", title = "Hospital Stays for Alcohol-related Harm in the Town Deal Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure4health.png", plot=alcoholplot, width=8, height=15, dpi=600)

leplotfemale <- ggplot(data = towndealsample, aes(x=reorder(`Town Name`, -lefemale), y=lefemale))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=lefemale), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 83.49927, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=85, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 83.1, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=81, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Life Expectancy at Birth (Female, 2013-17)", title = "Female Life Expectancy in the Town Deal Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure5health.png", plot=leplotfemale, width=8, height=15, dpi=600)

leplotmale <- ggplot(data = towndealsample, aes(x=reorder(`Town Name`, -lemale), y=lemale))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=lemale), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 79.78784, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=81, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 79.6, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=77, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Life Expectancy at Birth (Male, 2013-17)", title = "Male Life Expectancy in the Town Deal Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure6health.png", plot=leplotmale, width=8, height=15, dpi=600)

hleplotmale <- ggplot(data = towndealsample, aes(x=reorder(`Town Name`, -hlemale), y=hlemale))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=hlemale), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 64.29495, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=66, label="English Town Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Healthy Life Expectancy at Birth (Male, 2009-13)", title = "Male Healthy Life Expectancy in the Town Deal Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure6health0302.png", plot=hleplotmale, width=8, height=15, dpi=600)

hleplotfemale <- ggplot(data = towndealsample, aes(x=reorder(`Town Name`, -hlefemale), y=hlefemale))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=hlefemale), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 65.63827, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=67, label="English Town Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Healthy Life Expectancy at Birth (Female, 2009-13)", title = "Female Healthy Life Expectancy in the Town Deal Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure6health0402.png", plot=hleplotfemale, width=8, height=15, dpi=600)


lungcancerplot <- ggplot(data = towndealsample, aes(x=reorder(`Town Name`, -lungcancer), y=lungcancer))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=lungcancer), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 99.0816, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=97, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 100, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=102, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Incidence of Lung Cancer (Standardised Incidence Ratio, 2012-16)", title = "Lung Cancer in the Town Deal Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure7health.png", plot=lungcancerplot, width=8, height=15, dpi=600)

smoking15plot <- ggplot(data = towndealsample, aes(x=reorder(`Town Name`, -smoking15), y=smoking15))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=smoking15), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 8.799687, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=8, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 12.71, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=13.5, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Regular or Occasional Smokers (Age 15, estimated %, 2014)", title = "Teenage Smoking in the Town Deal Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure8health.png", plot=smoking15plot, width=8, height=15, dpi=600)



####deprivationranklollipops####



obesityplot1attempt22 <- ggplot(data = deprivedtownsample, aes(x=reorder(`Town Name`, -Obesechildrenyear6per), y=Obesechildrenyear6per))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=Obesechildrenyear6per), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 17.78253, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=16.88003, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 20.1, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=19.5, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Obesity at Year 6 (%, 2015/16-2017/18)", title = "Child Obesity at Year 6 in England's Most Deprived Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )
#ggsave("Figure9health.png", plot=obesityplot1attempt22, width=8, height=15, dpi=600)




obesityplot2attempt22 <- ggplot(data = deprivedtownsample, aes(x=reorder(`Town Name`, -Obesechildrenreceptionper), y=Obesechildrenreceptionper))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=Obesechildrenreceptionper), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 8.708197, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=8.4, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 9.5, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=9.25, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Obesity at Reception (%, 2015/16-2017/18)", title = "Child Obesity at Reception in England's Most Deprived Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )
#ggsave("Figure10health.png", plot=obesityplot2attempt22, width=8, height=15, dpi=600)


selfharmplot2 <- ggplot(data = deprivedtownsample, aes(x=reorder(`Town Name`, -selfharm), y=selfharm))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=selfharm), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 106.3085, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=108, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 100, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=98, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Hospital Stays for Self Harm (Standardised Admission Ratio, 2013/14-2017/18)", title = "Hospital Stays for Self Harm in England's Most Deprived Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure11health.png", plot=selfharmplot2, width=8, height=15, dpi=600)

alcoholplot2 <- ggplot(data = deprivedtownsample, aes(x=reorder(`Town Name`, -alcohol), y=alcohol))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=alcohol), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 96.63672, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=94, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 100, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=102, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Hospital Stays for Alcohol-related Harm (broad definiton) (Standardised Admission Ratio, 2013/14-2017/18)", title = "Hospital Stays for Alcohol-related Harm in England's Most Deprived Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure12health.png", plot=alcoholplot2, width=8, height=15, dpi=600)

leplotfemale2 <- ggplot(data = deprivedtownsample, aes(x=reorder(`Town Name`, -lefemale), y=lefemale))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=lefemale), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 83.49927, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=85, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 83.1, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=81, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Life Expectancy at Birth (Female, 2013-17)", title = "Female Life Expectancy in England's Most Deprived Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure13health.png", plot=leplotfemale2, width=8, height=15, dpi=600)

leplotmale2 <- ggplot(data = deprivedtownsample, aes(x=reorder(`Town Name`, -lemale), y=lemale))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=lemale), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 79.78784, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=81, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 79.6, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=77, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Life Expectancy at Birth (Male, 2013-17)", title = "Male Life Expectancy in England's Most Deprived Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure14health.png", plot=leplotmale2, width=8, height=15, dpi=600)

hleplotfemale2 <- ggplot(data = deprivedtownsample, aes(x=reorder(`Town Name`, -hlefemale), y=hlefemale))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=hlefemale), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 65.63827, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=67, label="English Town Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Healthy Life Expectancy at Birth (Female, 2009-13)", title = "Female Healthy Life Expectancy in England's Most Deprived Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure13health0402.png", plot=hleplotfemale2, width=8, height=15, dpi=600)

hleplotmale2 <- ggplot(data = deprivedtownsample, aes(x=reorder(`Town Name`, -hlemale), y=hlemale))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=hlemale), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 64.29495, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=66, label="English Town Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Healthy Life Expectancy at Birth (Male, 2009-13)", title = "Male Healthy Life Expectancy in England's Most Deprived Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure13health0302.png", plot=hleplotmale2, width=8, height=15, dpi=600)


lungcancerplot2 <- ggplot(data = deprivedtownsample, aes(x=reorder(`Town Name`, -lungcancer), y=lungcancer))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=lungcancer), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 99.0816, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=97, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 100, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=102, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Incidence of Lung Cancer (Standardised Incidence Ratio, 2012-16)", title = "Lung Cancer in England's Most Deprived Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure15health.png", plot=lungcancerplot2, width=8, height=15, dpi=600)

smoking15plot2 <- ggplot(data = deprivedtownsample, aes(x=reorder(`Town Name`, -smoking15), y=smoking15))+
  geom_point(size = 4, alpha = 0.6, color = "blue")+
  geom_segment(aes(x=`Town Name`, xend=`Town Name`, y=0, yend=smoking15), color="skyblue")+
  coord_flip()+
  geom_hline(yintercept = 8.799687, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=8, label="English Town Average"), color = "black", angle = 270)+
  geom_hline(yintercept = 12.71, linetype="dashed", color="black", size=1)+
  geom_text(aes(x=50, y=13.5, label="English Average"), color = "black", angle = 270)+
  labs(x = "Town", y = "Regular or Occasional Smokers (Age 15, estimated %, 2014)", title = "Teenage Smoking in England's Most Deprived Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )

#ggsave("Figure16health.png", plot=smoking15plot2, width=8, height=15, dpi=600)

####deprivationscatters####

Townhealthmaster$towndeal <- revalue(Townhealthmaster$towndeal, c("0"="No Town Deal", "1"="Town Deal"))
Townhealthmaster$towndeal <- factor(Townhealthmaster$towndeal)


obesityyr6depplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=Obesechildrenyear6per))+
  geom_point(aes(color=towndeal, alpha=towndeal),size=2)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
             aes(label=towndealsample$`Town Name`), size=2, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Obesity at Year 6 (%, 2015/16-2017/18)", title = "Child Obesity at Year 6 and Town Deprivation")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
  scale_alpha_discrete(range = c(0.25, 1))
#ggsave("Figure17health.png", plot=obesityyr6depplot, width=14, height=8, dpi=600)

obesityrepdepplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=Obesechildrenreceptionper))+
  geom_point(aes(color=towndeal, alpha=towndeal),size=2)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
                  aes(label=towndealsample$`Town Name`), size=2, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Obesity at Reception (%, 2015/16-2017/18)", title = "Child Obesity at Reception and Town Deprivation")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
  scale_alpha_discrete(range = c(0.25, 1))
#ggsave("Figure18health.png", plot=obesityrepdepplot, width=14, height=8, dpi=600)

selfharmdepplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=selfharm))+
  geom_point(aes(color=towndeal, alpha=towndeal),size=2)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
                  aes(label=towndealsample$`Town Name`), size=2, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Hospital Stays for Self Harm (Standardised Admission Ratio, 2013/14-2017/18)", title = "Hospital Stays for Self Harm and Town Deprivation")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
  scale_alpha_discrete(range = c(0.25, 1))
#ggsave("Figure19health.png", plot=selfharmdepplot, width=14, height=8, dpi=600)


alcoholdepplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=alcohol))+
  geom_point(aes(color=towndeal, alpha=towndeal),size=2)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
                  aes(label=towndealsample$`Town Name`), size=2, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Hospital Stays for Alcohol-related Harm (broad definiton) (Standardised Admission Ratio, 2013/14-2017/18)", title = "Hospital Stays for Alcohol-related Harm and Town Deprivation")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
  scale_alpha_discrete(range = c(0.25, 1))
#ggsave("Figure20health.png", plot=alcoholdepplot, width=14, height=8, dpi=600)

lemaledepplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=lemale))+
  geom_point(aes(color=towndeal, alpha=towndeal),size=2)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
                  aes(label=towndealsample$`Town Name`), size=2, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Life Expectancy at Birth (Male, 2013-17)", title = "Male Life Expectancy and Town Deprivation")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
  scale_alpha_discrete(range = c(0.25, 1))
#ggsave("Figure21health.png", plot=lemaledepplot, width=14, height=8, dpi=600)

lefemaledepplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=lefemale))+
  geom_point(aes(color=towndeal, alpha=towndeal),size=2)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
                  aes(label=towndealsample$`Town Name`), size=2, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Life Expectancy at Birth (Female, 2013-17)", title = "Female Life Expectancy and Town Deprivation")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
  scale_alpha_discrete(range = c(0.25, 1))
#ggsave("Figure22health.png", plot=lefemaledepplot, width=14, height=8, dpi=600)

hlefemaledepplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=hlefemale))+
  geom_point(aes(color=towndeal, alpha=towndeal),size=2)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
                  aes(label=towndealsample$`Town Name`), size=2, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Healthy Life Expectancy at Birth (Female, 2009-13)", title = "Healthy Female Life Expectancy and Town Deprivation")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
  scale_alpha_discrete(range = c(0.25, 1))
#ggsave("Figure22health0402.png", plot=hlefemaledepplot, width=14, height=8, dpi=600)

hlemaledepplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=hlemale))+
  geom_point(aes(color=towndeal, alpha=towndeal),size=2)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
                  aes(label=towndealsample$`Town Name`), size=2, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Healthy Life Expectancy at Birth (male, 2009-13)", title = "Healthy male Life Expectancy and Town Deprivation")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
  scale_alpha_discrete(range = c(0.25, 1))
#ggsave("Figure22health0302.png", plot=hlemaledepplot, width=14, height=8, dpi=600)

lungcancerdepplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=lungcancer))+
  geom_point(aes(color=towndeal, alpha=towndeal),size=2)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
                  aes(label=towndealsample$`Town Name`), size=2, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Incidence of Lung Cancer (Standardised Incidence Ratio, 2012-16)", title = "Lung Cancer Incidence and Town Deprivation")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
  scale_alpha_discrete(range = c(0.25, 1))
#ggsave("Figure23health.png", plot=lungcancerdepplot, width=14, height=8, dpi=600)


smoking15depplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=smoking15))+
  geom_point(aes(color=towndeal, alpha=towndeal),size=2)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
                  aes(label=towndealsample$`Town Name`), size=2, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Regular or Occasional Smokers (Age 15, estimated %, 2014)", title = "Smoking Prevalence at Age 15 and Town Deprivation")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
  scale_alpha_discrete(range = c(0.25, 1))
#ggsave("Figure24health.png", plot=smoking15depplot, width=14, height=8, dpi=600)

subvgooddepplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=perverygoodhealth))+
  geom_point(aes(color=towndeal, alpha=towndeal),size=2)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
                  aes(label=towndealsample$`Town Name`), size=2, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Very Good Health (%, 2011)", title = "Subjectively 'Very Good' Health and Town Deprivation")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
  scale_alpha_discrete(range = c(0.25, 1))
#ggsave("Figure33health.png", plot=subvgooddepplot, width=14, height=8, dpi=600)

subvbaddepplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=perverybadhealth))+
  geom_point(aes(color=towndeal, alpha=towndeal),size=2)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
                  aes(label=towndealsample$`Town Name`), size=2, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Very Bad Health (%, 2011)", title = "Subjectively 'Very Bad' Health and Town Deprivation")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
  scale_alpha_discrete(range = c(0.25, 1))
#ggsave("Figure34health.png", plot=subvbaddepplot, width=14, height=8, dpi=600)

####subjectiveplot####


townhealthsubjectiveplot <- merge(Townhealthmaster, townhealthsubjectiveplot, by="BUASD11CD", all.x=TRUE)
subjectivedeals <-townhealthsubjectiveplot[which(townhealthsubjectiveplot$towndeal=="Town Deal"),]
subjectivedeprived <- townhealthsubjectiveplot[which(townhealthsubjectiveplot$imdrank<101),]


subjectivedep <- ggplot(data = subjectivedeprived, aes(x=reorder(`Town Name`, -perverygoodhealth), y=per, fill=type))+
  geom_bar(stat="identity")+
  coord_flip()+
  labs(x = "Town", y = "Self-assessed general state of health (2011, census)", title = "Subjective General Health in Deprived Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )+
  scale_fill_brewer(palette = "PiYG")
#ggsave("Figure25health.png", plot=subjectivedep, width=8, height=15, dpi=600)


subjectivedeal <- ggplot(data = subjectivedeals, aes(x=reorder(`Town Name`, -perverygoodhealth), y=per, fill=type))+
  geom_bar(stat="identity")+
  coord_flip()+
  labs(x = "Town", y = "Self-assessed general state of health (2011, census)", title = "Subjective General Health in Town Deal Towns")+
  theme_light()+
  theme(panel.grid.major.y = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank() )+
  scale_fill_brewer(palette = "PiYG")
#ggsave("Figure26health.png", plot=subjectivedeal, width=8, height=15, dpi=600)



####violinplotsGRAYS####

viohlef <- ggplot(Townhealthmaster, aes(x=all, y=hlefemale, label=Grays))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Grays",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Grays"), position = position_nudge(x=0.15))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Female, 2009-13)", title = "Female Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )
  
viohlem <- ggplot(Townhealthmaster, aes(x=all, y=hlemale, label=Grays))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Grays",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Grays"), position = position_nudge(x=0.15))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Male, 2009-13)", title = "Male Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

violung <- ggplot(Townhealthmaster, aes(x=all, y=lungcancer, label=Grays))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Grays",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Grays"), position = position_nudge(x=0.15))+
  theme_light()+
  labs(x = "Density", y = "Incidence of Lung Cancer \n (Standardised Incidence Ratio, 2012-16)", title = "Lung Cancer")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioselfharm <- ggplot(Townhealthmaster, aes(x=all, y=selfharm, label=Grays))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Grays",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Grays"), position = position_nudge(x=0.15))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Self Harm \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Self Harm")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioalcohol <- ggplot(Townhealthmaster, aes(x=all, y=alcohol, label=Grays))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Grays",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Grays"), position = position_nudge(x=0.15))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Alcohol-related Harm (broad definiton) \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Alcohol")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioobese <- ggplot(Townhealthmaster, aes(x=all, y=Obesechildrenyear6per, label=Grays))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Grays",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Grays"), position = position_nudge(x=0.15))+
  theme_light()+
  labs(x = "Density", y = "Obesity at Year 6 \n (%, 2015/16-2017/18)", title = "Child Obesity")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

Grays <- ggarrange(viohlef, viohlem, vioalcohol, vioselfharm, violung, vioobese,  ncol=3, nrow=2)
#ggsave("Figure27health.png", plot=Grays, width=10, height=8, dpi=600)




####violinplotsMablethorpe####

viohlef <- ggplot(Townhealthmaster, aes(x=all, y=hlefemale, label=Mablethorpe))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Mablethorpe",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Mablethorpe"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Female, 2009-13)", title = "Female Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

viohlem <- ggplot(Townhealthmaster, aes(x=all, y=hlemale, label=Mablethorpe))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Mablethorpe",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Mablethorpe"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Male, 2009-13)", title = "Male Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

violung <- ggplot(Townhealthmaster, aes(x=all, y=lungcancer, label=Mablethorpe))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Mablethorpe",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Mablethorpe"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Incidence of Lung Cancer \n (Standardised Incidence Ratio, 2012-16)", title = "Lung Cancer")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioselfharm <- ggplot(Townhealthmaster, aes(x=all, y=selfharm, label=Mablethorpe))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Mablethorpe",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Mablethorpe"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Self Harm \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Self Harm")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioalcohol <- ggplot(Townhealthmaster, aes(x=all, y=alcohol, label=Mablethorpe))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Mablethorpe",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Mablethorpe"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Alcohol-related Harm (broad definiton) \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Alcohol")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioobese <- ggplot(Townhealthmaster, aes(x=all, y=Obesechildrenyear6per, label=Mablethorpe))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Mablethorpe",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Mablethorpe"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Obesity at Year 6 \n (%, 2015/16-2017/18)", title = "Child Obesity")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

Mablethorpe <- ggarrange(viohlef, viohlem, vioalcohol, vioselfharm, violung, vioobese,  ncol=3, nrow=2)
#ggsave("Figure28health.png", plot=Mablethorpe, width=10, height=8, dpi=600)


####violinplotsworkington####

viohlef <- ggplot(Townhealthmaster, aes(x=all, y=hlefemale, label=Workington))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Workington",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Workington"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Female, 2009-13)", title = "Female Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

viohlem <- ggplot(Townhealthmaster, aes(x=all, y=hlemale, label=Workington))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Workington",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Workington"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Male, 2009-13)", title = "Male Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

violung <- ggplot(Townhealthmaster, aes(x=all, y=lungcancer, label=Workington))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Workington",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Workington"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Incidence of Lung Cancer \n (Standardised Incidence Ratio, 2012-16)", title = "Lung Cancer")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioselfharm <- ggplot(Townhealthmaster, aes(x=all, y=selfharm, label=Workington))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Workington",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Workington"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Self Harm \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Self Harm")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioalcohol <- ggplot(Townhealthmaster, aes(x=all, y=alcohol, label=Workington))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Workington",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Workington"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Alcohol-related Harm (broad definiton) \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Alcohol")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioobese <- ggplot(Townhealthmaster, aes(x=all, y=Obesechildrenyear6per, label=Workington))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Workington",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Workington"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Obesity at Year 6 \n (%, 2015/16-2017/18)", title = "Child Obesity")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

Workington <- ggarrange(viohlef, viohlem, vioalcohol, vioselfharm, violung, vioobese,  ncol=3, nrow=2)
#ggsave("Figure29health.png", plot=Workington, width=10, height=8, dpi=600)

####violinplotsSt Ives (Cornwall)####

viohlef <- ggplot(Townhealthmaster, aes(x=all, y=hlefemale, label=StIvesCornwall))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="St Ives (Cornwall)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="St Ives (Cornwall)"), position = position_nudge(x=0.15))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Female, 2009-13)", title = "Female Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

viohlem <- ggplot(Townhealthmaster, aes(x=all, y=hlemale, label=StIvesCornwall))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="St Ives (Cornwall)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="St Ives (Cornwall)"), position = position_nudge(x=0.15))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Male, 2009-13)", title = "Male Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

violung <- ggplot(Townhealthmaster, aes(x=all, y=lungcancer, label=StIvesCornwall))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="St Ives (Cornwall)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="St Ives (Cornwall)"), position = position_nudge(x=0.15))+
  theme_light()+
  labs(x = "Density", y = "Incidence of Lung Cancer \n (Standardised Incidence Ratio, 2012-16)", title = "Lung Cancer")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioselfharm <- ggplot(Townhealthmaster, aes(x=all, y=selfharm, label=StIvesCornwall))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="St Ives (Cornwall)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="St Ives (Cornwall)"), position = position_nudge(x=0.15))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Self Harm \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Self Harm")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioalcohol <- ggplot(Townhealthmaster, aes(x=all, y=alcohol, label=StIvesCornwall))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="St Ives (Cornwall)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="St Ives (Cornwall)"), position = position_nudge(x=0.15))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Alcohol-related Harm (broad definiton) \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Alcohol")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioobese <- ggplot(Townhealthmaster, aes(x=all, y=Obesechildrenyear6per, label=StIvesCornwall))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="St Ives (Cornwall)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="St Ives (Cornwall)"), position = position_nudge(x=0.15))+
  theme_light()+
  labs(x = "Density", y = "Obesity at Year 6 \n (%, 2015/16-2017/18)", title = "Child Obesity")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

StIvesCornwall <- ggarrange(viohlef, viohlem, vioalcohol, vioselfharm, violung, vioobese,  ncol=3, nrow=2)
#ggsave("Figure30health.png", plot=StIvesCornwall, width=10, height=8, dpi=600)




####violinplotsKing's Lynn####

viohlef <- ggplot(Townhealthmaster, aes(x=all, y=hlefemale, label=KingsLynn))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="King's Lynn",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="King's Lynn"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Female, 2009-13)", title = "Female Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

viohlem <- ggplot(Townhealthmaster, aes(x=all, y=hlemale, label=KingsLynn))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="King's Lynn",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="King's Lynn"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Male, 2009-13)", title = "Male Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

violung <- ggplot(Townhealthmaster, aes(x=all, y=lungcancer, label=KingsLynn))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="King's Lynn",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="King's Lynn"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Incidence of Lung Cancer \n (Standardised Incidence Ratio, 2012-16)", title = "Lung Cancer")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioselfharm <- ggplot(Townhealthmaster, aes(x=all, y=selfharm, label=KingsLynn))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="King's Lynn",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="King's Lynn"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Self Harm \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Self Harm")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioalcohol <- ggplot(Townhealthmaster, aes(x=all, y=alcohol, label=KingsLynn))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="King's Lynn",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="King's Lynn"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Alcohol-related Harm (broad definiton) \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Alcohol")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioobese <- ggplot(Townhealthmaster, aes(x=all, y=Obesechildrenyear6per, label=KingsLynn))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="King's Lynn",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="King's Lynn"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Obesity at Year 6 \n (%, 2015/16-2017/18)", title = "Child Obesity")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

KingsLynn <- ggarrange(viohlef, viohlem, vioalcohol, vioselfharm, violung, vioobese,  ncol=3, nrow=2)
#ggsave("Figure31health.png", plot=KingsLynn, width=10, height=8, dpi=600)



####violinplotsNelson (Pendle)####

viohlef <- ggplot(Townhealthmaster, aes(x=all, y=hlefemale, label=Nelson))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Nelson (Pendle)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Nelson (Pendle)"), position = position_nudge(x=0.20))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Female, 2009-13)", title = "Female Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

viohlem <- ggplot(Townhealthmaster, aes(x=all, y=hlemale, label=Nelson))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Nelson (Pendle)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Nelson (Pendle)"), position = position_nudge(x=0.20))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Male, 2009-13)", title = "Male Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

violung <- ggplot(Townhealthmaster, aes(x=all, y=lungcancer, label=Nelson))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Nelson (Pendle)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Nelson (Pendle)"), position = position_nudge(x=0.20))+
  theme_light()+
  labs(x = "Density", y = "Incidence of Lung Cancer \n (Standardised Incidence Ratio, 2012-16)", title = "Lung Cancer")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioselfharm <- ggplot(Townhealthmaster, aes(x=all, y=selfharm, label=Nelson))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Nelson (Pendle)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Nelson (Pendle)"), position = position_nudge(x=0.20))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Self Harm \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Self Harm")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioalcohol <- ggplot(Townhealthmaster, aes(x=all, y=alcohol, label=Nelson))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Nelson (Pendle)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Nelson (Pendle)"), position = position_nudge(x=0.20))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Alcohol-related Harm (broad definiton) \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Alcohol")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioobese <- ggplot(Townhealthmaster, aes(x=all, y=Obesechildrenyear6per, label=Nelson))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Nelson (Pendle)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Nelson (Pendle)"), position = position_nudge(x=0.20))+
  theme_light()+
  labs(x = "Density", y = "Obesity at Year 6 \n (%, 2015/16-2017/18)", title = "Child Obesity")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

Nelson<- ggarrange(viohlef, viohlem, vioalcohol, vioselfharm, violung, vioobese,  ncol=3, nrow=2)
#ggsave("Figure32health.png", plot=Nelson, width=10, height=8, dpi=600)


Townhealthmaster <-Townhealthmaster %>% mutate(Jaywick = ifelse(Townhealthmaster$`Town Name`=="Jaywick", "Jaywick", ifelse(Townhealthmaster$`Town Name`=="Sidmouth", "Sidmouth", NA)))

####violinplotsJaywick and Sidmouth####

viohlef <- ggplot(Townhealthmaster, aes(x=all, y=hlefemale, label=Jaywick))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Jaywick"|Townhealthmaster$`Town Name`=="Sidmouth",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Jaywick"|Townhealthmaster$`Town Name`=="Sidmouth"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Female, 2009-13)", title = "Female Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

viohlem <- ggplot(Townhealthmaster, aes(x=all, y=hlemale, label=Jaywick))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Jaywick"|Townhealthmaster$`Town Name`=="Sidmouth",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Jaywick"|Townhealthmaster$`Town Name`=="Sidmouth"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Male, 2009-13)", title = "Male Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

violung <- ggplot(Townhealthmaster, aes(x=all, y=lungcancer, label=Jaywick))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Jaywick"|Townhealthmaster$`Town Name`=="Sidmouth",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Jaywick"|Townhealthmaster$`Town Name`=="Sidmouth"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Incidence of Lung Cancer \n (Standardised Incidence Ratio, 2012-16)", title = "Lung Cancer")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioselfharm <- ggplot(Townhealthmaster, aes(x=all, y=selfharm, label=Jaywick))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Jaywick"|Townhealthmaster$`Town Name`=="Sidmouth",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Jaywick"|Townhealthmaster$`Town Name`=="Sidmouth"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Self Harm \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Self Harm")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioalcohol <- ggplot(Townhealthmaster, aes(x=all, y=alcohol, label=Jaywick))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Jaywick"|Townhealthmaster$`Town Name`=="Sidmouth",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Jaywick"|Townhealthmaster$`Town Name`=="Sidmouth"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Alcohol-related Harm (broad definiton) \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Alcohol")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioobese <- ggplot(Townhealthmaster, aes(x=all, y=Obesechildrenyear6per, label=Jaywick))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Jaywick"|Townhealthmaster$`Town Name`=="Sidmouth",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Jaywick"|Townhealthmaster$`Town Name`=="Sidmouth"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Obesity at Year 6 \n (%, 2015/16-2017/18)", title = "Child Obesity")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

Jaywick <- ggarrange(viohlef, viohlem, vioalcohol, vioselfharm, violung, vioobese,  ncol=3, nrow=2)
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Jaywick.png", plot=Jaywick, width=14, height=8, dpi=600)

####violinplotsSale and Altrincham####

viohlef <- ggplot(Townhealthmaster, aes(x=all, y=hlefemale, label=Sale))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Sale"|Townhealthmaster$`Town Name`=="Altrincham",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Sale"|Townhealthmaster$`Town Name`=="Altrincham"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Female, 2009-13)", title = "Female Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

viohlem <- ggplot(Townhealthmaster, aes(x=all, y=hlemale, label=Sale))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Sale"|Townhealthmaster$`Town Name`=="Altrincham",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Sale"|Townhealthmaster$`Town Name`=="Altrincham"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Male, 2009-13)", title = "Male Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

violung <- ggplot(Townhealthmaster, aes(x=all, y=lungcancer, label=Sale))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Sale"|Townhealthmaster$`Town Name`=="Altrincham",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Sale"|Townhealthmaster$`Town Name`=="Altrincham"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Incidence of Lung Cancer \n (Standardised Incidence Ratio, 2012-16)", title = "Lung Cancer")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioselfharm <- ggplot(Townhealthmaster, aes(x=all, y=selfharm, label=Sale))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Sale"|Townhealthmaster$`Town Name`=="Altrincham",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Sale"|Townhealthmaster$`Town Name`=="Altrincham"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Self Harm \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Self Harm")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioalcohol <- ggplot(Townhealthmaster, aes(x=all, y=alcohol, label=Sale))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Sale"|Townhealthmaster$`Town Name`=="Altrincham",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Sale"|Townhealthmaster$`Town Name`=="Altrincham"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Alcohol-related Harm (broad definiton) \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Alcohol")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioobese <- ggplot(Townhealthmaster, aes(x=all, y=Obesechildrenyear6per, label=Sale))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Sale"|Townhealthmaster$`Town Name`=="Altrincham",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Sale"|Townhealthmaster$`Town Name`=="Altrincham"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Obesity at Year 6 \n (%, 2015/16-2017/18)", title = "Child Obesity")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

Sale <- ggarrange(viohlef, viohlem, vioalcohol, vioselfharm, violung, vioobese,  ncol=3, nrow=2)
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Sale.png", plot=Sale, width=14, height=8, dpi=600)

####violinplotsSoham and Swaffham####
Townhealthmaster <-Townhealthmaster %>% mutate(Soham = ifelse(Townhealthmaster$`Town Name`=="Soham", "Soham", ifelse(Townhealthmaster$`Town Name`=="Swaffham", "Swaffham", NA)))

viohlef <- ggplot(Townhealthmaster, aes(x=all, y=hlefemale, label=Soham))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Soham"|Townhealthmaster$`Town Name`=="Swaffham",],size=3, colour="Black", shape=21, fill="white")+
  geom_label_repel(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Soham"|Townhealthmaster$`Town Name`=="Swaffham"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Female, 2009-13)", title = "Female Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

viohlem <- ggplot(Townhealthmaster, aes(x=all, y=hlemale, label=Soham))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Soham"|Townhealthmaster$`Town Name`=="Swaffham",],size=3, colour="Black", shape=21, fill="white")+
  geom_label_repel(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Soham"|Townhealthmaster$`Town Name`=="Swaffham"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Male, 2009-13)", title = "Male Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

violung <- ggplot(Townhealthmaster, aes(x=all, y=lungcancer, label=Soham))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Soham"|Townhealthmaster$`Town Name`=="Swaffham",],size=3, colour="Black", shape=21, fill="white")+
  geom_label_repel(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Soham"|Townhealthmaster$`Town Name`=="Swaffham"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Incidence of Lung Cancer \n (Standardised Incidence Ratio, 2012-16)", title = "Lung Cancer")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioselfharm <- ggplot(Townhealthmaster, aes(x=all, y=selfharm, label=Soham))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Soham"|Townhealthmaster$`Town Name`=="Swaffham",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Soham"|Townhealthmaster$`Town Name`=="Swaffham"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Self Harm \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Self Harm")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioalcohol <- ggplot(Townhealthmaster, aes(x=all, y=alcohol, label=Soham))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Soham"|Townhealthmaster$`Town Name`=="Swaffham",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Soham"|Townhealthmaster$`Town Name`=="Swaffham"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Alcohol-related Harm (broad definiton) \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Alcohol")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioobese <- ggplot(Townhealthmaster, aes(x=all, y=Obesechildrenyear6per, label=Soham))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Soham"|Townhealthmaster$`Town Name`=="Swaffham",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Soham"|Townhealthmaster$`Town Name`=="Swaffham"), position = position_nudge(x=0.18))+
  theme_light()+
  labs(x = "Density", y = "Obesity at Year 6 \n (%, 2015/16-2017/18)", title = "Child Obesity")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

Soham <- ggarrange(viohlef, viohlem, vioalcohol, vioselfharm, violung, vioobese,  ncol=3, nrow=2)
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Soham.png", plot=Soham, width=14, height=8, dpi=600)

####violinplotsWednesbury and Tipton####
Townhealthmaster <-Townhealthmaster %>% mutate(Wednesbury = ifelse(Townhealthmaster$`Town Name`=="Wednesbury", "Wednesbury", ifelse(Townhealthmaster$`Town Name`=="Tipton", "Tipton",ifelse(Townhealthmaster$`Town Name`=="West Bromwich", "West Bromwich",ifelse(Townhealthmaster$`Town Name`=="Bilston", "Bilston",ifelse(Townhealthmaster$`Town Name`=="Dudley (Dudley)", "Dudley", NA))))))

viohlef <- ggplot(Townhealthmaster, aes(x=all, y=hlefemale, label=Wednesbury))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Wednesbury"|Townhealthmaster$`Town Name`=="Tipton"|Townhealthmaster$`Town Name`=="Dudley (Dudley)"|Townhealthmaster$`Town Name`=="Bilston"|Townhealthmaster$`Town Name`=="West Bromwich",],size=3, colour="Black", shape=21, fill="white")+
  geom_label_repel(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Wednesbury"|Townhealthmaster$`Town Name`=="Tipton"|Townhealthmaster$`Town Name`=="Dudley (Dudley)"|Townhealthmaster$`Town Name`=="Bilston"|Townhealthmaster$`Town Name`=="West Bromwich"), alpha=0.5)+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Female, 2009-13)", title = "Female Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

viohlem <- ggplot(Townhealthmaster, aes(x=all, y=hlemale, label=Wednesbury))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Wednesbury"|Townhealthmaster$`Town Name`=="Tipton"|Townhealthmaster$`Town Name`=="Dudley (Dudley)"|Townhealthmaster$`Town Name`=="Bilston"|Townhealthmaster$`Town Name`=="West Bromwich",],size=3, colour="Black", shape=21, fill="white")+
  geom_label_repel(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Wednesbury"|Townhealthmaster$`Town Name`=="Tipton"|Townhealthmaster$`Town Name`=="Dudley (Dudley)"|Townhealthmaster$`Town Name`=="Bilston"|Townhealthmaster$`Town Name`=="West Bromwich"),  alpha=0.5)+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Male, 2009-13)", title = "Male Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

violung <- ggplot(Townhealthmaster, aes(x=all, y=lungcancer, label=Wednesbury))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Wednesbury"|Townhealthmaster$`Town Name`=="Tipton"|Townhealthmaster$`Town Name`=="Dudley (Dudley)"|Townhealthmaster$`Town Name`=="Bilston"|Townhealthmaster$`Town Name`=="West Bromwich",],size=3, colour="Black", shape=21, fill="white")+
  geom_label_repel(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Wednesbury"|Townhealthmaster$`Town Name`=="Tipton"|Townhealthmaster$`Town Name`=="Dudley (Dudley)"|Townhealthmaster$`Town Name`=="Bilston"|Townhealthmaster$`Town Name`=="West Bromwich"),  alpha=0.5)+
  theme_light()+
  labs(x = "Density", y = "Incidence of Lung Cancer \n (Standardised Incidence Ratio, 2012-16)", title = "Lung Cancer")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioselfharm <- ggplot(Townhealthmaster, aes(x=all, y=selfharm, label=Wednesbury))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Wednesbury"|Townhealthmaster$`Town Name`=="Tipton"|Townhealthmaster$`Town Name`=="Dudley (Dudley)"|Townhealthmaster$`Town Name`=="Bilston"|Townhealthmaster$`Town Name`=="West Bromwich",],size=3, colour="Black", shape=21, fill="white")+
  geom_label_repel(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Wednesbury"|Townhealthmaster$`Town Name`=="Tipton"|Townhealthmaster$`Town Name`=="Dudley (Dudley)"|Townhealthmaster$`Town Name`=="Bilston"|Townhealthmaster$`Town Name`=="West Bromwich"),  alpha=0.5)+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Self Harm \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Self Harm")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioalcohol <- ggplot(Townhealthmaster, aes(x=all, y=alcohol, label=Wednesbury))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Wednesbury"|Townhealthmaster$`Town Name`=="Tipton"|Townhealthmaster$`Town Name`=="Dudley (Dudley)"|Townhealthmaster$`Town Name`=="Bilston"|Townhealthmaster$`Town Name`=="West Bromwich",],size=3, colour="Black", shape=21, fill="white")+
  geom_label_repel(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Wednesbury"|Townhealthmaster$`Town Name`=="Tipton"|Townhealthmaster$`Town Name`=="Dudley (Dudley)"|Townhealthmaster$`Town Name`=="Bilston"|Townhealthmaster$`Town Name`=="West Bromwich"),  alpha=0.5)+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Alcohol-related Harm (broad definiton) \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Alcohol")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioobese <- ggplot(Townhealthmaster, aes(x=all, y=Obesechildrenyear6per, label=Wednesbury))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Wednesbury"|Townhealthmaster$`Town Name`=="Tipton"|Townhealthmaster$`Town Name`=="Dudley (Dudley)"|Townhealthmaster$`Town Name`=="Bilston"|Townhealthmaster$`Town Name`=="West Bromwich",],size=3, colour="Black", shape=21, fill="white")+
  geom_label_repel(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Wednesbury"|Townhealthmaster$`Town Name`=="Tipton"|Townhealthmaster$`Town Name`=="Dudley (Dudley)"|Townhealthmaster$`Town Name`=="Bilston"|Townhealthmaster$`Town Name`=="West Bromwich"))+
  theme_light()+
  labs(x = "Density", y = "Obesity at Year 6 \n (%, 2015/16-2017/18)", title = "Child Obesity")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "vioobese.png", plot=vioobese, width=7, height=10, dpi=600)

Wednesbury <- ggarrange(viohlef, viohlem, vioalcohol, vioselfharm, violung, vioobese,  ncol=3, nrow=2)
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Wednesbury.png", plot=Wednesbury, width=14, height=8, dpi=600)


###sii and rii slope or relative index of inequality####
# 
# Townhealthmaster$group=1
# 
# siieffortone <- Townhealthmaster %>% 
#   phe_sii(quantile = Townhealthmaster$imdrank,
#           population = Townhealthmaster$lsoa18popbestfit,
#           value = Townhealthmaster$Obesechildrenyear6per,
#           value_type = 0,
#           lower_cl = Townhealthmaster$lower95yr6obesity,
#           upper_cl = Townhealthmaster$upper95yr6obesity,
#           rii=TRUE)
# 
# siieffortone <- phe_sii(data = Townhealthmasters,
#                         quantile = imdrank,
#           population = lsoa18popbestfit,
#           value = Obesechildrenyear6per,
#           value_type = 0,
#           lower_cl = lower95yr6obesity,
#           upper_cl = upper95yr6obesity,
#           rii=TRUE)
# 
# 
# Townhealthmasters <- phe_quantile(Townhealthmaster, imdrank)
# 
# 
# siieffortone <- phe_sii(data = Townhealthmasters,
#                         quantile = quantile,
#                         population = lsoa18popbestfit,
#                         value = Obesechildrenyear6per,
#                         value_type = 0,
#                         lower_cl = lower95yr6obesity,
#                         upper_cl = upper95yr6obesity,
#                         rii=TRUE)


siiobesity <- lm(Obesechildrenyear6per~imdrank, data=Townhealthmaster)
coeffs <- coefficients(siiobesity)
siiobesityies = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1108)

siiobesityrep <- lm(Obesechildrenreceptionper~imdrank, data=Townhealthmaster)
coeffs <- coefficients(siiobesityrep)
siiobesityrep = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)

siiselfharm <- lm(selfharm~imdrank, data=Townhealthmaster)
coeffs <- coefficients(siiselfharm)
siiselfharm = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)

siialcohol <- lm(alcohol~imdrank, data=Townhealthmaster)
coeffs <- coefficients(siialcohol)
siialcohol = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)

siilef <- lm(lefemale~imdrank, data=Townhealthmaster)
coeffs <- coefficients(siilef)
siilef = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)

siilem <- lm(lemale~imdrank, data=Townhealthmaster)
coeffs <- coefficients(siilem)
siilem = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)

siihlef <- lm(hlefemale~imdrank, data=Townhealthmaster)
coeffs <- coefficients(siihlef)
siihlef = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1108)

siihlem <- lm(hlemale~imdrank, data=Townhealthmaster)
coeffs <- coefficients(siihlem)
siihlem = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1108)

siilunccancer <- lm(lungcancer~imdrank, data=Townhealthmaster)
coeffs <- coefficients(siilunccancer)
siilunccancer = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)

siiperverygoodhealth <- lm(perverygoodhealth~imdrank, data=Townhealthmaster)
coeffs <- coefficients(siiperverygoodhealth)
siiperverygoodhealth = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)

siiperverybadhealth <- lm(perverybadhealth~imdrank, data=Townhealthmaster)
coeffs <- coefficients(siiperverybadhealth)
siiperverybadhealth = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)


####rii####
riilungcancer <- siilunccancer/mean(Townhealthmaster$lungcancer)
riipervbad <- siiperverybadhealth/mean(Townhealthmaster$perverybadhealth)
riipervgood <- siiperverygoodhealth/mean(Townhealthmaster$perverygoodhealth)
riiselfharm <- siiselfharm/mean(Townhealthmaster$selfharm)
riialcohol <- siialcohol/mean(Townhealthmaster$alcohol)
riilem <- siilem/mean(Townhealthmaster$lem)
riilef <- siilef/mean(Townhealthmaster$lef)
riihlem <- siihlem/mean(Townhealthmaster$hlem)
riihlef <- siihlef/mean(Townhealthmaster$hlef)
riiobysity6 <- siiobesityies/mean(Townhealthmaster$Obesechildrenyear6per)
yep <- Townhealthmaster[complete.cases(Townhealthmaster$Obesechildrenreceptionper), ]

riiobesityrep <- siiobesityrep/mean(yep$Obesechildrenreceptionper)

####longitudinal data ####

library(fingertipsR) ; library(tidyverse) ; library(stringr) ; library(ggplot2)

indicators <- indicators()



####violinplotsBlyth####

viohlef <- ggplot(Townhealthmaster, aes(x=all, y=hlefemale, label=Blyth))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Blyth (Northumberland)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Blyth (Northumberland)"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Female, 2009-13)", title = "Female Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

viohlem <- ggplot(Townhealthmaster, aes(x=all, y=hlemale, label=Blyth))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Blyth (Northumberland)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Blyth (Northumberland)"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Healthy Life Expectancy at Birth \n (Male, 2009-13)", title = "Male Healthy Life Expectancy")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

violung <- ggplot(Townhealthmaster, aes(x=all, y=lungcancer, label=Blyth))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Blyth (Northumberland)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Blyth (Northumberland)"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Incidence of Lung Cancer \n (Standardised Incidence Ratio, 2012-16)", title = "Lung Cancer")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioselfharm <- ggplot(Townhealthmaster, aes(x=all, y=selfharm, label=Blyth))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Blyth (Northumberland)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Blyth (Northumberland)"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Self Harm \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Self Harm")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioalcohol <- ggplot(Townhealthmaster, aes(x=all, y=alcohol, label=Blyth))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Blyth (Northumberland)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Blyth (Northumberland)"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Hospital Stays for Alcohol-related Harm (broad definiton) \n (Standardised Admission Ratio, 2013/14-2017/18)", title = "Alcohol")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

vioobese <- ggplot(Townhealthmaster, aes(x=all, y=Obesechildrenyear6per, label=Blyth))+
  geom_violin(trim=FALSE, fill = "seagreen")+
  geom_boxplot(width=0.1, outlier.shape = NA, fill="seagreen2")+
  geom_point(data=Townhealthmaster[Townhealthmaster$`Town Name`=="Blyth (Northumberland)",],size=3, colour="Black", shape=21, fill="white")+
  geom_label(data = Townhealthmaster %>% filter(Townhealthmaster$`Town Name`=="Blyth (Northumberland)"), position = position_nudge(x=0.25))+
  theme_light()+
  labs(x = "Density", y = "Obesity at Year 6 \n (%, 2015/16-2017/18)", title = "Child Obesity")+
  theme(panel.grid = element_blank(), panel.background = element_blank(), axis.ticks.y = element_blank(), axis.text.x = element_blank() )

Blyth <- ggarrange(viohlef, viohlem, vioalcohol, vioselfharm, violung, vioobese,  ncol=3, nrow=2)
#ggsave("Blyth.png", plot=Blyth, width=10, height=8, dpi=600)


####PRESCRIPTION DATA####

# prescribe201911 <- read_csv("H:/prescription data/T201911PDPI BNFT.csv")
# prescribe201911$drugcode <- parse_number(prescribe201911$`BNF CODE`)
# prescribe201911$drugcode <- substr(prescribe201911$drugcode, 0, 6)
# antidep201911 <- prescribe201911[which(prescribe201911$drugcode>=403000&prescribe201911$drugcode<404000),]
# obesedrugs201911 <- prescribe201911[which(prescribe201911$drugcode>=405000&prescribe201911$drugcode<406000),]
# allsubstancedep201911 <- prescribe201911[which(prescribe201911$drugcode>=410000&prescribe201911$drugcode<411000),]
# alcoholdep201911 <- prescribe201911[which(prescribe201911$drugcode>=410010&prescribe201911$drugcode<410020),]
# nicotinedep201911 <- prescribe201911[which(prescribe201911$drugcode>=410020&prescribe201911$drugcode<410030),]
# opioddep201911 <- prescribe201911[which(prescribe201911$drugcode>=410030&prescribe201911$drugcode<411000),]
# bronchodilators201911 <- prescribe201911[which(prescribe201911$drugcode>=310000&prescribe201911$drugcode<320000),]
# dementia201911 <- prescribe201911[which(prescribe201911$drugcode>=411000&prescribe201911$drugcode<500000),]
# diabetes201911 <- prescribe201911[which(prescribe201911$drugcode>=601000&prescribe201911$drugcode<602000),]
# 
# antidep201911 <- aggregate(antidep201911[-c(1:5, 11)], antidep201911["PRACTICE"], sum)
# antidep201911$PERIOD <- 201911
# antidep201911$Druggroup <- "Antidepressant"
# dementia201911 <- aggregate(dementia201911[-c(1:5, 11)], dementia201911["PRACTICE"], sum)
# dementia201911$PERIOD <- 201911
# dementia201911$Druggroup <- "Dementia"
# diabetes201911 <- aggregate(diabetes201911[-c(1:5, 11)], diabetes201911["PRACTICE"], sum)
# diabetes201911$PERIOD <- 201911
# diabetes201911$Druggroup <- "Diabetes"
# 
# bronchodilators201911 <- aggregate(bronchodilators201911[-c(1:5, 11)], bronchodilators201911["PRACTICE"], sum)
# bronchodilators201911$PERIOD <- 201911
# bronchodilators201911$Druggroup <- "Bronchodilators"
# opioddep201911 <- aggregate(opioddep201911[-c(1:5, 11)], opioddep201911["PRACTICE"], sum)
# opioddep201911$PERIOD <- 201911
# opioddep201911$Druggroup <- "Opiod"
# nicotinedep201911 <- aggregate(nicotinedep201911[-c(1:5, 11)], nicotinedep201911["PRACTICE"], sum)
# nicotinedep201911$PERIOD <- 201911
# nicotinedep201911$Druggroup <- "Nicotine"
# alcoholdep201911 <- aggregate(alcoholdep201911[-c(1:5, 11)], alcoholdep201911["PRACTICE"], sum)
# alcoholdep201911$PERIOD <- 201911
# alcoholdep201911$Druggroup <- "Alcohol"
# allsubstancedep201911 <- aggregate(allsubstancedep201911[-c(1:5, 11)], allsubstancedep201911["PRACTICE"], sum)
# allsubstancedep201911$PERIOD <- 201911
# allsubstancedep201911$Druggroup <- "SubstanceDep"
# obesedrugs201911 <- aggregate(obesedrugs201911[-c(1:5, 11)], obesedrugs201911["PRACTICE"], sum)
# obesedrugs201911$PERIOD <- 201911
# obesedrugs201911$Druggroup <- "Obesity"
# 
# prescribemaster201911 <- do.call("rbind", list(obesedrugs201911, allsubstancedep201911, alcoholdep201911, 
#                                          nicotinedep201911,opioddep201911, bronchodilators201911,
#                                          antidep201911, diabetes201911, dementia201911))
# 
# 
# write.csv(prescribemaster201911, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201911.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201912 <- read_csv("H:/prescription data/T201912PDPI BNFT.csv")
# prescribe201912$drugcode <- parse_number(prescribe201912$`BNF CODE`)
# prescribe201912$drugcode <- substr(prescribe201912$drugcode, 0, 6)
# antidep201912 <- prescribe201912[which(prescribe201912$drugcode>=403000&prescribe201912$drugcode<404000),]
# obesedrugs201912 <- prescribe201912[which(prescribe201912$drugcode>=405000&prescribe201912$drugcode<406000),]
# allsubstancedep201912 <- prescribe201912[which(prescribe201912$drugcode>=410000&prescribe201912$drugcode<411000),]
# alcoholdep201912 <- prescribe201912[which(prescribe201912$drugcode>=410010&prescribe201912$drugcode<410020),]
# nicotinedep201912 <- prescribe201912[which(prescribe201912$drugcode>=410020&prescribe201912$drugcode<410030),]
# opioddep201912 <- prescribe201912[which(prescribe201912$drugcode>=410030&prescribe201912$drugcode<411000),]
# bronchodilators201912 <- prescribe201912[which(prescribe201912$drugcode>=310000&prescribe201912$drugcode<320000),]
# dementia201912 <- prescribe201912[which(prescribe201912$drugcode>=411000&prescribe201912$drugcode<500000),]
# diabetes201912 <- prescribe201912[which(prescribe201912$drugcode>=601000&prescribe201912$drugcode<602000),]
# 
# antidep201912 <- aggregate(antidep201912[-c(1:5, 11)], antidep201912["PRACTICE"], sum)
# antidep201912$PERIOD <- 201912
# antidep201912$Druggroup <- "Antidepressant"
# dementia201912 <- aggregate(dementia201912[-c(1:5, 11)], dementia201912["PRACTICE"], sum)
# dementia201912$PERIOD <- 201912
# dementia201912$Druggroup <- "Dementia"
# diabetes201912 <- aggregate(diabetes201912[-c(1:5, 11)], diabetes201912["PRACTICE"], sum)
# diabetes201912$PERIOD <- 201912
# diabetes201912$Druggroup <- "Diabetes"
# 
# bronchodilators201912 <- aggregate(bronchodilators201912[-c(1:5, 11)], bronchodilators201912["PRACTICE"], sum)
# bronchodilators201912$PERIOD <- 201912
# bronchodilators201912$Druggroup <- "Bronchodilators"
# opioddep201912 <- aggregate(opioddep201912[-c(1:5, 11)], opioddep201912["PRACTICE"], sum)
# opioddep201912$PERIOD <- 201912
# opioddep201912$Druggroup <- "Opiod"
# nicotinedep201912 <- aggregate(nicotinedep201912[-c(1:5, 11)], nicotinedep201912["PRACTICE"], sum)
# nicotinedep201912$PERIOD <- 201912
# nicotinedep201912$Druggroup <- "Nicotine"
# alcoholdep201912 <- aggregate(alcoholdep201912[-c(1:5, 11)], alcoholdep201912["PRACTICE"], sum)
# alcoholdep201912$PERIOD <- 201912
# alcoholdep201912$Druggroup <- "Alcohol"
# allsubstancedep201912 <- aggregate(allsubstancedep201912[-c(1:5, 11)], allsubstancedep201912["PRACTICE"], sum)
# allsubstancedep201912$PERIOD <- 201912
# allsubstancedep201912$Druggroup <- "SubstanceDep"
# obesedrugs201912 <- aggregate(obesedrugs201912[-c(1:5, 11)], obesedrugs201912["PRACTICE"], sum)
# obesedrugs201912$PERIOD <- 201912
# obesedrugs201912$Druggroup <- "Obesity"
# 
# prescribemaster201912 <- do.call("rbind", list(obesedrugs201912, allsubstancedep201912, alcoholdep201912, 
#                                                nicotinedep201912,opioddep201912, bronchodilators201912,
#                                                antidep201912, diabetes201912, dementia201912))
# 
# 
# write.csv(prescribemaster201912, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201912.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201910 <- read_csv("H:/prescription data/T201910PDPI BNFT.csv")
# prescribe201910$drugcode <- parse_number(prescribe201910$`BNF CODE`)
# prescribe201910$drugcode <- substr(prescribe201910$drugcode, 0, 6)
# antidep201910 <- prescribe201910[which(prescribe201910$drugcode>=403000&prescribe201910$drugcode<404000),]
# obesedrugs201910 <- prescribe201910[which(prescribe201910$drugcode>=405000&prescribe201910$drugcode<406000),]
# allsubstancedep201910 <- prescribe201910[which(prescribe201910$drugcode>=410000&prescribe201910$drugcode<411000),]
# alcoholdep201910 <- prescribe201910[which(prescribe201910$drugcode>=410010&prescribe201910$drugcode<410020),]
# nicotinedep201910 <- prescribe201910[which(prescribe201910$drugcode>=410020&prescribe201910$drugcode<410030),]
# opioddep201910 <- prescribe201910[which(prescribe201910$drugcode>=410030&prescribe201910$drugcode<411000),]
# bronchodilators201910 <- prescribe201910[which(prescribe201910$drugcode>=310000&prescribe201910$drugcode<320000),]
# dementia201910 <- prescribe201910[which(prescribe201910$drugcode>=411000&prescribe201910$drugcode<500000),]
# diabetes201910 <- prescribe201910[which(prescribe201910$drugcode>=601000&prescribe201910$drugcode<602000),]
# 
# antidep201910 <- aggregate(antidep201910[-c(1:5, 11)], antidep201910["PRACTICE"], sum)
# antidep201910$PERIOD <- 201910
# antidep201910$Druggroup <- "Antidepressant"
# dementia201910 <- aggregate(dementia201910[-c(1:5, 11)], dementia201910["PRACTICE"], sum)
# dementia201910$PERIOD <- 201910
# dementia201910$Druggroup <- "Dementia"
# diabetes201910 <- aggregate(diabetes201910[-c(1:5, 11)], diabetes201910["PRACTICE"], sum)
# diabetes201910$PERIOD <- 201910
# diabetes201910$Druggroup <- "Diabetes"
# 
# bronchodilators201910 <- aggregate(bronchodilators201910[-c(1:5, 11)], bronchodilators201910["PRACTICE"], sum)
# bronchodilators201910$PERIOD <- 201910
# bronchodilators201910$Druggroup <- "Bronchodilators"
# opioddep201910 <- aggregate(opioddep201910[-c(1:5, 11)], opioddep201910["PRACTICE"], sum)
# opioddep201910$PERIOD <- 201910
# opioddep201910$Druggroup <- "Opiod"
# nicotinedep201910 <- aggregate(nicotinedep201910[-c(1:5, 11)], nicotinedep201910["PRACTICE"], sum)
# nicotinedep201910$PERIOD <- 201910
# nicotinedep201910$Druggroup <- "Nicotine"
# alcoholdep201910 <- aggregate(alcoholdep201910[-c(1:5, 11)], alcoholdep201910["PRACTICE"], sum)
# alcoholdep201910$PERIOD <- 201910
# alcoholdep201910$Druggroup <- "Alcohol"
# allsubstancedep201910 <- aggregate(allsubstancedep201910[-c(1:5, 11)], allsubstancedep201910["PRACTICE"], sum)
# allsubstancedep201910$PERIOD <- 201910
# allsubstancedep201910$Druggroup <- "SubstanceDep"
# obesedrugs201910 <- aggregate(obesedrugs201910[-c(1:5, 11)], obesedrugs201910["PRACTICE"], sum)
# obesedrugs201910$PERIOD <- 201910
# obesedrugs201910$Druggroup <- "Obesity"
# 
# prescribemaster201910 <- do.call("rbind", list(obesedrugs201910, allsubstancedep201910, alcoholdep201910, 
#                                                nicotinedep201910,opioddep201910, bronchodilators201910,
#                                                antidep201910, diabetes201910, dementia201910))
# 
# 
# write.csv(prescribemaster201910, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201910.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201909 <- read_csv("H:/prescription data/T201909PDPI BNFT.csv")
# prescribe201909$drugcode <- parse_number(prescribe201909$`BNF CODE`)
# prescribe201909$drugcode <- substr(prescribe201909$drugcode, 0, 6)
# antidep201909 <- prescribe201909[which(prescribe201909$drugcode>=403000&prescribe201909$drugcode<404000),]
# obesedrugs201909 <- prescribe201909[which(prescribe201909$drugcode>=405000&prescribe201909$drugcode<406000),]
# allsubstancedep201909 <- prescribe201909[which(prescribe201909$drugcode>=410000&prescribe201909$drugcode<411000),]
# alcoholdep201909 <- prescribe201909[which(prescribe201909$drugcode>=410010&prescribe201909$drugcode<410020),]
# nicotinedep201909 <- prescribe201909[which(prescribe201909$drugcode>=410020&prescribe201909$drugcode<410030),]
# opioddep201909 <- prescribe201909[which(prescribe201909$drugcode>=410030&prescribe201909$drugcode<411000),]
# bronchodilators201909 <- prescribe201909[which(prescribe201909$drugcode>=310000&prescribe201909$drugcode<320000),]
# dementia201909 <- prescribe201909[which(prescribe201909$drugcode>=411000&prescribe201909$drugcode<500000),]
# diabetes201909 <- prescribe201909[which(prescribe201909$drugcode>=601000&prescribe201909$drugcode<602000),]
# 
# antidep201909 <- aggregate(antidep201909[-c(1:5, 11)], antidep201909["PRACTICE"], sum)
# antidep201909$PERIOD <- 201909
# antidep201909$Druggroup <- "Antidepressant"
# dementia201909 <- aggregate(dementia201909[-c(1:5, 11)], dementia201909["PRACTICE"], sum)
# dementia201909$PERIOD <- 201909
# dementia201909$Druggroup <- "Dementia"
# diabetes201909 <- aggregate(diabetes201909[-c(1:5, 11)], diabetes201909["PRACTICE"], sum)
# diabetes201909$PERIOD <- 201909
# diabetes201909$Druggroup <- "Diabetes"
# 
# bronchodilators201909 <- aggregate(bronchodilators201909[-c(1:5, 11)], bronchodilators201909["PRACTICE"], sum)
# bronchodilators201909$PERIOD <- 201909
# bronchodilators201909$Druggroup <- "Bronchodilators"
# opioddep201909 <- aggregate(opioddep201909[-c(1:5, 11)], opioddep201909["PRACTICE"], sum)
# opioddep201909$PERIOD <- 201909
# opioddep201909$Druggroup <- "Opiod"
# nicotinedep201909 <- aggregate(nicotinedep201909[-c(1:5, 11)], nicotinedep201909["PRACTICE"], sum)
# nicotinedep201909$PERIOD <- 201909
# nicotinedep201909$Druggroup <- "Nicotine"
# alcoholdep201909 <- aggregate(alcoholdep201909[-c(1:5, 11)], alcoholdep201909["PRACTICE"], sum)
# alcoholdep201909$PERIOD <- 201909
# alcoholdep201909$Druggroup <- "Alcohol"
# allsubstancedep201909 <- aggregate(allsubstancedep201909[-c(1:5, 11)], allsubstancedep201909["PRACTICE"], sum)
# allsubstancedep201909$PERIOD <- 201909
# allsubstancedep201909$Druggroup <- "SubstanceDep"
# obesedrugs201909 <- aggregate(obesedrugs201909[-c(1:5, 11)], obesedrugs201909["PRACTICE"], sum)
# obesedrugs201909$PERIOD <- 201909
# obesedrugs201909$Druggroup <- "Obesity"
# 
# prescribemaster201909 <- do.call("rbind", list(obesedrugs201909, allsubstancedep201909, alcoholdep201909, 
#                                                nicotinedep201909,opioddep201909, bronchodilators201909,
#                                                antidep201909, diabetes201909, dementia201909))
# 
# 
# write.csv(prescribemaster201909, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201909.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201908 <- read_csv("H:/prescription data/T201908PDPI BNFT.csv")
# prescribe201908$drugcode <- parse_number(prescribe201908$`BNF CODE`)
# prescribe201908$drugcode <- substr(prescribe201908$drugcode, 0, 6)
# antidep201908 <- prescribe201908[which(prescribe201908$drugcode>=403000&prescribe201908$drugcode<404000),]
# obesedrugs201908 <- prescribe201908[which(prescribe201908$drugcode>=405000&prescribe201908$drugcode<406000),]
# allsubstancedep201908 <- prescribe201908[which(prescribe201908$drugcode>=410000&prescribe201908$drugcode<411000),]
# alcoholdep201908 <- prescribe201908[which(prescribe201908$drugcode>=410010&prescribe201908$drugcode<410020),]
# nicotinedep201908 <- prescribe201908[which(prescribe201908$drugcode>=410020&prescribe201908$drugcode<410030),]
# opioddep201908 <- prescribe201908[which(prescribe201908$drugcode>=410030&prescribe201908$drugcode<411000),]
# bronchodilators201908 <- prescribe201908[which(prescribe201908$drugcode>=310000&prescribe201908$drugcode<320000),]
# dementia201908 <- prescribe201908[which(prescribe201908$drugcode>=411000&prescribe201908$drugcode<500000),]
# diabetes201908 <- prescribe201908[which(prescribe201908$drugcode>=601000&prescribe201908$drugcode<602000),]
# 
# antidep201908 <- aggregate(antidep201908[-c(1:5, 11)], antidep201908["PRACTICE"], sum)
# antidep201908$PERIOD <- 201908
# antidep201908$Druggroup <- "Antidepressant"
# dementia201908 <- aggregate(dementia201908[-c(1:5, 11)], dementia201908["PRACTICE"], sum)
# dementia201908$PERIOD <- 201908
# dementia201908$Druggroup <- "Dementia"
# diabetes201908 <- aggregate(diabetes201908[-c(1:5, 11)], diabetes201908["PRACTICE"], sum)
# diabetes201908$PERIOD <- 201908
# diabetes201908$Druggroup <- "Diabetes"
# 
# bronchodilators201908 <- aggregate(bronchodilators201908[-c(1:5, 11)], bronchodilators201908["PRACTICE"], sum)
# bronchodilators201908$PERIOD <- 201908
# bronchodilators201908$Druggroup <- "Bronchodilators"
# opioddep201908 <- aggregate(opioddep201908[-c(1:5, 11)], opioddep201908["PRACTICE"], sum)
# opioddep201908$PERIOD <- 201908
# opioddep201908$Druggroup <- "Opiod"
# nicotinedep201908 <- aggregate(nicotinedep201908[-c(1:5, 11)], nicotinedep201908["PRACTICE"], sum)
# nicotinedep201908$PERIOD <- 201908
# nicotinedep201908$Druggroup <- "Nicotine"
# alcoholdep201908 <- aggregate(alcoholdep201908[-c(1:5, 11)], alcoholdep201908["PRACTICE"], sum)
# alcoholdep201908$PERIOD <- 201908
# alcoholdep201908$Druggroup <- "Alcohol"
# allsubstancedep201908 <- aggregate(allsubstancedep201908[-c(1:5, 11)], allsubstancedep201908["PRACTICE"], sum)
# allsubstancedep201908$PERIOD <- 201908
# allsubstancedep201908$Druggroup <- "SubstanceDep"
# obesedrugs201908 <- aggregate(obesedrugs201908[-c(1:5, 11)], obesedrugs201908["PRACTICE"], sum)
# obesedrugs201908$PERIOD <- 201908
# obesedrugs201908$Druggroup <- "Obesity"
# 
# prescribemaster201908 <- do.call("rbind", list(obesedrugs201908, allsubstancedep201908, alcoholdep201908, 
#                                                nicotinedep201908,opioddep201908, bronchodilators201908,
#                                                antidep201908, diabetes201908, dementia201908))
# 
# 
# write.csv(prescribemaster201908, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201908.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201907 <- read_csv("H:/prescription data/T201907PDPI BNFT.csv")
# prescribe201907$drugcode <- parse_number(prescribe201907$`BNF CODE`)
# prescribe201907$drugcode <- substr(prescribe201907$drugcode, 0, 6)
# antidep201907 <- prescribe201907[which(prescribe201907$drugcode>=403000&prescribe201907$drugcode<404000),]
# obesedrugs201907 <- prescribe201907[which(prescribe201907$drugcode>=405000&prescribe201907$drugcode<406000),]
# allsubstancedep201907 <- prescribe201907[which(prescribe201907$drugcode>=410000&prescribe201907$drugcode<411000),]
# alcoholdep201907 <- prescribe201907[which(prescribe201907$drugcode>=410010&prescribe201907$drugcode<410020),]
# nicotinedep201907 <- prescribe201907[which(prescribe201907$drugcode>=410020&prescribe201907$drugcode<410030),]
# opioddep201907 <- prescribe201907[which(prescribe201907$drugcode>=410030&prescribe201907$drugcode<411000),]
# bronchodilators201907 <- prescribe201907[which(prescribe201907$drugcode>=310000&prescribe201907$drugcode<320000),]
# dementia201907 <- prescribe201907[which(prescribe201907$drugcode>=411000&prescribe201907$drugcode<500000),]
# diabetes201907 <- prescribe201907[which(prescribe201907$drugcode>=601000&prescribe201907$drugcode<602000),]
# 
# antidep201907 <- aggregate(antidep201907[-c(1:5, 11)], antidep201907["PRACTICE"], sum)
# antidep201907$PERIOD <- 201907
# antidep201907$Druggroup <- "Antidepressant"
# dementia201907 <- aggregate(dementia201907[-c(1:5, 11)], dementia201907["PRACTICE"], sum)
# dementia201907$PERIOD <- 201907
# dementia201907$Druggroup <- "Dementia"
# diabetes201907 <- aggregate(diabetes201907[-c(1:5, 11)], diabetes201907["PRACTICE"], sum)
# diabetes201907$PERIOD <- 201907
# diabetes201907$Druggroup <- "Diabetes"
# 
# bronchodilators201907 <- aggregate(bronchodilators201907[-c(1:5, 11)], bronchodilators201907["PRACTICE"], sum)
# bronchodilators201907$PERIOD <- 201907
# bronchodilators201907$Druggroup <- "Bronchodilators"
# opioddep201907 <- aggregate(opioddep201907[-c(1:5, 11)], opioddep201907["PRACTICE"], sum)
# opioddep201907$PERIOD <- 201907
# opioddep201907$Druggroup <- "Opiod"
# nicotinedep201907 <- aggregate(nicotinedep201907[-c(1:5, 11)], nicotinedep201907["PRACTICE"], sum)
# nicotinedep201907$PERIOD <- 201907
# nicotinedep201907$Druggroup <- "Nicotine"
# alcoholdep201907 <- aggregate(alcoholdep201907[-c(1:5, 11)], alcoholdep201907["PRACTICE"], sum)
# alcoholdep201907$PERIOD <- 201907
# alcoholdep201907$Druggroup <- "Alcohol"
# allsubstancedep201907 <- aggregate(allsubstancedep201907[-c(1:5, 11)], allsubstancedep201907["PRACTICE"], sum)
# allsubstancedep201907$PERIOD <- 201907
# allsubstancedep201907$Druggroup <- "SubstanceDep"
# obesedrugs201907 <- aggregate(obesedrugs201907[-c(1:5, 11)], obesedrugs201907["PRACTICE"], sum)
# obesedrugs201907$PERIOD <- 201907
# obesedrugs201907$Druggroup <- "Obesity"
# 
# prescribemaster201907 <- do.call("rbind", list(obesedrugs201907, allsubstancedep201907, alcoholdep201907, 
#                                                nicotinedep201907,opioddep201907, bronchodilators201907,
#                                                antidep201907, diabetes201907, dementia201907))
# 
# 
# write.csv(prescribemaster201907, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201907.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201906 <- read_csv("H:/prescription data/T201906PDPI BNFT.csv")
# prescribe201906$drugcode <- parse_number(prescribe201906$`BNF CODE`)
# prescribe201906$drugcode <- substr(prescribe201906$drugcode, 0, 6)
# antidep201906 <- prescribe201906[which(prescribe201906$drugcode>=403000&prescribe201906$drugcode<404000),]
# obesedrugs201906 <- prescribe201906[which(prescribe201906$drugcode>=405000&prescribe201906$drugcode<406000),]
# allsubstancedep201906 <- prescribe201906[which(prescribe201906$drugcode>=410000&prescribe201906$drugcode<411000),]
# alcoholdep201906 <- prescribe201906[which(prescribe201906$drugcode>=410010&prescribe201906$drugcode<410020),]
# nicotinedep201906 <- prescribe201906[which(prescribe201906$drugcode>=410020&prescribe201906$drugcode<410030),]
# opioddep201906 <- prescribe201906[which(prescribe201906$drugcode>=410030&prescribe201906$drugcode<411000),]
# bronchodilators201906 <- prescribe201906[which(prescribe201906$drugcode>=310000&prescribe201906$drugcode<320000),]
# dementia201906 <- prescribe201906[which(prescribe201906$drugcode>=411000&prescribe201906$drugcode<500000),]
# diabetes201906 <- prescribe201906[which(prescribe201906$drugcode>=601000&prescribe201906$drugcode<602000),]
# 
# antidep201906 <- aggregate(antidep201906[-c(1:5, 11)], antidep201906["PRACTICE"], sum)
# antidep201906$PERIOD <- 201906
# antidep201906$Druggroup <- "Antidepressant"
# dementia201906 <- aggregate(dementia201906[-c(1:5, 11)], dementia201906["PRACTICE"], sum)
# dementia201906$PERIOD <- 201906
# dementia201906$Druggroup <- "Dementia"
# diabetes201906 <- aggregate(diabetes201906[-c(1:5, 11)], diabetes201906["PRACTICE"], sum)
# diabetes201906$PERIOD <- 201906
# diabetes201906$Druggroup <- "Diabetes"
# 
# bronchodilators201906 <- aggregate(bronchodilators201906[-c(1:5, 11)], bronchodilators201906["PRACTICE"], sum)
# bronchodilators201906$PERIOD <- 201906
# bronchodilators201906$Druggroup <- "Bronchodilators"
# opioddep201906 <- aggregate(opioddep201906[-c(1:5, 11)], opioddep201906["PRACTICE"], sum)
# opioddep201906$PERIOD <- 201906
# opioddep201906$Druggroup <- "Opiod"
# nicotinedep201906 <- aggregate(nicotinedep201906[-c(1:5, 11)], nicotinedep201906["PRACTICE"], sum)
# nicotinedep201906$PERIOD <- 201906
# nicotinedep201906$Druggroup <- "Nicotine"
# alcoholdep201906 <- aggregate(alcoholdep201906[-c(1:5, 11)], alcoholdep201906["PRACTICE"], sum)
# alcoholdep201906$PERIOD <- 201906
# alcoholdep201906$Druggroup <- "Alcohol"
# allsubstancedep201906 <- aggregate(allsubstancedep201906[-c(1:5, 11)], allsubstancedep201906["PRACTICE"], sum)
# allsubstancedep201906$PERIOD <- 201906
# allsubstancedep201906$Druggroup <- "SubstanceDep"
# obesedrugs201906 <- aggregate(obesedrugs201906[-c(1:5, 11)], obesedrugs201906["PRACTICE"], sum)
# obesedrugs201906$PERIOD <- 201906
# obesedrugs201906$Druggroup <- "Obesity"
# 
# prescribemaster201906 <- do.call("rbind", list(obesedrugs201906, allsubstancedep201906, alcoholdep201906, 
#                                                nicotinedep201906,opioddep201906, bronchodilators201906,
#                                                antidep201906, diabetes201906, dementia201906))
# 
# 
# write.csv(prescribemaster201906, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201906.csv")
# 
# rm(list = ls(all.names = TRUE))
# 
# prescribe201905 <- read_csv("H:/prescription data/T201905PDPI BNFT.csv")
# prescribe201905$drugcode <- parse_number(prescribe201905$`BNF CODE`)
# prescribe201905$drugcode <- substr(prescribe201905$drugcode, 0, 6)
# antidep201905 <- prescribe201905[which(prescribe201905$drugcode>=403000&prescribe201905$drugcode<404000),]
# obesedrugs201905 <- prescribe201905[which(prescribe201905$drugcode>=405000&prescribe201905$drugcode<406000),]
# allsubstancedep201905 <- prescribe201905[which(prescribe201905$drugcode>=410000&prescribe201905$drugcode<411000),]
# alcoholdep201905 <- prescribe201905[which(prescribe201905$drugcode>=410010&prescribe201905$drugcode<410020),]
# nicotinedep201905 <- prescribe201905[which(prescribe201905$drugcode>=410020&prescribe201905$drugcode<410030),]
# opioddep201905 <- prescribe201905[which(prescribe201905$drugcode>=410030&prescribe201905$drugcode<411000),]
# bronchodilators201905 <- prescribe201905[which(prescribe201905$drugcode>=310000&prescribe201905$drugcode<320000),]
# dementia201905 <- prescribe201905[which(prescribe201905$drugcode>=411000&prescribe201905$drugcode<500000),]
# diabetes201905 <- prescribe201905[which(prescribe201905$drugcode>=601000&prescribe201905$drugcode<602000),]
# 
# antidep201905 <- aggregate(antidep201905[-c(1:5, 11)], antidep201905["PRACTICE"], sum)
# antidep201905$PERIOD <- 201905
# antidep201905$Druggroup <- "Antidepressant"
# dementia201905 <- aggregate(dementia201905[-c(1:5, 11)], dementia201905["PRACTICE"], sum)
# dementia201905$PERIOD <- 201905
# dementia201905$Druggroup <- "Dementia"
# diabetes201905 <- aggregate(diabetes201905[-c(1:5, 11)], diabetes201905["PRACTICE"], sum)
# diabetes201905$PERIOD <- 201905
# diabetes201905$Druggroup <- "Diabetes"
# 
# bronchodilators201905 <- aggregate(bronchodilators201905[-c(1:5, 11)], bronchodilators201905["PRACTICE"], sum)
# bronchodilators201905$PERIOD <- 201905
# bronchodilators201905$Druggroup <- "Bronchodilators"
# opioddep201905 <- aggregate(opioddep201905[-c(1:5, 11)], opioddep201905["PRACTICE"], sum)
# opioddep201905$PERIOD <- 201905
# opioddep201905$Druggroup <- "Opiod"
# nicotinedep201905 <- aggregate(nicotinedep201905[-c(1:5, 11)], nicotinedep201905["PRACTICE"], sum)
# nicotinedep201905$PERIOD <- 201905
# nicotinedep201905$Druggroup <- "Nicotine"
# alcoholdep201905 <- aggregate(alcoholdep201905[-c(1:5, 11)], alcoholdep201905["PRACTICE"], sum)
# alcoholdep201905$PERIOD <- 201905
# alcoholdep201905$Druggroup <- "Alcohol"
# allsubstancedep201905 <- aggregate(allsubstancedep201905[-c(1:5, 11)], allsubstancedep201905["PRACTICE"], sum)
# allsubstancedep201905$PERIOD <- 201905
# allsubstancedep201905$Druggroup <- "SubstanceDep"
# obesedrugs201905 <- aggregate(obesedrugs201905[-c(1:5, 11)], obesedrugs201905["PRACTICE"], sum)
# obesedrugs201905$PERIOD <- 201905
# obesedrugs201905$Druggroup <- "Obesity"
# 
# prescribemaster201905 <- do.call("rbind", list(obesedrugs201905, allsubstancedep201905, alcoholdep201905, 
#                                                nicotinedep201905,opioddep201905, bronchodilators201905,
#                                                antidep201905, diabetes201905, dementia201905))
# 
# 
# write.csv(prescribemaster201905, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201905.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201904 <- read_csv("H:/prescription data/T201904PDPI BNFT.csv")
# prescribe201904$drugcode <- parse_number(prescribe201904$`BNF CODE`)
# prescribe201904$drugcode <- substr(prescribe201904$drugcode, 0, 6)
# antidep201904 <- prescribe201904[which(prescribe201904$drugcode>=403000&prescribe201904$drugcode<404000),]
# obesedrugs201904 <- prescribe201904[which(prescribe201904$drugcode>=405000&prescribe201904$drugcode<406000),]
# allsubstancedep201904 <- prescribe201904[which(prescribe201904$drugcode>=410000&prescribe201904$drugcode<411000),]
# alcoholdep201904 <- prescribe201904[which(prescribe201904$drugcode>=410010&prescribe201904$drugcode<410020),]
# nicotinedep201904 <- prescribe201904[which(prescribe201904$drugcode>=410020&prescribe201904$drugcode<410030),]
# opioddep201904 <- prescribe201904[which(prescribe201904$drugcode>=410030&prescribe201904$drugcode<411000),]
# bronchodilators201904 <- prescribe201904[which(prescribe201904$drugcode>=310000&prescribe201904$drugcode<320000),]
# dementia201904 <- prescribe201904[which(prescribe201904$drugcode>=411000&prescribe201904$drugcode<500000),]
# diabetes201904 <- prescribe201904[which(prescribe201904$drugcode>=601000&prescribe201904$drugcode<602000),]
# 
# antidep201904 <- aggregate(antidep201904[-c(1:5, 11)], antidep201904["PRACTICE"], sum)
# antidep201904$PERIOD <- 201904
# antidep201904$Druggroup <- "Antidepressant"
# dementia201904 <- aggregate(dementia201904[-c(1:5, 11)], dementia201904["PRACTICE"], sum)
# dementia201904$PERIOD <- 201904
# dementia201904$Druggroup <- "Dementia"
# diabetes201904 <- aggregate(diabetes201904[-c(1:5, 11)], diabetes201904["PRACTICE"], sum)
# diabetes201904$PERIOD <- 201904
# diabetes201904$Druggroup <- "Diabetes"
# 
# bronchodilators201904 <- aggregate(bronchodilators201904[-c(1:5, 11)], bronchodilators201904["PRACTICE"], sum)
# bronchodilators201904$PERIOD <- 201904
# bronchodilators201904$Druggroup <- "Bronchodilators"
# opioddep201904 <- aggregate(opioddep201904[-c(1:5, 11)], opioddep201904["PRACTICE"], sum)
# opioddep201904$PERIOD <- 201904
# opioddep201904$Druggroup <- "Opiod"
# nicotinedep201904 <- aggregate(nicotinedep201904[-c(1:5, 11)], nicotinedep201904["PRACTICE"], sum)
# nicotinedep201904$PERIOD <- 201904
# nicotinedep201904$Druggroup <- "Nicotine"
# alcoholdep201904 <- aggregate(alcoholdep201904[-c(1:5, 11)], alcoholdep201904["PRACTICE"], sum)
# alcoholdep201904$PERIOD <- 201904
# alcoholdep201904$Druggroup <- "Alcohol"
# allsubstancedep201904 <- aggregate(allsubstancedep201904[-c(1:5, 11)], allsubstancedep201904["PRACTICE"], sum)
# allsubstancedep201904$PERIOD <- 201904
# allsubstancedep201904$Druggroup <- "SubstanceDep"
# obesedrugs201904 <- aggregate(obesedrugs201904[-c(1:5, 11)], obesedrugs201904["PRACTICE"], sum)
# obesedrugs201904$PERIOD <- 201904
# obesedrugs201904$Druggroup <- "Obesity"
# 
# prescribemaster201904 <- do.call("rbind", list(obesedrugs201904, allsubstancedep201904, alcoholdep201904, 
#                                                nicotinedep201904,opioddep201904, bronchodilators201904,
#                                                antidep201904, diabetes201904, dementia201904))
# 
# 
# write.csv(prescribemaster201904, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201904.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201903 <- read_csv("H:/prescription data/T201903PDPI BNFT.csv")
# prescribe201903$drugcode <- parse_number(prescribe201903$`BNF CODE`)
# prescribe201903$drugcode <- substr(prescribe201903$drugcode, 0, 6)
# antidep201903 <- prescribe201903[which(prescribe201903$drugcode>=403000&prescribe201903$drugcode<404000),]
# obesedrugs201903 <- prescribe201903[which(prescribe201903$drugcode>=405000&prescribe201903$drugcode<406000),]
# allsubstancedep201903 <- prescribe201903[which(prescribe201903$drugcode>=410000&prescribe201903$drugcode<411000),]
# alcoholdep201903 <- prescribe201903[which(prescribe201903$drugcode>=410010&prescribe201903$drugcode<410020),]
# nicotinedep201903 <- prescribe201903[which(prescribe201903$drugcode>=410020&prescribe201903$drugcode<410030),]
# opioddep201903 <- prescribe201903[which(prescribe201903$drugcode>=410030&prescribe201903$drugcode<411000),]
# bronchodilators201903 <- prescribe201903[which(prescribe201903$drugcode>=310000&prescribe201903$drugcode<320000),]
# dementia201903 <- prescribe201903[which(prescribe201903$drugcode>=411000&prescribe201903$drugcode<500000),]
# diabetes201903 <- prescribe201903[which(prescribe201903$drugcode>=601000&prescribe201903$drugcode<602000),]
# 
# antidep201903 <- aggregate(antidep201903[-c(1:5, 11)], antidep201903["PRACTICE"], sum)
# antidep201903$PERIOD <- 201903
# antidep201903$Druggroup <- "Antidepressant"
# dementia201903 <- aggregate(dementia201903[-c(1:5, 11)], dementia201903["PRACTICE"], sum)
# dementia201903$PERIOD <- 201903
# dementia201903$Druggroup <- "Dementia"
# diabetes201903 <- aggregate(diabetes201903[-c(1:5, 11)], diabetes201903["PRACTICE"], sum)
# diabetes201903$PERIOD <- 201903
# diabetes201903$Druggroup <- "Diabetes"
# 
# bronchodilators201903 <- aggregate(bronchodilators201903[-c(1:5, 11)], bronchodilators201903["PRACTICE"], sum)
# bronchodilators201903$PERIOD <- 201903
# bronchodilators201903$Druggroup <- "Bronchodilators"
# opioddep201903 <- aggregate(opioddep201903[-c(1:5, 11)], opioddep201903["PRACTICE"], sum)
# opioddep201903$PERIOD <- 201903
# opioddep201903$Druggroup <- "Opiod"
# nicotinedep201903 <- aggregate(nicotinedep201903[-c(1:5, 11)], nicotinedep201903["PRACTICE"], sum)
# nicotinedep201903$PERIOD <- 201903
# nicotinedep201903$Druggroup <- "Nicotine"
# alcoholdep201903 <- aggregate(alcoholdep201903[-c(1:5, 11)], alcoholdep201903["PRACTICE"], sum)
# alcoholdep201903$PERIOD <- 201903
# alcoholdep201903$Druggroup <- "Alcohol"
# allsubstancedep201903 <- aggregate(allsubstancedep201903[-c(1:5, 11)], allsubstancedep201903["PRACTICE"], sum)
# allsubstancedep201903$PERIOD <- 201903
# allsubstancedep201903$Druggroup <- "SubstanceDep"
# obesedrugs201903 <- aggregate(obesedrugs201903[-c(1:5, 11)], obesedrugs201903["PRACTICE"], sum)
# obesedrugs201903$PERIOD <- 201903
# obesedrugs201903$Druggroup <- "Obesity"
# 
# prescribemaster201903 <- do.call("rbind", list(obesedrugs201903, allsubstancedep201903, alcoholdep201903, 
#                                                nicotinedep201903,opioddep201903, bronchodilators201903,
#                                                antidep201903, diabetes201903, dementia201903))
# 
# 
# write.csv(prescribemaster201903, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201903.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201902 <- read_csv("H:/prescription data/T201902PDPI BNFT.csv")
# prescribe201902$drugcode <- parse_number(prescribe201902$`BNF CODE`)
# prescribe201902$drugcode <- substr(prescribe201902$drugcode, 0, 6)
# antidep201902 <- prescribe201902[which(prescribe201902$drugcode>=403000&prescribe201902$drugcode<404000),]
# obesedrugs201902 <- prescribe201902[which(prescribe201902$drugcode>=405000&prescribe201902$drugcode<406000),]
# allsubstancedep201902 <- prescribe201902[which(prescribe201902$drugcode>=410000&prescribe201902$drugcode<411000),]
# alcoholdep201902 <- prescribe201902[which(prescribe201902$drugcode>=410010&prescribe201902$drugcode<410020),]
# nicotinedep201902 <- prescribe201902[which(prescribe201902$drugcode>=410020&prescribe201902$drugcode<410030),]
# opioddep201902 <- prescribe201902[which(prescribe201902$drugcode>=410030&prescribe201902$drugcode<411000),]
# bronchodilators201902 <- prescribe201902[which(prescribe201902$drugcode>=310000&prescribe201902$drugcode<320000),]
# dementia201902 <- prescribe201902[which(prescribe201902$drugcode>=411000&prescribe201902$drugcode<500000),]
# diabetes201902 <- prescribe201902[which(prescribe201902$drugcode>=601000&prescribe201902$drugcode<602000),]
# 
# antidep201902 <- aggregate(antidep201902[-c(1:5, 11)], antidep201902["PRACTICE"], sum)
# antidep201902$PERIOD <- 201902
# antidep201902$Druggroup <- "Antidepressant"
# dementia201902 <- aggregate(dementia201902[-c(1:5, 11)], dementia201902["PRACTICE"], sum)
# dementia201902$PERIOD <- 201902
# dementia201902$Druggroup <- "Dementia"
# diabetes201902 <- aggregate(diabetes201902[-c(1:5, 11)], diabetes201902["PRACTICE"], sum)
# diabetes201902$PERIOD <- 201902
# diabetes201902$Druggroup <- "Diabetes"
# 
# bronchodilators201902 <- aggregate(bronchodilators201902[-c(1:5, 11)], bronchodilators201902["PRACTICE"], sum)
# bronchodilators201902$PERIOD <- 201902
# bronchodilators201902$Druggroup <- "Bronchodilators"
# opioddep201902 <- aggregate(opioddep201902[-c(1:5, 11)], opioddep201902["PRACTICE"], sum)
# opioddep201902$PERIOD <- 201902
# opioddep201902$Druggroup <- "Opiod"
# nicotinedep201902 <- aggregate(nicotinedep201902[-c(1:5, 11)], nicotinedep201902["PRACTICE"], sum)
# nicotinedep201902$PERIOD <- 201902
# nicotinedep201902$Druggroup <- "Nicotine"
# alcoholdep201902 <- aggregate(alcoholdep201902[-c(1:5, 11)], alcoholdep201902["PRACTICE"], sum)
# alcoholdep201902$PERIOD <- 201902
# alcoholdep201902$Druggroup <- "Alcohol"
# allsubstancedep201902 <- aggregate(allsubstancedep201902[-c(1:5, 11)], allsubstancedep201902["PRACTICE"], sum)
# allsubstancedep201902$PERIOD <- 201902
# allsubstancedep201902$Druggroup <- "SubstanceDep"
# obesedrugs201902 <- aggregate(obesedrugs201902[-c(1:5, 11)], obesedrugs201902["PRACTICE"], sum)
# obesedrugs201902$PERIOD <- 201902
# obesedrugs201902$Druggroup <- "Obesity"
# 
# prescribemaster201902 <- do.call("rbind", list(obesedrugs201902, allsubstancedep201902, alcoholdep201902, 
#                                                nicotinedep201902,opioddep201902, bronchodilators201902,
#                                                antidep201902, diabetes201902, dementia201902))
# 
# 
# write.csv(prescribemaster201902, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201902.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201901 <- read_csv("H:/prescription data/T201901PDPI BNFT.csv")
# prescribe201901$drugcode <- parse_number(prescribe201901$`BNF CODE`)
# prescribe201901$drugcode <- substr(prescribe201901$drugcode, 0, 6)
# antidep201901 <- prescribe201901[which(prescribe201901$drugcode>=403000&prescribe201901$drugcode<404000),]
# obesedrugs201901 <- prescribe201901[which(prescribe201901$drugcode>=405000&prescribe201901$drugcode<406000),]
# allsubstancedep201901 <- prescribe201901[which(prescribe201901$drugcode>=410000&prescribe201901$drugcode<411000),]
# alcoholdep201901 <- prescribe201901[which(prescribe201901$drugcode>=410010&prescribe201901$drugcode<410020),]
# nicotinedep201901 <- prescribe201901[which(prescribe201901$drugcode>=410020&prescribe201901$drugcode<410030),]
# opioddep201901 <- prescribe201901[which(prescribe201901$drugcode>=410030&prescribe201901$drugcode<411000),]
# bronchodilators201901 <- prescribe201901[which(prescribe201901$drugcode>=310000&prescribe201901$drugcode<320000),]
# dementia201901 <- prescribe201901[which(prescribe201901$drugcode>=411000&prescribe201901$drugcode<500000),]
# diabetes201901 <- prescribe201901[which(prescribe201901$drugcode>=601000&prescribe201901$drugcode<602000),]
# 
# antidep201901 <- aggregate(antidep201901[-c(1:5, 11)], antidep201901["PRACTICE"], sum)
# antidep201901$PERIOD <- 201901
# antidep201901$Druggroup <- "Antidepressant"
# dementia201901 <- aggregate(dementia201901[-c(1:5, 11)], dementia201901["PRACTICE"], sum)
# dementia201901$PERIOD <- 201901
# dementia201901$Druggroup <- "Dementia"
# diabetes201901 <- aggregate(diabetes201901[-c(1:5, 11)], diabetes201901["PRACTICE"], sum)
# diabetes201901$PERIOD <- 201901
# diabetes201901$Druggroup <- "Diabetes"
# 
# bronchodilators201901 <- aggregate(bronchodilators201901[-c(1:5, 11)], bronchodilators201901["PRACTICE"], sum)
# bronchodilators201901$PERIOD <- 201901
# bronchodilators201901$Druggroup <- "Bronchodilators"
# opioddep201901 <- aggregate(opioddep201901[-c(1:5, 11)], opioddep201901["PRACTICE"], sum)
# opioddep201901$PERIOD <- 201901
# opioddep201901$Druggroup <- "Opiod"
# nicotinedep201901 <- aggregate(nicotinedep201901[-c(1:5, 11)], nicotinedep201901["PRACTICE"], sum)
# nicotinedep201901$PERIOD <- 201901
# nicotinedep201901$Druggroup <- "Nicotine"
# alcoholdep201901 <- aggregate(alcoholdep201901[-c(1:5, 11)], alcoholdep201901["PRACTICE"], sum)
# alcoholdep201901$PERIOD <- 201901
# alcoholdep201901$Druggroup <- "Alcohol"
# allsubstancedep201901 <- aggregate(allsubstancedep201901[-c(1:5, 11)], allsubstancedep201901["PRACTICE"], sum)
# allsubstancedep201901$PERIOD <- 201901
# allsubstancedep201901$Druggroup <- "SubstanceDep"
# obesedrugs201901 <- aggregate(obesedrugs201901[-c(1:5, 11)], obesedrugs201901["PRACTICE"], sum)
# obesedrugs201901$PERIOD <- 201901
# obesedrugs201901$Druggroup <- "Obesity"
# 
# prescribemaster201901 <- do.call("rbind", list(obesedrugs201901, allsubstancedep201901, alcoholdep201901, 
#                                                nicotinedep201901,opioddep201901, bronchodilators201901,
#                                                antidep201901, diabetes201901, dementia201901))
# 
# 
# write.csv(prescribemaster201901, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201901.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201812 <- read_csv("H:/prescription data/T201812PDPI BNFT.csv")
# prescribe201812$drugcode <- parse_number(prescribe201812$`BNF CODE`)
# prescribe201812$drugcode <- substr(prescribe201812$drugcode, 0, 6)
# antidep201812 <- prescribe201812[which(prescribe201812$drugcode>=403000&prescribe201812$drugcode<404000),]
# obesedrugs201812 <- prescribe201812[which(prescribe201812$drugcode>=405000&prescribe201812$drugcode<406000),]
# allsubstancedep201812 <- prescribe201812[which(prescribe201812$drugcode>=410000&prescribe201812$drugcode<411000),]
# alcoholdep201812 <- prescribe201812[which(prescribe201812$drugcode>=410010&prescribe201812$drugcode<410020),]
# nicotinedep201812 <- prescribe201812[which(prescribe201812$drugcode>=410020&prescribe201812$drugcode<410030),]
# opioddep201812 <- prescribe201812[which(prescribe201812$drugcode>=410030&prescribe201812$drugcode<411000),]
# bronchodilators201812 <- prescribe201812[which(prescribe201812$drugcode>=310000&prescribe201812$drugcode<320000),]
# dementia201812 <- prescribe201812[which(prescribe201812$drugcode>=411000&prescribe201812$drugcode<500000),]
# diabetes201812 <- prescribe201812[which(prescribe201812$drugcode>=601000&prescribe201812$drugcode<602000),]
# 
# antidep201812 <- aggregate(antidep201812[-c(1:5, 11)], antidep201812["PRACTICE"], sum)
# antidep201812$PERIOD <- 201812
# antidep201812$Druggroup <- "Antidepressant"
# dementia201812 <- aggregate(dementia201812[-c(1:5, 11)], dementia201812["PRACTICE"], sum)
# dementia201812$PERIOD <- 201812
# dementia201812$Druggroup <- "Dementia"
# diabetes201812 <- aggregate(diabetes201812[-c(1:5, 11)], diabetes201812["PRACTICE"], sum)
# diabetes201812$PERIOD <- 201812
# diabetes201812$Druggroup <- "Diabetes"
# 
# bronchodilators201812 <- aggregate(bronchodilators201812[-c(1:5, 11)], bronchodilators201812["PRACTICE"], sum)
# bronchodilators201812$PERIOD <- 201812
# bronchodilators201812$Druggroup <- "Bronchodilators"
# opioddep201812 <- aggregate(opioddep201812[-c(1:5, 11)], opioddep201812["PRACTICE"], sum)
# opioddep201812$PERIOD <- 201812
# opioddep201812$Druggroup <- "Opiod"
# nicotinedep201812 <- aggregate(nicotinedep201812[-c(1:5, 11)], nicotinedep201812["PRACTICE"], sum)
# nicotinedep201812$PERIOD <- 201812
# nicotinedep201812$Druggroup <- "Nicotine"
# alcoholdep201812 <- aggregate(alcoholdep201812[-c(1:5, 11)], alcoholdep201812["PRACTICE"], sum)
# alcoholdep201812$PERIOD <- 201812
# alcoholdep201812$Druggroup <- "Alcohol"
# allsubstancedep201812 <- aggregate(allsubstancedep201812[-c(1:5, 11)], allsubstancedep201812["PRACTICE"], sum)
# allsubstancedep201812$PERIOD <- 201812
# allsubstancedep201812$Druggroup <- "SubstanceDep"
# obesedrugs201812 <- aggregate(obesedrugs201812[-c(1:5, 11)], obesedrugs201812["PRACTICE"], sum)
# obesedrugs201812$PERIOD <- 201812
# obesedrugs201812$Druggroup <- "Obesity"
# 
# prescribemaster201812 <- do.call("rbind", list(obesedrugs201812, allsubstancedep201812, alcoholdep201812, 
#                                                nicotinedep201812,opioddep201812, bronchodilators201812,
#                                                antidep201812, diabetes201812, dementia201812))
# 
# 
# write.csv(prescribemaster201812, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201812.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201811 <- read_csv("H:/prescription data/T201811PDPI BNFT.csv")
# prescribe201811$drugcode <- parse_number(prescribe201811$`BNF CODE`)
# prescribe201811$drugcode <- substr(prescribe201811$drugcode, 0, 6)
# antidep201811 <- prescribe201811[which(prescribe201811$drugcode>=403000&prescribe201811$drugcode<404000),]
# obesedrugs201811 <- prescribe201811[which(prescribe201811$drugcode>=405000&prescribe201811$drugcode<406000),]
# allsubstancedep201811 <- prescribe201811[which(prescribe201811$drugcode>=410000&prescribe201811$drugcode<411000),]
# alcoholdep201811 <- prescribe201811[which(prescribe201811$drugcode>=410010&prescribe201811$drugcode<410020),]
# nicotinedep201811 <- prescribe201811[which(prescribe201811$drugcode>=410020&prescribe201811$drugcode<410030),]
# opioddep201811 <- prescribe201811[which(prescribe201811$drugcode>=410030&prescribe201811$drugcode<411000),]
# bronchodilators201811 <- prescribe201811[which(prescribe201811$drugcode>=310000&prescribe201811$drugcode<320000),]
# dementia201811 <- prescribe201811[which(prescribe201811$drugcode>=411000&prescribe201811$drugcode<500000),]
# diabetes201811 <- prescribe201811[which(prescribe201811$drugcode>=601000&prescribe201811$drugcode<602000),]
# 
# antidep201811 <- aggregate(antidep201811[-c(1:5, 11)], antidep201811["PRACTICE"], sum)
# antidep201811$PERIOD <- 201811
# antidep201811$Druggroup <- "Antidepressant"
# dementia201811 <- aggregate(dementia201811[-c(1:5, 11)], dementia201811["PRACTICE"], sum)
# dementia201811$PERIOD <- 201811
# dementia201811$Druggroup <- "Dementia"
# diabetes201811 <- aggregate(diabetes201811[-c(1:5, 11)], diabetes201811["PRACTICE"], sum)
# diabetes201811$PERIOD <- 201811
# diabetes201811$Druggroup <- "Diabetes"
# 
# bronchodilators201811 <- aggregate(bronchodilators201811[-c(1:5, 11)], bronchodilators201811["PRACTICE"], sum)
# bronchodilators201811$PERIOD <- 201811
# bronchodilators201811$Druggroup <- "Bronchodilators"
# opioddep201811 <- aggregate(opioddep201811[-c(1:5, 11)], opioddep201811["PRACTICE"], sum)
# opioddep201811$PERIOD <- 201811
# opioddep201811$Druggroup <- "Opiod"
# nicotinedep201811 <- aggregate(nicotinedep201811[-c(1:5, 11)], nicotinedep201811["PRACTICE"], sum)
# nicotinedep201811$PERIOD <- 201811
# nicotinedep201811$Druggroup <- "Nicotine"
# alcoholdep201811 <- aggregate(alcoholdep201811[-c(1:5, 11)], alcoholdep201811["PRACTICE"], sum)
# alcoholdep201811$PERIOD <- 201811
# alcoholdep201811$Druggroup <- "Alcohol"
# allsubstancedep201811 <- aggregate(allsubstancedep201811[-c(1:5, 11)], allsubstancedep201811["PRACTICE"], sum)
# allsubstancedep201811$PERIOD <- 201811
# allsubstancedep201811$Druggroup <- "SubstanceDep"
# obesedrugs201811 <- aggregate(obesedrugs201811[-c(1:5, 11)], obesedrugs201811["PRACTICE"], sum)
# obesedrugs201811$PERIOD <- 201811
# obesedrugs201811$Druggroup <- "Obesity"
# 
# prescribemaster201811 <- do.call("rbind", list(obesedrugs201811, allsubstancedep201811, alcoholdep201811, 
#                                                nicotinedep201811,opioddep201811, bronchodilators201811,
#                                                antidep201811, diabetes201811, dementia201811))
# 
# 
# write.csv(prescribemaster201811, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201811.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201810 <- read_csv("H:/prescription data/T201810PDPI BNFT.csv")
# prescribe201810$drugcode <- parse_number(prescribe201810$`BNF CODE`)
# prescribe201810$drugcode <- substr(prescribe201810$drugcode, 0, 6)
# antidep201810 <- prescribe201810[which(prescribe201810$drugcode>=403000&prescribe201810$drugcode<404000),]
# obesedrugs201810 <- prescribe201810[which(prescribe201810$drugcode>=405000&prescribe201810$drugcode<406000),]
# allsubstancedep201810 <- prescribe201810[which(prescribe201810$drugcode>=410000&prescribe201810$drugcode<411000),]
# alcoholdep201810 <- prescribe201810[which(prescribe201810$drugcode>=410010&prescribe201810$drugcode<410020),]
# nicotinedep201810 <- prescribe201810[which(prescribe201810$drugcode>=410020&prescribe201810$drugcode<410030),]
# opioddep201810 <- prescribe201810[which(prescribe201810$drugcode>=410030&prescribe201810$drugcode<411000),]
# bronchodilators201810 <- prescribe201810[which(prescribe201810$drugcode>=310000&prescribe201810$drugcode<320000),]
# dementia201810 <- prescribe201810[which(prescribe201810$drugcode>=411000&prescribe201810$drugcode<500000),]
# diabetes201810 <- prescribe201810[which(prescribe201810$drugcode>=601000&prescribe201810$drugcode<602000),]
# 
# antidep201810 <- aggregate(antidep201810[-c(1:5, 11)], antidep201810["PRACTICE"], sum)
# antidep201810$PERIOD <- 201810
# antidep201810$Druggroup <- "Antidepressant"
# dementia201810 <- aggregate(dementia201810[-c(1:5, 11)], dementia201810["PRACTICE"], sum)
# dementia201810$PERIOD <- 201810
# dementia201810$Druggroup <- "Dementia"
# diabetes201810 <- aggregate(diabetes201810[-c(1:5, 11)], diabetes201810["PRACTICE"], sum)
# diabetes201810$PERIOD <- 201810
# diabetes201810$Druggroup <- "Diabetes"
# 
# bronchodilators201810 <- aggregate(bronchodilators201810[-c(1:5, 11)], bronchodilators201810["PRACTICE"], sum)
# bronchodilators201810$PERIOD <- 201810
# bronchodilators201810$Druggroup <- "Bronchodilators"
# opioddep201810 <- aggregate(opioddep201810[-c(1:5, 11)], opioddep201810["PRACTICE"], sum)
# opioddep201810$PERIOD <- 201810
# opioddep201810$Druggroup <- "Opiod"
# nicotinedep201810 <- aggregate(nicotinedep201810[-c(1:5, 11)], nicotinedep201810["PRACTICE"], sum)
# nicotinedep201810$PERIOD <- 201810
# nicotinedep201810$Druggroup <- "Nicotine"
# alcoholdep201810 <- aggregate(alcoholdep201810[-c(1:5, 11)], alcoholdep201810["PRACTICE"], sum)
# alcoholdep201810$PERIOD <- 201810
# alcoholdep201810$Druggroup <- "Alcohol"
# allsubstancedep201810 <- aggregate(allsubstancedep201810[-c(1:5, 11)], allsubstancedep201810["PRACTICE"], sum)
# allsubstancedep201810$PERIOD <- 201810
# allsubstancedep201810$Druggroup <- "SubstanceDep"
# obesedrugs201810 <- aggregate(obesedrugs201810[-c(1:5, 11)], obesedrugs201810["PRACTICE"], sum)
# obesedrugs201810$PERIOD <- 201810
# obesedrugs201810$Druggroup <- "Obesity"
# 
# prescribemaster201810 <- do.call("rbind", list(obesedrugs201810, allsubstancedep201810, alcoholdep201810, 
#                                                nicotinedep201810,opioddep201810, bronchodilators201810,
#                                                antidep201810, diabetes201810, dementia201810))
# 
# 
# write.csv(prescribemaster201810, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201810.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201809 <- read_csv("H:/prescription data/T201809PDPI BNFT.csv")
# prescribe201809$drugcode <- parse_number(prescribe201809$`BNF CODE`)
# prescribe201809$drugcode <- substr(prescribe201809$drugcode, 0, 6)
# antidep201809 <- prescribe201809[which(prescribe201809$drugcode>=403000&prescribe201809$drugcode<404000),]
# obesedrugs201809 <- prescribe201809[which(prescribe201809$drugcode>=405000&prescribe201809$drugcode<406000),]
# allsubstancedep201809 <- prescribe201809[which(prescribe201809$drugcode>=410000&prescribe201809$drugcode<411000),]
# alcoholdep201809 <- prescribe201809[which(prescribe201809$drugcode>=410010&prescribe201809$drugcode<410020),]
# nicotinedep201809 <- prescribe201809[which(prescribe201809$drugcode>=410020&prescribe201809$drugcode<410030),]
# opioddep201809 <- prescribe201809[which(prescribe201809$drugcode>=410030&prescribe201809$drugcode<411000),]
# bronchodilators201809 <- prescribe201809[which(prescribe201809$drugcode>=310000&prescribe201809$drugcode<320000),]
# dementia201809 <- prescribe201809[which(prescribe201809$drugcode>=411000&prescribe201809$drugcode<500000),]
# diabetes201809 <- prescribe201809[which(prescribe201809$drugcode>=601000&prescribe201809$drugcode<602000),]
# 
# antidep201809 <- aggregate(antidep201809[-c(1:5, 11)], antidep201809["PRACTICE"], sum)
# antidep201809$PERIOD <- 201809
# antidep201809$Druggroup <- "Antidepressant"
# dementia201809 <- aggregate(dementia201809[-c(1:5, 11)], dementia201809["PRACTICE"], sum)
# dementia201809$PERIOD <- 201809
# dementia201809$Druggroup <- "Dementia"
# diabetes201809 <- aggregate(diabetes201809[-c(1:5, 11)], diabetes201809["PRACTICE"], sum)
# diabetes201809$PERIOD <- 201809
# diabetes201809$Druggroup <- "Diabetes"
# 
# bronchodilators201809 <- aggregate(bronchodilators201809[-c(1:5, 11)], bronchodilators201809["PRACTICE"], sum)
# bronchodilators201809$PERIOD <- 201809
# bronchodilators201809$Druggroup <- "Bronchodilators"
# opioddep201809 <- aggregate(opioddep201809[-c(1:5, 11)], opioddep201809["PRACTICE"], sum)
# opioddep201809$PERIOD <- 201809
# opioddep201809$Druggroup <- "Opiod"
# nicotinedep201809 <- aggregate(nicotinedep201809[-c(1:5, 11)], nicotinedep201809["PRACTICE"], sum)
# nicotinedep201809$PERIOD <- 201809
# nicotinedep201809$Druggroup <- "Nicotine"
# alcoholdep201809 <- aggregate(alcoholdep201809[-c(1:5, 11)], alcoholdep201809["PRACTICE"], sum)
# alcoholdep201809$PERIOD <- 201809
# alcoholdep201809$Druggroup <- "Alcohol"
# allsubstancedep201809 <- aggregate(allsubstancedep201809[-c(1:5, 11)], allsubstancedep201809["PRACTICE"], sum)
# allsubstancedep201809$PERIOD <- 201809
# allsubstancedep201809$Druggroup <- "SubstanceDep"
# obesedrugs201809 <- aggregate(obesedrugs201809[-c(1:5, 11)], obesedrugs201809["PRACTICE"], sum)
# obesedrugs201809$PERIOD <- 201809
# obesedrugs201809$Druggroup <- "Obesity"
# 
# prescribemaster201809 <- do.call("rbind", list(obesedrugs201809, allsubstancedep201809, alcoholdep201809, 
#                                                nicotinedep201809,opioddep201809, bronchodilators201809,
#                                                antidep201809, diabetes201809, dementia201809))
# 
# 
# write.csv(prescribemaster201809, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201809.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201808 <- read_csv("H:/prescription data/T201808PDPI BNFT.csv")
# prescribe201808$drugcode <- parse_number(prescribe201808$`BNF CODE`)
# prescribe201808$drugcode <- substr(prescribe201808$drugcode, 0, 6)
# antidep201808 <- prescribe201808[which(prescribe201808$drugcode>=403000&prescribe201808$drugcode<404000),]
# obesedrugs201808 <- prescribe201808[which(prescribe201808$drugcode>=405000&prescribe201808$drugcode<406000),]
# allsubstancedep201808 <- prescribe201808[which(prescribe201808$drugcode>=410000&prescribe201808$drugcode<411000),]
# alcoholdep201808 <- prescribe201808[which(prescribe201808$drugcode>=410010&prescribe201808$drugcode<410020),]
# nicotinedep201808 <- prescribe201808[which(prescribe201808$drugcode>=410020&prescribe201808$drugcode<410030),]
# opioddep201808 <- prescribe201808[which(prescribe201808$drugcode>=410030&prescribe201808$drugcode<411000),]
# bronchodilators201808 <- prescribe201808[which(prescribe201808$drugcode>=310000&prescribe201808$drugcode<320000),]
# dementia201808 <- prescribe201808[which(prescribe201808$drugcode>=411000&prescribe201808$drugcode<500000),]
# diabetes201808 <- prescribe201808[which(prescribe201808$drugcode>=601000&prescribe201808$drugcode<602000),]
# 
# antidep201808 <- aggregate(antidep201808[-c(1:5, 11)], antidep201808["PRACTICE"], sum)
# antidep201808$PERIOD <- 201808
# antidep201808$Druggroup <- "Antidepressant"
# dementia201808 <- aggregate(dementia201808[-c(1:5, 11)], dementia201808["PRACTICE"], sum)
# dementia201808$PERIOD <- 201808
# dementia201808$Druggroup <- "Dementia"
# diabetes201808 <- aggregate(diabetes201808[-c(1:5, 11)], diabetes201808["PRACTICE"], sum)
# diabetes201808$PERIOD <- 201808
# diabetes201808$Druggroup <- "Diabetes"
# 
# bronchodilators201808 <- aggregate(bronchodilators201808[-c(1:5, 11)], bronchodilators201808["PRACTICE"], sum)
# bronchodilators201808$PERIOD <- 201808
# bronchodilators201808$Druggroup <- "Bronchodilators"
# opioddep201808 <- aggregate(opioddep201808[-c(1:5, 11)], opioddep201808["PRACTICE"], sum)
# opioddep201808$PERIOD <- 201808
# opioddep201808$Druggroup <- "Opiod"
# nicotinedep201808 <- aggregate(nicotinedep201808[-c(1:5, 11)], nicotinedep201808["PRACTICE"], sum)
# nicotinedep201808$PERIOD <- 201808
# nicotinedep201808$Druggroup <- "Nicotine"
# alcoholdep201808 <- aggregate(alcoholdep201808[-c(1:5, 11)], alcoholdep201808["PRACTICE"], sum)
# alcoholdep201808$PERIOD <- 201808
# alcoholdep201808$Druggroup <- "Alcohol"
# allsubstancedep201808 <- aggregate(allsubstancedep201808[-c(1:5, 11)], allsubstancedep201808["PRACTICE"], sum)
# allsubstancedep201808$PERIOD <- 201808
# allsubstancedep201808$Druggroup <- "SubstanceDep"
# obesedrugs201808 <- aggregate(obesedrugs201808[-c(1:5, 11)], obesedrugs201808["PRACTICE"], sum)
# obesedrugs201808$PERIOD <- 201808
# obesedrugs201808$Druggroup <- "Obesity"
# 
# prescribemaster201808 <- do.call("rbind", list(obesedrugs201808, allsubstancedep201808, alcoholdep201808, 
#                                                nicotinedep201808,opioddep201808, bronchodilators201808,
#                                                antidep201808, diabetes201808, dementia201808))
# 
# 
# write.csv(prescribemaster201808, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201808.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201807 <- read_csv("H:/prescription data/T201807PDPI BNFT.csv")
# prescribe201807$drugcode <- parse_number(prescribe201807$`BNF CODE`)
# prescribe201807$drugcode <- substr(prescribe201807$drugcode, 0, 6)
# antidep201807 <- prescribe201807[which(prescribe201807$drugcode>=403000&prescribe201807$drugcode<404000),]
# obesedrugs201807 <- prescribe201807[which(prescribe201807$drugcode>=405000&prescribe201807$drugcode<406000),]
# allsubstancedep201807 <- prescribe201807[which(prescribe201807$drugcode>=410000&prescribe201807$drugcode<411000),]
# alcoholdep201807 <- prescribe201807[which(prescribe201807$drugcode>=410010&prescribe201807$drugcode<410020),]
# nicotinedep201807 <- prescribe201807[which(prescribe201807$drugcode>=410020&prescribe201807$drugcode<410030),]
# opioddep201807 <- prescribe201807[which(prescribe201807$drugcode>=410030&prescribe201807$drugcode<411000),]
# bronchodilators201807 <- prescribe201807[which(prescribe201807$drugcode>=310000&prescribe201807$drugcode<320000),]
# dementia201807 <- prescribe201807[which(prescribe201807$drugcode>=411000&prescribe201807$drugcode<500000),]
# diabetes201807 <- prescribe201807[which(prescribe201807$drugcode>=601000&prescribe201807$drugcode<602000),]
# 
# antidep201807 <- aggregate(antidep201807[-c(1:5, 11)], antidep201807["PRACTICE"], sum)
# antidep201807$PERIOD <- 201807
# antidep201807$Druggroup <- "Antidepressant"
# dementia201807 <- aggregate(dementia201807[-c(1:5, 11)], dementia201807["PRACTICE"], sum)
# dementia201807$PERIOD <- 201807
# dementia201807$Druggroup <- "Dementia"
# diabetes201807 <- aggregate(diabetes201807[-c(1:5, 11)], diabetes201807["PRACTICE"], sum)
# diabetes201807$PERIOD <- 201807
# diabetes201807$Druggroup <- "Diabetes"
# 
# bronchodilators201807 <- aggregate(bronchodilators201807[-c(1:5, 11)], bronchodilators201807["PRACTICE"], sum)
# bronchodilators201807$PERIOD <- 201807
# bronchodilators201807$Druggroup <- "Bronchodilators"
# opioddep201807 <- aggregate(opioddep201807[-c(1:5, 11)], opioddep201807["PRACTICE"], sum)
# opioddep201807$PERIOD <- 201807
# opioddep201807$Druggroup <- "Opiod"
# nicotinedep201807 <- aggregate(nicotinedep201807[-c(1:5, 11)], nicotinedep201807["PRACTICE"], sum)
# nicotinedep201807$PERIOD <- 201807
# nicotinedep201807$Druggroup <- "Nicotine"
# alcoholdep201807 <- aggregate(alcoholdep201807[-c(1:5, 11)], alcoholdep201807["PRACTICE"], sum)
# alcoholdep201807$PERIOD <- 201807
# alcoholdep201807$Druggroup <- "Alcohol"
# allsubstancedep201807 <- aggregate(allsubstancedep201807[-c(1:5, 11)], allsubstancedep201807["PRACTICE"], sum)
# allsubstancedep201807$PERIOD <- 201807
# allsubstancedep201807$Druggroup <- "SubstanceDep"
# obesedrugs201807 <- aggregate(obesedrugs201807[-c(1:5, 11)], obesedrugs201807["PRACTICE"], sum)
# obesedrugs201807$PERIOD <- 201807
# obesedrugs201807$Druggroup <- "Obesity"
# 
# prescribemaster201807 <- do.call("rbind", list(obesedrugs201807, allsubstancedep201807, alcoholdep201807, 
#                                                nicotinedep201807,opioddep201807, bronchodilators201807,
#                                                antidep201807, diabetes201807, dementia201807))
# 
# 
# write.csv(prescribemaster201807, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201807.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201806 <- read_csv("H:/prescription data/T201806PDPI BNFT.csv")
# prescribe201806$drugcode <- parse_number(prescribe201806$`BNF CODE`)
# prescribe201806$drugcode <- substr(prescribe201806$drugcode, 0, 6)
# antidep201806 <- prescribe201806[which(prescribe201806$drugcode>=403000&prescribe201806$drugcode<404000),]
# obesedrugs201806 <- prescribe201806[which(prescribe201806$drugcode>=405000&prescribe201806$drugcode<406000),]
# allsubstancedep201806 <- prescribe201806[which(prescribe201806$drugcode>=410000&prescribe201806$drugcode<411000),]
# alcoholdep201806 <- prescribe201806[which(prescribe201806$drugcode>=410010&prescribe201806$drugcode<410020),]
# nicotinedep201806 <- prescribe201806[which(prescribe201806$drugcode>=410020&prescribe201806$drugcode<410030),]
# opioddep201806 <- prescribe201806[which(prescribe201806$drugcode>=410030&prescribe201806$drugcode<411000),]
# bronchodilators201806 <- prescribe201806[which(prescribe201806$drugcode>=310000&prescribe201806$drugcode<320000),]
# dementia201806 <- prescribe201806[which(prescribe201806$drugcode>=411000&prescribe201806$drugcode<500000),]
# diabetes201806 <- prescribe201806[which(prescribe201806$drugcode>=601000&prescribe201806$drugcode<602000),]
# 
# antidep201806 <- aggregate(antidep201806[-c(1:5, 11)], antidep201806["PRACTICE"], sum)
# antidep201806$PERIOD <- 201806
# antidep201806$Druggroup <- "Antidepressant"
# dementia201806 <- aggregate(dementia201806[-c(1:5, 11)], dementia201806["PRACTICE"], sum)
# dementia201806$PERIOD <- 201806
# dementia201806$Druggroup <- "Dementia"
# diabetes201806 <- aggregate(diabetes201806[-c(1:5, 11)], diabetes201806["PRACTICE"], sum)
# diabetes201806$PERIOD <- 201806
# diabetes201806$Druggroup <- "Diabetes"
# 
# bronchodilators201806 <- aggregate(bronchodilators201806[-c(1:5, 11)], bronchodilators201806["PRACTICE"], sum)
# bronchodilators201806$PERIOD <- 201806
# bronchodilators201806$Druggroup <- "Bronchodilators"
# opioddep201806 <- aggregate(opioddep201806[-c(1:5, 11)], opioddep201806["PRACTICE"], sum)
# opioddep201806$PERIOD <- 201806
# opioddep201806$Druggroup <- "Opiod"
# nicotinedep201806 <- aggregate(nicotinedep201806[-c(1:5, 11)], nicotinedep201806["PRACTICE"], sum)
# nicotinedep201806$PERIOD <- 201806
# nicotinedep201806$Druggroup <- "Nicotine"
# alcoholdep201806 <- aggregate(alcoholdep201806[-c(1:5, 11)], alcoholdep201806["PRACTICE"], sum)
# alcoholdep201806$PERIOD <- 201806
# alcoholdep201806$Druggroup <- "Alcohol"
# allsubstancedep201806 <- aggregate(allsubstancedep201806[-c(1:5, 11)], allsubstancedep201806["PRACTICE"], sum)
# allsubstancedep201806$PERIOD <- 201806
# allsubstancedep201806$Druggroup <- "SubstanceDep"
# obesedrugs201806 <- aggregate(obesedrugs201806[-c(1:5, 11)], obesedrugs201806["PRACTICE"], sum)
# obesedrugs201806$PERIOD <- 201806
# obesedrugs201806$Druggroup <- "Obesity"
# 
# prescribemaster201806 <- do.call("rbind", list(obesedrugs201806, allsubstancedep201806, alcoholdep201806, 
#                                                nicotinedep201806,opioddep201806, bronchodilators201806,
#                                                antidep201806, diabetes201806, dementia201806))
# 
# 
# write.csv(prescribemaster201806, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201806.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201805 <- read_csv("H:/prescription data/T201805PDPI BNFT.csv")
# prescribe201805$drugcode <- parse_number(prescribe201805$`BNF CODE`)
# prescribe201805$drugcode <- substr(prescribe201805$drugcode, 0, 6)
# antidep201805 <- prescribe201805[which(prescribe201805$drugcode>=403000&prescribe201805$drugcode<404000),]
# obesedrugs201805 <- prescribe201805[which(prescribe201805$drugcode>=405000&prescribe201805$drugcode<406000),]
# allsubstancedep201805 <- prescribe201805[which(prescribe201805$drugcode>=410000&prescribe201805$drugcode<411000),]
# alcoholdep201805 <- prescribe201805[which(prescribe201805$drugcode>=410010&prescribe201805$drugcode<410020),]
# nicotinedep201805 <- prescribe201805[which(prescribe201805$drugcode>=410020&prescribe201805$drugcode<410030),]
# opioddep201805 <- prescribe201805[which(prescribe201805$drugcode>=410030&prescribe201805$drugcode<411000),]
# bronchodilators201805 <- prescribe201805[which(prescribe201805$drugcode>=310000&prescribe201805$drugcode<320000),]
# dementia201805 <- prescribe201805[which(prescribe201805$drugcode>=411000&prescribe201805$drugcode<500000),]
# diabetes201805 <- prescribe201805[which(prescribe201805$drugcode>=601000&prescribe201805$drugcode<602000),]
# 
# antidep201805 <- aggregate(antidep201805[-c(1:5, 11)], antidep201805["PRACTICE"], sum)
# antidep201805$PERIOD <- 201805
# antidep201805$Druggroup <- "Antidepressant"
# dementia201805 <- aggregate(dementia201805[-c(1:5, 11)], dementia201805["PRACTICE"], sum)
# dementia201805$PERIOD <- 201805
# dementia201805$Druggroup <- "Dementia"
# diabetes201805 <- aggregate(diabetes201805[-c(1:5, 11)], diabetes201805["PRACTICE"], sum)
# diabetes201805$PERIOD <- 201805
# diabetes201805$Druggroup <- "Diabetes"
# 
# bronchodilators201805 <- aggregate(bronchodilators201805[-c(1:5, 11)], bronchodilators201805["PRACTICE"], sum)
# bronchodilators201805$PERIOD <- 201805
# bronchodilators201805$Druggroup <- "Bronchodilators"
# opioddep201805 <- aggregate(opioddep201805[-c(1:5, 11)], opioddep201805["PRACTICE"], sum)
# opioddep201805$PERIOD <- 201805
# opioddep201805$Druggroup <- "Opiod"
# nicotinedep201805 <- aggregate(nicotinedep201805[-c(1:5, 11)], nicotinedep201805["PRACTICE"], sum)
# nicotinedep201805$PERIOD <- 201805
# nicotinedep201805$Druggroup <- "Nicotine"
# alcoholdep201805 <- aggregate(alcoholdep201805[-c(1:5, 11)], alcoholdep201805["PRACTICE"], sum)
# alcoholdep201805$PERIOD <- 201805
# alcoholdep201805$Druggroup <- "Alcohol"
# allsubstancedep201805 <- aggregate(allsubstancedep201805[-c(1:5, 11)], allsubstancedep201805["PRACTICE"], sum)
# allsubstancedep201805$PERIOD <- 201805
# allsubstancedep201805$Druggroup <- "SubstanceDep"
# obesedrugs201805 <- aggregate(obesedrugs201805[-c(1:5, 11)], obesedrugs201805["PRACTICE"], sum)
# obesedrugs201805$PERIOD <- 201805
# obesedrugs201805$Druggroup <- "Obesity"
# 
# prescribemaster201805 <- do.call("rbind", list(obesedrugs201805, allsubstancedep201805, alcoholdep201805, 
#                                                nicotinedep201805,opioddep201805, bronchodilators201805,
#                                                antidep201805, diabetes201805, dementia201805))
# 
# 
# write.csv(prescribemaster201805, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201805.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201804 <- read_csv("H:/prescription data/T201804PDPI BNFT.csv")
# prescribe201804$drugcode <- parse_number(prescribe201804$`BNF CODE`)
# prescribe201804$drugcode <- substr(prescribe201804$drugcode, 0, 6)
# antidep201804 <- prescribe201804[which(prescribe201804$drugcode>=403000&prescribe201804$drugcode<404000),]
# obesedrugs201804 <- prescribe201804[which(prescribe201804$drugcode>=405000&prescribe201804$drugcode<406000),]
# allsubstancedep201804 <- prescribe201804[which(prescribe201804$drugcode>=410000&prescribe201804$drugcode<411000),]
# alcoholdep201804 <- prescribe201804[which(prescribe201804$drugcode>=410010&prescribe201804$drugcode<410020),]
# nicotinedep201804 <- prescribe201804[which(prescribe201804$drugcode>=410020&prescribe201804$drugcode<410030),]
# opioddep201804 <- prescribe201804[which(prescribe201804$drugcode>=410030&prescribe201804$drugcode<411000),]
# bronchodilators201804 <- prescribe201804[which(prescribe201804$drugcode>=310000&prescribe201804$drugcode<320000),]
# dementia201804 <- prescribe201804[which(prescribe201804$drugcode>=411000&prescribe201804$drugcode<500000),]
# diabetes201804 <- prescribe201804[which(prescribe201804$drugcode>=601000&prescribe201804$drugcode<602000),]
# 
# antidep201804 <- aggregate(antidep201804[-c(1:5, 11)], antidep201804["PRACTICE"], sum)
# antidep201804$PERIOD <- 201804
# antidep201804$Druggroup <- "Antidepressant"
# dementia201804 <- aggregate(dementia201804[-c(1:5, 11)], dementia201804["PRACTICE"], sum)
# dementia201804$PERIOD <- 201804
# dementia201804$Druggroup <- "Dementia"
# diabetes201804 <- aggregate(diabetes201804[-c(1:5, 11)], diabetes201804["PRACTICE"], sum)
# diabetes201804$PERIOD <- 201804
# diabetes201804$Druggroup <- "Diabetes"
# 
# bronchodilators201804 <- aggregate(bronchodilators201804[-c(1:5, 11)], bronchodilators201804["PRACTICE"], sum)
# bronchodilators201804$PERIOD <- 201804
# bronchodilators201804$Druggroup <- "Bronchodilators"
# opioddep201804 <- aggregate(opioddep201804[-c(1:5, 11)], opioddep201804["PRACTICE"], sum)
# opioddep201804$PERIOD <- 201804
# opioddep201804$Druggroup <- "Opiod"
# nicotinedep201804 <- aggregate(nicotinedep201804[-c(1:5, 11)], nicotinedep201804["PRACTICE"], sum)
# nicotinedep201804$PERIOD <- 201804
# nicotinedep201804$Druggroup <- "Nicotine"
# alcoholdep201804 <- aggregate(alcoholdep201804[-c(1:5, 11)], alcoholdep201804["PRACTICE"], sum)
# alcoholdep201804$PERIOD <- 201804
# alcoholdep201804$Druggroup <- "Alcohol"
# allsubstancedep201804 <- aggregate(allsubstancedep201804[-c(1:5, 11)], allsubstancedep201804["PRACTICE"], sum)
# allsubstancedep201804$PERIOD <- 201804
# allsubstancedep201804$Druggroup <- "SubstanceDep"
# obesedrugs201804 <- aggregate(obesedrugs201804[-c(1:5, 11)], obesedrugs201804["PRACTICE"], sum)
# obesedrugs201804$PERIOD <- 201804
# obesedrugs201804$Druggroup <- "Obesity"
# 
# prescribemaster201804 <- do.call("rbind", list(obesedrugs201804, allsubstancedep201804, alcoholdep201804, 
#                                                nicotinedep201804,opioddep201804, bronchodilators201804,
#                                                antidep201804, diabetes201804, dementia201804))
# 
# 
# write.csv(prescribemaster201804, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201804.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201803 <- read_csv("H:/prescription data/T201803PDPI BNFT.csv")
# prescribe201803$drugcode <- parse_number(prescribe201803$`BNF CODE`)
# prescribe201803$drugcode <- substr(prescribe201803$drugcode, 0, 6)
# antidep201803 <- prescribe201803[which(prescribe201803$drugcode>=403000&prescribe201803$drugcode<404000),]
# obesedrugs201803 <- prescribe201803[which(prescribe201803$drugcode>=405000&prescribe201803$drugcode<406000),]
# allsubstancedep201803 <- prescribe201803[which(prescribe201803$drugcode>=410000&prescribe201803$drugcode<411000),]
# alcoholdep201803 <- prescribe201803[which(prescribe201803$drugcode>=410010&prescribe201803$drugcode<410020),]
# nicotinedep201803 <- prescribe201803[which(prescribe201803$drugcode>=410020&prescribe201803$drugcode<410030),]
# opioddep201803 <- prescribe201803[which(prescribe201803$drugcode>=410030&prescribe201803$drugcode<411000),]
# bronchodilators201803 <- prescribe201803[which(prescribe201803$drugcode>=310000&prescribe201803$drugcode<320000),]
# dementia201803 <- prescribe201803[which(prescribe201803$drugcode>=411000&prescribe201803$drugcode<500000),]
# diabetes201803 <- prescribe201803[which(prescribe201803$drugcode>=601000&prescribe201803$drugcode<602000),]
# 
# antidep201803 <- aggregate(antidep201803[-c(1:5, 11)], antidep201803["PRACTICE"], sum)
# antidep201803$PERIOD <- 201803
# antidep201803$Druggroup <- "Antidepressant"
# dementia201803 <- aggregate(dementia201803[-c(1:5, 11)], dementia201803["PRACTICE"], sum)
# dementia201803$PERIOD <- 201803
# dementia201803$Druggroup <- "Dementia"
# diabetes201803 <- aggregate(diabetes201803[-c(1:5, 11)], diabetes201803["PRACTICE"], sum)
# diabetes201803$PERIOD <- 201803
# diabetes201803$Druggroup <- "Diabetes"
# 
# bronchodilators201803 <- aggregate(bronchodilators201803[-c(1:5, 11)], bronchodilators201803["PRACTICE"], sum)
# bronchodilators201803$PERIOD <- 201803
# bronchodilators201803$Druggroup <- "Bronchodilators"
# opioddep201803 <- aggregate(opioddep201803[-c(1:5, 11)], opioddep201803["PRACTICE"], sum)
# opioddep201803$PERIOD <- 201803
# opioddep201803$Druggroup <- "Opiod"
# nicotinedep201803 <- aggregate(nicotinedep201803[-c(1:5, 11)], nicotinedep201803["PRACTICE"], sum)
# nicotinedep201803$PERIOD <- 201803
# nicotinedep201803$Druggroup <- "Nicotine"
# alcoholdep201803 <- aggregate(alcoholdep201803[-c(1:5, 11)], alcoholdep201803["PRACTICE"], sum)
# alcoholdep201803$PERIOD <- 201803
# alcoholdep201803$Druggroup <- "Alcohol"
# allsubstancedep201803 <- aggregate(allsubstancedep201803[-c(1:5, 11)], allsubstancedep201803["PRACTICE"], sum)
# allsubstancedep201803$PERIOD <- 201803
# allsubstancedep201803$Druggroup <- "SubstanceDep"
# obesedrugs201803 <- aggregate(obesedrugs201803[-c(1:5, 11)], obesedrugs201803["PRACTICE"], sum)
# obesedrugs201803$PERIOD <- 201803
# obesedrugs201803$Druggroup <- "Obesity"
# 
# prescribemaster201803 <- do.call("rbind", list(obesedrugs201803, allsubstancedep201803, alcoholdep201803, 
#                                                nicotinedep201803,opioddep201803, bronchodilators201803,
#                                                antidep201803, diabetes201803, dementia201803))
# 
# 
# write.csv(prescribemaster201803, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201803.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201802 <- read_csv("H:/prescription data/T201802PDPI BNFT.csv")
# prescribe201802$drugcode <- parse_number(prescribe201802$`BNF CODE`)
# prescribe201802$drugcode <- substr(prescribe201802$drugcode, 0, 6)
# antidep201802 <- prescribe201802[which(prescribe201802$drugcode>=403000&prescribe201802$drugcode<404000),]
# obesedrugs201802 <- prescribe201802[which(prescribe201802$drugcode>=405000&prescribe201802$drugcode<406000),]
# allsubstancedep201802 <- prescribe201802[which(prescribe201802$drugcode>=410000&prescribe201802$drugcode<411000),]
# alcoholdep201802 <- prescribe201802[which(prescribe201802$drugcode>=410010&prescribe201802$drugcode<410020),]
# nicotinedep201802 <- prescribe201802[which(prescribe201802$drugcode>=410020&prescribe201802$drugcode<410030),]
# opioddep201802 <- prescribe201802[which(prescribe201802$drugcode>=410030&prescribe201802$drugcode<411000),]
# bronchodilators201802 <- prescribe201802[which(prescribe201802$drugcode>=310000&prescribe201802$drugcode<320000),]
# dementia201802 <- prescribe201802[which(prescribe201802$drugcode>=411000&prescribe201802$drugcode<500000),]
# diabetes201802 <- prescribe201802[which(prescribe201802$drugcode>=601000&prescribe201802$drugcode<602000),]
# 
# antidep201802 <- aggregate(antidep201802[-c(1:5, 11)], antidep201802["PRACTICE"], sum)
# antidep201802$PERIOD <- 201802
# antidep201802$Druggroup <- "Antidepressant"
# dementia201802 <- aggregate(dementia201802[-c(1:5, 11)], dementia201802["PRACTICE"], sum)
# dementia201802$PERIOD <- 201802
# dementia201802$Druggroup <- "Dementia"
# diabetes201802 <- aggregate(diabetes201802[-c(1:5, 11)], diabetes201802["PRACTICE"], sum)
# diabetes201802$PERIOD <- 201802
# diabetes201802$Druggroup <- "Diabetes"
# 
# bronchodilators201802 <- aggregate(bronchodilators201802[-c(1:5, 11)], bronchodilators201802["PRACTICE"], sum)
# bronchodilators201802$PERIOD <- 201802
# bronchodilators201802$Druggroup <- "Bronchodilators"
# opioddep201802 <- aggregate(opioddep201802[-c(1:5, 11)], opioddep201802["PRACTICE"], sum)
# opioddep201802$PERIOD <- 201802
# opioddep201802$Druggroup <- "Opiod"
# nicotinedep201802 <- aggregate(nicotinedep201802[-c(1:5, 11)], nicotinedep201802["PRACTICE"], sum)
# nicotinedep201802$PERIOD <- 201802
# nicotinedep201802$Druggroup <- "Nicotine"
# alcoholdep201802 <- aggregate(alcoholdep201802[-c(1:5, 11)], alcoholdep201802["PRACTICE"], sum)
# alcoholdep201802$PERIOD <- 201802
# alcoholdep201802$Druggroup <- "Alcohol"
# allsubstancedep201802 <- aggregate(allsubstancedep201802[-c(1:5, 11)], allsubstancedep201802["PRACTICE"], sum)
# allsubstancedep201802$PERIOD <- 201802
# allsubstancedep201802$Druggroup <- "SubstanceDep"
# obesedrugs201802 <- aggregate(obesedrugs201802[-c(1:5, 11)], obesedrugs201802["PRACTICE"], sum)
# obesedrugs201802$PERIOD <- 201802
# obesedrugs201802$Druggroup <- "Obesity"
# 
# prescribemaster201802 <- do.call("rbind", list(obesedrugs201802, allsubstancedep201802, alcoholdep201802, 
#                                                nicotinedep201802,opioddep201802, bronchodilators201802,
#                                                antidep201802, diabetes201802, dementia201802))
# 
# 
# write.csv(prescribemaster201802, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201802.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201801 <- read_csv("H:/prescription data/T201801PDPI BNFT.csv")
# prescribe201801$drugcode <- parse_number(prescribe201801$`BNF CODE`)
# prescribe201801$drugcode <- substr(prescribe201801$drugcode, 0, 6)
# antidep201801 <- prescribe201801[which(prescribe201801$drugcode>=403000&prescribe201801$drugcode<404000),]
# obesedrugs201801 <- prescribe201801[which(prescribe201801$drugcode>=405000&prescribe201801$drugcode<406000),]
# allsubstancedep201801 <- prescribe201801[which(prescribe201801$drugcode>=410000&prescribe201801$drugcode<411000),]
# alcoholdep201801 <- prescribe201801[which(prescribe201801$drugcode>=410010&prescribe201801$drugcode<410020),]
# nicotinedep201801 <- prescribe201801[which(prescribe201801$drugcode>=410020&prescribe201801$drugcode<410030),]
# opioddep201801 <- prescribe201801[which(prescribe201801$drugcode>=410030&prescribe201801$drugcode<411000),]
# bronchodilators201801 <- prescribe201801[which(prescribe201801$drugcode>=310000&prescribe201801$drugcode<320000),]
# dementia201801 <- prescribe201801[which(prescribe201801$drugcode>=411000&prescribe201801$drugcode<500000),]
# diabetes201801 <- prescribe201801[which(prescribe201801$drugcode>=601000&prescribe201801$drugcode<602000),]
# 
# antidep201801 <- aggregate(antidep201801[-c(1:5, 11)], antidep201801["PRACTICE"], sum)
# antidep201801$PERIOD <- 201801
# antidep201801$Druggroup <- "Antidepressant"
# dementia201801 <- aggregate(dementia201801[-c(1:5, 11)], dementia201801["PRACTICE"], sum)
# dementia201801$PERIOD <- 201801
# dementia201801$Druggroup <- "Dementia"
# diabetes201801 <- aggregate(diabetes201801[-c(1:5, 11)], diabetes201801["PRACTICE"], sum)
# diabetes201801$PERIOD <- 201801
# diabetes201801$Druggroup <- "Diabetes"
# 
# bronchodilators201801 <- aggregate(bronchodilators201801[-c(1:5, 11)], bronchodilators201801["PRACTICE"], sum)
# bronchodilators201801$PERIOD <- 201801
# bronchodilators201801$Druggroup <- "Bronchodilators"
# opioddep201801 <- aggregate(opioddep201801[-c(1:5, 11)], opioddep201801["PRACTICE"], sum)
# opioddep201801$PERIOD <- 201801
# opioddep201801$Druggroup <- "Opiod"
# nicotinedep201801 <- aggregate(nicotinedep201801[-c(1:5, 11)], nicotinedep201801["PRACTICE"], sum)
# nicotinedep201801$PERIOD <- 201801
# nicotinedep201801$Druggroup <- "Nicotine"
# alcoholdep201801 <- aggregate(alcoholdep201801[-c(1:5, 11)], alcoholdep201801["PRACTICE"], sum)
# alcoholdep201801$PERIOD <- 201801
# alcoholdep201801$Druggroup <- "Alcohol"
# allsubstancedep201801 <- aggregate(allsubstancedep201801[-c(1:5, 11)], allsubstancedep201801["PRACTICE"], sum)
# allsubstancedep201801$PERIOD <- 201801
# allsubstancedep201801$Druggroup <- "SubstanceDep"
# obesedrugs201801 <- aggregate(obesedrugs201801[-c(1:5, 11)], obesedrugs201801["PRACTICE"], sum)
# obesedrugs201801$PERIOD <- 201801
# obesedrugs201801$Druggroup <- "Obesity"
# 
# prescribemaster201801 <- do.call("rbind", list(obesedrugs201801, allsubstancedep201801, alcoholdep201801, 
#                                                nicotinedep201801,opioddep201801, bronchodilators201801,
#                                                antidep201801, diabetes201801, dementia201801))
# 
# 
# write.csv(prescribemaster201801, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201801.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201712 <- read_csv("H:/prescription data/T201712PDPI BNFT.csv")
# prescribe201712$drugcode <- parse_number(prescribe201712$`BNF CODE`)
# prescribe201712$drugcode <- substr(prescribe201712$drugcode, 0, 6)
# antidep201712 <- prescribe201712[which(prescribe201712$drugcode>=403000&prescribe201712$drugcode<404000),]
# obesedrugs201712 <- prescribe201712[which(prescribe201712$drugcode>=405000&prescribe201712$drugcode<406000),]
# allsubstancedep201712 <- prescribe201712[which(prescribe201712$drugcode>=410000&prescribe201712$drugcode<411000),]
# alcoholdep201712 <- prescribe201712[which(prescribe201712$drugcode>=410010&prescribe201712$drugcode<410020),]
# nicotinedep201712 <- prescribe201712[which(prescribe201712$drugcode>=410020&prescribe201712$drugcode<410030),]
# opioddep201712 <- prescribe201712[which(prescribe201712$drugcode>=410030&prescribe201712$drugcode<411000),]
# bronchodilators201712 <- prescribe201712[which(prescribe201712$drugcode>=310000&prescribe201712$drugcode<320000),]
# dementia201712 <- prescribe201712[which(prescribe201712$drugcode>=411000&prescribe201712$drugcode<500000),]
# diabetes201712 <- prescribe201712[which(prescribe201712$drugcode>=601000&prescribe201712$drugcode<602000),]
# 
# antidep201712 <- aggregate(antidep201712[-c(1:5, 11)], antidep201712["PRACTICE"], sum)
# antidep201712$PERIOD <- 201712
# antidep201712$Druggroup <- "Antidepressant"
# dementia201712 <- aggregate(dementia201712[-c(1:5, 11)], dementia201712["PRACTICE"], sum)
# dementia201712$PERIOD <- 201712
# dementia201712$Druggroup <- "Dementia"
# diabetes201712 <- aggregate(diabetes201712[-c(1:5, 11)], diabetes201712["PRACTICE"], sum)
# diabetes201712$PERIOD <- 201712
# diabetes201712$Druggroup <- "Diabetes"
# 
# bronchodilators201712 <- aggregate(bronchodilators201712[-c(1:5, 11)], bronchodilators201712["PRACTICE"], sum)
# bronchodilators201712$PERIOD <- 201712
# bronchodilators201712$Druggroup <- "Bronchodilators"
# opioddep201712 <- aggregate(opioddep201712[-c(1:5, 11)], opioddep201712["PRACTICE"], sum)
# opioddep201712$PERIOD <- 201712
# opioddep201712$Druggroup <- "Opiod"
# nicotinedep201712 <- aggregate(nicotinedep201712[-c(1:5, 11)], nicotinedep201712["PRACTICE"], sum)
# nicotinedep201712$PERIOD <- 201712
# nicotinedep201712$Druggroup <- "Nicotine"
# alcoholdep201712 <- aggregate(alcoholdep201712[-c(1:5, 11)], alcoholdep201712["PRACTICE"], sum)
# alcoholdep201712$PERIOD <- 201712
# alcoholdep201712$Druggroup <- "Alcohol"
# allsubstancedep201712 <- aggregate(allsubstancedep201712[-c(1:5, 11)], allsubstancedep201712["PRACTICE"], sum)
# allsubstancedep201712$PERIOD <- 201712
# allsubstancedep201712$Druggroup <- "SubstanceDep"
# obesedrugs201712 <- aggregate(obesedrugs201712[-c(1:5, 11)], obesedrugs201712["PRACTICE"], sum)
# obesedrugs201712$PERIOD <- 201712
# obesedrugs201712$Druggroup <- "Obesity"
# 
# prescribemaster201712 <- do.call("rbind", list(obesedrugs201712, allsubstancedep201712, alcoholdep201712, 
#                                                nicotinedep201712,opioddep201712, bronchodilators201712,
#                                                antidep201712, diabetes201712, dementia201712))
# 
# 
# write.csv(prescribemaster201712, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201712.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201711 <- read_csv("H:/prescription data/T201711PDPI BNFT.csv")
# prescribe201711$drugcode <- parse_number(prescribe201711$`BNF CODE`)
# prescribe201711$drugcode <- substr(prescribe201711$drugcode, 0, 6)
# antidep201711 <- prescribe201711[which(prescribe201711$drugcode>=403000&prescribe201711$drugcode<404000),]
# obesedrugs201711 <- prescribe201711[which(prescribe201711$drugcode>=405000&prescribe201711$drugcode<406000),]
# allsubstancedep201711 <- prescribe201711[which(prescribe201711$drugcode>=410000&prescribe201711$drugcode<411000),]
# alcoholdep201711 <- prescribe201711[which(prescribe201711$drugcode>=410010&prescribe201711$drugcode<410020),]
# nicotinedep201711 <- prescribe201711[which(prescribe201711$drugcode>=410020&prescribe201711$drugcode<410030),]
# opioddep201711 <- prescribe201711[which(prescribe201711$drugcode>=410030&prescribe201711$drugcode<411000),]
# bronchodilators201711 <- prescribe201711[which(prescribe201711$drugcode>=310000&prescribe201711$drugcode<320000),]
# dementia201711 <- prescribe201711[which(prescribe201711$drugcode>=411000&prescribe201711$drugcode<500000),]
# diabetes201711 <- prescribe201711[which(prescribe201711$drugcode>=601000&prescribe201711$drugcode<602000),]
# 
# antidep201711 <- aggregate(antidep201711[-c(1:5, 11)], antidep201711["PRACTICE"], sum)
# antidep201711$PERIOD <- 201711
# antidep201711$Druggroup <- "Antidepressant"
# dementia201711 <- aggregate(dementia201711[-c(1:5, 11)], dementia201711["PRACTICE"], sum)
# dementia201711$PERIOD <- 201711
# dementia201711$Druggroup <- "Dementia"
# diabetes201711 <- aggregate(diabetes201711[-c(1:5, 11)], diabetes201711["PRACTICE"], sum)
# diabetes201711$PERIOD <- 201711
# diabetes201711$Druggroup <- "Diabetes"
# 
# bronchodilators201711 <- aggregate(bronchodilators201711[-c(1:5, 11)], bronchodilators201711["PRACTICE"], sum)
# bronchodilators201711$PERIOD <- 201711
# bronchodilators201711$Druggroup <- "Bronchodilators"
# opioddep201711 <- aggregate(opioddep201711[-c(1:5, 11)], opioddep201711["PRACTICE"], sum)
# opioddep201711$PERIOD <- 201711
# opioddep201711$Druggroup <- "Opiod"
# nicotinedep201711 <- aggregate(nicotinedep201711[-c(1:5, 11)], nicotinedep201711["PRACTICE"], sum)
# nicotinedep201711$PERIOD <- 201711
# nicotinedep201711$Druggroup <- "Nicotine"
# alcoholdep201711 <- aggregate(alcoholdep201711[-c(1:5, 11)], alcoholdep201711["PRACTICE"], sum)
# alcoholdep201711$PERIOD <- 201711
# alcoholdep201711$Druggroup <- "Alcohol"
# allsubstancedep201711 <- aggregate(allsubstancedep201711[-c(1:5, 11)], allsubstancedep201711["PRACTICE"], sum)
# allsubstancedep201711$PERIOD <- 201711
# allsubstancedep201711$Druggroup <- "SubstanceDep"
# obesedrugs201711 <- aggregate(obesedrugs201711[-c(1:5, 11)], obesedrugs201711["PRACTICE"], sum)
# obesedrugs201711$PERIOD <- 201711
# obesedrugs201711$Druggroup <- "Obesity"
# 
# prescribemaster201711 <- do.call("rbind", list(obesedrugs201711, allsubstancedep201711, alcoholdep201711, 
#                                                nicotinedep201711,opioddep201711, bronchodilators201711,
#                                                antidep201711, diabetes201711, dementia201711))
# 
# 
# write.csv(prescribemaster201711, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201711.csv")
# 
# rm(list = ls(all.names = TRUE))
# 
# prescribe201710 <- read_csv("H:/prescription data/T201710PDPI BNFT.csv")
# prescribe201710$drugcode <- parse_number(prescribe201710$`BNF CODE`)
# prescribe201710$drugcode <- substr(prescribe201710$drugcode, 0, 6)
# antidep201710 <- prescribe201710[which(prescribe201710$drugcode>=403000&prescribe201710$drugcode<404000),]
# obesedrugs201710 <- prescribe201710[which(prescribe201710$drugcode>=405000&prescribe201710$drugcode<406000),]
# allsubstancedep201710 <- prescribe201710[which(prescribe201710$drugcode>=410000&prescribe201710$drugcode<411000),]
# alcoholdep201710 <- prescribe201710[which(prescribe201710$drugcode>=410010&prescribe201710$drugcode<410020),]
# nicotinedep201710 <- prescribe201710[which(prescribe201710$drugcode>=410020&prescribe201710$drugcode<410030),]
# opioddep201710 <- prescribe201710[which(prescribe201710$drugcode>=410030&prescribe201710$drugcode<411000),]
# bronchodilators201710 <- prescribe201710[which(prescribe201710$drugcode>=310000&prescribe201710$drugcode<320000),]
# dementia201710 <- prescribe201710[which(prescribe201710$drugcode>=411000&prescribe201710$drugcode<500000),]
# diabetes201710 <- prescribe201710[which(prescribe201710$drugcode>=601000&prescribe201710$drugcode<602000),]
# 
# antidep201710 <- aggregate(antidep201710[-c(1:5, 11)], antidep201710["PRACTICE"], sum)
# antidep201710$PERIOD <- 201710
# antidep201710$Druggroup <- "Antidepressant"
# dementia201710 <- aggregate(dementia201710[-c(1:5, 11)], dementia201710["PRACTICE"], sum)
# dementia201710$PERIOD <- 201710
# dementia201710$Druggroup <- "Dementia"
# diabetes201710 <- aggregate(diabetes201710[-c(1:5, 11)], diabetes201710["PRACTICE"], sum)
# diabetes201710$PERIOD <- 201710
# diabetes201710$Druggroup <- "Diabetes"
# 
# bronchodilators201710 <- aggregate(bronchodilators201710[-c(1:5, 11)], bronchodilators201710["PRACTICE"], sum)
# bronchodilators201710$PERIOD <- 201710
# bronchodilators201710$Druggroup <- "Bronchodilators"
# opioddep201710 <- aggregate(opioddep201710[-c(1:5, 11)], opioddep201710["PRACTICE"], sum)
# opioddep201710$PERIOD <- 201710
# opioddep201710$Druggroup <- "Opiod"
# nicotinedep201710 <- aggregate(nicotinedep201710[-c(1:5, 11)], nicotinedep201710["PRACTICE"], sum)
# nicotinedep201710$PERIOD <- 201710
# nicotinedep201710$Druggroup <- "Nicotine"
# alcoholdep201710 <- aggregate(alcoholdep201710[-c(1:5, 11)], alcoholdep201710["PRACTICE"], sum)
# alcoholdep201710$PERIOD <- 201710
# alcoholdep201710$Druggroup <- "Alcohol"
# allsubstancedep201710 <- aggregate(allsubstancedep201710[-c(1:5, 11)], allsubstancedep201710["PRACTICE"], sum)
# allsubstancedep201710$PERIOD <- 201710
# allsubstancedep201710$Druggroup <- "SubstanceDep"
# obesedrugs201710 <- aggregate(obesedrugs201710[-c(1:5, 11)], obesedrugs201710["PRACTICE"], sum)
# obesedrugs201710$PERIOD <- 201710
# obesedrugs201710$Druggroup <- "Obesity"
# 
# prescribemaster201710 <- do.call("rbind", list(obesedrugs201710, allsubstancedep201710, alcoholdep201710, 
#                                                nicotinedep201710,opioddep201710, bronchodilators201710,
#                                                antidep201710, diabetes201710, dementia201710))
# 
# 
# write.csv(prescribemaster201710, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201710.csv")
# 
# 
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201709 <- read_csv("H:/prescription data/T201709PDPI BNFT.csv")
# prescribe201709$drugcode <- parse_number(prescribe201709$`BNF CODE`)
# prescribe201709$drugcode <- substr(prescribe201709$drugcode, 0, 6)
# antidep201709 <- prescribe201709[which(prescribe201709$drugcode>=403000&prescribe201709$drugcode<404000),]
# obesedrugs201709 <- prescribe201709[which(prescribe201709$drugcode>=405000&prescribe201709$drugcode<406000),]
# allsubstancedep201709 <- prescribe201709[which(prescribe201709$drugcode>=410000&prescribe201709$drugcode<411000),]
# alcoholdep201709 <- prescribe201709[which(prescribe201709$drugcode>=410010&prescribe201709$drugcode<410020),]
# nicotinedep201709 <- prescribe201709[which(prescribe201709$drugcode>=410020&prescribe201709$drugcode<410030),]
# opioddep201709 <- prescribe201709[which(prescribe201709$drugcode>=410030&prescribe201709$drugcode<411000),]
# bronchodilators201709 <- prescribe201709[which(prescribe201709$drugcode>=310000&prescribe201709$drugcode<320000),]
# dementia201709 <- prescribe201709[which(prescribe201709$drugcode>=411000&prescribe201709$drugcode<500000),]
# diabetes201709 <- prescribe201709[which(prescribe201709$drugcode>=601000&prescribe201709$drugcode<602000),]
# 
# antidep201709 <- aggregate(antidep201709[-c(1:5, 11)], antidep201709["PRACTICE"], sum)
# antidep201709$PERIOD <- 201709
# antidep201709$Druggroup <- "Antidepressant"
# dementia201709 <- aggregate(dementia201709[-c(1:5, 11)], dementia201709["PRACTICE"], sum)
# dementia201709$PERIOD <- 201709
# dementia201709$Druggroup <- "Dementia"
# diabetes201709 <- aggregate(diabetes201709[-c(1:5, 11)], diabetes201709["PRACTICE"], sum)
# diabetes201709$PERIOD <- 201709
# diabetes201709$Druggroup <- "Diabetes"
# 
# bronchodilators201709 <- aggregate(bronchodilators201709[-c(1:5, 11)], bronchodilators201709["PRACTICE"], sum)
# bronchodilators201709$PERIOD <- 201709
# bronchodilators201709$Druggroup <- "Bronchodilators"
# opioddep201709 <- aggregate(opioddep201709[-c(1:5, 11)], opioddep201709["PRACTICE"], sum)
# opioddep201709$PERIOD <- 201709
# opioddep201709$Druggroup <- "Opiod"
# nicotinedep201709 <- aggregate(nicotinedep201709[-c(1:5, 11)], nicotinedep201709["PRACTICE"], sum)
# nicotinedep201709$PERIOD <- 201709
# nicotinedep201709$Druggroup <- "Nicotine"
# alcoholdep201709 <- aggregate(alcoholdep201709[-c(1:5, 11)], alcoholdep201709["PRACTICE"], sum)
# alcoholdep201709$PERIOD <- 201709
# alcoholdep201709$Druggroup <- "Alcohol"
# allsubstancedep201709 <- aggregate(allsubstancedep201709[-c(1:5, 11)], allsubstancedep201709["PRACTICE"], sum)
# allsubstancedep201709$PERIOD <- 201709
# allsubstancedep201709$Druggroup <- "SubstanceDep"
# obesedrugs201709 <- aggregate(obesedrugs201709[-c(1:5, 11)], obesedrugs201709["PRACTICE"], sum)
# obesedrugs201709$PERIOD <- 201709
# obesedrugs201709$Druggroup <- "Obesity"
# 
# prescribemaster201709 <- do.call("rbind", list(obesedrugs201709, allsubstancedep201709, alcoholdep201709, 
#                                                nicotinedep201709,opioddep201709, bronchodilators201709,
#                                                antidep201709, diabetes201709, dementia201709))
# 
# 
# write.csv(prescribemaster201709, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201709.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201708 <- read_csv("H:/prescription data/T201708PDPI BNFT.csv")
# prescribe201708$drugcode <- parse_number(prescribe201708$`BNF CODE`)
# prescribe201708$drugcode <- substr(prescribe201708$drugcode, 0, 6)
# antidep201708 <- prescribe201708[which(prescribe201708$drugcode>=403000&prescribe201708$drugcode<404000),]
# obesedrugs201708 <- prescribe201708[which(prescribe201708$drugcode>=405000&prescribe201708$drugcode<406000),]
# allsubstancedep201708 <- prescribe201708[which(prescribe201708$drugcode>=410000&prescribe201708$drugcode<411000),]
# alcoholdep201708 <- prescribe201708[which(prescribe201708$drugcode>=410010&prescribe201708$drugcode<410020),]
# nicotinedep201708 <- prescribe201708[which(prescribe201708$drugcode>=410020&prescribe201708$drugcode<410030),]
# opioddep201708 <- prescribe201708[which(prescribe201708$drugcode>=410030&prescribe201708$drugcode<411000),]
# bronchodilators201708 <- prescribe201708[which(prescribe201708$drugcode>=310000&prescribe201708$drugcode<320000),]
# dementia201708 <- prescribe201708[which(prescribe201708$drugcode>=411000&prescribe201708$drugcode<500000),]
# diabetes201708 <- prescribe201708[which(prescribe201708$drugcode>=601000&prescribe201708$drugcode<602000),]
# 
# antidep201708 <- aggregate(antidep201708[-c(1:5, 11)], antidep201708["PRACTICE"], sum)
# antidep201708$PERIOD <- 201708
# antidep201708$Druggroup <- "Antidepressant"
# dementia201708 <- aggregate(dementia201708[-c(1:5, 11)], dementia201708["PRACTICE"], sum)
# dementia201708$PERIOD <- 201708
# dementia201708$Druggroup <- "Dementia"
# diabetes201708 <- aggregate(diabetes201708[-c(1:5, 11)], diabetes201708["PRACTICE"], sum)
# diabetes201708$PERIOD <- 201708
# diabetes201708$Druggroup <- "Diabetes"
# 
# bronchodilators201708 <- aggregate(bronchodilators201708[-c(1:5, 11)], bronchodilators201708["PRACTICE"], sum)
# bronchodilators201708$PERIOD <- 201708
# bronchodilators201708$Druggroup <- "Bronchodilators"
# opioddep201708 <- aggregate(opioddep201708[-c(1:5, 11)], opioddep201708["PRACTICE"], sum)
# opioddep201708$PERIOD <- 201708
# opioddep201708$Druggroup <- "Opiod"
# nicotinedep201708 <- aggregate(nicotinedep201708[-c(1:5, 11)], nicotinedep201708["PRACTICE"], sum)
# nicotinedep201708$PERIOD <- 201708
# nicotinedep201708$Druggroup <- "Nicotine"
# alcoholdep201708 <- aggregate(alcoholdep201708[-c(1:5, 11)], alcoholdep201708["PRACTICE"], sum)
# alcoholdep201708$PERIOD <- 201708
# alcoholdep201708$Druggroup <- "Alcohol"
# allsubstancedep201708 <- aggregate(allsubstancedep201708[-c(1:5, 11)], allsubstancedep201708["PRACTICE"], sum)
# allsubstancedep201708$PERIOD <- 201708
# allsubstancedep201708$Druggroup <- "SubstanceDep"
# obesedrugs201708 <- aggregate(obesedrugs201708[-c(1:5, 11)], obesedrugs201708["PRACTICE"], sum)
# obesedrugs201708$PERIOD <- 201708
# obesedrugs201708$Druggroup <- "Obesity"
# 
# prescribemaster201708 <- do.call("rbind", list(obesedrugs201708, allsubstancedep201708, alcoholdep201708, 
#                                                nicotinedep201708,opioddep201708, bronchodilators201708,
#                                                antidep201708, diabetes201708, dementia201708))
# 
# 
# write.csv(prescribemaster201708, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201708.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201707 <- read_csv("H:/prescription data/T201707PDPI BNFT.csv")
# prescribe201707$drugcode <- parse_number(prescribe201707$`BNF CODE`)
# prescribe201707$drugcode <- substr(prescribe201707$drugcode, 0, 6)
# antidep201707 <- prescribe201707[which(prescribe201707$drugcode>=403000&prescribe201707$drugcode<404000),]
# obesedrugs201707 <- prescribe201707[which(prescribe201707$drugcode>=405000&prescribe201707$drugcode<406000),]
# allsubstancedep201707 <- prescribe201707[which(prescribe201707$drugcode>=410000&prescribe201707$drugcode<411000),]
# alcoholdep201707 <- prescribe201707[which(prescribe201707$drugcode>=410010&prescribe201707$drugcode<410020),]
# nicotinedep201707 <- prescribe201707[which(prescribe201707$drugcode>=410020&prescribe201707$drugcode<410030),]
# opioddep201707 <- prescribe201707[which(prescribe201707$drugcode>=410030&prescribe201707$drugcode<411000),]
# bronchodilators201707 <- prescribe201707[which(prescribe201707$drugcode>=310000&prescribe201707$drugcode<320000),]
# dementia201707 <- prescribe201707[which(prescribe201707$drugcode>=411000&prescribe201707$drugcode<500000),]
# diabetes201707 <- prescribe201707[which(prescribe201707$drugcode>=601000&prescribe201707$drugcode<602000),]
# 
# antidep201707 <- aggregate(antidep201707[-c(1:5, 11)], antidep201707["PRACTICE"], sum)
# antidep201707$PERIOD <- 201707
# antidep201707$Druggroup <- "Antidepressant"
# dementia201707 <- aggregate(dementia201707[-c(1:5, 11)], dementia201707["PRACTICE"], sum)
# dementia201707$PERIOD <- 201707
# dementia201707$Druggroup <- "Dementia"
# diabetes201707 <- aggregate(diabetes201707[-c(1:5, 11)], diabetes201707["PRACTICE"], sum)
# diabetes201707$PERIOD <- 201707
# diabetes201707$Druggroup <- "Diabetes"
# 
# bronchodilators201707 <- aggregate(bronchodilators201707[-c(1:5, 11)], bronchodilators201707["PRACTICE"], sum)
# bronchodilators201707$PERIOD <- 201707
# bronchodilators201707$Druggroup <- "Bronchodilators"
# opioddep201707 <- aggregate(opioddep201707[-c(1:5, 11)], opioddep201707["PRACTICE"], sum)
# opioddep201707$PERIOD <- 201707
# opioddep201707$Druggroup <- "Opiod"
# nicotinedep201707 <- aggregate(nicotinedep201707[-c(1:5, 11)], nicotinedep201707["PRACTICE"], sum)
# nicotinedep201707$PERIOD <- 201707
# nicotinedep201707$Druggroup <- "Nicotine"
# alcoholdep201707 <- aggregate(alcoholdep201707[-c(1:5, 11)], alcoholdep201707["PRACTICE"], sum)
# alcoholdep201707$PERIOD <- 201707
# alcoholdep201707$Druggroup <- "Alcohol"
# allsubstancedep201707 <- aggregate(allsubstancedep201707[-c(1:5, 11)], allsubstancedep201707["PRACTICE"], sum)
# allsubstancedep201707$PERIOD <- 201707
# allsubstancedep201707$Druggroup <- "SubstanceDep"
# obesedrugs201707 <- aggregate(obesedrugs201707[-c(1:5, 11)], obesedrugs201707["PRACTICE"], sum)
# obesedrugs201707$PERIOD <- 201707
# obesedrugs201707$Druggroup <- "Obesity"
# 
# prescribemaster201707 <- do.call("rbind", list(obesedrugs201707, allsubstancedep201707, alcoholdep201707, 
#                                                nicotinedep201707,opioddep201707, bronchodilators201707,
#                                                antidep201707, diabetes201707, dementia201707))
# 
# 
# write.csv(prescribemaster201707, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201707.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201706 <- read_csv("H:/prescription data/T201706PDPI BNFT.csv")
# prescribe201706$drugcode <- parse_number(prescribe201706$`BNF CODE`)
# prescribe201706$drugcode <- substr(prescribe201706$drugcode, 0, 6)
# antidep201706 <- prescribe201706[which(prescribe201706$drugcode>=403000&prescribe201706$drugcode<404000),]
# obesedrugs201706 <- prescribe201706[which(prescribe201706$drugcode>=405000&prescribe201706$drugcode<406000),]
# allsubstancedep201706 <- prescribe201706[which(prescribe201706$drugcode>=410000&prescribe201706$drugcode<411000),]
# alcoholdep201706 <- prescribe201706[which(prescribe201706$drugcode>=410010&prescribe201706$drugcode<410020),]
# nicotinedep201706 <- prescribe201706[which(prescribe201706$drugcode>=410020&prescribe201706$drugcode<410030),]
# opioddep201706 <- prescribe201706[which(prescribe201706$drugcode>=410030&prescribe201706$drugcode<411000),]
# bronchodilators201706 <- prescribe201706[which(prescribe201706$drugcode>=310000&prescribe201706$drugcode<320000),]
# dementia201706 <- prescribe201706[which(prescribe201706$drugcode>=411000&prescribe201706$drugcode<500000),]
# diabetes201706 <- prescribe201706[which(prescribe201706$drugcode>=601000&prescribe201706$drugcode<602000),]
# 
# antidep201706 <- aggregate(antidep201706[-c(1:5, 11)], antidep201706["PRACTICE"], sum)
# antidep201706$PERIOD <- 201706
# antidep201706$Druggroup <- "Antidepressant"
# dementia201706 <- aggregate(dementia201706[-c(1:5, 11)], dementia201706["PRACTICE"], sum)
# dementia201706$PERIOD <- 201706
# dementia201706$Druggroup <- "Dementia"
# diabetes201706 <- aggregate(diabetes201706[-c(1:5, 11)], diabetes201706["PRACTICE"], sum)
# diabetes201706$PERIOD <- 201706
# diabetes201706$Druggroup <- "Diabetes"
# 
# bronchodilators201706 <- aggregate(bronchodilators201706[-c(1:5, 11)], bronchodilators201706["PRACTICE"], sum)
# bronchodilators201706$PERIOD <- 201706
# bronchodilators201706$Druggroup <- "Bronchodilators"
# opioddep201706 <- aggregate(opioddep201706[-c(1:5, 11)], opioddep201706["PRACTICE"], sum)
# opioddep201706$PERIOD <- 201706
# opioddep201706$Druggroup <- "Opiod"
# nicotinedep201706 <- aggregate(nicotinedep201706[-c(1:5, 11)], nicotinedep201706["PRACTICE"], sum)
# nicotinedep201706$PERIOD <- 201706
# nicotinedep201706$Druggroup <- "Nicotine"
# alcoholdep201706 <- aggregate(alcoholdep201706[-c(1:5, 11)], alcoholdep201706["PRACTICE"], sum)
# alcoholdep201706$PERIOD <- 201706
# alcoholdep201706$Druggroup <- "Alcohol"
# allsubstancedep201706 <- aggregate(allsubstancedep201706[-c(1:5, 11)], allsubstancedep201706["PRACTICE"], sum)
# allsubstancedep201706$PERIOD <- 201706
# allsubstancedep201706$Druggroup <- "SubstanceDep"
# obesedrugs201706 <- aggregate(obesedrugs201706[-c(1:5, 11)], obesedrugs201706["PRACTICE"], sum)
# obesedrugs201706$PERIOD <- 201706
# obesedrugs201706$Druggroup <- "Obesity"
# 
# prescribemaster201706 <- do.call("rbind", list(obesedrugs201706, allsubstancedep201706, alcoholdep201706, 
#                                                nicotinedep201706,opioddep201706, bronchodilators201706,
#                                                antidep201706, diabetes201706, dementia201706))
# 
# 
# write.csv(prescribemaster201706, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201706.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201705 <- read_csv("H:/prescription data/T201705PDPI BNFT.csv")
# prescribe201705$drugcode <- parse_number(prescribe201705$`BNF CODE`)
# prescribe201705$drugcode <- substr(prescribe201705$drugcode, 0, 6)
# antidep201705 <- prescribe201705[which(prescribe201705$drugcode>=403000&prescribe201705$drugcode<404000),]
# obesedrugs201705 <- prescribe201705[which(prescribe201705$drugcode>=405000&prescribe201705$drugcode<406000),]
# allsubstancedep201705 <- prescribe201705[which(prescribe201705$drugcode>=410000&prescribe201705$drugcode<411000),]
# alcoholdep201705 <- prescribe201705[which(prescribe201705$drugcode>=410010&prescribe201705$drugcode<410020),]
# nicotinedep201705 <- prescribe201705[which(prescribe201705$drugcode>=410020&prescribe201705$drugcode<410030),]
# opioddep201705 <- prescribe201705[which(prescribe201705$drugcode>=410030&prescribe201705$drugcode<411000),]
# bronchodilators201705 <- prescribe201705[which(prescribe201705$drugcode>=310000&prescribe201705$drugcode<320000),]
# dementia201705 <- prescribe201705[which(prescribe201705$drugcode>=411000&prescribe201705$drugcode<500000),]
# diabetes201705 <- prescribe201705[which(prescribe201705$drugcode>=601000&prescribe201705$drugcode<602000),]
# 
# antidep201705 <- aggregate(antidep201705[-c(1:5, 11)], antidep201705["PRACTICE"], sum)
# antidep201705$PERIOD <- 201705
# antidep201705$Druggroup <- "Antidepressant"
# dementia201705 <- aggregate(dementia201705[-c(1:5, 11)], dementia201705["PRACTICE"], sum)
# dementia201705$PERIOD <- 201705
# dementia201705$Druggroup <- "Dementia"
# diabetes201705 <- aggregate(diabetes201705[-c(1:5, 11)], diabetes201705["PRACTICE"], sum)
# diabetes201705$PERIOD <- 201705
# diabetes201705$Druggroup <- "Diabetes"
# 
# bronchodilators201705 <- aggregate(bronchodilators201705[-c(1:5, 11)], bronchodilators201705["PRACTICE"], sum)
# bronchodilators201705$PERIOD <- 201705
# bronchodilators201705$Druggroup <- "Bronchodilators"
# opioddep201705 <- aggregate(opioddep201705[-c(1:5, 11)], opioddep201705["PRACTICE"], sum)
# opioddep201705$PERIOD <- 201705
# opioddep201705$Druggroup <- "Opiod"
# nicotinedep201705 <- aggregate(nicotinedep201705[-c(1:5, 11)], nicotinedep201705["PRACTICE"], sum)
# nicotinedep201705$PERIOD <- 201705
# nicotinedep201705$Druggroup <- "Nicotine"
# alcoholdep201705 <- aggregate(alcoholdep201705[-c(1:5, 11)], alcoholdep201705["PRACTICE"], sum)
# alcoholdep201705$PERIOD <- 201705
# alcoholdep201705$Druggroup <- "Alcohol"
# allsubstancedep201705 <- aggregate(allsubstancedep201705[-c(1:5, 11)], allsubstancedep201705["PRACTICE"], sum)
# allsubstancedep201705$PERIOD <- 201705
# allsubstancedep201705$Druggroup <- "SubstanceDep"
# obesedrugs201705 <- aggregate(obesedrugs201705[-c(1:5, 11)], obesedrugs201705["PRACTICE"], sum)
# obesedrugs201705$PERIOD <- 201705
# obesedrugs201705$Druggroup <- "Obesity"
# 
# prescribemaster201705 <- do.call("rbind", list(obesedrugs201705, allsubstancedep201705, alcoholdep201705, 
#                                                nicotinedep201705,opioddep201705, bronchodilators201705,
#                                                antidep201705, diabetes201705, dementia201705))
# 
# 
# write.csv(prescribemaster201705, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201705.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201704 <- read_csv("H:/prescription data/T201704PDPI BNFT.csv")
# prescribe201704$drugcode <- parse_number(prescribe201704$`BNF CODE`)
# prescribe201704$drugcode <- substr(prescribe201704$drugcode, 0, 6)
# antidep201704 <- prescribe201704[which(prescribe201704$drugcode>=403000&prescribe201704$drugcode<404000),]
# obesedrugs201704 <- prescribe201704[which(prescribe201704$drugcode>=405000&prescribe201704$drugcode<406000),]
# allsubstancedep201704 <- prescribe201704[which(prescribe201704$drugcode>=410000&prescribe201704$drugcode<411000),]
# alcoholdep201704 <- prescribe201704[which(prescribe201704$drugcode>=410010&prescribe201704$drugcode<410020),]
# nicotinedep201704 <- prescribe201704[which(prescribe201704$drugcode>=410020&prescribe201704$drugcode<410030),]
# opioddep201704 <- prescribe201704[which(prescribe201704$drugcode>=410030&prescribe201704$drugcode<411000),]
# bronchodilators201704 <- prescribe201704[which(prescribe201704$drugcode>=310000&prescribe201704$drugcode<320000),]
# dementia201704 <- prescribe201704[which(prescribe201704$drugcode>=411000&prescribe201704$drugcode<500000),]
# diabetes201704 <- prescribe201704[which(prescribe201704$drugcode>=601000&prescribe201704$drugcode<602000),]
# 
# antidep201704 <- aggregate(antidep201704[-c(1:5, 11)], antidep201704["PRACTICE"], sum)
# antidep201704$PERIOD <- 201704
# antidep201704$Druggroup <- "Antidepressant"
# dementia201704 <- aggregate(dementia201704[-c(1:5, 11)], dementia201704["PRACTICE"], sum)
# dementia201704$PERIOD <- 201704
# dementia201704$Druggroup <- "Dementia"
# diabetes201704 <- aggregate(diabetes201704[-c(1:5, 11)], diabetes201704["PRACTICE"], sum)
# diabetes201704$PERIOD <- 201704
# diabetes201704$Druggroup <- "Diabetes"
# 
# bronchodilators201704 <- aggregate(bronchodilators201704[-c(1:5, 11)], bronchodilators201704["PRACTICE"], sum)
# bronchodilators201704$PERIOD <- 201704
# bronchodilators201704$Druggroup <- "Bronchodilators"
# opioddep201704 <- aggregate(opioddep201704[-c(1:5, 11)], opioddep201704["PRACTICE"], sum)
# opioddep201704$PERIOD <- 201704
# opioddep201704$Druggroup <- "Opiod"
# nicotinedep201704 <- aggregate(nicotinedep201704[-c(1:5, 11)], nicotinedep201704["PRACTICE"], sum)
# nicotinedep201704$PERIOD <- 201704
# nicotinedep201704$Druggroup <- "Nicotine"
# alcoholdep201704 <- aggregate(alcoholdep201704[-c(1:5, 11)], alcoholdep201704["PRACTICE"], sum)
# alcoholdep201704$PERIOD <- 201704
# alcoholdep201704$Druggroup <- "Alcohol"
# allsubstancedep201704 <- aggregate(allsubstancedep201704[-c(1:5, 11)], allsubstancedep201704["PRACTICE"], sum)
# allsubstancedep201704$PERIOD <- 201704
# allsubstancedep201704$Druggroup <- "SubstanceDep"
# obesedrugs201704 <- aggregate(obesedrugs201704[-c(1:5, 11)], obesedrugs201704["PRACTICE"], sum)
# obesedrugs201704$PERIOD <- 201704
# obesedrugs201704$Druggroup <- "Obesity"
# 
# prescribemaster201704 <- do.call("rbind", list(obesedrugs201704, allsubstancedep201704, alcoholdep201704, 
#                                                nicotinedep201704,opioddep201704, bronchodilators201704,
#                                                antidep201704, diabetes201704, dementia201704))
# 
# 
# write.csv(prescribemaster201704, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201704.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201703 <- read_csv("H:/prescription data/T201703PDPI BNFT.csv")
# prescribe201703$drugcode <- parse_number(prescribe201703$`BNF CODE`)
# prescribe201703$drugcode <- substr(prescribe201703$drugcode, 0, 6)
# antidep201703 <- prescribe201703[which(prescribe201703$drugcode>=403000&prescribe201703$drugcode<404000),]
# obesedrugs201703 <- prescribe201703[which(prescribe201703$drugcode>=405000&prescribe201703$drugcode<406000),]
# allsubstancedep201703 <- prescribe201703[which(prescribe201703$drugcode>=410000&prescribe201703$drugcode<411000),]
# alcoholdep201703 <- prescribe201703[which(prescribe201703$drugcode>=410010&prescribe201703$drugcode<410020),]
# nicotinedep201703 <- prescribe201703[which(prescribe201703$drugcode>=410020&prescribe201703$drugcode<410030),]
# opioddep201703 <- prescribe201703[which(prescribe201703$drugcode>=410030&prescribe201703$drugcode<411000),]
# bronchodilators201703 <- prescribe201703[which(prescribe201703$drugcode>=310000&prescribe201703$drugcode<320000),]
# dementia201703 <- prescribe201703[which(prescribe201703$drugcode>=411000&prescribe201703$drugcode<500000),]
# diabetes201703 <- prescribe201703[which(prescribe201703$drugcode>=601000&prescribe201703$drugcode<602000),]
# 
# antidep201703 <- aggregate(antidep201703[-c(1:5, 11)], antidep201703["PRACTICE"], sum)
# antidep201703$PERIOD <- 201703
# antidep201703$Druggroup <- "Antidepressant"
# dementia201703 <- aggregate(dementia201703[-c(1:5, 11)], dementia201703["PRACTICE"], sum)
# dementia201703$PERIOD <- 201703
# dementia201703$Druggroup <- "Dementia"
# diabetes201703 <- aggregate(diabetes201703[-c(1:5, 11)], diabetes201703["PRACTICE"], sum)
# diabetes201703$PERIOD <- 201703
# diabetes201703$Druggroup <- "Diabetes"
# 
# bronchodilators201703 <- aggregate(bronchodilators201703[-c(1:5, 11)], bronchodilators201703["PRACTICE"], sum)
# bronchodilators201703$PERIOD <- 201703
# bronchodilators201703$Druggroup <- "Bronchodilators"
# opioddep201703 <- aggregate(opioddep201703[-c(1:5, 11)], opioddep201703["PRACTICE"], sum)
# opioddep201703$PERIOD <- 201703
# opioddep201703$Druggroup <- "Opiod"
# nicotinedep201703 <- aggregate(nicotinedep201703[-c(1:5, 11)], nicotinedep201703["PRACTICE"], sum)
# nicotinedep201703$PERIOD <- 201703
# nicotinedep201703$Druggroup <- "Nicotine"
# alcoholdep201703 <- aggregate(alcoholdep201703[-c(1:5, 11)], alcoholdep201703["PRACTICE"], sum)
# alcoholdep201703$PERIOD <- 201703
# alcoholdep201703$Druggroup <- "Alcohol"
# allsubstancedep201703 <- aggregate(allsubstancedep201703[-c(1:5, 11)], allsubstancedep201703["PRACTICE"], sum)
# allsubstancedep201703$PERIOD <- 201703
# allsubstancedep201703$Druggroup <- "SubstanceDep"
# obesedrugs201703 <- aggregate(obesedrugs201703[-c(1:5, 11)], obesedrugs201703["PRACTICE"], sum)
# obesedrugs201703$PERIOD <- 201703
# obesedrugs201703$Druggroup <- "Obesity"
# 
# prescribemaster201703 <- do.call("rbind", list(obesedrugs201703, allsubstancedep201703, alcoholdep201703, 
#                                                nicotinedep201703,opioddep201703, bronchodilators201703,
#                                                antidep201703, diabetes201703, dementia201703))
# 
# 
# write.csv(prescribemaster201703, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201703.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201702 <- read_csv("H:/prescription data/T201702PDPI BNFT.csv")
# prescribe201702$drugcode <- parse_number(prescribe201702$`BNF CODE`)
# prescribe201702$drugcode <- substr(prescribe201702$drugcode, 0, 6)
# antidep201702 <- prescribe201702[which(prescribe201702$drugcode>=403000&prescribe201702$drugcode<404000),]
# obesedrugs201702 <- prescribe201702[which(prescribe201702$drugcode>=405000&prescribe201702$drugcode<406000),]
# allsubstancedep201702 <- prescribe201702[which(prescribe201702$drugcode>=410000&prescribe201702$drugcode<411000),]
# alcoholdep201702 <- prescribe201702[which(prescribe201702$drugcode>=410010&prescribe201702$drugcode<410020),]
# nicotinedep201702 <- prescribe201702[which(prescribe201702$drugcode>=410020&prescribe201702$drugcode<410030),]
# opioddep201702 <- prescribe201702[which(prescribe201702$drugcode>=410030&prescribe201702$drugcode<411000),]
# bronchodilators201702 <- prescribe201702[which(prescribe201702$drugcode>=310000&prescribe201702$drugcode<320000),]
# dementia201702 <- prescribe201702[which(prescribe201702$drugcode>=411000&prescribe201702$drugcode<500000),]
# diabetes201702 <- prescribe201702[which(prescribe201702$drugcode>=601000&prescribe201702$drugcode<602000),]
# 
# antidep201702 <- aggregate(antidep201702[-c(1:5, 11)], antidep201702["PRACTICE"], sum)
# antidep201702$PERIOD <- 201702
# antidep201702$Druggroup <- "Antidepressant"
# dementia201702 <- aggregate(dementia201702[-c(1:5, 11)], dementia201702["PRACTICE"], sum)
# dementia201702$PERIOD <- 201702
# dementia201702$Druggroup <- "Dementia"
# diabetes201702 <- aggregate(diabetes201702[-c(1:5, 11)], diabetes201702["PRACTICE"], sum)
# diabetes201702$PERIOD <- 201702
# diabetes201702$Druggroup <- "Diabetes"
# 
# bronchodilators201702 <- aggregate(bronchodilators201702[-c(1:5, 11)], bronchodilators201702["PRACTICE"], sum)
# bronchodilators201702$PERIOD <- 201702
# bronchodilators201702$Druggroup <- "Bronchodilators"
# opioddep201702 <- aggregate(opioddep201702[-c(1:5, 11)], opioddep201702["PRACTICE"], sum)
# opioddep201702$PERIOD <- 201702
# opioddep201702$Druggroup <- "Opiod"
# nicotinedep201702 <- aggregate(nicotinedep201702[-c(1:5, 11)], nicotinedep201702["PRACTICE"], sum)
# nicotinedep201702$PERIOD <- 201702
# nicotinedep201702$Druggroup <- "Nicotine"
# alcoholdep201702 <- aggregate(alcoholdep201702[-c(1:5, 11)], alcoholdep201702["PRACTICE"], sum)
# alcoholdep201702$PERIOD <- 201702
# alcoholdep201702$Druggroup <- "Alcohol"
# allsubstancedep201702 <- aggregate(allsubstancedep201702[-c(1:5, 11)], allsubstancedep201702["PRACTICE"], sum)
# allsubstancedep201702$PERIOD <- 201702
# allsubstancedep201702$Druggroup <- "SubstanceDep"
# obesedrugs201702 <- aggregate(obesedrugs201702[-c(1:5, 11)], obesedrugs201702["PRACTICE"], sum)
# obesedrugs201702$PERIOD <- 201702
# obesedrugs201702$Druggroup <- "Obesity"
# 
# prescribemaster201702 <- do.call("rbind", list(obesedrugs201702, allsubstancedep201702, alcoholdep201702, 
#                                                nicotinedep201702,opioddep201702, bronchodilators201702,
#                                                antidep201702, diabetes201702, dementia201702))
# 
# 
# write.csv(prescribemaster201702, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201702.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201701 <- read_csv("H:/prescription data/T201701PDPI BNFT.csv")
# prescribe201701$drugcode <- parse_number(prescribe201701$`BNF CODE`)
# prescribe201701$drugcode <- substr(prescribe201701$drugcode, 0, 6)
# antidep201701 <- prescribe201701[which(prescribe201701$drugcode>=403000&prescribe201701$drugcode<404000),]
# obesedrugs201701 <- prescribe201701[which(prescribe201701$drugcode>=405000&prescribe201701$drugcode<406000),]
# allsubstancedep201701 <- prescribe201701[which(prescribe201701$drugcode>=410000&prescribe201701$drugcode<411000),]
# alcoholdep201701 <- prescribe201701[which(prescribe201701$drugcode>=410010&prescribe201701$drugcode<410020),]
# nicotinedep201701 <- prescribe201701[which(prescribe201701$drugcode>=410020&prescribe201701$drugcode<410030),]
# opioddep201701 <- prescribe201701[which(prescribe201701$drugcode>=410030&prescribe201701$drugcode<411000),]
# bronchodilators201701 <- prescribe201701[which(prescribe201701$drugcode>=310000&prescribe201701$drugcode<320000),]
# dementia201701 <- prescribe201701[which(prescribe201701$drugcode>=411000&prescribe201701$drugcode<500000),]
# diabetes201701 <- prescribe201701[which(prescribe201701$drugcode>=601000&prescribe201701$drugcode<602000),]
# 
# antidep201701 <- aggregate(antidep201701[-c(1:5, 11)], antidep201701["PRACTICE"], sum)
# antidep201701$PERIOD <- 201701
# antidep201701$Druggroup <- "Antidepressant"
# dementia201701 <- aggregate(dementia201701[-c(1:5, 11)], dementia201701["PRACTICE"], sum)
# dementia201701$PERIOD <- 201701
# dementia201701$Druggroup <- "Dementia"
# diabetes201701 <- aggregate(diabetes201701[-c(1:5, 11)], diabetes201701["PRACTICE"], sum)
# diabetes201701$PERIOD <- 201701
# diabetes201701$Druggroup <- "Diabetes"
# 
# bronchodilators201701 <- aggregate(bronchodilators201701[-c(1:5, 11)], bronchodilators201701["PRACTICE"], sum)
# bronchodilators201701$PERIOD <- 201701
# bronchodilators201701$Druggroup <- "Bronchodilators"
# opioddep201701 <- aggregate(opioddep201701[-c(1:5, 11)], opioddep201701["PRACTICE"], sum)
# opioddep201701$PERIOD <- 201701
# opioddep201701$Druggroup <- "Opiod"
# nicotinedep201701 <- aggregate(nicotinedep201701[-c(1:5, 11)], nicotinedep201701["PRACTICE"], sum)
# nicotinedep201701$PERIOD <- 201701
# nicotinedep201701$Druggroup <- "Nicotine"
# alcoholdep201701 <- aggregate(alcoholdep201701[-c(1:5, 11)], alcoholdep201701["PRACTICE"], sum)
# alcoholdep201701$PERIOD <- 201701
# alcoholdep201701$Druggroup <- "Alcohol"
# allsubstancedep201701 <- aggregate(allsubstancedep201701[-c(1:5, 11)], allsubstancedep201701["PRACTICE"], sum)
# allsubstancedep201701$PERIOD <- 201701
# allsubstancedep201701$Druggroup <- "SubstanceDep"
# obesedrugs201701 <- aggregate(obesedrugs201701[-c(1:5, 11)], obesedrugs201701["PRACTICE"], sum)
# obesedrugs201701$PERIOD <- 201701
# obesedrugs201701$Druggroup <- "Obesity"
# 
# prescribemaster201701 <- do.call("rbind", list(obesedrugs201701, allsubstancedep201701, alcoholdep201701, 
#                                                nicotinedep201701,opioddep201701, bronchodilators201701,
#                                                antidep201701, diabetes201701, dementia201701))
# 
# 
# write.csv(prescribemaster201701, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201701.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201612 <- read_csv("H:/prescription data/T201612PDPI BNFT.csv")
# prescribe201612$drugcode <- parse_number(prescribe201612$`BNF CODE`)
# prescribe201612$drugcode <- substr(prescribe201612$drugcode, 0, 6)
# antidep201612 <- prescribe201612[which(prescribe201612$drugcode>=403000&prescribe201612$drugcode<404000),]
# obesedrugs201612 <- prescribe201612[which(prescribe201612$drugcode>=405000&prescribe201612$drugcode<406000),]
# allsubstancedep201612 <- prescribe201612[which(prescribe201612$drugcode>=410000&prescribe201612$drugcode<411000),]
# alcoholdep201612 <- prescribe201612[which(prescribe201612$drugcode>=410010&prescribe201612$drugcode<410020),]
# nicotinedep201612 <- prescribe201612[which(prescribe201612$drugcode>=410020&prescribe201612$drugcode<410030),]
# opioddep201612 <- prescribe201612[which(prescribe201612$drugcode>=410030&prescribe201612$drugcode<411000),]
# bronchodilators201612 <- prescribe201612[which(prescribe201612$drugcode>=310000&prescribe201612$drugcode<320000),]
# dementia201612 <- prescribe201612[which(prescribe201612$drugcode>=411000&prescribe201612$drugcode<500000),]
# diabetes201612 <- prescribe201612[which(prescribe201612$drugcode>=601000&prescribe201612$drugcode<602000),]
# 
# antidep201612 <- aggregate(antidep201612[-c(1:5, 11)], antidep201612["PRACTICE"], sum)
# antidep201612$PERIOD <- 201612
# antidep201612$Druggroup <- "Antidepressant"
# dementia201612 <- aggregate(dementia201612[-c(1:5, 11)], dementia201612["PRACTICE"], sum)
# dementia201612$PERIOD <- 201612
# dementia201612$Druggroup <- "Dementia"
# diabetes201612 <- aggregate(diabetes201612[-c(1:5, 11)], diabetes201612["PRACTICE"], sum)
# diabetes201612$PERIOD <- 201612
# diabetes201612$Druggroup <- "Diabetes"
# 
# bronchodilators201612 <- aggregate(bronchodilators201612[-c(1:5, 11)], bronchodilators201612["PRACTICE"], sum)
# bronchodilators201612$PERIOD <- 201612
# bronchodilators201612$Druggroup <- "Bronchodilators"
# opioddep201612 <- aggregate(opioddep201612[-c(1:5, 11)], opioddep201612["PRACTICE"], sum)
# opioddep201612$PERIOD <- 201612
# opioddep201612$Druggroup <- "Opiod"
# nicotinedep201612 <- aggregate(nicotinedep201612[-c(1:5, 11)], nicotinedep201612["PRACTICE"], sum)
# nicotinedep201612$PERIOD <- 201612
# nicotinedep201612$Druggroup <- "Nicotine"
# alcoholdep201612 <- aggregate(alcoholdep201612[-c(1:5, 11)], alcoholdep201612["PRACTICE"], sum)
# alcoholdep201612$PERIOD <- 201612
# alcoholdep201612$Druggroup <- "Alcohol"
# allsubstancedep201612 <- aggregate(allsubstancedep201612[-c(1:5, 11)], allsubstancedep201612["PRACTICE"], sum)
# allsubstancedep201612$PERIOD <- 201612
# allsubstancedep201612$Druggroup <- "SubstanceDep"
# obesedrugs201612 <- aggregate(obesedrugs201612[-c(1:5, 11)], obesedrugs201612["PRACTICE"], sum)
# obesedrugs201612$PERIOD <- 201612
# obesedrugs201612$Druggroup <- "Obesity"
# 
# prescribemaster201612 <- do.call("rbind", list(obesedrugs201612, allsubstancedep201612, alcoholdep201612, 
#                                                nicotinedep201612,opioddep201612, bronchodilators201612,
#                                                antidep201612, diabetes201612, dementia201612))
# 
# 
# write.csv(prescribemaster201612, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201612.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201611 <- read_csv("H:/prescription data/T201611PDPI BNFT.csv")
# prescribe201611$drugcode <- parse_number(prescribe201611$`BNF CODE`)
# prescribe201611$drugcode <- substr(prescribe201611$drugcode, 0, 6)
# antidep201611 <- prescribe201611[which(prescribe201611$drugcode>=403000&prescribe201611$drugcode<404000),]
# obesedrugs201611 <- prescribe201611[which(prescribe201611$drugcode>=405000&prescribe201611$drugcode<406000),]
# allsubstancedep201611 <- prescribe201611[which(prescribe201611$drugcode>=410000&prescribe201611$drugcode<411000),]
# alcoholdep201611 <- prescribe201611[which(prescribe201611$drugcode>=410010&prescribe201611$drugcode<410020),]
# nicotinedep201611 <- prescribe201611[which(prescribe201611$drugcode>=410020&prescribe201611$drugcode<410030),]
# opioddep201611 <- prescribe201611[which(prescribe201611$drugcode>=410030&prescribe201611$drugcode<411000),]
# bronchodilators201611 <- prescribe201611[which(prescribe201611$drugcode>=310000&prescribe201611$drugcode<320000),]
# dementia201611 <- prescribe201611[which(prescribe201611$drugcode>=411000&prescribe201611$drugcode<500000),]
# diabetes201611 <- prescribe201611[which(prescribe201611$drugcode>=601000&prescribe201611$drugcode<602000),]
# 
# antidep201611 <- aggregate(antidep201611[-c(1:5, 11)], antidep201611["PRACTICE"], sum)
# antidep201611$PERIOD <- 201611
# antidep201611$Druggroup <- "Antidepressant"
# dementia201611 <- aggregate(dementia201611[-c(1:5, 11)], dementia201611["PRACTICE"], sum)
# dementia201611$PERIOD <- 201611
# dementia201611$Druggroup <- "Dementia"
# diabetes201611 <- aggregate(diabetes201611[-c(1:5, 11)], diabetes201611["PRACTICE"], sum)
# diabetes201611$PERIOD <- 201611
# diabetes201611$Druggroup <- "Diabetes"
# 
# bronchodilators201611 <- aggregate(bronchodilators201611[-c(1:5, 11)], bronchodilators201611["PRACTICE"], sum)
# bronchodilators201611$PERIOD <- 201611
# bronchodilators201611$Druggroup <- "Bronchodilators"
# opioddep201611 <- aggregate(opioddep201611[-c(1:5, 11)], opioddep201611["PRACTICE"], sum)
# opioddep201611$PERIOD <- 201611
# opioddep201611$Druggroup <- "Opiod"
# nicotinedep201611 <- aggregate(nicotinedep201611[-c(1:5, 11)], nicotinedep201611["PRACTICE"], sum)
# nicotinedep201611$PERIOD <- 201611
# nicotinedep201611$Druggroup <- "Nicotine"
# alcoholdep201611 <- aggregate(alcoholdep201611[-c(1:5, 11)], alcoholdep201611["PRACTICE"], sum)
# alcoholdep201611$PERIOD <- 201611
# alcoholdep201611$Druggroup <- "Alcohol"
# allsubstancedep201611 <- aggregate(allsubstancedep201611[-c(1:5, 11)], allsubstancedep201611["PRACTICE"], sum)
# allsubstancedep201611$PERIOD <- 201611
# allsubstancedep201611$Druggroup <- "SubstanceDep"
# obesedrugs201611 <- aggregate(obesedrugs201611[-c(1:5, 11)], obesedrugs201611["PRACTICE"], sum)
# obesedrugs201611$PERIOD <- 201611
# obesedrugs201611$Druggroup <- "Obesity"
# 
# prescribemaster201611 <- do.call("rbind", list(obesedrugs201611, allsubstancedep201611, alcoholdep201611, 
#                                                nicotinedep201611,opioddep201611, bronchodilators201611,
#                                                antidep201611, diabetes201611, dementia201611))
# 
# 
# write.csv(prescribemaster201611, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201611.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201610 <- read_csv("H:/prescription data/T201610PDPI BNFT.csv")
# prescribe201610$drugcode <- parse_number(prescribe201610$`BNF CODE`)
# prescribe201610$drugcode <- substr(prescribe201610$drugcode, 0, 6)
# antidep201610 <- prescribe201610[which(prescribe201610$drugcode>=403000&prescribe201610$drugcode<404000),]
# obesedrugs201610 <- prescribe201610[which(prescribe201610$drugcode>=405000&prescribe201610$drugcode<406000),]
# allsubstancedep201610 <- prescribe201610[which(prescribe201610$drugcode>=410000&prescribe201610$drugcode<411000),]
# alcoholdep201610 <- prescribe201610[which(prescribe201610$drugcode>=410010&prescribe201610$drugcode<410020),]
# nicotinedep201610 <- prescribe201610[which(prescribe201610$drugcode>=410020&prescribe201610$drugcode<410030),]
# opioddep201610 <- prescribe201610[which(prescribe201610$drugcode>=410030&prescribe201610$drugcode<411000),]
# bronchodilators201610 <- prescribe201610[which(prescribe201610$drugcode>=310000&prescribe201610$drugcode<320000),]
# dementia201610 <- prescribe201610[which(prescribe201610$drugcode>=411000&prescribe201610$drugcode<500000),]
# diabetes201610 <- prescribe201610[which(prescribe201610$drugcode>=601000&prescribe201610$drugcode<602000),]
# 
# antidep201610 <- aggregate(antidep201610[-c(1:5, 11)], antidep201610["PRACTICE"], sum)
# antidep201610$PERIOD <- 201610
# antidep201610$Druggroup <- "Antidepressant"
# dementia201610 <- aggregate(dementia201610[-c(1:5, 11)], dementia201610["PRACTICE"], sum)
# dementia201610$PERIOD <- 201610
# dementia201610$Druggroup <- "Dementia"
# diabetes201610 <- aggregate(diabetes201610[-c(1:5, 11)], diabetes201610["PRACTICE"], sum)
# diabetes201610$PERIOD <- 201610
# diabetes201610$Druggroup <- "Diabetes"
# 
# bronchodilators201610 <- aggregate(bronchodilators201610[-c(1:5, 11)], bronchodilators201610["PRACTICE"], sum)
# bronchodilators201610$PERIOD <- 201610
# bronchodilators201610$Druggroup <- "Bronchodilators"
# opioddep201610 <- aggregate(opioddep201610[-c(1:5, 11)], opioddep201610["PRACTICE"], sum)
# opioddep201610$PERIOD <- 201610
# opioddep201610$Druggroup <- "Opiod"
# nicotinedep201610 <- aggregate(nicotinedep201610[-c(1:5, 11)], nicotinedep201610["PRACTICE"], sum)
# nicotinedep201610$PERIOD <- 201610
# nicotinedep201610$Druggroup <- "Nicotine"
# alcoholdep201610 <- aggregate(alcoholdep201610[-c(1:5, 11)], alcoholdep201610["PRACTICE"], sum)
# alcoholdep201610$PERIOD <- 201610
# alcoholdep201610$Druggroup <- "Alcohol"
# allsubstancedep201610 <- aggregate(allsubstancedep201610[-c(1:5, 11)], allsubstancedep201610["PRACTICE"], sum)
# allsubstancedep201610$PERIOD <- 201610
# allsubstancedep201610$Druggroup <- "SubstanceDep"
# obesedrugs201610 <- aggregate(obesedrugs201610[-c(1:5, 11)], obesedrugs201610["PRACTICE"], sum)
# obesedrugs201610$PERIOD <- 201610
# obesedrugs201610$Druggroup <- "Obesity"
# 
# prescribemaster201610 <- do.call("rbind", list(obesedrugs201610, allsubstancedep201610, alcoholdep201610, 
#                                                nicotinedep201610,opioddep201610, bronchodilators201610,
#                                                antidep201610, diabetes201610, dementia201610))
# 
# 
# write.csv(prescribemaster201610, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201610.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201609 <- read_csv("H:/prescription data/T201609PDPI BNFT.csv")
# prescribe201609$drugcode <- parse_number(prescribe201609$`BNF CODE`)
# prescribe201609$drugcode <- substr(prescribe201609$drugcode, 0, 6)
# antidep201609 <- prescribe201609[which(prescribe201609$drugcode>=403000&prescribe201609$drugcode<404000),]
# obesedrugs201609 <- prescribe201609[which(prescribe201609$drugcode>=405000&prescribe201609$drugcode<406000),]
# allsubstancedep201609 <- prescribe201609[which(prescribe201609$drugcode>=410000&prescribe201609$drugcode<411000),]
# alcoholdep201609 <- prescribe201609[which(prescribe201609$drugcode>=410010&prescribe201609$drugcode<410020),]
# nicotinedep201609 <- prescribe201609[which(prescribe201609$drugcode>=410020&prescribe201609$drugcode<410030),]
# opioddep201609 <- prescribe201609[which(prescribe201609$drugcode>=410030&prescribe201609$drugcode<411000),]
# bronchodilators201609 <- prescribe201609[which(prescribe201609$drugcode>=310000&prescribe201609$drugcode<320000),]
# dementia201609 <- prescribe201609[which(prescribe201609$drugcode>=411000&prescribe201609$drugcode<500000),]
# diabetes201609 <- prescribe201609[which(prescribe201609$drugcode>=601000&prescribe201609$drugcode<602000),]
# 
# antidep201609 <- aggregate(antidep201609[-c(1:5, 11)], antidep201609["PRACTICE"], sum)
# antidep201609$PERIOD <- 201609
# antidep201609$Druggroup <- "Antidepressant"
# dementia201609 <- aggregate(dementia201609[-c(1:5, 11)], dementia201609["PRACTICE"], sum)
# dementia201609$PERIOD <- 201609
# dementia201609$Druggroup <- "Dementia"
# diabetes201609 <- aggregate(diabetes201609[-c(1:5, 11)], diabetes201609["PRACTICE"], sum)
# diabetes201609$PERIOD <- 201609
# diabetes201609$Druggroup <- "Diabetes"
# 
# bronchodilators201609 <- aggregate(bronchodilators201609[-c(1:5, 11)], bronchodilators201609["PRACTICE"], sum)
# bronchodilators201609$PERIOD <- 201609
# bronchodilators201609$Druggroup <- "Bronchodilators"
# opioddep201609 <- aggregate(opioddep201609[-c(1:5, 11)], opioddep201609["PRACTICE"], sum)
# opioddep201609$PERIOD <- 201609
# opioddep201609$Druggroup <- "Opiod"
# nicotinedep201609 <- aggregate(nicotinedep201609[-c(1:5, 11)], nicotinedep201609["PRACTICE"], sum)
# nicotinedep201609$PERIOD <- 201609
# nicotinedep201609$Druggroup <- "Nicotine"
# alcoholdep201609 <- aggregate(alcoholdep201609[-c(1:5, 11)], alcoholdep201609["PRACTICE"], sum)
# alcoholdep201609$PERIOD <- 201609
# alcoholdep201609$Druggroup <- "Alcohol"
# allsubstancedep201609 <- aggregate(allsubstancedep201609[-c(1:5, 11)], allsubstancedep201609["PRACTICE"], sum)
# allsubstancedep201609$PERIOD <- 201609
# allsubstancedep201609$Druggroup <- "SubstanceDep"
# obesedrugs201609 <- aggregate(obesedrugs201609[-c(1:5, 11)], obesedrugs201609["PRACTICE"], sum)
# obesedrugs201609$PERIOD <- 201609
# obesedrugs201609$Druggroup <- "Obesity"
# 
# prescribemaster201609 <- do.call("rbind", list(obesedrugs201609, allsubstancedep201609, alcoholdep201609, 
#                                                nicotinedep201609,opioddep201609, bronchodilators201609,
#                                                antidep201609, diabetes201609, dementia201609))
# 
# 
# write.csv(prescribemaster201609, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201609.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201608 <- read_csv("H:/prescription data/T201608PDPI BNFT.csv")
# prescribe201608$drugcode <- parse_number(prescribe201608$`BNF CODE`)
# prescribe201608$drugcode <- substr(prescribe201608$drugcode, 0, 6)
# antidep201608 <- prescribe201608[which(prescribe201608$drugcode>=403000&prescribe201608$drugcode<404000),]
# obesedrugs201608 <- prescribe201608[which(prescribe201608$drugcode>=405000&prescribe201608$drugcode<406000),]
# allsubstancedep201608 <- prescribe201608[which(prescribe201608$drugcode>=410000&prescribe201608$drugcode<411000),]
# alcoholdep201608 <- prescribe201608[which(prescribe201608$drugcode>=410010&prescribe201608$drugcode<410020),]
# nicotinedep201608 <- prescribe201608[which(prescribe201608$drugcode>=410020&prescribe201608$drugcode<410030),]
# opioddep201608 <- prescribe201608[which(prescribe201608$drugcode>=410030&prescribe201608$drugcode<411000),]
# bronchodilators201608 <- prescribe201608[which(prescribe201608$drugcode>=310000&prescribe201608$drugcode<320000),]
# dementia201608 <- prescribe201608[which(prescribe201608$drugcode>=411000&prescribe201608$drugcode<500000),]
# diabetes201608 <- prescribe201608[which(prescribe201608$drugcode>=601000&prescribe201608$drugcode<602000),]
# 
# antidep201608 <- aggregate(antidep201608[-c(1:5, 11)], antidep201608["PRACTICE"], sum)
# antidep201608$PERIOD <- 201608
# antidep201608$Druggroup <- "Antidepressant"
# dementia201608 <- aggregate(dementia201608[-c(1:5, 11)], dementia201608["PRACTICE"], sum)
# dementia201608$PERIOD <- 201608
# dementia201608$Druggroup <- "Dementia"
# diabetes201608 <- aggregate(diabetes201608[-c(1:5, 11)], diabetes201608["PRACTICE"], sum)
# diabetes201608$PERIOD <- 201608
# diabetes201608$Druggroup <- "Diabetes"
# 
# bronchodilators201608 <- aggregate(bronchodilators201608[-c(1:5, 11)], bronchodilators201608["PRACTICE"], sum)
# bronchodilators201608$PERIOD <- 201608
# bronchodilators201608$Druggroup <- "Bronchodilators"
# opioddep201608 <- aggregate(opioddep201608[-c(1:5, 11)], opioddep201608["PRACTICE"], sum)
# opioddep201608$PERIOD <- 201608
# opioddep201608$Druggroup <- "Opiod"
# nicotinedep201608 <- aggregate(nicotinedep201608[-c(1:5, 11)], nicotinedep201608["PRACTICE"], sum)
# nicotinedep201608$PERIOD <- 201608
# nicotinedep201608$Druggroup <- "Nicotine"
# alcoholdep201608 <- aggregate(alcoholdep201608[-c(1:5, 11)], alcoholdep201608["PRACTICE"], sum)
# alcoholdep201608$PERIOD <- 201608
# alcoholdep201608$Druggroup <- "Alcohol"
# allsubstancedep201608 <- aggregate(allsubstancedep201608[-c(1:5, 11)], allsubstancedep201608["PRACTICE"], sum)
# allsubstancedep201608$PERIOD <- 201608
# allsubstancedep201608$Druggroup <- "SubstanceDep"
# obesedrugs201608 <- aggregate(obesedrugs201608[-c(1:5, 11)], obesedrugs201608["PRACTICE"], sum)
# obesedrugs201608$PERIOD <- 201608
# obesedrugs201608$Druggroup <- "Obesity"
# 
# prescribemaster201608 <- do.call("rbind", list(obesedrugs201608, allsubstancedep201608, alcoholdep201608, 
#                                                nicotinedep201608,opioddep201608, bronchodilators201608,
#                                                antidep201608, diabetes201608, dementia201608))
# 
# 
# write.csv(prescribemaster201608, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201608.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# 
# prescribe201607 <- read_csv("H:/prescription data/T201607PDPI BNFT.csv")
# prescribe201607$drugcode <- parse_number(prescribe201607$`BNF CODE`)
# prescribe201607$drugcode <- substr(prescribe201607$drugcode, 0, 6)
# antidep201607 <- prescribe201607[which(prescribe201607$drugcode>=403000&prescribe201607$drugcode<404000),]
# obesedrugs201607 <- prescribe201607[which(prescribe201607$drugcode>=405000&prescribe201607$drugcode<406000),]
# allsubstancedep201607 <- prescribe201607[which(prescribe201607$drugcode>=410000&prescribe201607$drugcode<411000),]
# alcoholdep201607 <- prescribe201607[which(prescribe201607$drugcode>=410010&prescribe201607$drugcode<410020),]
# nicotinedep201607 <- prescribe201607[which(prescribe201607$drugcode>=410020&prescribe201607$drugcode<410030),]
# opioddep201607 <- prescribe201607[which(prescribe201607$drugcode>=410030&prescribe201607$drugcode<411000),]
# bronchodilators201607 <- prescribe201607[which(prescribe201607$drugcode>=310000&prescribe201607$drugcode<320000),]
# dementia201607 <- prescribe201607[which(prescribe201607$drugcode>=411000&prescribe201607$drugcode<500000),]
# diabetes201607 <- prescribe201607[which(prescribe201607$drugcode>=601000&prescribe201607$drugcode<602000),]
# 
# antidep201607 <- aggregate(antidep201607[-c(1:5, 11)], antidep201607["PRACTICE"], sum)
# antidep201607$PERIOD <- 201607
# antidep201607$Druggroup <- "Antidepressant"
# dementia201607 <- aggregate(dementia201607[-c(1:5, 11)], dementia201607["PRACTICE"], sum)
# dementia201607$PERIOD <- 201607
# dementia201607$Druggroup <- "Dementia"
# diabetes201607 <- aggregate(diabetes201607[-c(1:5, 11)], diabetes201607["PRACTICE"], sum)
# diabetes201607$PERIOD <- 201607
# diabetes201607$Druggroup <- "Diabetes"
# 
# bronchodilators201607 <- aggregate(bronchodilators201607[-c(1:5, 11)], bronchodilators201607["PRACTICE"], sum)
# bronchodilators201607$PERIOD <- 201607
# bronchodilators201607$Druggroup <- "Bronchodilators"
# opioddep201607 <- aggregate(opioddep201607[-c(1:5, 11)], opioddep201607["PRACTICE"], sum)
# opioddep201607$PERIOD <- 201607
# opioddep201607$Druggroup <- "Opiod"
# nicotinedep201607 <- aggregate(nicotinedep201607[-c(1:5, 11)], nicotinedep201607["PRACTICE"], sum)
# nicotinedep201607$PERIOD <- 201607
# nicotinedep201607$Druggroup <- "Nicotine"
# alcoholdep201607 <- aggregate(alcoholdep201607[-c(1:5, 11)], alcoholdep201607["PRACTICE"], sum)
# alcoholdep201607$PERIOD <- 201607
# alcoholdep201607$Druggroup <- "Alcohol"
# allsubstancedep201607 <- aggregate(allsubstancedep201607[-c(1:5, 11)], allsubstancedep201607["PRACTICE"], sum)
# allsubstancedep201607$PERIOD <- 201607
# allsubstancedep201607$Druggroup <- "SubstanceDep"
# obesedrugs201607 <- aggregate(obesedrugs201607[-c(1:5, 11)], obesedrugs201607["PRACTICE"], sum)
# obesedrugs201607$PERIOD <- 201607
# obesedrugs201607$Druggroup <- "Obesity"
# 
# prescribemaster201607 <- do.call("rbind", list(obesedrugs201607, allsubstancedep201607, alcoholdep201607, 
#                                                nicotinedep201607,opioddep201607, bronchodilators201607,
#                                                antidep201607, diabetes201607, dementia201607))
# 
# 
# write.csv(prescribemaster201607, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201607.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201606 <- read_csv("H:/prescription data/T201606PDPI BNFT.csv")
# prescribe201606$drugcode <- parse_number(prescribe201606$`BNF CODE`)
# prescribe201606$drugcode <- substr(prescribe201606$drugcode, 0, 6)
# antidep201606 <- prescribe201606[which(prescribe201606$drugcode>=403000&prescribe201606$drugcode<404000),]
# obesedrugs201606 <- prescribe201606[which(prescribe201606$drugcode>=405000&prescribe201606$drugcode<406000),]
# allsubstancedep201606 <- prescribe201606[which(prescribe201606$drugcode>=410000&prescribe201606$drugcode<411000),]
# alcoholdep201606 <- prescribe201606[which(prescribe201606$drugcode>=410010&prescribe201606$drugcode<410020),]
# nicotinedep201606 <- prescribe201606[which(prescribe201606$drugcode>=410020&prescribe201606$drugcode<410030),]
# opioddep201606 <- prescribe201606[which(prescribe201606$drugcode>=410030&prescribe201606$drugcode<411000),]
# bronchodilators201606 <- prescribe201606[which(prescribe201606$drugcode>=310000&prescribe201606$drugcode<320000),]
# dementia201606 <- prescribe201606[which(prescribe201606$drugcode>=411000&prescribe201606$drugcode<500000),]
# diabetes201606 <- prescribe201606[which(prescribe201606$drugcode>=601000&prescribe201606$drugcode<602000),]
# 
# antidep201606 <- aggregate(antidep201606[-c(1:5, 11)], antidep201606["PRACTICE"], sum)
# antidep201606$PERIOD <- 201606
# antidep201606$Druggroup <- "Antidepressant"
# dementia201606 <- aggregate(dementia201606[-c(1:5, 11)], dementia201606["PRACTICE"], sum)
# dementia201606$PERIOD <- 201606
# dementia201606$Druggroup <- "Dementia"
# diabetes201606 <- aggregate(diabetes201606[-c(1:5, 11)], diabetes201606["PRACTICE"], sum)
# diabetes201606$PERIOD <- 201606
# diabetes201606$Druggroup <- "Diabetes"
# 
# bronchodilators201606 <- aggregate(bronchodilators201606[-c(1:5, 11)], bronchodilators201606["PRACTICE"], sum)
# bronchodilators201606$PERIOD <- 201606
# bronchodilators201606$Druggroup <- "Bronchodilators"
# opioddep201606 <- aggregate(opioddep201606[-c(1:5, 11)], opioddep201606["PRACTICE"], sum)
# opioddep201606$PERIOD <- 201606
# opioddep201606$Druggroup <- "Opiod"
# nicotinedep201606 <- aggregate(nicotinedep201606[-c(1:5, 11)], nicotinedep201606["PRACTICE"], sum)
# nicotinedep201606$PERIOD <- 201606
# nicotinedep201606$Druggroup <- "Nicotine"
# alcoholdep201606 <- aggregate(alcoholdep201606[-c(1:5, 11)], alcoholdep201606["PRACTICE"], sum)
# alcoholdep201606$PERIOD <- 201606
# alcoholdep201606$Druggroup <- "Alcohol"
# allsubstancedep201606 <- aggregate(allsubstancedep201606[-c(1:5, 11)], allsubstancedep201606["PRACTICE"], sum)
# allsubstancedep201606$PERIOD <- 201606
# allsubstancedep201606$Druggroup <- "SubstanceDep"
# obesedrugs201606 <- aggregate(obesedrugs201606[-c(1:5, 11)], obesedrugs201606["PRACTICE"], sum)
# obesedrugs201606$PERIOD <- 201606
# obesedrugs201606$Druggroup <- "Obesity"
# 
# prescribemaster201606 <- do.call("rbind", list(obesedrugs201606, allsubstancedep201606, alcoholdep201606, 
#                                                nicotinedep201606,opioddep201606, bronchodilators201606,
#                                                antidep201606, diabetes201606, dementia201606))
# 
# 
# write.csv(prescribemaster201606, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201606.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201605 <- read_csv("H:/prescription data/T201605PDPI BNFT.csv")
# prescribe201605$drugcode <- parse_number(prescribe201605$`BNF CODE`)
# prescribe201605$drugcode <- substr(prescribe201605$drugcode, 0, 6)
# antidep201605 <- prescribe201605[which(prescribe201605$drugcode>=403000&prescribe201605$drugcode<404000),]
# obesedrugs201605 <- prescribe201605[which(prescribe201605$drugcode>=405000&prescribe201605$drugcode<406000),]
# allsubstancedep201605 <- prescribe201605[which(prescribe201605$drugcode>=410000&prescribe201605$drugcode<411000),]
# alcoholdep201605 <- prescribe201605[which(prescribe201605$drugcode>=410010&prescribe201605$drugcode<410020),]
# nicotinedep201605 <- prescribe201605[which(prescribe201605$drugcode>=410020&prescribe201605$drugcode<410030),]
# opioddep201605 <- prescribe201605[which(prescribe201605$drugcode>=410030&prescribe201605$drugcode<411000),]
# bronchodilators201605 <- prescribe201605[which(prescribe201605$drugcode>=310000&prescribe201605$drugcode<320000),]
# dementia201605 <- prescribe201605[which(prescribe201605$drugcode>=411000&prescribe201605$drugcode<500000),]
# diabetes201605 <- prescribe201605[which(prescribe201605$drugcode>=601000&prescribe201605$drugcode<602000),]
# 
# antidep201605 <- aggregate(antidep201605[-c(1:5, 11)], antidep201605["PRACTICE"], sum)
# antidep201605$PERIOD <- 201605
# antidep201605$Druggroup <- "Antidepressant"
# dementia201605 <- aggregate(dementia201605[-c(1:5, 11)], dementia201605["PRACTICE"], sum)
# dementia201605$PERIOD <- 201605
# dementia201605$Druggroup <- "Dementia"
# diabetes201605 <- aggregate(diabetes201605[-c(1:5, 11)], diabetes201605["PRACTICE"], sum)
# diabetes201605$PERIOD <- 201605
# diabetes201605$Druggroup <- "Diabetes"
# 
# bronchodilators201605 <- aggregate(bronchodilators201605[-c(1:5, 11)], bronchodilators201605["PRACTICE"], sum)
# bronchodilators201605$PERIOD <- 201605
# bronchodilators201605$Druggroup <- "Bronchodilators"
# opioddep201605 <- aggregate(opioddep201605[-c(1:5, 11)], opioddep201605["PRACTICE"], sum)
# opioddep201605$PERIOD <- 201605
# opioddep201605$Druggroup <- "Opiod"
# nicotinedep201605 <- aggregate(nicotinedep201605[-c(1:5, 11)], nicotinedep201605["PRACTICE"], sum)
# nicotinedep201605$PERIOD <- 201605
# nicotinedep201605$Druggroup <- "Nicotine"
# alcoholdep201605 <- aggregate(alcoholdep201605[-c(1:5, 11)], alcoholdep201605["PRACTICE"], sum)
# alcoholdep201605$PERIOD <- 201605
# alcoholdep201605$Druggroup <- "Alcohol"
# allsubstancedep201605 <- aggregate(allsubstancedep201605[-c(1:5, 11)], allsubstancedep201605["PRACTICE"], sum)
# allsubstancedep201605$PERIOD <- 201605
# allsubstancedep201605$Druggroup <- "SubstanceDep"
# obesedrugs201605 <- aggregate(obesedrugs201605[-c(1:5, 11)], obesedrugs201605["PRACTICE"], sum)
# obesedrugs201605$PERIOD <- 201605
# obesedrugs201605$Druggroup <- "Obesity"
# 
# prescribemaster201605 <- do.call("rbind", list(obesedrugs201605, allsubstancedep201605, alcoholdep201605, 
#                                                nicotinedep201605,opioddep201605, bronchodilators201605,
#                                                antidep201605, diabetes201605, dementia201605))
# 
# 
# write.csv(prescribemaster201605, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201605.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201604 <- read_csv("H:/prescription data/T201604PDPI BNFT.csv")
# prescribe201604$drugcode <- parse_number(prescribe201604$`BNF CODE`)
# prescribe201604$drugcode <- substr(prescribe201604$drugcode, 0, 6)
# antidep201604 <- prescribe201604[which(prescribe201604$drugcode>=403000&prescribe201604$drugcode<404000),]
# obesedrugs201604 <- prescribe201604[which(prescribe201604$drugcode>=405000&prescribe201604$drugcode<406000),]
# allsubstancedep201604 <- prescribe201604[which(prescribe201604$drugcode>=410000&prescribe201604$drugcode<411000),]
# alcoholdep201604 <- prescribe201604[which(prescribe201604$drugcode>=410010&prescribe201604$drugcode<410020),]
# nicotinedep201604 <- prescribe201604[which(prescribe201604$drugcode>=410020&prescribe201604$drugcode<410030),]
# opioddep201604 <- prescribe201604[which(prescribe201604$drugcode>=410030&prescribe201604$drugcode<411000),]
# bronchodilators201604 <- prescribe201604[which(prescribe201604$drugcode>=310000&prescribe201604$drugcode<320000),]
# dementia201604 <- prescribe201604[which(prescribe201604$drugcode>=411000&prescribe201604$drugcode<500000),]
# diabetes201604 <- prescribe201604[which(prescribe201604$drugcode>=601000&prescribe201604$drugcode<602000),]
# 
# antidep201604 <- aggregate(antidep201604[-c(1:5, 11)], antidep201604["PRACTICE"], sum)
# antidep201604$PERIOD <- 201604
# antidep201604$Druggroup <- "Antidepressant"
# dementia201604 <- aggregate(dementia201604[-c(1:5, 11)], dementia201604["PRACTICE"], sum)
# dementia201604$PERIOD <- 201604
# dementia201604$Druggroup <- "Dementia"
# diabetes201604 <- aggregate(diabetes201604[-c(1:5, 11)], diabetes201604["PRACTICE"], sum)
# diabetes201604$PERIOD <- 201604
# diabetes201604$Druggroup <- "Diabetes"
# 
# bronchodilators201604 <- aggregate(bronchodilators201604[-c(1:5, 11)], bronchodilators201604["PRACTICE"], sum)
# bronchodilators201604$PERIOD <- 201604
# bronchodilators201604$Druggroup <- "Bronchodilators"
# opioddep201604 <- aggregate(opioddep201604[-c(1:5, 11)], opioddep201604["PRACTICE"], sum)
# opioddep201604$PERIOD <- 201604
# opioddep201604$Druggroup <- "Opiod"
# nicotinedep201604 <- aggregate(nicotinedep201604[-c(1:5, 11)], nicotinedep201604["PRACTICE"], sum)
# nicotinedep201604$PERIOD <- 201604
# nicotinedep201604$Druggroup <- "Nicotine"
# alcoholdep201604 <- aggregate(alcoholdep201604[-c(1:5, 11)], alcoholdep201604["PRACTICE"], sum)
# alcoholdep201604$PERIOD <- 201604
# alcoholdep201604$Druggroup <- "Alcohol"
# allsubstancedep201604 <- aggregate(allsubstancedep201604[-c(1:5, 11)], allsubstancedep201604["PRACTICE"], sum)
# allsubstancedep201604$PERIOD <- 201604
# allsubstancedep201604$Druggroup <- "SubstanceDep"
# obesedrugs201604 <- aggregate(obesedrugs201604[-c(1:5, 11)], obesedrugs201604["PRACTICE"], sum)
# obesedrugs201604$PERIOD <- 201604
# obesedrugs201604$Druggroup <- "Obesity"
# 
# prescribemaster201604 <- do.call("rbind", list(obesedrugs201604, allsubstancedep201604, alcoholdep201604, 
#                                                nicotinedep201604,opioddep201604, bronchodilators201604,
#                                                antidep201604, diabetes201604, dementia201604))
# 
# 
# write.csv(prescribemaster201604, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201604.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201603 <- read_csv("H:/prescription data/T201603PDPI BNFT.csv")
# prescribe201603$drugcode <- parse_number(prescribe201603$`BNF CODE`)
# prescribe201603$drugcode <- substr(prescribe201603$drugcode, 0, 6)
# antidep201603 <- prescribe201603[which(prescribe201603$drugcode>=403000&prescribe201603$drugcode<404000),]
# obesedrugs201603 <- prescribe201603[which(prescribe201603$drugcode>=405000&prescribe201603$drugcode<406000),]
# allsubstancedep201603 <- prescribe201603[which(prescribe201603$drugcode>=410000&prescribe201603$drugcode<411000),]
# alcoholdep201603 <- prescribe201603[which(prescribe201603$drugcode>=410010&prescribe201603$drugcode<410020),]
# nicotinedep201603 <- prescribe201603[which(prescribe201603$drugcode>=410020&prescribe201603$drugcode<410030),]
# opioddep201603 <- prescribe201603[which(prescribe201603$drugcode>=410030&prescribe201603$drugcode<411000),]
# bronchodilators201603 <- prescribe201603[which(prescribe201603$drugcode>=310000&prescribe201603$drugcode<320000),]
# dementia201603 <- prescribe201603[which(prescribe201603$drugcode>=411000&prescribe201603$drugcode<500000),]
# diabetes201603 <- prescribe201603[which(prescribe201603$drugcode>=601000&prescribe201603$drugcode<602000),]
# 
# antidep201603 <- aggregate(antidep201603[-c(1:5, 11)], antidep201603["PRACTICE"], sum)
# antidep201603$PERIOD <- 201603
# antidep201603$Druggroup <- "Antidepressant"
# dementia201603 <- aggregate(dementia201603[-c(1:5, 11)], dementia201603["PRACTICE"], sum)
# dementia201603$PERIOD <- 201603
# dementia201603$Druggroup <- "Dementia"
# diabetes201603 <- aggregate(diabetes201603[-c(1:5, 11)], diabetes201603["PRACTICE"], sum)
# diabetes201603$PERIOD <- 201603
# diabetes201603$Druggroup <- "Diabetes"
# 
# bronchodilators201603 <- aggregate(bronchodilators201603[-c(1:5, 11)], bronchodilators201603["PRACTICE"], sum)
# bronchodilators201603$PERIOD <- 201603
# bronchodilators201603$Druggroup <- "Bronchodilators"
# opioddep201603 <- aggregate(opioddep201603[-c(1:5, 11)], opioddep201603["PRACTICE"], sum)
# opioddep201603$PERIOD <- 201603
# opioddep201603$Druggroup <- "Opiod"
# nicotinedep201603 <- aggregate(nicotinedep201603[-c(1:5, 11)], nicotinedep201603["PRACTICE"], sum)
# nicotinedep201603$PERIOD <- 201603
# nicotinedep201603$Druggroup <- "Nicotine"
# alcoholdep201603 <- aggregate(alcoholdep201603[-c(1:5, 11)], alcoholdep201603["PRACTICE"], sum)
# alcoholdep201603$PERIOD <- 201603
# alcoholdep201603$Druggroup <- "Alcohol"
# allsubstancedep201603 <- aggregate(allsubstancedep201603[-c(1:5, 11)], allsubstancedep201603["PRACTICE"], sum)
# allsubstancedep201603$PERIOD <- 201603
# allsubstancedep201603$Druggroup <- "SubstanceDep"
# obesedrugs201603 <- aggregate(obesedrugs201603[-c(1:5, 11)], obesedrugs201603["PRACTICE"], sum)
# obesedrugs201603$PERIOD <- 201603
# obesedrugs201603$Druggroup <- "Obesity"
# 
# prescribemaster201603 <- do.call("rbind", list(obesedrugs201603, allsubstancedep201603, alcoholdep201603, 
#                                                nicotinedep201603,opioddep201603, bronchodilators201603,
#                                                antidep201603, diabetes201603, dementia201603))
# 
# 
# write.csv(prescribemaster201603, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201603.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201602 <- read_csv("H:/prescription data/T201602PDPI BNFT.csv")
# prescribe201602$drugcode <- parse_number(prescribe201602$`BNF CODE`)
# prescribe201602$drugcode <- substr(prescribe201602$drugcode, 0, 6)
# antidep201602 <- prescribe201602[which(prescribe201602$drugcode>=403000&prescribe201602$drugcode<404000),]
# obesedrugs201602 <- prescribe201602[which(prescribe201602$drugcode>=405000&prescribe201602$drugcode<406000),]
# allsubstancedep201602 <- prescribe201602[which(prescribe201602$drugcode>=410000&prescribe201602$drugcode<411000),]
# alcoholdep201602 <- prescribe201602[which(prescribe201602$drugcode>=410010&prescribe201602$drugcode<410020),]
# nicotinedep201602 <- prescribe201602[which(prescribe201602$drugcode>=410020&prescribe201602$drugcode<410030),]
# opioddep201602 <- prescribe201602[which(prescribe201602$drugcode>=410030&prescribe201602$drugcode<411000),]
# bronchodilators201602 <- prescribe201602[which(prescribe201602$drugcode>=310000&prescribe201602$drugcode<320000),]
# dementia201602 <- prescribe201602[which(prescribe201602$drugcode>=411000&prescribe201602$drugcode<500000),]
# diabetes201602 <- prescribe201602[which(prescribe201602$drugcode>=601000&prescribe201602$drugcode<602000),]
# 
# antidep201602 <- aggregate(antidep201602[-c(1:5, 11)], antidep201602["PRACTICE"], sum)
# antidep201602$PERIOD <- 201602
# antidep201602$Druggroup <- "Antidepressant"
# dementia201602 <- aggregate(dementia201602[-c(1:5, 11)], dementia201602["PRACTICE"], sum)
# dementia201602$PERIOD <- 201602
# dementia201602$Druggroup <- "Dementia"
# diabetes201602 <- aggregate(diabetes201602[-c(1:5, 11)], diabetes201602["PRACTICE"], sum)
# diabetes201602$PERIOD <- 201602
# diabetes201602$Druggroup <- "Diabetes"
# 
# bronchodilators201602 <- aggregate(bronchodilators201602[-c(1:5, 11)], bronchodilators201602["PRACTICE"], sum)
# bronchodilators201602$PERIOD <- 201602
# bronchodilators201602$Druggroup <- "Bronchodilators"
# opioddep201602 <- aggregate(opioddep201602[-c(1:5, 11)], opioddep201602["PRACTICE"], sum)
# opioddep201602$PERIOD <- 201602
# opioddep201602$Druggroup <- "Opiod"
# nicotinedep201602 <- aggregate(nicotinedep201602[-c(1:5, 11)], nicotinedep201602["PRACTICE"], sum)
# nicotinedep201602$PERIOD <- 201602
# nicotinedep201602$Druggroup <- "Nicotine"
# alcoholdep201602 <- aggregate(alcoholdep201602[-c(1:5, 11)], alcoholdep201602["PRACTICE"], sum)
# alcoholdep201602$PERIOD <- 201602
# alcoholdep201602$Druggroup <- "Alcohol"
# allsubstancedep201602 <- aggregate(allsubstancedep201602[-c(1:5, 11)], allsubstancedep201602["PRACTICE"], sum)
# allsubstancedep201602$PERIOD <- 201602
# allsubstancedep201602$Druggroup <- "SubstanceDep"
# obesedrugs201602 <- aggregate(obesedrugs201602[-c(1:5, 11)], obesedrugs201602["PRACTICE"], sum)
# obesedrugs201602$PERIOD <- 201602
# obesedrugs201602$Druggroup <- "Obesity"
# 
# prescribemaster201602 <- do.call("rbind", list(obesedrugs201602, allsubstancedep201602, alcoholdep201602, 
#                                                nicotinedep201602,opioddep201602, bronchodilators201602,
#                                                antidep201602, diabetes201602, dementia201602))
# 
# 
# write.csv(prescribemaster201602, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201602.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201601 <- read_csv("H:/prescription data/T201601PDPI BNFT.csv")
# prescribe201601$drugcode <- parse_number(prescribe201601$`BNF CODE`)
# prescribe201601$drugcode <- substr(prescribe201601$drugcode, 0, 6)
# antidep201601 <- prescribe201601[which(prescribe201601$drugcode>=403000&prescribe201601$drugcode<404000),]
# obesedrugs201601 <- prescribe201601[which(prescribe201601$drugcode>=405000&prescribe201601$drugcode<406000),]
# allsubstancedep201601 <- prescribe201601[which(prescribe201601$drugcode>=410000&prescribe201601$drugcode<411000),]
# alcoholdep201601 <- prescribe201601[which(prescribe201601$drugcode>=410010&prescribe201601$drugcode<410020),]
# nicotinedep201601 <- prescribe201601[which(prescribe201601$drugcode>=410020&prescribe201601$drugcode<410030),]
# opioddep201601 <- prescribe201601[which(prescribe201601$drugcode>=410030&prescribe201601$drugcode<411000),]
# bronchodilators201601 <- prescribe201601[which(prescribe201601$drugcode>=310000&prescribe201601$drugcode<320000),]
# dementia201601 <- prescribe201601[which(prescribe201601$drugcode>=411000&prescribe201601$drugcode<500000),]
# diabetes201601 <- prescribe201601[which(prescribe201601$drugcode>=601000&prescribe201601$drugcode<602000),]
# 
# antidep201601 <- aggregate(antidep201601[-c(1:5, 11)], antidep201601["PRACTICE"], sum)
# antidep201601$PERIOD <- 201601
# antidep201601$Druggroup <- "Antidepressant"
# dementia201601 <- aggregate(dementia201601[-c(1:5, 11)], dementia201601["PRACTICE"], sum)
# dementia201601$PERIOD <- 201601
# dementia201601$Druggroup <- "Dementia"
# diabetes201601 <- aggregate(diabetes201601[-c(1:5, 11)], diabetes201601["PRACTICE"], sum)
# diabetes201601$PERIOD <- 201601
# diabetes201601$Druggroup <- "Diabetes"
# 
# bronchodilators201601 <- aggregate(bronchodilators201601[-c(1:5, 11)], bronchodilators201601["PRACTICE"], sum)
# bronchodilators201601$PERIOD <- 201601
# bronchodilators201601$Druggroup <- "Bronchodilators"
# opioddep201601 <- aggregate(opioddep201601[-c(1:5, 11)], opioddep201601["PRACTICE"], sum)
# opioddep201601$PERIOD <- 201601
# opioddep201601$Druggroup <- "Opiod"
# nicotinedep201601 <- aggregate(nicotinedep201601[-c(1:5, 11)], nicotinedep201601["PRACTICE"], sum)
# nicotinedep201601$PERIOD <- 201601
# nicotinedep201601$Druggroup <- "Nicotine"
# alcoholdep201601 <- aggregate(alcoholdep201601[-c(1:5, 11)], alcoholdep201601["PRACTICE"], sum)
# alcoholdep201601$PERIOD <- 201601
# alcoholdep201601$Druggroup <- "Alcohol"
# allsubstancedep201601 <- aggregate(allsubstancedep201601[-c(1:5, 11)], allsubstancedep201601["PRACTICE"], sum)
# allsubstancedep201601$PERIOD <- 201601
# allsubstancedep201601$Druggroup <- "SubstanceDep"
# obesedrugs201601 <- aggregate(obesedrugs201601[-c(1:5, 11)], obesedrugs201601["PRACTICE"], sum)
# obesedrugs201601$PERIOD <- 201601
# obesedrugs201601$Druggroup <- "Obesity"
# 
# prescribemaster201601 <- do.call("rbind", list(obesedrugs201601, allsubstancedep201601, alcoholdep201601, 
#                                                nicotinedep201601,opioddep201601, bronchodilators201601,
#                                                antidep201601, diabetes201601, dementia201601))
# 
# 
# write.csv(prescribemaster201601, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201601.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201512 <- read_csv("H:/prescription data/T201512PDPI BNFT.csv")
# prescribe201512$drugcode <- parse_number(prescribe201512$`BNF CODE`)
# prescribe201512$drugcode <- substr(prescribe201512$drugcode, 0, 6)
# antidep201512 <- prescribe201512[which(prescribe201512$drugcode>=403000&prescribe201512$drugcode<404000),]
# obesedrugs201512 <- prescribe201512[which(prescribe201512$drugcode>=405000&prescribe201512$drugcode<406000),]
# allsubstancedep201512 <- prescribe201512[which(prescribe201512$drugcode>=410000&prescribe201512$drugcode<411000),]
# alcoholdep201512 <- prescribe201512[which(prescribe201512$drugcode>=410010&prescribe201512$drugcode<410020),]
# nicotinedep201512 <- prescribe201512[which(prescribe201512$drugcode>=410020&prescribe201512$drugcode<410030),]
# opioddep201512 <- prescribe201512[which(prescribe201512$drugcode>=410030&prescribe201512$drugcode<411000),]
# bronchodilators201512 <- prescribe201512[which(prescribe201512$drugcode>=310000&prescribe201512$drugcode<320000),]
# dementia201512 <- prescribe201512[which(prescribe201512$drugcode>=411000&prescribe201512$drugcode<500000),]
# diabetes201512 <- prescribe201512[which(prescribe201512$drugcode>=601000&prescribe201512$drugcode<602000),]
# 
# antidep201512 <- aggregate(antidep201512[-c(1:5, 11)], antidep201512["PRACTICE"], sum)
# antidep201512$PERIOD <- 201512
# antidep201512$Druggroup <- "Antidepressant"
# dementia201512 <- aggregate(dementia201512[-c(1:5, 11)], dementia201512["PRACTICE"], sum)
# dementia201512$PERIOD <- 201512
# dementia201512$Druggroup <- "Dementia"
# diabetes201512 <- aggregate(diabetes201512[-c(1:5, 11)], diabetes201512["PRACTICE"], sum)
# diabetes201512$PERIOD <- 201512
# diabetes201512$Druggroup <- "Diabetes"
# 
# bronchodilators201512 <- aggregate(bronchodilators201512[-c(1:5, 11)], bronchodilators201512["PRACTICE"], sum)
# bronchodilators201512$PERIOD <- 201512
# bronchodilators201512$Druggroup <- "Bronchodilators"
# opioddep201512 <- aggregate(opioddep201512[-c(1:5, 11)], opioddep201512["PRACTICE"], sum)
# opioddep201512$PERIOD <- 201512
# opioddep201512$Druggroup <- "Opiod"
# nicotinedep201512 <- aggregate(nicotinedep201512[-c(1:5, 11)], nicotinedep201512["PRACTICE"], sum)
# nicotinedep201512$PERIOD <- 201512
# nicotinedep201512$Druggroup <- "Nicotine"
# alcoholdep201512 <- aggregate(alcoholdep201512[-c(1:5, 11)], alcoholdep201512["PRACTICE"], sum)
# alcoholdep201512$PERIOD <- 201512
# alcoholdep201512$Druggroup <- "Alcohol"
# allsubstancedep201512 <- aggregate(allsubstancedep201512[-c(1:5, 11)], allsubstancedep201512["PRACTICE"], sum)
# allsubstancedep201512$PERIOD <- 201512
# allsubstancedep201512$Druggroup <- "SubstanceDep"
# obesedrugs201512 <- aggregate(obesedrugs201512[-c(1:5, 11)], obesedrugs201512["PRACTICE"], sum)
# obesedrugs201512$PERIOD <- 201512
# obesedrugs201512$Druggroup <- "Obesity"
# 
# prescribemaster201512 <- do.call("rbind", list(obesedrugs201512, allsubstancedep201512, alcoholdep201512, 
#                                                nicotinedep201512,opioddep201512, bronchodilators201512,
#                                                antidep201512, diabetes201512, dementia201512))
# 
# 
# write.csv(prescribemaster201512, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201512.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201511 <- read_csv("H:/prescription data/T201511PDPI BNFT.csv")
# prescribe201511$drugcode <- parse_number(prescribe201511$`BNF CODE`)
# prescribe201511$drugcode <- substr(prescribe201511$drugcode, 0, 6)
# antidep201511 <- prescribe201511[which(prescribe201511$drugcode>=403000&prescribe201511$drugcode<404000),]
# obesedrugs201511 <- prescribe201511[which(prescribe201511$drugcode>=405000&prescribe201511$drugcode<406000),]
# allsubstancedep201511 <- prescribe201511[which(prescribe201511$drugcode>=410000&prescribe201511$drugcode<411000),]
# alcoholdep201511 <- prescribe201511[which(prescribe201511$drugcode>=410010&prescribe201511$drugcode<410020),]
# nicotinedep201511 <- prescribe201511[which(prescribe201511$drugcode>=410020&prescribe201511$drugcode<410030),]
# opioddep201511 <- prescribe201511[which(prescribe201511$drugcode>=410030&prescribe201511$drugcode<411000),]
# bronchodilators201511 <- prescribe201511[which(prescribe201511$drugcode>=310000&prescribe201511$drugcode<320000),]
# dementia201511 <- prescribe201511[which(prescribe201511$drugcode>=411000&prescribe201511$drugcode<500000),]
# diabetes201511 <- prescribe201511[which(prescribe201511$drugcode>=601000&prescribe201511$drugcode<602000),]
# 
# antidep201511 <- aggregate(antidep201511[-c(1:5, 11)], antidep201511["PRACTICE"], sum)
# antidep201511$PERIOD <- 201511
# antidep201511$Druggroup <- "Antidepressant"
# dementia201511 <- aggregate(dementia201511[-c(1:5, 11)], dementia201511["PRACTICE"], sum)
# dementia201511$PERIOD <- 201511
# dementia201511$Druggroup <- "Dementia"
# diabetes201511 <- aggregate(diabetes201511[-c(1:5, 11)], diabetes201511["PRACTICE"], sum)
# diabetes201511$PERIOD <- 201511
# diabetes201511$Druggroup <- "Diabetes"
# 
# bronchodilators201511 <- aggregate(bronchodilators201511[-c(1:5, 11)], bronchodilators201511["PRACTICE"], sum)
# bronchodilators201511$PERIOD <- 201511
# bronchodilators201511$Druggroup <- "Bronchodilators"
# opioddep201511 <- aggregate(opioddep201511[-c(1:5, 11)], opioddep201511["PRACTICE"], sum)
# opioddep201511$PERIOD <- 201511
# opioddep201511$Druggroup <- "Opiod"
# nicotinedep201511 <- aggregate(nicotinedep201511[-c(1:5, 11)], nicotinedep201511["PRACTICE"], sum)
# nicotinedep201511$PERIOD <- 201511
# nicotinedep201511$Druggroup <- "Nicotine"
# alcoholdep201511 <- aggregate(alcoholdep201511[-c(1:5, 11)], alcoholdep201511["PRACTICE"], sum)
# alcoholdep201511$PERIOD <- 201511
# alcoholdep201511$Druggroup <- "Alcohol"
# allsubstancedep201511 <- aggregate(allsubstancedep201511[-c(1:5, 11)], allsubstancedep201511["PRACTICE"], sum)
# allsubstancedep201511$PERIOD <- 201511
# allsubstancedep201511$Druggroup <- "SubstanceDep"
# obesedrugs201511 <- aggregate(obesedrugs201511[-c(1:5, 11)], obesedrugs201511["PRACTICE"], sum)
# obesedrugs201511$PERIOD <- 201511
# obesedrugs201511$Druggroup <- "Obesity"
# 
# prescribemaster201511 <- do.call("rbind", list(obesedrugs201511, allsubstancedep201511, alcoholdep201511, 
#                                                nicotinedep201511,opioddep201511, bronchodilators201511,
#                                                antidep201511, diabetes201511, dementia201511))
# 
# 
# write.csv(prescribemaster201511, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201511.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201510 <- read_csv("H:/prescription data/T201510PDPI BNFT.csv")
# prescribe201510$drugcode <- parse_number(prescribe201510$`BNF CODE`)
# prescribe201510$drugcode <- substr(prescribe201510$drugcode, 0, 6)
# antidep201510 <- prescribe201510[which(prescribe201510$drugcode>=403000&prescribe201510$drugcode<404000),]
# obesedrugs201510 <- prescribe201510[which(prescribe201510$drugcode>=405000&prescribe201510$drugcode<406000),]
# allsubstancedep201510 <- prescribe201510[which(prescribe201510$drugcode>=410000&prescribe201510$drugcode<411000),]
# alcoholdep201510 <- prescribe201510[which(prescribe201510$drugcode>=410010&prescribe201510$drugcode<410020),]
# nicotinedep201510 <- prescribe201510[which(prescribe201510$drugcode>=410020&prescribe201510$drugcode<410030),]
# opioddep201510 <- prescribe201510[which(prescribe201510$drugcode>=410030&prescribe201510$drugcode<411000),]
# bronchodilators201510 <- prescribe201510[which(prescribe201510$drugcode>=310000&prescribe201510$drugcode<320000),]
# dementia201510 <- prescribe201510[which(prescribe201510$drugcode>=411000&prescribe201510$drugcode<500000),]
# diabetes201510 <- prescribe201510[which(prescribe201510$drugcode>=601000&prescribe201510$drugcode<602000),]
# 
# antidep201510 <- aggregate(antidep201510[-c(1:5, 11)], antidep201510["PRACTICE"], sum)
# antidep201510$PERIOD <- 201510
# antidep201510$Druggroup <- "Antidepressant"
# dementia201510 <- aggregate(dementia201510[-c(1:5, 11)], dementia201510["PRACTICE"], sum)
# dementia201510$PERIOD <- 201510
# dementia201510$Druggroup <- "Dementia"
# diabetes201510 <- aggregate(diabetes201510[-c(1:5, 11)], diabetes201510["PRACTICE"], sum)
# diabetes201510$PERIOD <- 201510
# diabetes201510$Druggroup <- "Diabetes"
# 
# bronchodilators201510 <- aggregate(bronchodilators201510[-c(1:5, 11)], bronchodilators201510["PRACTICE"], sum)
# bronchodilators201510$PERIOD <- 201510
# bronchodilators201510$Druggroup <- "Bronchodilators"
# opioddep201510 <- aggregate(opioddep201510[-c(1:5, 11)], opioddep201510["PRACTICE"], sum)
# opioddep201510$PERIOD <- 201510
# opioddep201510$Druggroup <- "Opiod"
# nicotinedep201510 <- aggregate(nicotinedep201510[-c(1:5, 11)], nicotinedep201510["PRACTICE"], sum)
# nicotinedep201510$PERIOD <- 201510
# nicotinedep201510$Druggroup <- "Nicotine"
# alcoholdep201510 <- aggregate(alcoholdep201510[-c(1:5, 11)], alcoholdep201510["PRACTICE"], sum)
# alcoholdep201510$PERIOD <- 201510
# alcoholdep201510$Druggroup <- "Alcohol"
# allsubstancedep201510 <- aggregate(allsubstancedep201510[-c(1:5, 11)], allsubstancedep201510["PRACTICE"], sum)
# allsubstancedep201510$PERIOD <- 201510
# allsubstancedep201510$Druggroup <- "SubstanceDep"
# obesedrugs201510 <- aggregate(obesedrugs201510[-c(1:5, 11)], obesedrugs201510["PRACTICE"], sum)
# obesedrugs201510$PERIOD <- 201510
# obesedrugs201510$Druggroup <- "Obesity"
# 
# prescribemaster201510 <- do.call("rbind", list(obesedrugs201510, allsubstancedep201510, alcoholdep201510, 
#                                                nicotinedep201510,opioddep201510, bronchodilators201510,
#                                                antidep201510, diabetes201510, dementia201510))
# 
# 
# write.csv(prescribemaster201510, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201510.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201509 <- read_csv("H:/prescription data/T201509PDPI BNFT.csv")
# prescribe201509$drugcode <- parse_number(prescribe201509$`BNF CODE`)
# prescribe201509$drugcode <- substr(prescribe201509$drugcode, 0, 6)
# antidep201509 <- prescribe201509[which(prescribe201509$drugcode>=403000&prescribe201509$drugcode<404000),]
# obesedrugs201509 <- prescribe201509[which(prescribe201509$drugcode>=405000&prescribe201509$drugcode<406000),]
# allsubstancedep201509 <- prescribe201509[which(prescribe201509$drugcode>=410000&prescribe201509$drugcode<411000),]
# alcoholdep201509 <- prescribe201509[which(prescribe201509$drugcode>=410010&prescribe201509$drugcode<410020),]
# nicotinedep201509 <- prescribe201509[which(prescribe201509$drugcode>=410020&prescribe201509$drugcode<410030),]
# opioddep201509 <- prescribe201509[which(prescribe201509$drugcode>=410030&prescribe201509$drugcode<411000),]
# bronchodilators201509 <- prescribe201509[which(prescribe201509$drugcode>=310000&prescribe201509$drugcode<320000),]
# dementia201509 <- prescribe201509[which(prescribe201509$drugcode>=411000&prescribe201509$drugcode<500000),]
# diabetes201509 <- prescribe201509[which(prescribe201509$drugcode>=601000&prescribe201509$drugcode<602000),]
# 
# antidep201509 <- aggregate(antidep201509[-c(1:5, 11)], antidep201509["PRACTICE"], sum)
# antidep201509$PERIOD <- 201509
# antidep201509$Druggroup <- "Antidepressant"
# dementia201509 <- aggregate(dementia201509[-c(1:5, 11)], dementia201509["PRACTICE"], sum)
# dementia201509$PERIOD <- 201509
# dementia201509$Druggroup <- "Dementia"
# diabetes201509 <- aggregate(diabetes201509[-c(1:5, 11)], diabetes201509["PRACTICE"], sum)
# diabetes201509$PERIOD <- 201509
# diabetes201509$Druggroup <- "Diabetes"
# 
# bronchodilators201509 <- aggregate(bronchodilators201509[-c(1:5, 11)], bronchodilators201509["PRACTICE"], sum)
# bronchodilators201509$PERIOD <- 201509
# bronchodilators201509$Druggroup <- "Bronchodilators"
# opioddep201509 <- aggregate(opioddep201509[-c(1:5, 11)], opioddep201509["PRACTICE"], sum)
# opioddep201509$PERIOD <- 201509
# opioddep201509$Druggroup <- "Opiod"
# nicotinedep201509 <- aggregate(nicotinedep201509[-c(1:5, 11)], nicotinedep201509["PRACTICE"], sum)
# nicotinedep201509$PERIOD <- 201509
# nicotinedep201509$Druggroup <- "Nicotine"
# alcoholdep201509 <- aggregate(alcoholdep201509[-c(1:5, 11)], alcoholdep201509["PRACTICE"], sum)
# alcoholdep201509$PERIOD <- 201509
# alcoholdep201509$Druggroup <- "Alcohol"
# allsubstancedep201509 <- aggregate(allsubstancedep201509[-c(1:5, 11)], allsubstancedep201509["PRACTICE"], sum)
# allsubstancedep201509$PERIOD <- 201509
# allsubstancedep201509$Druggroup <- "SubstanceDep"
# obesedrugs201509 <- aggregate(obesedrugs201509[-c(1:5, 11)], obesedrugs201509["PRACTICE"], sum)
# obesedrugs201509$PERIOD <- 201509
# obesedrugs201509$Druggroup <- "Obesity"
# 
# prescribemaster201509 <- do.call("rbind", list(obesedrugs201509, allsubstancedep201509, alcoholdep201509, 
#                                                nicotinedep201509,opioddep201509, bronchodilators201509,
#                                                antidep201509, diabetes201509, dementia201509))
# 
# 
# write.csv(prescribemaster201509, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201509.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201508 <- read_csv("H:/prescription data/T201508PDPI BNFT.csv")
# prescribe201508$drugcode <- parse_number(prescribe201508$`BNF CODE`)
# prescribe201508$drugcode <- substr(prescribe201508$drugcode, 0, 6)
# antidep201508 <- prescribe201508[which(prescribe201508$drugcode>=403000&prescribe201508$drugcode<404000),]
# obesedrugs201508 <- prescribe201508[which(prescribe201508$drugcode>=405000&prescribe201508$drugcode<406000),]
# allsubstancedep201508 <- prescribe201508[which(prescribe201508$drugcode>=410000&prescribe201508$drugcode<411000),]
# alcoholdep201508 <- prescribe201508[which(prescribe201508$drugcode>=410010&prescribe201508$drugcode<410020),]
# nicotinedep201508 <- prescribe201508[which(prescribe201508$drugcode>=410020&prescribe201508$drugcode<410030),]
# opioddep201508 <- prescribe201508[which(prescribe201508$drugcode>=410030&prescribe201508$drugcode<411000),]
# bronchodilators201508 <- prescribe201508[which(prescribe201508$drugcode>=310000&prescribe201508$drugcode<320000),]
# dementia201508 <- prescribe201508[which(prescribe201508$drugcode>=411000&prescribe201508$drugcode<500000),]
# diabetes201508 <- prescribe201508[which(prescribe201508$drugcode>=601000&prescribe201508$drugcode<602000),]
# 
# antidep201508 <- aggregate(antidep201508[-c(1:5, 11)], antidep201508["PRACTICE"], sum)
# antidep201508$PERIOD <- 201508
# antidep201508$Druggroup <- "Antidepressant"
# dementia201508 <- aggregate(dementia201508[-c(1:5, 11)], dementia201508["PRACTICE"], sum)
# dementia201508$PERIOD <- 201508
# dementia201508$Druggroup <- "Dementia"
# diabetes201508 <- aggregate(diabetes201508[-c(1:5, 11)], diabetes201508["PRACTICE"], sum)
# diabetes201508$PERIOD <- 201508
# diabetes201508$Druggroup <- "Diabetes"
# 
# bronchodilators201508 <- aggregate(bronchodilators201508[-c(1:5, 11)], bronchodilators201508["PRACTICE"], sum)
# bronchodilators201508$PERIOD <- 201508
# bronchodilators201508$Druggroup <- "Bronchodilators"
# opioddep201508 <- aggregate(opioddep201508[-c(1:5, 11)], opioddep201508["PRACTICE"], sum)
# opioddep201508$PERIOD <- 201508
# opioddep201508$Druggroup <- "Opiod"
# nicotinedep201508 <- aggregate(nicotinedep201508[-c(1:5, 11)], nicotinedep201508["PRACTICE"], sum)
# nicotinedep201508$PERIOD <- 201508
# nicotinedep201508$Druggroup <- "Nicotine"
# alcoholdep201508 <- aggregate(alcoholdep201508[-c(1:5, 11)], alcoholdep201508["PRACTICE"], sum)
# alcoholdep201508$PERIOD <- 201508
# alcoholdep201508$Druggroup <- "Alcohol"
# allsubstancedep201508 <- aggregate(allsubstancedep201508[-c(1:5, 11)], allsubstancedep201508["PRACTICE"], sum)
# allsubstancedep201508$PERIOD <- 201508
# allsubstancedep201508$Druggroup <- "SubstanceDep"
# obesedrugs201508 <- aggregate(obesedrugs201508[-c(1:5, 11)], obesedrugs201508["PRACTICE"], sum)
# obesedrugs201508$PERIOD <- 201508
# obesedrugs201508$Druggroup <- "Obesity"
# 
# prescribemaster201508 <- do.call("rbind", list(obesedrugs201508, allsubstancedep201508, alcoholdep201508, 
#                                                nicotinedep201508,opioddep201508, bronchodilators201508,
#                                                antidep201508, diabetes201508, dementia201508))
# 
# 
# write.csv(prescribemaster201508, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201508.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201507 <- read_csv("H:/prescription data/T201507PDPI BNFT.csv")
# prescribe201507$drugcode <- parse_number(prescribe201507$`BNF CODE`)
# prescribe201507$drugcode <- substr(prescribe201507$drugcode, 0, 6)
# antidep201507 <- prescribe201507[which(prescribe201507$drugcode>=403000&prescribe201507$drugcode<404000),]
# obesedrugs201507 <- prescribe201507[which(prescribe201507$drugcode>=405000&prescribe201507$drugcode<406000),]
# allsubstancedep201507 <- prescribe201507[which(prescribe201507$drugcode>=410000&prescribe201507$drugcode<411000),]
# alcoholdep201507 <- prescribe201507[which(prescribe201507$drugcode>=410010&prescribe201507$drugcode<410020),]
# nicotinedep201507 <- prescribe201507[which(prescribe201507$drugcode>=410020&prescribe201507$drugcode<410030),]
# opioddep201507 <- prescribe201507[which(prescribe201507$drugcode>=410030&prescribe201507$drugcode<411000),]
# bronchodilators201507 <- prescribe201507[which(prescribe201507$drugcode>=310000&prescribe201507$drugcode<320000),]
# dementia201507 <- prescribe201507[which(prescribe201507$drugcode>=411000&prescribe201507$drugcode<500000),]
# diabetes201507 <- prescribe201507[which(prescribe201507$drugcode>=601000&prescribe201507$drugcode<602000),]
# 
# antidep201507 <- aggregate(antidep201507[-c(1:5, 11)], antidep201507["PRACTICE"], sum)
# antidep201507$PERIOD <- 201507
# antidep201507$Druggroup <- "Antidepressant"
# dementia201507 <- aggregate(dementia201507[-c(1:5, 11)], dementia201507["PRACTICE"], sum)
# dementia201507$PERIOD <- 201507
# dementia201507$Druggroup <- "Dementia"
# diabetes201507 <- aggregate(diabetes201507[-c(1:5, 11)], diabetes201507["PRACTICE"], sum)
# diabetes201507$PERIOD <- 201507
# diabetes201507$Druggroup <- "Diabetes"
# 
# bronchodilators201507 <- aggregate(bronchodilators201507[-c(1:5, 11)], bronchodilators201507["PRACTICE"], sum)
# bronchodilators201507$PERIOD <- 201507
# bronchodilators201507$Druggroup <- "Bronchodilators"
# opioddep201507 <- aggregate(opioddep201507[-c(1:5, 11)], opioddep201507["PRACTICE"], sum)
# opioddep201507$PERIOD <- 201507
# opioddep201507$Druggroup <- "Opiod"
# nicotinedep201507 <- aggregate(nicotinedep201507[-c(1:5, 11)], nicotinedep201507["PRACTICE"], sum)
# nicotinedep201507$PERIOD <- 201507
# nicotinedep201507$Druggroup <- "Nicotine"
# alcoholdep201507 <- aggregate(alcoholdep201507[-c(1:5, 11)], alcoholdep201507["PRACTICE"], sum)
# alcoholdep201507$PERIOD <- 201507
# alcoholdep201507$Druggroup <- "Alcohol"
# allsubstancedep201507 <- aggregate(allsubstancedep201507[-c(1:5, 11)], allsubstancedep201507["PRACTICE"], sum)
# allsubstancedep201507$PERIOD <- 201507
# allsubstancedep201507$Druggroup <- "SubstanceDep"
# obesedrugs201507 <- aggregate(obesedrugs201507[-c(1:5, 11)], obesedrugs201507["PRACTICE"], sum)
# obesedrugs201507$PERIOD <- 201507
# obesedrugs201507$Druggroup <- "Obesity"
# 
# prescribemaster201507 <- do.call("rbind", list(obesedrugs201507, allsubstancedep201507, alcoholdep201507, 
#                                                nicotinedep201507,opioddep201507, bronchodilators201507,
#                                                antidep201507, diabetes201507, dementia201507))
# 
# 
# write.csv(prescribemaster201507, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201507.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201506 <- read_csv("H:/prescription data/T201506PDPI BNFT.csv")
# prescribe201506$drugcode <- parse_number(prescribe201506$`BNF CODE`)
# prescribe201506$drugcode <- substr(prescribe201506$drugcode, 0, 6)
# antidep201506 <- prescribe201506[which(prescribe201506$drugcode>=403000&prescribe201506$drugcode<404000),]
# obesedrugs201506 <- prescribe201506[which(prescribe201506$drugcode>=405000&prescribe201506$drugcode<406000),]
# allsubstancedep201506 <- prescribe201506[which(prescribe201506$drugcode>=410000&prescribe201506$drugcode<411000),]
# alcoholdep201506 <- prescribe201506[which(prescribe201506$drugcode>=410010&prescribe201506$drugcode<410020),]
# nicotinedep201506 <- prescribe201506[which(prescribe201506$drugcode>=410020&prescribe201506$drugcode<410030),]
# opioddep201506 <- prescribe201506[which(prescribe201506$drugcode>=410030&prescribe201506$drugcode<411000),]
# bronchodilators201506 <- prescribe201506[which(prescribe201506$drugcode>=310000&prescribe201506$drugcode<320000),]
# dementia201506 <- prescribe201506[which(prescribe201506$drugcode>=411000&prescribe201506$drugcode<500000),]
# diabetes201506 <- prescribe201506[which(prescribe201506$drugcode>=601000&prescribe201506$drugcode<602000),]
# 
# antidep201506 <- aggregate(antidep201506[-c(1:5, 11)], antidep201506["PRACTICE"], sum)
# antidep201506$PERIOD <- 201506
# antidep201506$Druggroup <- "Antidepressant"
# dementia201506 <- aggregate(dementia201506[-c(1:5, 11)], dementia201506["PRACTICE"], sum)
# dementia201506$PERIOD <- 201506
# dementia201506$Druggroup <- "Dementia"
# diabetes201506 <- aggregate(diabetes201506[-c(1:5, 11)], diabetes201506["PRACTICE"], sum)
# diabetes201506$PERIOD <- 201506
# diabetes201506$Druggroup <- "Diabetes"
# 
# bronchodilators201506 <- aggregate(bronchodilators201506[-c(1:5, 11)], bronchodilators201506["PRACTICE"], sum)
# bronchodilators201506$PERIOD <- 201506
# bronchodilators201506$Druggroup <- "Bronchodilators"
# opioddep201506 <- aggregate(opioddep201506[-c(1:5, 11)], opioddep201506["PRACTICE"], sum)
# opioddep201506$PERIOD <- 201506
# opioddep201506$Druggroup <- "Opiod"
# nicotinedep201506 <- aggregate(nicotinedep201506[-c(1:5, 11)], nicotinedep201506["PRACTICE"], sum)
# nicotinedep201506$PERIOD <- 201506
# nicotinedep201506$Druggroup <- "Nicotine"
# alcoholdep201506 <- aggregate(alcoholdep201506[-c(1:5, 11)], alcoholdep201506["PRACTICE"], sum)
# alcoholdep201506$PERIOD <- 201506
# alcoholdep201506$Druggroup <- "Alcohol"
# allsubstancedep201506 <- aggregate(allsubstancedep201506[-c(1:5, 11)], allsubstancedep201506["PRACTICE"], sum)
# allsubstancedep201506$PERIOD <- 201506
# allsubstancedep201506$Druggroup <- "SubstanceDep"
# obesedrugs201506 <- aggregate(obesedrugs201506[-c(1:5, 11)], obesedrugs201506["PRACTICE"], sum)
# obesedrugs201506$PERIOD <- 201506
# obesedrugs201506$Druggroup <- "Obesity"
# 
# prescribemaster201506 <- do.call("rbind", list(obesedrugs201506, allsubstancedep201506, alcoholdep201506, 
#                                                nicotinedep201506,opioddep201506, bronchodilators201506,
#                                                antidep201506, diabetes201506, dementia201506))
# 
# 
# write.csv(prescribemaster201506, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201506.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# 
# prescribe201505 <- read_csv("H:/prescription data/T201505PDPI BNFT.csv")
# prescribe201505$drugcode <- parse_number(prescribe201505$`BNF CODE`)
# prescribe201505$drugcode <- substr(prescribe201505$drugcode, 0, 6)
# antidep201505 <- prescribe201505[which(prescribe201505$drugcode>=403000&prescribe201505$drugcode<404000),]
# obesedrugs201505 <- prescribe201505[which(prescribe201505$drugcode>=405000&prescribe201505$drugcode<406000),]
# allsubstancedep201505 <- prescribe201505[which(prescribe201505$drugcode>=410000&prescribe201505$drugcode<411000),]
# alcoholdep201505 <- prescribe201505[which(prescribe201505$drugcode>=410010&prescribe201505$drugcode<410020),]
# nicotinedep201505 <- prescribe201505[which(prescribe201505$drugcode>=410020&prescribe201505$drugcode<410030),]
# opioddep201505 <- prescribe201505[which(prescribe201505$drugcode>=410030&prescribe201505$drugcode<411000),]
# bronchodilators201505 <- prescribe201505[which(prescribe201505$drugcode>=310000&prescribe201505$drugcode<320000),]
# dementia201505 <- prescribe201505[which(prescribe201505$drugcode>=411000&prescribe201505$drugcode<500000),]
# diabetes201505 <- prescribe201505[which(prescribe201505$drugcode>=601000&prescribe201505$drugcode<602000),]
# 
# antidep201505 <- aggregate(antidep201505[-c(1:5, 11)], antidep201505["PRACTICE"], sum)
# antidep201505$PERIOD <- 201505
# antidep201505$Druggroup <- "Antidepressant"
# dementia201505 <- aggregate(dementia201505[-c(1:5, 11)], dementia201505["PRACTICE"], sum)
# dementia201505$PERIOD <- 201505
# dementia201505$Druggroup <- "Dementia"
# diabetes201505 <- aggregate(diabetes201505[-c(1:5, 11)], diabetes201505["PRACTICE"], sum)
# diabetes201505$PERIOD <- 201505
# diabetes201505$Druggroup <- "Diabetes"
# 
# bronchodilators201505 <- aggregate(bronchodilators201505[-c(1:5, 11)], bronchodilators201505["PRACTICE"], sum)
# bronchodilators201505$PERIOD <- 201505
# bronchodilators201505$Druggroup <- "Bronchodilators"
# opioddep201505 <- aggregate(opioddep201505[-c(1:5, 11)], opioddep201505["PRACTICE"], sum)
# opioddep201505$PERIOD <- 201505
# opioddep201505$Druggroup <- "Opiod"
# nicotinedep201505 <- aggregate(nicotinedep201505[-c(1:5, 11)], nicotinedep201505["PRACTICE"], sum)
# nicotinedep201505$PERIOD <- 201505
# nicotinedep201505$Druggroup <- "Nicotine"
# alcoholdep201505 <- aggregate(alcoholdep201505[-c(1:5, 11)], alcoholdep201505["PRACTICE"], sum)
# alcoholdep201505$PERIOD <- 201505
# alcoholdep201505$Druggroup <- "Alcohol"
# allsubstancedep201505 <- aggregate(allsubstancedep201505[-c(1:5, 11)], allsubstancedep201505["PRACTICE"], sum)
# allsubstancedep201505$PERIOD <- 201505
# allsubstancedep201505$Druggroup <- "SubstanceDep"
# obesedrugs201505 <- aggregate(obesedrugs201505[-c(1:5, 11)], obesedrugs201505["PRACTICE"], sum)
# obesedrugs201505$PERIOD <- 201505
# obesedrugs201505$Druggroup <- "Obesity"
# 
# prescribemaster201505 <- do.call("rbind", list(obesedrugs201505, allsubstancedep201505, alcoholdep201505, 
#                                                nicotinedep201505,opioddep201505, bronchodilators201505,
#                                                antidep201505, diabetes201505, dementia201505))
# 
# 
# write.csv(prescribemaster201505, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201505.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201504 <- read_csv("H:/prescription data/T201504PDPI BNFT.csv")
# prescribe201504$drugcode <- parse_number(prescribe201504$`BNF CODE`)
# prescribe201504$drugcode <- substr(prescribe201504$drugcode, 0, 6)
# antidep201504 <- prescribe201504[which(prescribe201504$drugcode>=403000&prescribe201504$drugcode<404000),]
# obesedrugs201504 <- prescribe201504[which(prescribe201504$drugcode>=405000&prescribe201504$drugcode<406000),]
# allsubstancedep201504 <- prescribe201504[which(prescribe201504$drugcode>=410000&prescribe201504$drugcode<411000),]
# alcoholdep201504 <- prescribe201504[which(prescribe201504$drugcode>=410010&prescribe201504$drugcode<410020),]
# nicotinedep201504 <- prescribe201504[which(prescribe201504$drugcode>=410020&prescribe201504$drugcode<410030),]
# opioddep201504 <- prescribe201504[which(prescribe201504$drugcode>=410030&prescribe201504$drugcode<411000),]
# bronchodilators201504 <- prescribe201504[which(prescribe201504$drugcode>=310000&prescribe201504$drugcode<320000),]
# dementia201504 <- prescribe201504[which(prescribe201504$drugcode>=411000&prescribe201504$drugcode<500000),]
# diabetes201504 <- prescribe201504[which(prescribe201504$drugcode>=601000&prescribe201504$drugcode<602000),]
# 
# antidep201504 <- aggregate(antidep201504[-c(1:5, 11)], antidep201504["PRACTICE"], sum)
# antidep201504$PERIOD <- 201504
# antidep201504$Druggroup <- "Antidepressant"
# dementia201504 <- aggregate(dementia201504[-c(1:5, 11)], dementia201504["PRACTICE"], sum)
# dementia201504$PERIOD <- 201504
# dementia201504$Druggroup <- "Dementia"
# diabetes201504 <- aggregate(diabetes201504[-c(1:5, 11)], diabetes201504["PRACTICE"], sum)
# diabetes201504$PERIOD <- 201504
# diabetes201504$Druggroup <- "Diabetes"
# 
# bronchodilators201504 <- aggregate(bronchodilators201504[-c(1:5, 11)], bronchodilators201504["PRACTICE"], sum)
# bronchodilators201504$PERIOD <- 201504
# bronchodilators201504$Druggroup <- "Bronchodilators"
# opioddep201504 <- aggregate(opioddep201504[-c(1:5, 11)], opioddep201504["PRACTICE"], sum)
# opioddep201504$PERIOD <- 201504
# opioddep201504$Druggroup <- "Opiod"
# nicotinedep201504 <- aggregate(nicotinedep201504[-c(1:5, 11)], nicotinedep201504["PRACTICE"], sum)
# nicotinedep201504$PERIOD <- 201504
# nicotinedep201504$Druggroup <- "Nicotine"
# alcoholdep201504 <- aggregate(alcoholdep201504[-c(1:5, 11)], alcoholdep201504["PRACTICE"], sum)
# alcoholdep201504$PERIOD <- 201504
# alcoholdep201504$Druggroup <- "Alcohol"
# allsubstancedep201504 <- aggregate(allsubstancedep201504[-c(1:5, 11)], allsubstancedep201504["PRACTICE"], sum)
# allsubstancedep201504$PERIOD <- 201504
# allsubstancedep201504$Druggroup <- "SubstanceDep"
# obesedrugs201504 <- aggregate(obesedrugs201504[-c(1:5, 11)], obesedrugs201504["PRACTICE"], sum)
# obesedrugs201504$PERIOD <- 201504
# obesedrugs201504$Druggroup <- "Obesity"
# 
# prescribemaster201504 <- do.call("rbind", list(obesedrugs201504, allsubstancedep201504, alcoholdep201504, 
#                                                nicotinedep201504,opioddep201504, bronchodilators201504,
#                                                antidep201504, diabetes201504, dementia201504))
# 
# 
# write.csv(prescribemaster201504, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201504.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201503 <- read_csv("H:/prescription data/T201503PDPI BNFT.csv")
# prescribe201503$drugcode <- parse_number(prescribe201503$`BNF CODE`)
# prescribe201503$drugcode <- substr(prescribe201503$drugcode, 0, 6)
# antidep201503 <- prescribe201503[which(prescribe201503$drugcode>=403000&prescribe201503$drugcode<404000),]
# obesedrugs201503 <- prescribe201503[which(prescribe201503$drugcode>=405000&prescribe201503$drugcode<406000),]
# allsubstancedep201503 <- prescribe201503[which(prescribe201503$drugcode>=410000&prescribe201503$drugcode<411000),]
# alcoholdep201503 <- prescribe201503[which(prescribe201503$drugcode>=410010&prescribe201503$drugcode<410020),]
# nicotinedep201503 <- prescribe201503[which(prescribe201503$drugcode>=410020&prescribe201503$drugcode<410030),]
# opioddep201503 <- prescribe201503[which(prescribe201503$drugcode>=410030&prescribe201503$drugcode<411000),]
# bronchodilators201503 <- prescribe201503[which(prescribe201503$drugcode>=310000&prescribe201503$drugcode<320000),]
# dementia201503 <- prescribe201503[which(prescribe201503$drugcode>=411000&prescribe201503$drugcode<500000),]
# diabetes201503 <- prescribe201503[which(prescribe201503$drugcode>=601000&prescribe201503$drugcode<602000),]
# 
# antidep201503 <- aggregate(antidep201503[-c(1:5, 11)], antidep201503["PRACTICE"], sum)
# antidep201503$PERIOD <- 201503
# antidep201503$Druggroup <- "Antidepressant"
# dementia201503 <- aggregate(dementia201503[-c(1:5, 11)], dementia201503["PRACTICE"], sum)
# dementia201503$PERIOD <- 201503
# dementia201503$Druggroup <- "Dementia"
# diabetes201503 <- aggregate(diabetes201503[-c(1:5, 11)], diabetes201503["PRACTICE"], sum)
# diabetes201503$PERIOD <- 201503
# diabetes201503$Druggroup <- "Diabetes"
# 
# bronchodilators201503 <- aggregate(bronchodilators201503[-c(1:5, 11)], bronchodilators201503["PRACTICE"], sum)
# bronchodilators201503$PERIOD <- 201503
# bronchodilators201503$Druggroup <- "Bronchodilators"
# opioddep201503 <- aggregate(opioddep201503[-c(1:5, 11)], opioddep201503["PRACTICE"], sum)
# opioddep201503$PERIOD <- 201503
# opioddep201503$Druggroup <- "Opiod"
# nicotinedep201503 <- aggregate(nicotinedep201503[-c(1:5, 11)], nicotinedep201503["PRACTICE"], sum)
# nicotinedep201503$PERIOD <- 201503
# nicotinedep201503$Druggroup <- "Nicotine"
# alcoholdep201503 <- aggregate(alcoholdep201503[-c(1:5, 11)], alcoholdep201503["PRACTICE"], sum)
# alcoholdep201503$PERIOD <- 201503
# alcoholdep201503$Druggroup <- "Alcohol"
# allsubstancedep201503 <- aggregate(allsubstancedep201503[-c(1:5, 11)], allsubstancedep201503["PRACTICE"], sum)
# allsubstancedep201503$PERIOD <- 201503
# allsubstancedep201503$Druggroup <- "SubstanceDep"
# obesedrugs201503 <- aggregate(obesedrugs201503[-c(1:5, 11)], obesedrugs201503["PRACTICE"], sum)
# obesedrugs201503$PERIOD <- 201503
# obesedrugs201503$Druggroup <- "Obesity"
# 
# prescribemaster201503 <- do.call("rbind", list(obesedrugs201503, allsubstancedep201503, alcoholdep201503, 
#                                                nicotinedep201503,opioddep201503, bronchodilators201503,
#                                                antidep201503, diabetes201503, dementia201503))
# 
# 
# write.csv(prescribemaster201503, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201503.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201502 <- read_csv("H:/prescription data/T201502PDPI BNFT.csv")
# prescribe201502$drugcode <- parse_number(prescribe201502$`BNF CODE`)
# prescribe201502$drugcode <- substr(prescribe201502$drugcode, 0, 6)
# antidep201502 <- prescribe201502[which(prescribe201502$drugcode>=403000&prescribe201502$drugcode<404000),]
# obesedrugs201502 <- prescribe201502[which(prescribe201502$drugcode>=405000&prescribe201502$drugcode<406000),]
# allsubstancedep201502 <- prescribe201502[which(prescribe201502$drugcode>=410000&prescribe201502$drugcode<411000),]
# alcoholdep201502 <- prescribe201502[which(prescribe201502$drugcode>=410010&prescribe201502$drugcode<410020),]
# nicotinedep201502 <- prescribe201502[which(prescribe201502$drugcode>=410020&prescribe201502$drugcode<410030),]
# opioddep201502 <- prescribe201502[which(prescribe201502$drugcode>=410030&prescribe201502$drugcode<411000),]
# bronchodilators201502 <- prescribe201502[which(prescribe201502$drugcode>=310000&prescribe201502$drugcode<320000),]
# dementia201502 <- prescribe201502[which(prescribe201502$drugcode>=411000&prescribe201502$drugcode<500000),]
# diabetes201502 <- prescribe201502[which(prescribe201502$drugcode>=601000&prescribe201502$drugcode<602000),]
# 
# antidep201502 <- aggregate(antidep201502[-c(1:5, 11)], antidep201502["PRACTICE"], sum)
# antidep201502$PERIOD <- 201502
# antidep201502$Druggroup <- "Antidepressant"
# dementia201502 <- aggregate(dementia201502[-c(1:5, 11)], dementia201502["PRACTICE"], sum)
# dementia201502$PERIOD <- 201502
# dementia201502$Druggroup <- "Dementia"
# diabetes201502 <- aggregate(diabetes201502[-c(1:5, 11)], diabetes201502["PRACTICE"], sum)
# diabetes201502$PERIOD <- 201502
# diabetes201502$Druggroup <- "Diabetes"
# 
# bronchodilators201502 <- aggregate(bronchodilators201502[-c(1:5, 11)], bronchodilators201502["PRACTICE"], sum)
# bronchodilators201502$PERIOD <- 201502
# bronchodilators201502$Druggroup <- "Bronchodilators"
# opioddep201502 <- aggregate(opioddep201502[-c(1:5, 11)], opioddep201502["PRACTICE"], sum)
# opioddep201502$PERIOD <- 201502
# opioddep201502$Druggroup <- "Opiod"
# nicotinedep201502 <- aggregate(nicotinedep201502[-c(1:5, 11)], nicotinedep201502["PRACTICE"], sum)
# nicotinedep201502$PERIOD <- 201502
# nicotinedep201502$Druggroup <- "Nicotine"
# alcoholdep201502 <- aggregate(alcoholdep201502[-c(1:5, 11)], alcoholdep201502["PRACTICE"], sum)
# alcoholdep201502$PERIOD <- 201502
# alcoholdep201502$Druggroup <- "Alcohol"
# allsubstancedep201502 <- aggregate(allsubstancedep201502[-c(1:5, 11)], allsubstancedep201502["PRACTICE"], sum)
# allsubstancedep201502$PERIOD <- 201502
# allsubstancedep201502$Druggroup <- "SubstanceDep"
# obesedrugs201502 <- aggregate(obesedrugs201502[-c(1:5, 11)], obesedrugs201502["PRACTICE"], sum)
# obesedrugs201502$PERIOD <- 201502
# obesedrugs201502$Druggroup <- "Obesity"
# 
# prescribemaster201502 <- do.call("rbind", list(obesedrugs201502, allsubstancedep201502, alcoholdep201502, 
#                                                nicotinedep201502,opioddep201502, bronchodilators201502,
#                                                antidep201502, diabetes201502, dementia201502))
# 
# 
# write.csv(prescribemaster201502, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201502.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201501 <- read_csv("H:/prescription data/T201501PDPI BNFT.csv")
# prescribe201501$drugcode <- parse_number(prescribe201501$`BNF CODE`)
# prescribe201501$drugcode <- substr(prescribe201501$drugcode, 0, 6)
# antidep201501 <- prescribe201501[which(prescribe201501$drugcode>=403000&prescribe201501$drugcode<404000),]
# obesedrugs201501 <- prescribe201501[which(prescribe201501$drugcode>=405000&prescribe201501$drugcode<406000),]
# allsubstancedep201501 <- prescribe201501[which(prescribe201501$drugcode>=410000&prescribe201501$drugcode<411000),]
# alcoholdep201501 <- prescribe201501[which(prescribe201501$drugcode>=410010&prescribe201501$drugcode<410020),]
# nicotinedep201501 <- prescribe201501[which(prescribe201501$drugcode>=410020&prescribe201501$drugcode<410030),]
# opioddep201501 <- prescribe201501[which(prescribe201501$drugcode>=410030&prescribe201501$drugcode<411000),]
# bronchodilators201501 <- prescribe201501[which(prescribe201501$drugcode>=310000&prescribe201501$drugcode<320000),]
# dementia201501 <- prescribe201501[which(prescribe201501$drugcode>=411000&prescribe201501$drugcode<500000),]
# diabetes201501 <- prescribe201501[which(prescribe201501$drugcode>=601000&prescribe201501$drugcode<602000),]
# 
# antidep201501 <- aggregate(antidep201501[-c(1:5, 11)], antidep201501["PRACTICE"], sum)
# antidep201501$PERIOD <- 201501
# antidep201501$Druggroup <- "Antidepressant"
# dementia201501 <- aggregate(dementia201501[-c(1:5, 11)], dementia201501["PRACTICE"], sum)
# dementia201501$PERIOD <- 201501
# dementia201501$Druggroup <- "Dementia"
# diabetes201501 <- aggregate(diabetes201501[-c(1:5, 11)], diabetes201501["PRACTICE"], sum)
# diabetes201501$PERIOD <- 201501
# diabetes201501$Druggroup <- "Diabetes"
# 
# bronchodilators201501 <- aggregate(bronchodilators201501[-c(1:5, 11)], bronchodilators201501["PRACTICE"], sum)
# bronchodilators201501$PERIOD <- 201501
# bronchodilators201501$Druggroup <- "Bronchodilators"
# opioddep201501 <- aggregate(opioddep201501[-c(1:5, 11)], opioddep201501["PRACTICE"], sum)
# opioddep201501$PERIOD <- 201501
# opioddep201501$Druggroup <- "Opiod"
# nicotinedep201501 <- aggregate(nicotinedep201501[-c(1:5, 11)], nicotinedep201501["PRACTICE"], sum)
# nicotinedep201501$PERIOD <- 201501
# nicotinedep201501$Druggroup <- "Nicotine"
# alcoholdep201501 <- aggregate(alcoholdep201501[-c(1:5, 11)], alcoholdep201501["PRACTICE"], sum)
# alcoholdep201501$PERIOD <- 201501
# alcoholdep201501$Druggroup <- "Alcohol"
# allsubstancedep201501 <- aggregate(allsubstancedep201501[-c(1:5, 11)], allsubstancedep201501["PRACTICE"], sum)
# allsubstancedep201501$PERIOD <- 201501
# allsubstancedep201501$Druggroup <- "SubstanceDep"
# obesedrugs201501 <- aggregate(obesedrugs201501[-c(1:5, 11)], obesedrugs201501["PRACTICE"], sum)
# obesedrugs201501$PERIOD <- 201501
# obesedrugs201501$Druggroup <- "Obesity"
# 
# prescribemaster201501 <- do.call("rbind", list(obesedrugs201501, allsubstancedep201501, alcoholdep201501, 
#                                                nicotinedep201501,opioddep201501, bronchodilators201501,
#                                                antidep201501, diabetes201501, dementia201501))
# 
# 
# write.csv(prescribemaster201501, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201501.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201412 <- read_csv("H:/prescription data/T201412PDPI BNFT.csv")
# prescribe201412$drugcode <- parse_number(prescribe201412$`BNF CODE`)
# prescribe201412$drugcode <- substr(prescribe201412$drugcode, 0, 6)
# antidep201412 <- prescribe201412[which(prescribe201412$drugcode>=403000&prescribe201412$drugcode<404000),]
# obesedrugs201412 <- prescribe201412[which(prescribe201412$drugcode>=405000&prescribe201412$drugcode<406000),]
# allsubstancedep201412 <- prescribe201412[which(prescribe201412$drugcode>=410000&prescribe201412$drugcode<411000),]
# alcoholdep201412 <- prescribe201412[which(prescribe201412$drugcode>=410010&prescribe201412$drugcode<410020),]
# nicotinedep201412 <- prescribe201412[which(prescribe201412$drugcode>=410020&prescribe201412$drugcode<410030),]
# opioddep201412 <- prescribe201412[which(prescribe201412$drugcode>=410030&prescribe201412$drugcode<411000),]
# bronchodilators201412 <- prescribe201412[which(prescribe201412$drugcode>=310000&prescribe201412$drugcode<320000),]
# dementia201412 <- prescribe201412[which(prescribe201412$drugcode>=411000&prescribe201412$drugcode<500000),]
# diabetes201412 <- prescribe201412[which(prescribe201412$drugcode>=601000&prescribe201412$drugcode<602000),]
# 
# antidep201412 <- aggregate(antidep201412[-c(1:5, 11)], antidep201412["PRACTICE"], sum)
# antidep201412$PERIOD <- 201412
# antidep201412$Druggroup <- "Antidepressant"
# dementia201412 <- aggregate(dementia201412[-c(1:5, 11)], dementia201412["PRACTICE"], sum)
# dementia201412$PERIOD <- 201412
# dementia201412$Druggroup <- "Dementia"
# diabetes201412 <- aggregate(diabetes201412[-c(1:5, 11)], diabetes201412["PRACTICE"], sum)
# diabetes201412$PERIOD <- 201412
# diabetes201412$Druggroup <- "Diabetes"
# 
# bronchodilators201412 <- aggregate(bronchodilators201412[-c(1:5, 11)], bronchodilators201412["PRACTICE"], sum)
# bronchodilators201412$PERIOD <- 201412
# bronchodilators201412$Druggroup <- "Bronchodilators"
# opioddep201412 <- aggregate(opioddep201412[-c(1:5, 11)], opioddep201412["PRACTICE"], sum)
# opioddep201412$PERIOD <- 201412
# opioddep201412$Druggroup <- "Opiod"
# nicotinedep201412 <- aggregate(nicotinedep201412[-c(1:5, 11)], nicotinedep201412["PRACTICE"], sum)
# nicotinedep201412$PERIOD <- 201412
# nicotinedep201412$Druggroup <- "Nicotine"
# alcoholdep201412 <- aggregate(alcoholdep201412[-c(1:5, 11)], alcoholdep201412["PRACTICE"], sum)
# alcoholdep201412$PERIOD <- 201412
# alcoholdep201412$Druggroup <- "Alcohol"
# allsubstancedep201412 <- aggregate(allsubstancedep201412[-c(1:5, 11)], allsubstancedep201412["PRACTICE"], sum)
# allsubstancedep201412$PERIOD <- 201412
# allsubstancedep201412$Druggroup <- "SubstanceDep"
# obesedrugs201412 <- aggregate(obesedrugs201412[-c(1:5, 11)], obesedrugs201412["PRACTICE"], sum)
# obesedrugs201412$PERIOD <- 201412
# obesedrugs201412$Druggroup <- "Obesity"
# 
# prescribemaster201412 <- do.call("rbind", list(obesedrugs201412, allsubstancedep201412, alcoholdep201412, 
#                                                nicotinedep201412,opioddep201412, bronchodilators201412,
#                                                antidep201412, diabetes201412, dementia201412))
# 
# 
# write.csv(prescribemaster201412, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201412.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201411 <- read_csv("H:/prescription data/T201411PDPI BNFT.csv")
# prescribe201411$drugcode <- parse_number(prescribe201411$`BNF CODE`)
# prescribe201411$drugcode <- substr(prescribe201411$drugcode, 0, 6)
# antidep201411 <- prescribe201411[which(prescribe201411$drugcode>=403000&prescribe201411$drugcode<404000),]
# obesedrugs201411 <- prescribe201411[which(prescribe201411$drugcode>=405000&prescribe201411$drugcode<406000),]
# allsubstancedep201411 <- prescribe201411[which(prescribe201411$drugcode>=410000&prescribe201411$drugcode<411000),]
# alcoholdep201411 <- prescribe201411[which(prescribe201411$drugcode>=410010&prescribe201411$drugcode<410020),]
# nicotinedep201411 <- prescribe201411[which(prescribe201411$drugcode>=410020&prescribe201411$drugcode<410030),]
# opioddep201411 <- prescribe201411[which(prescribe201411$drugcode>=410030&prescribe201411$drugcode<411000),]
# bronchodilators201411 <- prescribe201411[which(prescribe201411$drugcode>=310000&prescribe201411$drugcode<320000),]
# dementia201411 <- prescribe201411[which(prescribe201411$drugcode>=411000&prescribe201411$drugcode<500000),]
# diabetes201411 <- prescribe201411[which(prescribe201411$drugcode>=601000&prescribe201411$drugcode<602000),]
# 
# antidep201411 <- aggregate(antidep201411[-c(1:5, 11)], antidep201411["PRACTICE"], sum)
# antidep201411$PERIOD <- 201411
# antidep201411$Druggroup <- "Antidepressant"
# dementia201411 <- aggregate(dementia201411[-c(1:5, 11)], dementia201411["PRACTICE"], sum)
# dementia201411$PERIOD <- 201411
# dementia201411$Druggroup <- "Dementia"
# diabetes201411 <- aggregate(diabetes201411[-c(1:5, 11)], diabetes201411["PRACTICE"], sum)
# diabetes201411$PERIOD <- 201411
# diabetes201411$Druggroup <- "Diabetes"
# 
# bronchodilators201411 <- aggregate(bronchodilators201411[-c(1:5, 11)], bronchodilators201411["PRACTICE"], sum)
# bronchodilators201411$PERIOD <- 201411
# bronchodilators201411$Druggroup <- "Bronchodilators"
# opioddep201411 <- aggregate(opioddep201411[-c(1:5, 11)], opioddep201411["PRACTICE"], sum)
# opioddep201411$PERIOD <- 201411
# opioddep201411$Druggroup <- "Opiod"
# nicotinedep201411 <- aggregate(nicotinedep201411[-c(1:5, 11)], nicotinedep201411["PRACTICE"], sum)
# nicotinedep201411$PERIOD <- 201411
# nicotinedep201411$Druggroup <- "Nicotine"
# alcoholdep201411 <- aggregate(alcoholdep201411[-c(1:5, 11)], alcoholdep201411["PRACTICE"], sum)
# alcoholdep201411$PERIOD <- 201411
# alcoholdep201411$Druggroup <- "Alcohol"
# allsubstancedep201411 <- aggregate(allsubstancedep201411[-c(1:5, 11)], allsubstancedep201411["PRACTICE"], sum)
# allsubstancedep201411$PERIOD <- 201411
# allsubstancedep201411$Druggroup <- "SubstanceDep"
# obesedrugs201411 <- aggregate(obesedrugs201411[-c(1:5, 11)], obesedrugs201411["PRACTICE"], sum)
# obesedrugs201411$PERIOD <- 201411
# obesedrugs201411$Druggroup <- "Obesity"
# 
# prescribemaster201411 <- do.call("rbind", list(obesedrugs201411, allsubstancedep201411, alcoholdep201411, 
#                                                nicotinedep201411,opioddep201411, bronchodilators201411,
#                                                antidep201411, diabetes201411, dementia201411))
# 
# 
# write.csv(prescribemaster201411, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201411.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201410 <- read_csv("H:/prescription data/T201410PDPI BNFT.csv")
# prescribe201410$drugcode <- parse_number(prescribe201410$`BNF CODE`)
# prescribe201410$drugcode <- substr(prescribe201410$drugcode, 0, 6)
# antidep201410 <- prescribe201410[which(prescribe201410$drugcode>=403000&prescribe201410$drugcode<404000),]
# obesedrugs201410 <- prescribe201410[which(prescribe201410$drugcode>=405000&prescribe201410$drugcode<406000),]
# allsubstancedep201410 <- prescribe201410[which(prescribe201410$drugcode>=410000&prescribe201410$drugcode<411000),]
# alcoholdep201410 <- prescribe201410[which(prescribe201410$drugcode>=410010&prescribe201410$drugcode<410020),]
# nicotinedep201410 <- prescribe201410[which(prescribe201410$drugcode>=410020&prescribe201410$drugcode<410030),]
# opioddep201410 <- prescribe201410[which(prescribe201410$drugcode>=410030&prescribe201410$drugcode<411000),]
# bronchodilators201410 <- prescribe201410[which(prescribe201410$drugcode>=310000&prescribe201410$drugcode<320000),]
# dementia201410 <- prescribe201410[which(prescribe201410$drugcode>=411000&prescribe201410$drugcode<500000),]
# diabetes201410 <- prescribe201410[which(prescribe201410$drugcode>=601000&prescribe201410$drugcode<602000),]
# 
# antidep201410 <- aggregate(antidep201410[-c(1:5, 11)], antidep201410["PRACTICE"], sum)
# antidep201410$PERIOD <- 201410
# antidep201410$Druggroup <- "Antidepressant"
# dementia201410 <- aggregate(dementia201410[-c(1:5, 11)], dementia201410["PRACTICE"], sum)
# dementia201410$PERIOD <- 201410
# dementia201410$Druggroup <- "Dementia"
# diabetes201410 <- aggregate(diabetes201410[-c(1:5, 11)], diabetes201410["PRACTICE"], sum)
# diabetes201410$PERIOD <- 201410
# diabetes201410$Druggroup <- "Diabetes"
# 
# bronchodilators201410 <- aggregate(bronchodilators201410[-c(1:5, 11)], bronchodilators201410["PRACTICE"], sum)
# bronchodilators201410$PERIOD <- 201410
# bronchodilators201410$Druggroup <- "Bronchodilators"
# opioddep201410 <- aggregate(opioddep201410[-c(1:5, 11)], opioddep201410["PRACTICE"], sum)
# opioddep201410$PERIOD <- 201410
# opioddep201410$Druggroup <- "Opiod"
# nicotinedep201410 <- aggregate(nicotinedep201410[-c(1:5, 11)], nicotinedep201410["PRACTICE"], sum)
# nicotinedep201410$PERIOD <- 201410
# nicotinedep201410$Druggroup <- "Nicotine"
# alcoholdep201410 <- aggregate(alcoholdep201410[-c(1:5, 11)], alcoholdep201410["PRACTICE"], sum)
# alcoholdep201410$PERIOD <- 201410
# alcoholdep201410$Druggroup <- "Alcohol"
# allsubstancedep201410 <- aggregate(allsubstancedep201410[-c(1:5, 11)], allsubstancedep201410["PRACTICE"], sum)
# allsubstancedep201410$PERIOD <- 201410
# allsubstancedep201410$Druggroup <- "SubstanceDep"
# obesedrugs201410 <- aggregate(obesedrugs201410[-c(1:5, 11)], obesedrugs201410["PRACTICE"], sum)
# obesedrugs201410$PERIOD <- 201410
# obesedrugs201410$Druggroup <- "Obesity"
# 
# prescribemaster201410 <- do.call("rbind", list(obesedrugs201410, allsubstancedep201410, alcoholdep201410, 
#                                                nicotinedep201410,opioddep201410, bronchodilators201410,
#                                                antidep201410, diabetes201410, dementia201410))
# 
# 
# write.csv(prescribemaster201410, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201410.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201409 <- read_csv("H:/prescription data/T201409PDPI BNFT.csv")
# prescribe201409$drugcode <- parse_number(prescribe201409$`BNF CODE`)
# prescribe201409$drugcode <- substr(prescribe201409$drugcode, 0, 6)
# antidep201409 <- prescribe201409[which(prescribe201409$drugcode>=403000&prescribe201409$drugcode<404000),]
# obesedrugs201409 <- prescribe201409[which(prescribe201409$drugcode>=405000&prescribe201409$drugcode<406000),]
# allsubstancedep201409 <- prescribe201409[which(prescribe201409$drugcode>=410000&prescribe201409$drugcode<411000),]
# alcoholdep201409 <- prescribe201409[which(prescribe201409$drugcode>=410010&prescribe201409$drugcode<410020),]
# nicotinedep201409 <- prescribe201409[which(prescribe201409$drugcode>=410020&prescribe201409$drugcode<410030),]
# opioddep201409 <- prescribe201409[which(prescribe201409$drugcode>=410030&prescribe201409$drugcode<411000),]
# bronchodilators201409 <- prescribe201409[which(prescribe201409$drugcode>=310000&prescribe201409$drugcode<320000),]
# dementia201409 <- prescribe201409[which(prescribe201409$drugcode>=411000&prescribe201409$drugcode<500000),]
# diabetes201409 <- prescribe201409[which(prescribe201409$drugcode>=601000&prescribe201409$drugcode<602000),]
# 
# antidep201409 <- aggregate(antidep201409[-c(1:5, 11)], antidep201409["PRACTICE"], sum)
# antidep201409$PERIOD <- 201409
# antidep201409$Druggroup <- "Antidepressant"
# dementia201409 <- aggregate(dementia201409[-c(1:5, 11)], dementia201409["PRACTICE"], sum)
# dementia201409$PERIOD <- 201409
# dementia201409$Druggroup <- "Dementia"
# diabetes201409 <- aggregate(diabetes201409[-c(1:5, 11)], diabetes201409["PRACTICE"], sum)
# diabetes201409$PERIOD <- 201409
# diabetes201409$Druggroup <- "Diabetes"
# 
# bronchodilators201409 <- aggregate(bronchodilators201409[-c(1:5, 11)], bronchodilators201409["PRACTICE"], sum)
# bronchodilators201409$PERIOD <- 201409
# bronchodilators201409$Druggroup <- "Bronchodilators"
# opioddep201409 <- aggregate(opioddep201409[-c(1:5, 11)], opioddep201409["PRACTICE"], sum)
# opioddep201409$PERIOD <- 201409
# opioddep201409$Druggroup <- "Opiod"
# nicotinedep201409 <- aggregate(nicotinedep201409[-c(1:5, 11)], nicotinedep201409["PRACTICE"], sum)
# nicotinedep201409$PERIOD <- 201409
# nicotinedep201409$Druggroup <- "Nicotine"
# alcoholdep201409 <- aggregate(alcoholdep201409[-c(1:5, 11)], alcoholdep201409["PRACTICE"], sum)
# alcoholdep201409$PERIOD <- 201409
# alcoholdep201409$Druggroup <- "Alcohol"
# allsubstancedep201409 <- aggregate(allsubstancedep201409[-c(1:5, 11)], allsubstancedep201409["PRACTICE"], sum)
# allsubstancedep201409$PERIOD <- 201409
# allsubstancedep201409$Druggroup <- "SubstanceDep"
# obesedrugs201409 <- aggregate(obesedrugs201409[-c(1:5, 11)], obesedrugs201409["PRACTICE"], sum)
# obesedrugs201409$PERIOD <- 201409
# obesedrugs201409$Druggroup <- "Obesity"
# 
# prescribemaster201409 <- do.call("rbind", list(obesedrugs201409, allsubstancedep201409, alcoholdep201409, 
#                                                nicotinedep201409,opioddep201409, bronchodilators201409,
#                                                antidep201409, diabetes201409, dementia201409))
# 
# 
# write.csv(prescribemaster201409, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201409.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201408 <- read_csv("H:/prescription data/T201408PDPI BNFT.csv")
# prescribe201408$drugcode <- parse_number(prescribe201408$`BNF CODE`)
# prescribe201408$drugcode <- substr(prescribe201408$drugcode, 0, 6)
# antidep201408 <- prescribe201408[which(prescribe201408$drugcode>=403000&prescribe201408$drugcode<404000),]
# obesedrugs201408 <- prescribe201408[which(prescribe201408$drugcode>=405000&prescribe201408$drugcode<406000),]
# allsubstancedep201408 <- prescribe201408[which(prescribe201408$drugcode>=410000&prescribe201408$drugcode<411000),]
# alcoholdep201408 <- prescribe201408[which(prescribe201408$drugcode>=410010&prescribe201408$drugcode<410020),]
# nicotinedep201408 <- prescribe201408[which(prescribe201408$drugcode>=410020&prescribe201408$drugcode<410030),]
# opioddep201408 <- prescribe201408[which(prescribe201408$drugcode>=410030&prescribe201408$drugcode<411000),]
# bronchodilators201408 <- prescribe201408[which(prescribe201408$drugcode>=310000&prescribe201408$drugcode<320000),]
# dementia201408 <- prescribe201408[which(prescribe201408$drugcode>=411000&prescribe201408$drugcode<500000),]
# diabetes201408 <- prescribe201408[which(prescribe201408$drugcode>=601000&prescribe201408$drugcode<602000),]
# 
# antidep201408 <- aggregate(antidep201408[-c(1:5, 11)], antidep201408["PRACTICE"], sum)
# antidep201408$PERIOD <- 201408
# antidep201408$Druggroup <- "Antidepressant"
# dementia201408 <- aggregate(dementia201408[-c(1:5, 11)], dementia201408["PRACTICE"], sum)
# dementia201408$PERIOD <- 201408
# dementia201408$Druggroup <- "Dementia"
# diabetes201408 <- aggregate(diabetes201408[-c(1:5, 11)], diabetes201408["PRACTICE"], sum)
# diabetes201408$PERIOD <- 201408
# diabetes201408$Druggroup <- "Diabetes"
# 
# bronchodilators201408 <- aggregate(bronchodilators201408[-c(1:5, 11)], bronchodilators201408["PRACTICE"], sum)
# bronchodilators201408$PERIOD <- 201408
# bronchodilators201408$Druggroup <- "Bronchodilators"
# opioddep201408 <- aggregate(opioddep201408[-c(1:5, 11)], opioddep201408["PRACTICE"], sum)
# opioddep201408$PERIOD <- 201408
# opioddep201408$Druggroup <- "Opiod"
# nicotinedep201408 <- aggregate(nicotinedep201408[-c(1:5, 11)], nicotinedep201408["PRACTICE"], sum)
# nicotinedep201408$PERIOD <- 201408
# nicotinedep201408$Druggroup <- "Nicotine"
# alcoholdep201408 <- aggregate(alcoholdep201408[-c(1:5, 11)], alcoholdep201408["PRACTICE"], sum)
# alcoholdep201408$PERIOD <- 201408
# alcoholdep201408$Druggroup <- "Alcohol"
# allsubstancedep201408 <- aggregate(allsubstancedep201408[-c(1:5, 11)], allsubstancedep201408["PRACTICE"], sum)
# allsubstancedep201408$PERIOD <- 201408
# allsubstancedep201408$Druggroup <- "SubstanceDep"
# obesedrugs201408 <- aggregate(obesedrugs201408[-c(1:5, 11)], obesedrugs201408["PRACTICE"], sum)
# obesedrugs201408$PERIOD <- 201408
# obesedrugs201408$Druggroup <- "Obesity"
# 
# prescribemaster201408 <- do.call("rbind", list(obesedrugs201408, allsubstancedep201408, alcoholdep201408, 
#                                                nicotinedep201408,opioddep201408, bronchodilators201408,
#                                                antidep201408, diabetes201408, dementia201408))
# 
# 
# write.csv(prescribemaster201408, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201408.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201407 <- read_csv("H:/prescription data/T201407PDPI BNFT.csv")
# prescribe201407$drugcode <- parse_number(prescribe201407$`BNF CODE`)
# prescribe201407$drugcode <- substr(prescribe201407$drugcode, 0, 6)
# antidep201407 <- prescribe201407[which(prescribe201407$drugcode>=403000&prescribe201407$drugcode<404000),]
# obesedrugs201407 <- prescribe201407[which(prescribe201407$drugcode>=405000&prescribe201407$drugcode<406000),]
# allsubstancedep201407 <- prescribe201407[which(prescribe201407$drugcode>=410000&prescribe201407$drugcode<411000),]
# alcoholdep201407 <- prescribe201407[which(prescribe201407$drugcode>=410010&prescribe201407$drugcode<410020),]
# nicotinedep201407 <- prescribe201407[which(prescribe201407$drugcode>=410020&prescribe201407$drugcode<410030),]
# opioddep201407 <- prescribe201407[which(prescribe201407$drugcode>=410030&prescribe201407$drugcode<411000),]
# bronchodilators201407 <- prescribe201407[which(prescribe201407$drugcode>=310000&prescribe201407$drugcode<320000),]
# dementia201407 <- prescribe201407[which(prescribe201407$drugcode>=411000&prescribe201407$drugcode<500000),]
# diabetes201407 <- prescribe201407[which(prescribe201407$drugcode>=601000&prescribe201407$drugcode<602000),]
# 
# antidep201407 <- aggregate(antidep201407[-c(1:5, 11)], antidep201407["PRACTICE"], sum)
# antidep201407$PERIOD <- 201407
# antidep201407$Druggroup <- "Antidepressant"
# dementia201407 <- aggregate(dementia201407[-c(1:5, 11)], dementia201407["PRACTICE"], sum)
# dementia201407$PERIOD <- 201407
# dementia201407$Druggroup <- "Dementia"
# diabetes201407 <- aggregate(diabetes201407[-c(1:5, 11)], diabetes201407["PRACTICE"], sum)
# diabetes201407$PERIOD <- 201407
# diabetes201407$Druggroup <- "Diabetes"
# 
# bronchodilators201407 <- aggregate(bronchodilators201407[-c(1:5, 11)], bronchodilators201407["PRACTICE"], sum)
# bronchodilators201407$PERIOD <- 201407
# bronchodilators201407$Druggroup <- "Bronchodilators"
# opioddep201407 <- aggregate(opioddep201407[-c(1:5, 11)], opioddep201407["PRACTICE"], sum)
# opioddep201407$PERIOD <- 201407
# opioddep201407$Druggroup <- "Opiod"
# nicotinedep201407 <- aggregate(nicotinedep201407[-c(1:5, 11)], nicotinedep201407["PRACTICE"], sum)
# nicotinedep201407$PERIOD <- 201407
# nicotinedep201407$Druggroup <- "Nicotine"
# alcoholdep201407 <- aggregate(alcoholdep201407[-c(1:5, 11)], alcoholdep201407["PRACTICE"], sum)
# alcoholdep201407$PERIOD <- 201407
# alcoholdep201407$Druggroup <- "Alcohol"
# allsubstancedep201407 <- aggregate(allsubstancedep201407[-c(1:5, 11)], allsubstancedep201407["PRACTICE"], sum)
# allsubstancedep201407$PERIOD <- 201407
# allsubstancedep201407$Druggroup <- "SubstanceDep"
# obesedrugs201407 <- aggregate(obesedrugs201407[-c(1:5, 11)], obesedrugs201407["PRACTICE"], sum)
# obesedrugs201407$PERIOD <- 201407
# obesedrugs201407$Druggroup <- "Obesity"
# 
# prescribemaster201407 <- do.call("rbind", list(obesedrugs201407, allsubstancedep201407, alcoholdep201407, 
#                                                nicotinedep201407,opioddep201407, bronchodilators201407,
#                                                antidep201407, diabetes201407, dementia201407))
# 
# 
# write.csv(prescribemaster201407, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201407.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201406 <- read_csv("H:/prescription data/T201406PDPI BNFT.csv")
# prescribe201406$drugcode <- parse_number(prescribe201406$`BNF CODE`)
# prescribe201406$drugcode <- substr(prescribe201406$drugcode, 0, 6)
# antidep201406 <- prescribe201406[which(prescribe201406$drugcode>=403000&prescribe201406$drugcode<404000),]
# obesedrugs201406 <- prescribe201406[which(prescribe201406$drugcode>=405000&prescribe201406$drugcode<406000),]
# allsubstancedep201406 <- prescribe201406[which(prescribe201406$drugcode>=410000&prescribe201406$drugcode<411000),]
# alcoholdep201406 <- prescribe201406[which(prescribe201406$drugcode>=410010&prescribe201406$drugcode<410020),]
# nicotinedep201406 <- prescribe201406[which(prescribe201406$drugcode>=410020&prescribe201406$drugcode<410030),]
# opioddep201406 <- prescribe201406[which(prescribe201406$drugcode>=410030&prescribe201406$drugcode<411000),]
# bronchodilators201406 <- prescribe201406[which(prescribe201406$drugcode>=310000&prescribe201406$drugcode<320000),]
# dementia201406 <- prescribe201406[which(prescribe201406$drugcode>=411000&prescribe201406$drugcode<500000),]
# diabetes201406 <- prescribe201406[which(prescribe201406$drugcode>=601000&prescribe201406$drugcode<602000),]
# 
# antidep201406 <- aggregate(antidep201406[-c(1:5, 11)], antidep201406["PRACTICE"], sum)
# antidep201406$PERIOD <- 201406
# antidep201406$Druggroup <- "Antidepressant"
# dementia201406 <- aggregate(dementia201406[-c(1:5, 11)], dementia201406["PRACTICE"], sum)
# dementia201406$PERIOD <- 201406
# dementia201406$Druggroup <- "Dementia"
# diabetes201406 <- aggregate(diabetes201406[-c(1:5, 11)], diabetes201406["PRACTICE"], sum)
# diabetes201406$PERIOD <- 201406
# diabetes201406$Druggroup <- "Diabetes"
# 
# bronchodilators201406 <- aggregate(bronchodilators201406[-c(1:5, 11)], bronchodilators201406["PRACTICE"], sum)
# bronchodilators201406$PERIOD <- 201406
# bronchodilators201406$Druggroup <- "Bronchodilators"
# opioddep201406 <- aggregate(opioddep201406[-c(1:5, 11)], opioddep201406["PRACTICE"], sum)
# opioddep201406$PERIOD <- 201406
# opioddep201406$Druggroup <- "Opiod"
# nicotinedep201406 <- aggregate(nicotinedep201406[-c(1:5, 11)], nicotinedep201406["PRACTICE"], sum)
# nicotinedep201406$PERIOD <- 201406
# nicotinedep201406$Druggroup <- "Nicotine"
# alcoholdep201406 <- aggregate(alcoholdep201406[-c(1:5, 11)], alcoholdep201406["PRACTICE"], sum)
# alcoholdep201406$PERIOD <- 201406
# alcoholdep201406$Druggroup <- "Alcohol"
# allsubstancedep201406 <- aggregate(allsubstancedep201406[-c(1:5, 11)], allsubstancedep201406["PRACTICE"], sum)
# allsubstancedep201406$PERIOD <- 201406
# allsubstancedep201406$Druggroup <- "SubstanceDep"
# obesedrugs201406 <- aggregate(obesedrugs201406[-c(1:5, 11)], obesedrugs201406["PRACTICE"], sum)
# obesedrugs201406$PERIOD <- 201406
# obesedrugs201406$Druggroup <- "Obesity"
# 
# prescribemaster201406 <- do.call("rbind", list(obesedrugs201406, allsubstancedep201406, alcoholdep201406, 
#                                                nicotinedep201406,opioddep201406, bronchodilators201406,
#                                                antidep201406, diabetes201406, dementia201406))
# 
# 
# write.csv(prescribemaster201406, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201406.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201405 <- read_csv("H:/prescription data/T201405PDPI BNFT.csv")
# prescribe201405$drugcode <- parse_number(prescribe201405$`BNF CODE`)
# prescribe201405$drugcode <- substr(prescribe201405$drugcode, 0, 6)
# antidep201405 <- prescribe201405[which(prescribe201405$drugcode>=403000&prescribe201405$drugcode<404000),]
# obesedrugs201405 <- prescribe201405[which(prescribe201405$drugcode>=405000&prescribe201405$drugcode<406000),]
# allsubstancedep201405 <- prescribe201405[which(prescribe201405$drugcode>=410000&prescribe201405$drugcode<411000),]
# alcoholdep201405 <- prescribe201405[which(prescribe201405$drugcode>=410010&prescribe201405$drugcode<410020),]
# nicotinedep201405 <- prescribe201405[which(prescribe201405$drugcode>=410020&prescribe201405$drugcode<410030),]
# opioddep201405 <- prescribe201405[which(prescribe201405$drugcode>=410030&prescribe201405$drugcode<411000),]
# bronchodilators201405 <- prescribe201405[which(prescribe201405$drugcode>=310000&prescribe201405$drugcode<320000),]
# dementia201405 <- prescribe201405[which(prescribe201405$drugcode>=411000&prescribe201405$drugcode<500000),]
# diabetes201405 <- prescribe201405[which(prescribe201405$drugcode>=601000&prescribe201405$drugcode<602000),]
# 
# antidep201405 <- aggregate(antidep201405[-c(1:5, 11)], antidep201405["PRACTICE"], sum)
# antidep201405$PERIOD <- 201405
# antidep201405$Druggroup <- "Antidepressant"
# dementia201405 <- aggregate(dementia201405[-c(1:5, 11)], dementia201405["PRACTICE"], sum)
# dementia201405$PERIOD <- 201405
# dementia201405$Druggroup <- "Dementia"
# diabetes201405 <- aggregate(diabetes201405[-c(1:5, 11)], diabetes201405["PRACTICE"], sum)
# diabetes201405$PERIOD <- 201405
# diabetes201405$Druggroup <- "Diabetes"
# 
# bronchodilators201405 <- aggregate(bronchodilators201405[-c(1:5, 11)], bronchodilators201405["PRACTICE"], sum)
# bronchodilators201405$PERIOD <- 201405
# bronchodilators201405$Druggroup <- "Bronchodilators"
# opioddep201405 <- aggregate(opioddep201405[-c(1:5, 11)], opioddep201405["PRACTICE"], sum)
# opioddep201405$PERIOD <- 201405
# opioddep201405$Druggroup <- "Opiod"
# nicotinedep201405 <- aggregate(nicotinedep201405[-c(1:5, 11)], nicotinedep201405["PRACTICE"], sum)
# nicotinedep201405$PERIOD <- 201405
# nicotinedep201405$Druggroup <- "Nicotine"
# alcoholdep201405 <- aggregate(alcoholdep201405[-c(1:5, 11)], alcoholdep201405["PRACTICE"], sum)
# alcoholdep201405$PERIOD <- 201405
# alcoholdep201405$Druggroup <- "Alcohol"
# allsubstancedep201405 <- aggregate(allsubstancedep201405[-c(1:5, 11)], allsubstancedep201405["PRACTICE"], sum)
# allsubstancedep201405$PERIOD <- 201405
# allsubstancedep201405$Druggroup <- "SubstanceDep"
# obesedrugs201405 <- aggregate(obesedrugs201405[-c(1:5, 11)], obesedrugs201405["PRACTICE"], sum)
# obesedrugs201405$PERIOD <- 201405
# obesedrugs201405$Druggroup <- "Obesity"
# 
# prescribemaster201405 <- do.call("rbind", list(obesedrugs201405, allsubstancedep201405, alcoholdep201405, 
#                                                nicotinedep201405,opioddep201405, bronchodilators201405,
#                                                antidep201405, diabetes201405, dementia201405))
# 
# 
# write.csv(prescribemaster201405, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201405.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201404 <- read_csv("H:/prescription data/T201404PDPI BNFT.csv")
# prescribe201404$drugcode <- parse_number(prescribe201404$`BNF CODE`)
# prescribe201404$drugcode <- substr(prescribe201404$drugcode, 0, 6)
# antidep201404 <- prescribe201404[which(prescribe201404$drugcode>=403000&prescribe201404$drugcode<404000),]
# obesedrugs201404 <- prescribe201404[which(prescribe201404$drugcode>=405000&prescribe201404$drugcode<406000),]
# allsubstancedep201404 <- prescribe201404[which(prescribe201404$drugcode>=410000&prescribe201404$drugcode<411000),]
# alcoholdep201404 <- prescribe201404[which(prescribe201404$drugcode>=410010&prescribe201404$drugcode<410020),]
# nicotinedep201404 <- prescribe201404[which(prescribe201404$drugcode>=410020&prescribe201404$drugcode<410030),]
# opioddep201404 <- prescribe201404[which(prescribe201404$drugcode>=410030&prescribe201404$drugcode<411000),]
# bronchodilators201404 <- prescribe201404[which(prescribe201404$drugcode>=310000&prescribe201404$drugcode<320000),]
# dementia201404 <- prescribe201404[which(prescribe201404$drugcode>=411000&prescribe201404$drugcode<500000),]
# diabetes201404 <- prescribe201404[which(prescribe201404$drugcode>=601000&prescribe201404$drugcode<602000),]
# 
# antidep201404 <- aggregate(antidep201404[-c(1:5, 11)], antidep201404["PRACTICE"], sum)
# antidep201404$PERIOD <- 201404
# antidep201404$Druggroup <- "Antidepressant"
# dementia201404 <- aggregate(dementia201404[-c(1:5, 11)], dementia201404["PRACTICE"], sum)
# dementia201404$PERIOD <- 201404
# dementia201404$Druggroup <- "Dementia"
# diabetes201404 <- aggregate(diabetes201404[-c(1:5, 11)], diabetes201404["PRACTICE"], sum)
# diabetes201404$PERIOD <- 201404
# diabetes201404$Druggroup <- "Diabetes"
# 
# bronchodilators201404 <- aggregate(bronchodilators201404[-c(1:5, 11)], bronchodilators201404["PRACTICE"], sum)
# bronchodilators201404$PERIOD <- 201404
# bronchodilators201404$Druggroup <- "Bronchodilators"
# opioddep201404 <- aggregate(opioddep201404[-c(1:5, 11)], opioddep201404["PRACTICE"], sum)
# opioddep201404$PERIOD <- 201404
# opioddep201404$Druggroup <- "Opiod"
# nicotinedep201404 <- aggregate(nicotinedep201404[-c(1:5, 11)], nicotinedep201404["PRACTICE"], sum)
# nicotinedep201404$PERIOD <- 201404
# nicotinedep201404$Druggroup <- "Nicotine"
# alcoholdep201404 <- aggregate(alcoholdep201404[-c(1:5, 11)], alcoholdep201404["PRACTICE"], sum)
# alcoholdep201404$PERIOD <- 201404
# alcoholdep201404$Druggroup <- "Alcohol"
# allsubstancedep201404 <- aggregate(allsubstancedep201404[-c(1:5, 11)], allsubstancedep201404["PRACTICE"], sum)
# allsubstancedep201404$PERIOD <- 201404
# allsubstancedep201404$Druggroup <- "SubstanceDep"
# obesedrugs201404 <- aggregate(obesedrugs201404[-c(1:5, 11)], obesedrugs201404["PRACTICE"], sum)
# obesedrugs201404$PERIOD <- 201404
# obesedrugs201404$Druggroup <- "Obesity"
# 
# prescribemaster201404 <- do.call("rbind", list(obesedrugs201404, allsubstancedep201404, alcoholdep201404, 
#                                                nicotinedep201404,opioddep201404, bronchodilators201404,
#                                                antidep201404, diabetes201404, dementia201404))
# 
# 
# write.csv(prescribemaster201404, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201404.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201403 <- read_csv("H:/prescription data/T201403PDPI BNFT.csv")
# prescribe201403$drugcode <- parse_number(prescribe201403$`BNF CODE`)
# prescribe201403$drugcode <- substr(prescribe201403$drugcode, 0, 6)
# antidep201403 <- prescribe201403[which(prescribe201403$drugcode>=403000&prescribe201403$drugcode<404000),]
# obesedrugs201403 <- prescribe201403[which(prescribe201403$drugcode>=405000&prescribe201403$drugcode<406000),]
# allsubstancedep201403 <- prescribe201403[which(prescribe201403$drugcode>=410000&prescribe201403$drugcode<411000),]
# alcoholdep201403 <- prescribe201403[which(prescribe201403$drugcode>=410010&prescribe201403$drugcode<410020),]
# nicotinedep201403 <- prescribe201403[which(prescribe201403$drugcode>=410020&prescribe201403$drugcode<410030),]
# opioddep201403 <- prescribe201403[which(prescribe201403$drugcode>=410030&prescribe201403$drugcode<411000),]
# bronchodilators201403 <- prescribe201403[which(prescribe201403$drugcode>=310000&prescribe201403$drugcode<320000),]
# dementia201403 <- prescribe201403[which(prescribe201403$drugcode>=411000&prescribe201403$drugcode<500000),]
# diabetes201403 <- prescribe201403[which(prescribe201403$drugcode>=601000&prescribe201403$drugcode<602000),]
# 
# antidep201403 <- aggregate(antidep201403[-c(1:5, 11)], antidep201403["PRACTICE"], sum)
# antidep201403$PERIOD <- 201403
# antidep201403$Druggroup <- "Antidepressant"
# dementia201403 <- aggregate(dementia201403[-c(1:5, 11)], dementia201403["PRACTICE"], sum)
# dementia201403$PERIOD <- 201403
# dementia201403$Druggroup <- "Dementia"
# diabetes201403 <- aggregate(diabetes201403[-c(1:5, 11)], diabetes201403["PRACTICE"], sum)
# diabetes201403$PERIOD <- 201403
# diabetes201403$Druggroup <- "Diabetes"
# 
# bronchodilators201403 <- aggregate(bronchodilators201403[-c(1:5, 11)], bronchodilators201403["PRACTICE"], sum)
# bronchodilators201403$PERIOD <- 201403
# bronchodilators201403$Druggroup <- "Bronchodilators"
# opioddep201403 <- aggregate(opioddep201403[-c(1:5, 11)], opioddep201403["PRACTICE"], sum)
# opioddep201403$PERIOD <- 201403
# opioddep201403$Druggroup <- "Opiod"
# nicotinedep201403 <- aggregate(nicotinedep201403[-c(1:5, 11)], nicotinedep201403["PRACTICE"], sum)
# nicotinedep201403$PERIOD <- 201403
# nicotinedep201403$Druggroup <- "Nicotine"
# alcoholdep201403 <- aggregate(alcoholdep201403[-c(1:5, 11)], alcoholdep201403["PRACTICE"], sum)
# alcoholdep201403$PERIOD <- 201403
# alcoholdep201403$Druggroup <- "Alcohol"
# allsubstancedep201403 <- aggregate(allsubstancedep201403[-c(1:5, 11)], allsubstancedep201403["PRACTICE"], sum)
# allsubstancedep201403$PERIOD <- 201403
# allsubstancedep201403$Druggroup <- "SubstanceDep"
# obesedrugs201403 <- aggregate(obesedrugs201403[-c(1:5, 11)], obesedrugs201403["PRACTICE"], sum)
# obesedrugs201403$PERIOD <- 201403
# obesedrugs201403$Druggroup <- "Obesity"
# 
# prescribemaster201403 <- do.call("rbind", list(obesedrugs201403, allsubstancedep201403, alcoholdep201403, 
#                                                nicotinedep201403,opioddep201403, bronchodilators201403,
#                                                antidep201403, diabetes201403, dementia201403))
# 
# 
# write.csv(prescribemaster201403, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201403.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201402 <- read_csv("H:/prescription data/T201402PDPI BNFT.csv")
# prescribe201402$drugcode <- parse_number(prescribe201402$`BNF CODE`)
# prescribe201402$drugcode <- substr(prescribe201402$drugcode, 0, 6)
# antidep201402 <- prescribe201402[which(prescribe201402$drugcode>=403000&prescribe201402$drugcode<404000),]
# obesedrugs201402 <- prescribe201402[which(prescribe201402$drugcode>=405000&prescribe201402$drugcode<406000),]
# allsubstancedep201402 <- prescribe201402[which(prescribe201402$drugcode>=410000&prescribe201402$drugcode<411000),]
# alcoholdep201402 <- prescribe201402[which(prescribe201402$drugcode>=410010&prescribe201402$drugcode<410020),]
# nicotinedep201402 <- prescribe201402[which(prescribe201402$drugcode>=410020&prescribe201402$drugcode<410030),]
# opioddep201402 <- prescribe201402[which(prescribe201402$drugcode>=410030&prescribe201402$drugcode<411000),]
# bronchodilators201402 <- prescribe201402[which(prescribe201402$drugcode>=310000&prescribe201402$drugcode<320000),]
# dementia201402 <- prescribe201402[which(prescribe201402$drugcode>=411000&prescribe201402$drugcode<500000),]
# diabetes201402 <- prescribe201402[which(prescribe201402$drugcode>=601000&prescribe201402$drugcode<602000),]
# 
# antidep201402 <- aggregate(antidep201402[-c(1:5, 11)], antidep201402["PRACTICE"], sum)
# antidep201402$PERIOD <- 201402
# antidep201402$Druggroup <- "Antidepressant"
# dementia201402 <- aggregate(dementia201402[-c(1:5, 11)], dementia201402["PRACTICE"], sum)
# dementia201402$PERIOD <- 201402
# dementia201402$Druggroup <- "Dementia"
# diabetes201402 <- aggregate(diabetes201402[-c(1:5, 11)], diabetes201402["PRACTICE"], sum)
# diabetes201402$PERIOD <- 201402
# diabetes201402$Druggroup <- "Diabetes"
# 
# bronchodilators201402 <- aggregate(bronchodilators201402[-c(1:5, 11)], bronchodilators201402["PRACTICE"], sum)
# bronchodilators201402$PERIOD <- 201402
# bronchodilators201402$Druggroup <- "Bronchodilators"
# opioddep201402 <- aggregate(opioddep201402[-c(1:5, 11)], opioddep201402["PRACTICE"], sum)
# opioddep201402$PERIOD <- 201402
# opioddep201402$Druggroup <- "Opiod"
# nicotinedep201402 <- aggregate(nicotinedep201402[-c(1:5, 11)], nicotinedep201402["PRACTICE"], sum)
# nicotinedep201402$PERIOD <- 201402
# nicotinedep201402$Druggroup <- "Nicotine"
# alcoholdep201402 <- aggregate(alcoholdep201402[-c(1:5, 11)], alcoholdep201402["PRACTICE"], sum)
# alcoholdep201402$PERIOD <- 201402
# alcoholdep201402$Druggroup <- "Alcohol"
# allsubstancedep201402 <- aggregate(allsubstancedep201402[-c(1:5, 11)], allsubstancedep201402["PRACTICE"], sum)
# allsubstancedep201402$PERIOD <- 201402
# allsubstancedep201402$Druggroup <- "SubstanceDep"
# obesedrugs201402 <- aggregate(obesedrugs201402[-c(1:5, 11)], obesedrugs201402["PRACTICE"], sum)
# obesedrugs201402$PERIOD <- 201402
# obesedrugs201402$Druggroup <- "Obesity"
# 
# prescribemaster201402 <- do.call("rbind", list(obesedrugs201402, allsubstancedep201402, alcoholdep201402, 
#                                                nicotinedep201402,opioddep201402, bronchodilators201402,
#                                                antidep201402, diabetes201402, dementia201402))
# 
# 
# write.csv(prescribemaster201402, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201402.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201401 <- read_csv("H:/prescription data/T201401PDPI BNFT.csv")
# prescribe201401$drugcode <- parse_number(prescribe201401$`BNF CODE`)
# prescribe201401$drugcode <- substr(prescribe201401$drugcode, 0, 6)
# antidep201401 <- prescribe201401[which(prescribe201401$drugcode>=403000&prescribe201401$drugcode<404000),]
# obesedrugs201401 <- prescribe201401[which(prescribe201401$drugcode>=405000&prescribe201401$drugcode<406000),]
# allsubstancedep201401 <- prescribe201401[which(prescribe201401$drugcode>=410000&prescribe201401$drugcode<411000),]
# alcoholdep201401 <- prescribe201401[which(prescribe201401$drugcode>=410010&prescribe201401$drugcode<410020),]
# nicotinedep201401 <- prescribe201401[which(prescribe201401$drugcode>=410020&prescribe201401$drugcode<410030),]
# opioddep201401 <- prescribe201401[which(prescribe201401$drugcode>=410030&prescribe201401$drugcode<411000),]
# bronchodilators201401 <- prescribe201401[which(prescribe201401$drugcode>=310000&prescribe201401$drugcode<320000),]
# dementia201401 <- prescribe201401[which(prescribe201401$drugcode>=411000&prescribe201401$drugcode<500000),]
# diabetes201401 <- prescribe201401[which(prescribe201401$drugcode>=601000&prescribe201401$drugcode<602000),]
# 
# antidep201401 <- aggregate(antidep201401[-c(1:5, 11)], antidep201401["PRACTICE"], sum)
# antidep201401$PERIOD <- 201401
# antidep201401$Druggroup <- "Antidepressant"
# dementia201401 <- aggregate(dementia201401[-c(1:5, 11)], dementia201401["PRACTICE"], sum)
# dementia201401$PERIOD <- 201401
# dementia201401$Druggroup <- "Dementia"
# diabetes201401 <- aggregate(diabetes201401[-c(1:5, 11)], diabetes201401["PRACTICE"], sum)
# diabetes201401$PERIOD <- 201401
# diabetes201401$Druggroup <- "Diabetes"
# 
# bronchodilators201401 <- aggregate(bronchodilators201401[-c(1:5, 11)], bronchodilators201401["PRACTICE"], sum)
# bronchodilators201401$PERIOD <- 201401
# bronchodilators201401$Druggroup <- "Bronchodilators"
# opioddep201401 <- aggregate(opioddep201401[-c(1:5, 11)], opioddep201401["PRACTICE"], sum)
# opioddep201401$PERIOD <- 201401
# opioddep201401$Druggroup <- "Opiod"
# nicotinedep201401 <- aggregate(nicotinedep201401[-c(1:5, 11)], nicotinedep201401["PRACTICE"], sum)
# nicotinedep201401$PERIOD <- 201401
# nicotinedep201401$Druggroup <- "Nicotine"
# alcoholdep201401 <- aggregate(alcoholdep201401[-c(1:5, 11)], alcoholdep201401["PRACTICE"], sum)
# alcoholdep201401$PERIOD <- 201401
# alcoholdep201401$Druggroup <- "Alcohol"
# allsubstancedep201401 <- aggregate(allsubstancedep201401[-c(1:5, 11)], allsubstancedep201401["PRACTICE"], sum)
# allsubstancedep201401$PERIOD <- 201401
# allsubstancedep201401$Druggroup <- "SubstanceDep"
# obesedrugs201401 <- aggregate(obesedrugs201401[-c(1:5, 11)], obesedrugs201401["PRACTICE"], sum)
# obesedrugs201401$PERIOD <- 201401
# obesedrugs201401$Druggroup <- "Obesity"
# 
# prescribemaster201401 <- do.call("rbind", list(obesedrugs201401, allsubstancedep201401, alcoholdep201401, 
#                                                nicotinedep201401,opioddep201401, bronchodilators201401,
#                                                antidep201401, diabetes201401, dementia201401))
# 
# 
# write.csv(prescribemaster201401, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201401.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201312 <- read_csv("H:/prescription data/T201312PDPI BNFT.csv")
# prescribe201312$drugcode <- parse_number(prescribe201312$`BNF CODE`)
# prescribe201312$drugcode <- substr(prescribe201312$drugcode, 0, 6)
# antidep201312 <- prescribe201312[which(prescribe201312$drugcode>=403000&prescribe201312$drugcode<404000),]
# obesedrugs201312 <- prescribe201312[which(prescribe201312$drugcode>=405000&prescribe201312$drugcode<406000),]
# allsubstancedep201312 <- prescribe201312[which(prescribe201312$drugcode>=410000&prescribe201312$drugcode<411000),]
# alcoholdep201312 <- prescribe201312[which(prescribe201312$drugcode>=410010&prescribe201312$drugcode<410020),]
# nicotinedep201312 <- prescribe201312[which(prescribe201312$drugcode>=410020&prescribe201312$drugcode<410030),]
# opioddep201312 <- prescribe201312[which(prescribe201312$drugcode>=410030&prescribe201312$drugcode<411000),]
# bronchodilators201312 <- prescribe201312[which(prescribe201312$drugcode>=310000&prescribe201312$drugcode<320000),]
# dementia201312 <- prescribe201312[which(prescribe201312$drugcode>=411000&prescribe201312$drugcode<500000),]
# diabetes201312 <- prescribe201312[which(prescribe201312$drugcode>=601000&prescribe201312$drugcode<602000),]
# 
# antidep201312 <- aggregate(antidep201312[-c(1:5, 11)], antidep201312["PRACTICE"], sum)
# antidep201312$PERIOD <- 201312
# antidep201312$Druggroup <- "Antidepressant"
# dementia201312 <- aggregate(dementia201312[-c(1:5, 11)], dementia201312["PRACTICE"], sum)
# dementia201312$PERIOD <- 201312
# dementia201312$Druggroup <- "Dementia"
# diabetes201312 <- aggregate(diabetes201312[-c(1:5, 11)], diabetes201312["PRACTICE"], sum)
# diabetes201312$PERIOD <- 201312
# diabetes201312$Druggroup <- "Diabetes"
# 
# bronchodilators201312 <- aggregate(bronchodilators201312[-c(1:5, 11)], bronchodilators201312["PRACTICE"], sum)
# bronchodilators201312$PERIOD <- 201312
# bronchodilators201312$Druggroup <- "Bronchodilators"
# opioddep201312 <- aggregate(opioddep201312[-c(1:5, 11)], opioddep201312["PRACTICE"], sum)
# opioddep201312$PERIOD <- 201312
# opioddep201312$Druggroup <- "Opiod"
# nicotinedep201312 <- aggregate(nicotinedep201312[-c(1:5, 11)], nicotinedep201312["PRACTICE"], sum)
# nicotinedep201312$PERIOD <- 201312
# nicotinedep201312$Druggroup <- "Nicotine"
# alcoholdep201312 <- aggregate(alcoholdep201312[-c(1:5, 11)], alcoholdep201312["PRACTICE"], sum)
# alcoholdep201312$PERIOD <- 201312
# alcoholdep201312$Druggroup <- "Alcohol"
# allsubstancedep201312 <- aggregate(allsubstancedep201312[-c(1:5, 11)], allsubstancedep201312["PRACTICE"], sum)
# allsubstancedep201312$PERIOD <- 201312
# allsubstancedep201312$Druggroup <- "SubstanceDep"
# obesedrugs201312 <- aggregate(obesedrugs201312[-c(1:5, 11)], obesedrugs201312["PRACTICE"], sum)
# obesedrugs201312$PERIOD <- 201312
# obesedrugs201312$Druggroup <- "Obesity"
# 
# prescribemaster201312 <- do.call("rbind", list(obesedrugs201312, allsubstancedep201312, alcoholdep201312, 
#                                                nicotinedep201312,opioddep201312, bronchodilators201312,
#                                                antidep201312, diabetes201312, dementia201312))
# 
# 
# write.csv(prescribemaster201312, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201312.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201311 <- read_csv("H:/prescription data/T201311PDPI BNFT.csv")
# prescribe201311$drugcode <- parse_number(prescribe201311$`BNF CODE`)
# prescribe201311$drugcode <- substr(prescribe201311$drugcode, 0, 6)
# antidep201311 <- prescribe201311[which(prescribe201311$drugcode>=403000&prescribe201311$drugcode<404000),]
# obesedrugs201311 <- prescribe201311[which(prescribe201311$drugcode>=405000&prescribe201311$drugcode<406000),]
# allsubstancedep201311 <- prescribe201311[which(prescribe201311$drugcode>=410000&prescribe201311$drugcode<411000),]
# alcoholdep201311 <- prescribe201311[which(prescribe201311$drugcode>=410010&prescribe201311$drugcode<410020),]
# nicotinedep201311 <- prescribe201311[which(prescribe201311$drugcode>=410020&prescribe201311$drugcode<410030),]
# opioddep201311 <- prescribe201311[which(prescribe201311$drugcode>=410030&prescribe201311$drugcode<411000),]
# bronchodilators201311 <- prescribe201311[which(prescribe201311$drugcode>=310000&prescribe201311$drugcode<320000),]
# dementia201311 <- prescribe201311[which(prescribe201311$drugcode>=411000&prescribe201311$drugcode<500000),]
# diabetes201311 <- prescribe201311[which(prescribe201311$drugcode>=601000&prescribe201311$drugcode<602000),]
# 
# antidep201311 <- aggregate(antidep201311[-c(1:5, 11)], antidep201311["PRACTICE"], sum)
# antidep201311$PERIOD <- 201311
# antidep201311$Druggroup <- "Antidepressant"
# dementia201311 <- aggregate(dementia201311[-c(1:5, 11)], dementia201311["PRACTICE"], sum)
# dementia201311$PERIOD <- 201311
# dementia201311$Druggroup <- "Dementia"
# diabetes201311 <- aggregate(diabetes201311[-c(1:5, 11)], diabetes201311["PRACTICE"], sum)
# diabetes201311$PERIOD <- 201311
# diabetes201311$Druggroup <- "Diabetes"
# 
# bronchodilators201311 <- aggregate(bronchodilators201311[-c(1:5, 11)], bronchodilators201311["PRACTICE"], sum)
# bronchodilators201311$PERIOD <- 201311
# bronchodilators201311$Druggroup <- "Bronchodilators"
# opioddep201311 <- aggregate(opioddep201311[-c(1:5, 11)], opioddep201311["PRACTICE"], sum)
# opioddep201311$PERIOD <- 201311
# opioddep201311$Druggroup <- "Opiod"
# nicotinedep201311 <- aggregate(nicotinedep201311[-c(1:5, 11)], nicotinedep201311["PRACTICE"], sum)
# nicotinedep201311$PERIOD <- 201311
# nicotinedep201311$Druggroup <- "Nicotine"
# alcoholdep201311 <- aggregate(alcoholdep201311[-c(1:5, 11)], alcoholdep201311["PRACTICE"], sum)
# alcoholdep201311$PERIOD <- 201311
# alcoholdep201311$Druggroup <- "Alcohol"
# allsubstancedep201311 <- aggregate(allsubstancedep201311[-c(1:5, 11)], allsubstancedep201311["PRACTICE"], sum)
# allsubstancedep201311$PERIOD <- 201311
# allsubstancedep201311$Druggroup <- "SubstanceDep"
# obesedrugs201311 <- aggregate(obesedrugs201311[-c(1:5, 11)], obesedrugs201311["PRACTICE"], sum)
# obesedrugs201311$PERIOD <- 201311
# obesedrugs201311$Druggroup <- "Obesity"
# 
# prescribemaster201311 <- do.call("rbind", list(obesedrugs201311, allsubstancedep201311, alcoholdep201311, 
#                                                nicotinedep201311,opioddep201311, bronchodilators201311,
#                                                antidep201311, diabetes201311, dementia201311))
# 
# 
# write.csv(prescribemaster201311, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201311.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201310 <- read_csv("H:/prescription data/T201310PDPI BNFT.csv")
# prescribe201310$drugcode <- parse_number(prescribe201310$`BNF CODE`)
# prescribe201310$drugcode <- substr(prescribe201310$drugcode, 0, 6)
# antidep201310 <- prescribe201310[which(prescribe201310$drugcode>=403000&prescribe201310$drugcode<404000),]
# obesedrugs201310 <- prescribe201310[which(prescribe201310$drugcode>=405000&prescribe201310$drugcode<406000),]
# allsubstancedep201310 <- prescribe201310[which(prescribe201310$drugcode>=410000&prescribe201310$drugcode<411000),]
# alcoholdep201310 <- prescribe201310[which(prescribe201310$drugcode>=410010&prescribe201310$drugcode<410020),]
# nicotinedep201310 <- prescribe201310[which(prescribe201310$drugcode>=410020&prescribe201310$drugcode<410030),]
# opioddep201310 <- prescribe201310[which(prescribe201310$drugcode>=410030&prescribe201310$drugcode<411000),]
# bronchodilators201310 <- prescribe201310[which(prescribe201310$drugcode>=310000&prescribe201310$drugcode<320000),]
# dementia201310 <- prescribe201310[which(prescribe201310$drugcode>=411000&prescribe201310$drugcode<500000),]
# diabetes201310 <- prescribe201310[which(prescribe201310$drugcode>=601000&prescribe201310$drugcode<602000),]
# 
# antidep201310 <- aggregate(antidep201310[-c(1:5, 11)], antidep201310["PRACTICE"], sum)
# antidep201310$PERIOD <- 201310
# antidep201310$Druggroup <- "Antidepressant"
# dementia201310 <- aggregate(dementia201310[-c(1:5, 11)], dementia201310["PRACTICE"], sum)
# dementia201310$PERIOD <- 201310
# dementia201310$Druggroup <- "Dementia"
# diabetes201310 <- aggregate(diabetes201310[-c(1:5, 11)], diabetes201310["PRACTICE"], sum)
# diabetes201310$PERIOD <- 201310
# diabetes201310$Druggroup <- "Diabetes"
# 
# bronchodilators201310 <- aggregate(bronchodilators201310[-c(1:5, 11)], bronchodilators201310["PRACTICE"], sum)
# bronchodilators201310$PERIOD <- 201310
# bronchodilators201310$Druggroup <- "Bronchodilators"
# opioddep201310 <- aggregate(opioddep201310[-c(1:5, 11)], opioddep201310["PRACTICE"], sum)
# opioddep201310$PERIOD <- 201310
# opioddep201310$Druggroup <- "Opiod"
# nicotinedep201310 <- aggregate(nicotinedep201310[-c(1:5, 11)], nicotinedep201310["PRACTICE"], sum)
# nicotinedep201310$PERIOD <- 201310
# nicotinedep201310$Druggroup <- "Nicotine"
# alcoholdep201310 <- aggregate(alcoholdep201310[-c(1:5, 11)], alcoholdep201310["PRACTICE"], sum)
# alcoholdep201310$PERIOD <- 201310
# alcoholdep201310$Druggroup <- "Alcohol"
# allsubstancedep201310 <- aggregate(allsubstancedep201310[-c(1:5, 11)], allsubstancedep201310["PRACTICE"], sum)
# allsubstancedep201310$PERIOD <- 201310
# allsubstancedep201310$Druggroup <- "SubstanceDep"
# obesedrugs201310 <- aggregate(obesedrugs201310[-c(1:5, 11)], obesedrugs201310["PRACTICE"], sum)
# obesedrugs201310$PERIOD <- 201310
# obesedrugs201310$Druggroup <- "Obesity"
# 
# prescribemaster201310 <- do.call("rbind", list(obesedrugs201310, allsubstancedep201310, alcoholdep201310, 
#                                                nicotinedep201310,opioddep201310, bronchodilators201310,
#                                                antidep201310, diabetes201310, dementia201310))
# 
# 
# write.csv(prescribemaster201310, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201310.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201309 <- read_csv("H:/prescription data/T201309PDPI BNFT.csv")
# prescribe201309$drugcode <- parse_number(prescribe201309$`BNF CODE`)
# prescribe201309$drugcode <- substr(prescribe201309$drugcode, 0, 6)
# antidep201309 <- prescribe201309[which(prescribe201309$drugcode>=403000&prescribe201309$drugcode<404000),]
# obesedrugs201309 <- prescribe201309[which(prescribe201309$drugcode>=405000&prescribe201309$drugcode<406000),]
# allsubstancedep201309 <- prescribe201309[which(prescribe201309$drugcode>=410000&prescribe201309$drugcode<411000),]
# alcoholdep201309 <- prescribe201309[which(prescribe201309$drugcode>=410010&prescribe201309$drugcode<410020),]
# nicotinedep201309 <- prescribe201309[which(prescribe201309$drugcode>=410020&prescribe201309$drugcode<410030),]
# opioddep201309 <- prescribe201309[which(prescribe201309$drugcode>=410030&prescribe201309$drugcode<411000),]
# bronchodilators201309 <- prescribe201309[which(prescribe201309$drugcode>=310000&prescribe201309$drugcode<320000),]
# dementia201309 <- prescribe201309[which(prescribe201309$drugcode>=411000&prescribe201309$drugcode<500000),]
# diabetes201309 <- prescribe201309[which(prescribe201309$drugcode>=601000&prescribe201309$drugcode<602000),]
# 
# antidep201309 <- aggregate(antidep201309[-c(1:5, 11)], antidep201309["PRACTICE"], sum)
# antidep201309$PERIOD <- 201309
# antidep201309$Druggroup <- "Antidepressant"
# dementia201309 <- aggregate(dementia201309[-c(1:5, 11)], dementia201309["PRACTICE"], sum)
# dementia201309$PERIOD <- 201309
# dementia201309$Druggroup <- "Dementia"
# diabetes201309 <- aggregate(diabetes201309[-c(1:5, 11)], diabetes201309["PRACTICE"], sum)
# diabetes201309$PERIOD <- 201309
# diabetes201309$Druggroup <- "Diabetes"
# 
# bronchodilators201309 <- aggregate(bronchodilators201309[-c(1:5, 11)], bronchodilators201309["PRACTICE"], sum)
# bronchodilators201309$PERIOD <- 201309
# bronchodilators201309$Druggroup <- "Bronchodilators"
# opioddep201309 <- aggregate(opioddep201309[-c(1:5, 11)], opioddep201309["PRACTICE"], sum)
# opioddep201309$PERIOD <- 201309
# opioddep201309$Druggroup <- "Opiod"
# nicotinedep201309 <- aggregate(nicotinedep201309[-c(1:5, 11)], nicotinedep201309["PRACTICE"], sum)
# nicotinedep201309$PERIOD <- 201309
# nicotinedep201309$Druggroup <- "Nicotine"
# alcoholdep201309 <- aggregate(alcoholdep201309[-c(1:5, 11)], alcoholdep201309["PRACTICE"], sum)
# alcoholdep201309$PERIOD <- 201309
# alcoholdep201309$Druggroup <- "Alcohol"
# allsubstancedep201309 <- aggregate(allsubstancedep201309[-c(1:5, 11)], allsubstancedep201309["PRACTICE"], sum)
# allsubstancedep201309$PERIOD <- 201309
# allsubstancedep201309$Druggroup <- "SubstanceDep"
# obesedrugs201309 <- aggregate(obesedrugs201309[-c(1:5, 11)], obesedrugs201309["PRACTICE"], sum)
# obesedrugs201309$PERIOD <- 201309
# obesedrugs201309$Druggroup <- "Obesity"
# 
# prescribemaster201309 <- do.call("rbind", list(obesedrugs201309, allsubstancedep201309, alcoholdep201309, 
#                                                nicotinedep201309,opioddep201309, bronchodilators201309,
#                                                antidep201309, diabetes201309, dementia201309))
# 
# 
# write.csv(prescribemaster201309, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201309.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201308 <- read_csv("H:/prescription data/T201308PDPI BNFT.csv")
# prescribe201308$drugcode <- parse_number(prescribe201308$`BNF CODE`)
# prescribe201308$drugcode <- substr(prescribe201308$drugcode, 0, 6)
# antidep201308 <- prescribe201308[which(prescribe201308$drugcode>=403000&prescribe201308$drugcode<404000),]
# obesedrugs201308 <- prescribe201308[which(prescribe201308$drugcode>=405000&prescribe201308$drugcode<406000),]
# allsubstancedep201308 <- prescribe201308[which(prescribe201308$drugcode>=410000&prescribe201308$drugcode<411000),]
# alcoholdep201308 <- prescribe201308[which(prescribe201308$drugcode>=410010&prescribe201308$drugcode<410020),]
# nicotinedep201308 <- prescribe201308[which(prescribe201308$drugcode>=410020&prescribe201308$drugcode<410030),]
# opioddep201308 <- prescribe201308[which(prescribe201308$drugcode>=410030&prescribe201308$drugcode<411000),]
# bronchodilators201308 <- prescribe201308[which(prescribe201308$drugcode>=310000&prescribe201308$drugcode<320000),]
# dementia201308 <- prescribe201308[which(prescribe201308$drugcode>=411000&prescribe201308$drugcode<500000),]
# diabetes201308 <- prescribe201308[which(prescribe201308$drugcode>=601000&prescribe201308$drugcode<602000),]
# 
# antidep201308 <- aggregate(antidep201308[-c(1:5, 11)], antidep201308["PRACTICE"], sum)
# antidep201308$PERIOD <- 201308
# antidep201308$Druggroup <- "Antidepressant"
# dementia201308 <- aggregate(dementia201308[-c(1:5, 11)], dementia201308["PRACTICE"], sum)
# dementia201308$PERIOD <- 201308
# dementia201308$Druggroup <- "Dementia"
# diabetes201308 <- aggregate(diabetes201308[-c(1:5, 11)], diabetes201308["PRACTICE"], sum)
# diabetes201308$PERIOD <- 201308
# diabetes201308$Druggroup <- "Diabetes"
# 
# bronchodilators201308 <- aggregate(bronchodilators201308[-c(1:5, 11)], bronchodilators201308["PRACTICE"], sum)
# bronchodilators201308$PERIOD <- 201308
# bronchodilators201308$Druggroup <- "Bronchodilators"
# opioddep201308 <- aggregate(opioddep201308[-c(1:5, 11)], opioddep201308["PRACTICE"], sum)
# opioddep201308$PERIOD <- 201308
# opioddep201308$Druggroup <- "Opiod"
# nicotinedep201308 <- aggregate(nicotinedep201308[-c(1:5, 11)], nicotinedep201308["PRACTICE"], sum)
# nicotinedep201308$PERIOD <- 201308
# nicotinedep201308$Druggroup <- "Nicotine"
# alcoholdep201308 <- aggregate(alcoholdep201308[-c(1:5, 11)], alcoholdep201308["PRACTICE"], sum)
# alcoholdep201308$PERIOD <- 201308
# alcoholdep201308$Druggroup <- "Alcohol"
# allsubstancedep201308 <- aggregate(allsubstancedep201308[-c(1:5, 11)], allsubstancedep201308["PRACTICE"], sum)
# allsubstancedep201308$PERIOD <- 201308
# allsubstancedep201308$Druggroup <- "SubstanceDep"
# obesedrugs201308 <- aggregate(obesedrugs201308[-c(1:5, 11)], obesedrugs201308["PRACTICE"], sum)
# obesedrugs201308$PERIOD <- 201308
# obesedrugs201308$Druggroup <- "Obesity"
# 
# prescribemaster201308 <- do.call("rbind", list(obesedrugs201308, allsubstancedep201308, alcoholdep201308, 
#                                                nicotinedep201308,opioddep201308, bronchodilators201308,
#                                                antidep201308, diabetes201308, dementia201308))
# 
# 
# write.csv(prescribemaster201308, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201308.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201307 <- read_csv("H:/prescription data/T201307PDPI BNFT.csv")
# prescribe201307$drugcode <- parse_number(prescribe201307$`BNF CODE`)
# prescribe201307$drugcode <- substr(prescribe201307$drugcode, 0, 6)
# antidep201307 <- prescribe201307[which(prescribe201307$drugcode>=403000&prescribe201307$drugcode<404000),]
# obesedrugs201307 <- prescribe201307[which(prescribe201307$drugcode>=405000&prescribe201307$drugcode<406000),]
# allsubstancedep201307 <- prescribe201307[which(prescribe201307$drugcode>=410000&prescribe201307$drugcode<411000),]
# alcoholdep201307 <- prescribe201307[which(prescribe201307$drugcode>=410010&prescribe201307$drugcode<410020),]
# nicotinedep201307 <- prescribe201307[which(prescribe201307$drugcode>=410020&prescribe201307$drugcode<410030),]
# opioddep201307 <- prescribe201307[which(prescribe201307$drugcode>=410030&prescribe201307$drugcode<411000),]
# bronchodilators201307 <- prescribe201307[which(prescribe201307$drugcode>=310000&prescribe201307$drugcode<320000),]
# dementia201307 <- prescribe201307[which(prescribe201307$drugcode>=411000&prescribe201307$drugcode<500000),]
# diabetes201307 <- prescribe201307[which(prescribe201307$drugcode>=601000&prescribe201307$drugcode<602000),]
# 
# antidep201307 <- aggregate(antidep201307[-c(1:5, 11)], antidep201307["PRACTICE"], sum)
# antidep201307$PERIOD <- 201307
# antidep201307$Druggroup <- "Antidepressant"
# dementia201307 <- aggregate(dementia201307[-c(1:5, 11)], dementia201307["PRACTICE"], sum)
# dementia201307$PERIOD <- 201307
# dementia201307$Druggroup <- "Dementia"
# diabetes201307 <- aggregate(diabetes201307[-c(1:5, 11)], diabetes201307["PRACTICE"], sum)
# diabetes201307$PERIOD <- 201307
# diabetes201307$Druggroup <- "Diabetes"
# 
# bronchodilators201307 <- aggregate(bronchodilators201307[-c(1:5, 11)], bronchodilators201307["PRACTICE"], sum)
# bronchodilators201307$PERIOD <- 201307
# bronchodilators201307$Druggroup <- "Bronchodilators"
# opioddep201307 <- aggregate(opioddep201307[-c(1:5, 11)], opioddep201307["PRACTICE"], sum)
# opioddep201307$PERIOD <- 201307
# opioddep201307$Druggroup <- "Opiod"
# nicotinedep201307 <- aggregate(nicotinedep201307[-c(1:5, 11)], nicotinedep201307["PRACTICE"], sum)
# nicotinedep201307$PERIOD <- 201307
# nicotinedep201307$Druggroup <- "Nicotine"
# alcoholdep201307 <- aggregate(alcoholdep201307[-c(1:5, 11)], alcoholdep201307["PRACTICE"], sum)
# alcoholdep201307$PERIOD <- 201307
# alcoholdep201307$Druggroup <- "Alcohol"
# allsubstancedep201307 <- aggregate(allsubstancedep201307[-c(1:5, 11)], allsubstancedep201307["PRACTICE"], sum)
# allsubstancedep201307$PERIOD <- 201307
# allsubstancedep201307$Druggroup <- "SubstanceDep"
# obesedrugs201307 <- aggregate(obesedrugs201307[-c(1:5, 11)], obesedrugs201307["PRACTICE"], sum)
# obesedrugs201307$PERIOD <- 201307
# obesedrugs201307$Druggroup <- "Obesity"
# 
# prescribemaster201307 <- do.call("rbind", list(obesedrugs201307, allsubstancedep201307, alcoholdep201307, 
#                                                nicotinedep201307,opioddep201307, bronchodilators201307,
#                                                antidep201307, diabetes201307, dementia201307))
# 
# 
# write.csv(prescribemaster201307, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201307.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201306 <- read_csv("H:/prescription data/T201306PDPI BNFT.csv")
# prescribe201306$drugcode <- parse_number(prescribe201306$`BNF CODE`)
# prescribe201306$drugcode <- substr(prescribe201306$drugcode, 0, 6)
# antidep201306 <- prescribe201306[which(prescribe201306$drugcode>=403000&prescribe201306$drugcode<404000),]
# obesedrugs201306 <- prescribe201306[which(prescribe201306$drugcode>=405000&prescribe201306$drugcode<406000),]
# allsubstancedep201306 <- prescribe201306[which(prescribe201306$drugcode>=410000&prescribe201306$drugcode<411000),]
# alcoholdep201306 <- prescribe201306[which(prescribe201306$drugcode>=410010&prescribe201306$drugcode<410020),]
# nicotinedep201306 <- prescribe201306[which(prescribe201306$drugcode>=410020&prescribe201306$drugcode<410030),]
# opioddep201306 <- prescribe201306[which(prescribe201306$drugcode>=410030&prescribe201306$drugcode<411000),]
# bronchodilators201306 <- prescribe201306[which(prescribe201306$drugcode>=310000&prescribe201306$drugcode<320000),]
# dementia201306 <- prescribe201306[which(prescribe201306$drugcode>=411000&prescribe201306$drugcode<500000),]
# diabetes201306 <- prescribe201306[which(prescribe201306$drugcode>=601000&prescribe201306$drugcode<602000),]
# 
# antidep201306 <- aggregate(antidep201306[-c(1:5, 11)], antidep201306["PRACTICE"], sum)
# antidep201306$PERIOD <- 201306
# antidep201306$Druggroup <- "Antidepressant"
# dementia201306 <- aggregate(dementia201306[-c(1:5, 11)], dementia201306["PRACTICE"], sum)
# dementia201306$PERIOD <- 201306
# dementia201306$Druggroup <- "Dementia"
# diabetes201306 <- aggregate(diabetes201306[-c(1:5, 11)], diabetes201306["PRACTICE"], sum)
# diabetes201306$PERIOD <- 201306
# diabetes201306$Druggroup <- "Diabetes"
# 
# bronchodilators201306 <- aggregate(bronchodilators201306[-c(1:5, 11)], bronchodilators201306["PRACTICE"], sum)
# bronchodilators201306$PERIOD <- 201306
# bronchodilators201306$Druggroup <- "Bronchodilators"
# opioddep201306 <- aggregate(opioddep201306[-c(1:5, 11)], opioddep201306["PRACTICE"], sum)
# opioddep201306$PERIOD <- 201306
# opioddep201306$Druggroup <- "Opiod"
# nicotinedep201306 <- aggregate(nicotinedep201306[-c(1:5, 11)], nicotinedep201306["PRACTICE"], sum)
# nicotinedep201306$PERIOD <- 201306
# nicotinedep201306$Druggroup <- "Nicotine"
# alcoholdep201306 <- aggregate(alcoholdep201306[-c(1:5, 11)], alcoholdep201306["PRACTICE"], sum)
# alcoholdep201306$PERIOD <- 201306
# alcoholdep201306$Druggroup <- "Alcohol"
# allsubstancedep201306 <- aggregate(allsubstancedep201306[-c(1:5, 11)], allsubstancedep201306["PRACTICE"], sum)
# allsubstancedep201306$PERIOD <- 201306
# allsubstancedep201306$Druggroup <- "SubstanceDep"
# obesedrugs201306 <- aggregate(obesedrugs201306[-c(1:5, 11)], obesedrugs201306["PRACTICE"], sum)
# obesedrugs201306$PERIOD <- 201306
# obesedrugs201306$Druggroup <- "Obesity"
# 
# prescribemaster201306 <- do.call("rbind", list(obesedrugs201306, allsubstancedep201306, alcoholdep201306, 
#                                                nicotinedep201306,opioddep201306, bronchodilators201306,
#                                                antidep201306, diabetes201306, dementia201306))
# 
# 
# write.csv(prescribemaster201306, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201306.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201305 <- read_csv("H:/prescription data/T201305PDPI BNFT.csv")
# prescribe201305$drugcode <- parse_number(prescribe201305$`BNF CODE`)
# prescribe201305$drugcode <- substr(prescribe201305$drugcode, 0, 6)
# antidep201305 <- prescribe201305[which(prescribe201305$drugcode>=403000&prescribe201305$drugcode<404000),]
# obesedrugs201305 <- prescribe201305[which(prescribe201305$drugcode>=405000&prescribe201305$drugcode<406000),]
# allsubstancedep201305 <- prescribe201305[which(prescribe201305$drugcode>=410000&prescribe201305$drugcode<411000),]
# alcoholdep201305 <- prescribe201305[which(prescribe201305$drugcode>=410010&prescribe201305$drugcode<410020),]
# nicotinedep201305 <- prescribe201305[which(prescribe201305$drugcode>=410020&prescribe201305$drugcode<410030),]
# opioddep201305 <- prescribe201305[which(prescribe201305$drugcode>=410030&prescribe201305$drugcode<411000),]
# bronchodilators201305 <- prescribe201305[which(prescribe201305$drugcode>=310000&prescribe201305$drugcode<320000),]
# dementia201305 <- prescribe201305[which(prescribe201305$drugcode>=411000&prescribe201305$drugcode<500000),]
# diabetes201305 <- prescribe201305[which(prescribe201305$drugcode>=601000&prescribe201305$drugcode<602000),]
# 
# antidep201305 <- aggregate(antidep201305[-c(1:5, 11)], antidep201305["PRACTICE"], sum)
# antidep201305$PERIOD <- 201305
# antidep201305$Druggroup <- "Antidepressant"
# dementia201305 <- aggregate(dementia201305[-c(1:5, 11)], dementia201305["PRACTICE"], sum)
# dementia201305$PERIOD <- 201305
# dementia201305$Druggroup <- "Dementia"
# diabetes201305 <- aggregate(diabetes201305[-c(1:5, 11)], diabetes201305["PRACTICE"], sum)
# diabetes201305$PERIOD <- 201305
# diabetes201305$Druggroup <- "Diabetes"
# 
# bronchodilators201305 <- aggregate(bronchodilators201305[-c(1:5, 11)], bronchodilators201305["PRACTICE"], sum)
# bronchodilators201305$PERIOD <- 201305
# bronchodilators201305$Druggroup <- "Bronchodilators"
# opioddep201305 <- aggregate(opioddep201305[-c(1:5, 11)], opioddep201305["PRACTICE"], sum)
# opioddep201305$PERIOD <- 201305
# opioddep201305$Druggroup <- "Opiod"
# nicotinedep201305 <- aggregate(nicotinedep201305[-c(1:5, 11)], nicotinedep201305["PRACTICE"], sum)
# nicotinedep201305$PERIOD <- 201305
# nicotinedep201305$Druggroup <- "Nicotine"
# alcoholdep201305 <- aggregate(alcoholdep201305[-c(1:5, 11)], alcoholdep201305["PRACTICE"], sum)
# alcoholdep201305$PERIOD <- 201305
# alcoholdep201305$Druggroup <- "Alcohol"
# allsubstancedep201305 <- aggregate(allsubstancedep201305[-c(1:5, 11)], allsubstancedep201305["PRACTICE"], sum)
# allsubstancedep201305$PERIOD <- 201305
# allsubstancedep201305$Druggroup <- "SubstanceDep"
# obesedrugs201305 <- aggregate(obesedrugs201305[-c(1:5, 11)], obesedrugs201305["PRACTICE"], sum)
# obesedrugs201305$PERIOD <- 201305
# obesedrugs201305$Druggroup <- "Obesity"
# 
# prescribemaster201305 <- do.call("rbind", list(obesedrugs201305, allsubstancedep201305, alcoholdep201305, 
#                                                nicotinedep201305,opioddep201305, bronchodilators201305,
#                                                antidep201305, diabetes201305, dementia201305))
# 
# 
# write.csv(prescribemaster201305, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201305.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201304 <- read_csv("H:/prescription data/T201304PDPI BNFT.csv")
# prescribe201304$drugcode <- parse_number(prescribe201304$`BNF CODE`)
# prescribe201304$drugcode <- substr(prescribe201304$drugcode, 0, 6)
# antidep201304 <- prescribe201304[which(prescribe201304$drugcode>=403000&prescribe201304$drugcode<404000),]
# obesedrugs201304 <- prescribe201304[which(prescribe201304$drugcode>=405000&prescribe201304$drugcode<406000),]
# allsubstancedep201304 <- prescribe201304[which(prescribe201304$drugcode>=410000&prescribe201304$drugcode<411000),]
# alcoholdep201304 <- prescribe201304[which(prescribe201304$drugcode>=410010&prescribe201304$drugcode<410020),]
# nicotinedep201304 <- prescribe201304[which(prescribe201304$drugcode>=410020&prescribe201304$drugcode<410030),]
# opioddep201304 <- prescribe201304[which(prescribe201304$drugcode>=410030&prescribe201304$drugcode<411000),]
# bronchodilators201304 <- prescribe201304[which(prescribe201304$drugcode>=310000&prescribe201304$drugcode<320000),]
# dementia201304 <- prescribe201304[which(prescribe201304$drugcode>=411000&prescribe201304$drugcode<500000),]
# diabetes201304 <- prescribe201304[which(prescribe201304$drugcode>=601000&prescribe201304$drugcode<602000),]
# 
# antidep201304 <- aggregate(antidep201304[-c(1:5, 11)], antidep201304["PRACTICE"], sum)
# antidep201304$PERIOD <- 201304
# antidep201304$Druggroup <- "Antidepressant"
# dementia201304 <- aggregate(dementia201304[-c(1:5, 11)], dementia201304["PRACTICE"], sum)
# dementia201304$PERIOD <- 201304
# dementia201304$Druggroup <- "Dementia"
# diabetes201304 <- aggregate(diabetes201304[-c(1:5, 11)], diabetes201304["PRACTICE"], sum)
# diabetes201304$PERIOD <- 201304
# diabetes201304$Druggroup <- "Diabetes"
# 
# bronchodilators201304 <- aggregate(bronchodilators201304[-c(1:5, 11)], bronchodilators201304["PRACTICE"], sum)
# bronchodilators201304$PERIOD <- 201304
# bronchodilators201304$Druggroup <- "Bronchodilators"
# opioddep201304 <- aggregate(opioddep201304[-c(1:5, 11)], opioddep201304["PRACTICE"], sum)
# opioddep201304$PERIOD <- 201304
# opioddep201304$Druggroup <- "Opiod"
# nicotinedep201304 <- aggregate(nicotinedep201304[-c(1:5, 11)], nicotinedep201304["PRACTICE"], sum)
# nicotinedep201304$PERIOD <- 201304
# nicotinedep201304$Druggroup <- "Nicotine"
# alcoholdep201304 <- aggregate(alcoholdep201304[-c(1:5, 11)], alcoholdep201304["PRACTICE"], sum)
# alcoholdep201304$PERIOD <- 201304
# alcoholdep201304$Druggroup <- "Alcohol"
# allsubstancedep201304 <- aggregate(allsubstancedep201304[-c(1:5, 11)], allsubstancedep201304["PRACTICE"], sum)
# allsubstancedep201304$PERIOD <- 201304
# allsubstancedep201304$Druggroup <- "SubstanceDep"
# obesedrugs201304 <- aggregate(obesedrugs201304[-c(1:5, 11)], obesedrugs201304["PRACTICE"], sum)
# obesedrugs201304$PERIOD <- 201304
# obesedrugs201304$Druggroup <- "Obesity"
# 
# prescribemaster201304 <- do.call("rbind", list(obesedrugs201304, allsubstancedep201304, alcoholdep201304, 
#                                                nicotinedep201304,opioddep201304, bronchodilators201304,
#                                                antidep201304, diabetes201304, dementia201304))
# 
# 
# write.csv(prescribemaster201304, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201304.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201303 <- read_csv("H:/prescription data/T201303PDPI BNFT.csv")
# prescribe201303$drugcode <- parse_number(prescribe201303$`BNF CODE`)
# prescribe201303$drugcode <- substr(prescribe201303$drugcode, 0, 6)
# antidep201303 <- prescribe201303[which(prescribe201303$drugcode>=403000&prescribe201303$drugcode<404000),]
# obesedrugs201303 <- prescribe201303[which(prescribe201303$drugcode>=405000&prescribe201303$drugcode<406000),]
# allsubstancedep201303 <- prescribe201303[which(prescribe201303$drugcode>=410000&prescribe201303$drugcode<411000),]
# alcoholdep201303 <- prescribe201303[which(prescribe201303$drugcode>=410010&prescribe201303$drugcode<410020),]
# nicotinedep201303 <- prescribe201303[which(prescribe201303$drugcode>=410020&prescribe201303$drugcode<410030),]
# opioddep201303 <- prescribe201303[which(prescribe201303$drugcode>=410030&prescribe201303$drugcode<411000),]
# bronchodilators201303 <- prescribe201303[which(prescribe201303$drugcode>=310000&prescribe201303$drugcode<320000),]
# dementia201303 <- prescribe201303[which(prescribe201303$drugcode>=411000&prescribe201303$drugcode<500000),]
# diabetes201303 <- prescribe201303[which(prescribe201303$drugcode>=601000&prescribe201303$drugcode<602000),]
# 
# antidep201303 <- aggregate(antidep201303[-c(1:5, 11)], antidep201303["PRACTICE"], sum)
# antidep201303$PERIOD <- 201303
# antidep201303$Druggroup <- "Antidepressant"
# dementia201303 <- aggregate(dementia201303[-c(1:5, 11)], dementia201303["PRACTICE"], sum)
# dementia201303$PERIOD <- 201303
# dementia201303$Druggroup <- "Dementia"
# diabetes201303 <- aggregate(diabetes201303[-c(1:5, 11)], diabetes201303["PRACTICE"], sum)
# diabetes201303$PERIOD <- 201303
# diabetes201303$Druggroup <- "Diabetes"
# 
# bronchodilators201303 <- aggregate(bronchodilators201303[-c(1:5, 11)], bronchodilators201303["PRACTICE"], sum)
# bronchodilators201303$PERIOD <- 201303
# bronchodilators201303$Druggroup <- "Bronchodilators"
# opioddep201303 <- aggregate(opioddep201303[-c(1:5, 11)], opioddep201303["PRACTICE"], sum)
# opioddep201303$PERIOD <- 201303
# opioddep201303$Druggroup <- "Opiod"
# nicotinedep201303 <- aggregate(nicotinedep201303[-c(1:5, 11)], nicotinedep201303["PRACTICE"], sum)
# nicotinedep201303$PERIOD <- 201303
# nicotinedep201303$Druggroup <- "Nicotine"
# alcoholdep201303 <- aggregate(alcoholdep201303[-c(1:5, 11)], alcoholdep201303["PRACTICE"], sum)
# alcoholdep201303$PERIOD <- 201303
# alcoholdep201303$Druggroup <- "Alcohol"
# allsubstancedep201303 <- aggregate(allsubstancedep201303[-c(1:5, 11)], allsubstancedep201303["PRACTICE"], sum)
# allsubstancedep201303$PERIOD <- 201303
# allsubstancedep201303$Druggroup <- "SubstanceDep"
# obesedrugs201303 <- aggregate(obesedrugs201303[-c(1:5, 11)], obesedrugs201303["PRACTICE"], sum)
# obesedrugs201303$PERIOD <- 201303
# obesedrugs201303$Druggroup <- "Obesity"
# 
# prescribemaster201303 <- do.call("rbind", list(obesedrugs201303, allsubstancedep201303, alcoholdep201303, 
#                                                nicotinedep201303,opioddep201303, bronchodilators201303,
#                                                antidep201303, diabetes201303, dementia201303))
# 
# 
# write.csv(prescribemaster201303, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201303.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201302 <- read_csv("H:/prescription data/T201302PDPI BNFT.csv")
# prescribe201302$drugcode <- parse_number(prescribe201302$`BNF CODE`)
# prescribe201302$drugcode <- substr(prescribe201302$drugcode, 0, 6)
# antidep201302 <- prescribe201302[which(prescribe201302$drugcode>=403000&prescribe201302$drugcode<404000),]
# obesedrugs201302 <- prescribe201302[which(prescribe201302$drugcode>=405000&prescribe201302$drugcode<406000),]
# allsubstancedep201302 <- prescribe201302[which(prescribe201302$drugcode>=410000&prescribe201302$drugcode<411000),]
# alcoholdep201302 <- prescribe201302[which(prescribe201302$drugcode>=410010&prescribe201302$drugcode<410020),]
# nicotinedep201302 <- prescribe201302[which(prescribe201302$drugcode>=410020&prescribe201302$drugcode<410030),]
# opioddep201302 <- prescribe201302[which(prescribe201302$drugcode>=410030&prescribe201302$drugcode<411000),]
# bronchodilators201302 <- prescribe201302[which(prescribe201302$drugcode>=310000&prescribe201302$drugcode<320000),]
# dementia201302 <- prescribe201302[which(prescribe201302$drugcode>=411000&prescribe201302$drugcode<500000),]
# diabetes201302 <- prescribe201302[which(prescribe201302$drugcode>=601000&prescribe201302$drugcode<602000),]
# 
# antidep201302 <- aggregate(antidep201302[-c(1:5, 11)], antidep201302["PRACTICE"], sum)
# antidep201302$PERIOD <- 201302
# antidep201302$Druggroup <- "Antidepressant"
# dementia201302 <- aggregate(dementia201302[-c(1:5, 11)], dementia201302["PRACTICE"], sum)
# dementia201302$PERIOD <- 201302
# dementia201302$Druggroup <- "Dementia"
# diabetes201302 <- aggregate(diabetes201302[-c(1:5, 11)], diabetes201302["PRACTICE"], sum)
# diabetes201302$PERIOD <- 201302
# diabetes201302$Druggroup <- "Diabetes"
# 
# bronchodilators201302 <- aggregate(bronchodilators201302[-c(1:5, 11)], bronchodilators201302["PRACTICE"], sum)
# bronchodilators201302$PERIOD <- 201302
# bronchodilators201302$Druggroup <- "Bronchodilators"
# opioddep201302 <- aggregate(opioddep201302[-c(1:5, 11)], opioddep201302["PRACTICE"], sum)
# opioddep201302$PERIOD <- 201302
# opioddep201302$Druggroup <- "Opiod"
# nicotinedep201302 <- aggregate(nicotinedep201302[-c(1:5, 11)], nicotinedep201302["PRACTICE"], sum)
# nicotinedep201302$PERIOD <- 201302
# nicotinedep201302$Druggroup <- "Nicotine"
# alcoholdep201302 <- aggregate(alcoholdep201302[-c(1:5, 11)], alcoholdep201302["PRACTICE"], sum)
# alcoholdep201302$PERIOD <- 201302
# alcoholdep201302$Druggroup <- "Alcohol"
# allsubstancedep201302 <- aggregate(allsubstancedep201302[-c(1:5, 11)], allsubstancedep201302["PRACTICE"], sum)
# allsubstancedep201302$PERIOD <- 201302
# allsubstancedep201302$Druggroup <- "SubstanceDep"
# obesedrugs201302 <- aggregate(obesedrugs201302[-c(1:5, 11)], obesedrugs201302["PRACTICE"], sum)
# obesedrugs201302$PERIOD <- 201302
# obesedrugs201302$Druggroup <- "Obesity"
# 
# prescribemaster201302 <- do.call("rbind", list(obesedrugs201302, allsubstancedep201302, alcoholdep201302, 
#                                                nicotinedep201302,opioddep201302, bronchodilators201302,
#                                                antidep201302, diabetes201302, dementia201302))
# 
# 
# write.csv(prescribemaster201302, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201302.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201301 <- read_csv("H:/prescription data/T201301PDPI BNFT.csv")
# prescribe201301$drugcode <- parse_number(prescribe201301$`BNF CODE`)
# prescribe201301$drugcode <- substr(prescribe201301$drugcode, 0, 6)
# antidep201301 <- prescribe201301[which(prescribe201301$drugcode>=403000&prescribe201301$drugcode<404000),]
# obesedrugs201301 <- prescribe201301[which(prescribe201301$drugcode>=405000&prescribe201301$drugcode<406000),]
# allsubstancedep201301 <- prescribe201301[which(prescribe201301$drugcode>=410000&prescribe201301$drugcode<411000),]
# alcoholdep201301 <- prescribe201301[which(prescribe201301$drugcode>=410010&prescribe201301$drugcode<410020),]
# nicotinedep201301 <- prescribe201301[which(prescribe201301$drugcode>=410020&prescribe201301$drugcode<410030),]
# opioddep201301 <- prescribe201301[which(prescribe201301$drugcode>=410030&prescribe201301$drugcode<411000),]
# bronchodilators201301 <- prescribe201301[which(prescribe201301$drugcode>=310000&prescribe201301$drugcode<320000),]
# dementia201301 <- prescribe201301[which(prescribe201301$drugcode>=411000&prescribe201301$drugcode<500000),]
# diabetes201301 <- prescribe201301[which(prescribe201301$drugcode>=601000&prescribe201301$drugcode<602000),]
# 
# antidep201301 <- aggregate(antidep201301[-c(1:5, 11)], antidep201301["PRACTICE"], sum)
# antidep201301$PERIOD <- 201301
# antidep201301$Druggroup <- "Antidepressant"
# dementia201301 <- aggregate(dementia201301[-c(1:5, 11)], dementia201301["PRACTICE"], sum)
# dementia201301$PERIOD <- 201301
# dementia201301$Druggroup <- "Dementia"
# diabetes201301 <- aggregate(diabetes201301[-c(1:5, 11)], diabetes201301["PRACTICE"], sum)
# diabetes201301$PERIOD <- 201301
# diabetes201301$Druggroup <- "Diabetes"
# 
# bronchodilators201301 <- aggregate(bronchodilators201301[-c(1:5, 11)], bronchodilators201301["PRACTICE"], sum)
# bronchodilators201301$PERIOD <- 201301
# bronchodilators201301$Druggroup <- "Bronchodilators"
# opioddep201301 <- aggregate(opioddep201301[-c(1:5, 11)], opioddep201301["PRACTICE"], sum)
# opioddep201301$PERIOD <- 201301
# opioddep201301$Druggroup <- "Opiod"
# nicotinedep201301 <- aggregate(nicotinedep201301[-c(1:5, 11)], nicotinedep201301["PRACTICE"], sum)
# nicotinedep201301$PERIOD <- 201301
# nicotinedep201301$Druggroup <- "Nicotine"
# alcoholdep201301 <- aggregate(alcoholdep201301[-c(1:5, 11)], alcoholdep201301["PRACTICE"], sum)
# alcoholdep201301$PERIOD <- 201301
# alcoholdep201301$Druggroup <- "Alcohol"
# allsubstancedep201301 <- aggregate(allsubstancedep201301[-c(1:5, 11)], allsubstancedep201301["PRACTICE"], sum)
# allsubstancedep201301$PERIOD <- 201301
# allsubstancedep201301$Druggroup <- "SubstanceDep"
# obesedrugs201301 <- aggregate(obesedrugs201301[-c(1:5, 11)], obesedrugs201301["PRACTICE"], sum)
# obesedrugs201301$PERIOD <- 201301
# obesedrugs201301$Druggroup <- "Obesity"
# 
# prescribemaster201301 <- do.call("rbind", list(obesedrugs201301, allsubstancedep201301, alcoholdep201301, 
#                                                nicotinedep201301,opioddep201301, bronchodilators201301,
#                                                antidep201301, diabetes201301, dementia201301))
# 
# 
# write.csv(prescribemaster201301, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201301.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201212 <- read_csv("H:/prescription data/T201212PDPI BNFT.csv")
# prescribe201212$drugcode <- parse_number(prescribe201212$`BNF CODE`)
# prescribe201212$drugcode <- substr(prescribe201212$drugcode, 0, 6)
# antidep201212 <- prescribe201212[which(prescribe201212$drugcode>=403000&prescribe201212$drugcode<404000),]
# obesedrugs201212 <- prescribe201212[which(prescribe201212$drugcode>=405000&prescribe201212$drugcode<406000),]
# allsubstancedep201212 <- prescribe201212[which(prescribe201212$drugcode>=410000&prescribe201212$drugcode<411000),]
# alcoholdep201212 <- prescribe201212[which(prescribe201212$drugcode>=410010&prescribe201212$drugcode<410020),]
# nicotinedep201212 <- prescribe201212[which(prescribe201212$drugcode>=410020&prescribe201212$drugcode<410030),]
# opioddep201212 <- prescribe201212[which(prescribe201212$drugcode>=410030&prescribe201212$drugcode<411000),]
# bronchodilators201212 <- prescribe201212[which(prescribe201212$drugcode>=310000&prescribe201212$drugcode<320000),]
# dementia201212 <- prescribe201212[which(prescribe201212$drugcode>=411000&prescribe201212$drugcode<500000),]
# diabetes201212 <- prescribe201212[which(prescribe201212$drugcode>=601000&prescribe201212$drugcode<602000),]
# 
# antidep201212 <- aggregate(antidep201212[-c(1:5, 11)], antidep201212["PRACTICE"], sum)
# antidep201212$PERIOD <- 201212
# antidep201212$Druggroup <- "Antidepressant"
# dementia201212 <- aggregate(dementia201212[-c(1:5, 11)], dementia201212["PRACTICE"], sum)
# dementia201212$PERIOD <- 201212
# dementia201212$Druggroup <- "Dementia"
# diabetes201212 <- aggregate(diabetes201212[-c(1:5, 11)], diabetes201212["PRACTICE"], sum)
# diabetes201212$PERIOD <- 201212
# diabetes201212$Druggroup <- "Diabetes"
# 
# bronchodilators201212 <- aggregate(bronchodilators201212[-c(1:5, 11)], bronchodilators201212["PRACTICE"], sum)
# bronchodilators201212$PERIOD <- 201212
# bronchodilators201212$Druggroup <- "Bronchodilators"
# opioddep201212 <- aggregate(opioddep201212[-c(1:5, 11)], opioddep201212["PRACTICE"], sum)
# opioddep201212$PERIOD <- 201212
# opioddep201212$Druggroup <- "Opiod"
# nicotinedep201212 <- aggregate(nicotinedep201212[-c(1:5, 11)], nicotinedep201212["PRACTICE"], sum)
# nicotinedep201212$PERIOD <- 201212
# nicotinedep201212$Druggroup <- "Nicotine"
# alcoholdep201212 <- aggregate(alcoholdep201212[-c(1:5, 11)], alcoholdep201212["PRACTICE"], sum)
# alcoholdep201212$PERIOD <- 201212
# alcoholdep201212$Druggroup <- "Alcohol"
# allsubstancedep201212 <- aggregate(allsubstancedep201212[-c(1:5, 11)], allsubstancedep201212["PRACTICE"], sum)
# allsubstancedep201212$PERIOD <- 201212
# allsubstancedep201212$Druggroup <- "SubstanceDep"
# obesedrugs201212 <- aggregate(obesedrugs201212[-c(1:5, 11)], obesedrugs201212["PRACTICE"], sum)
# obesedrugs201212$PERIOD <- 201212
# obesedrugs201212$Druggroup <- "Obesity"
# 
# prescribemaster201212 <- do.call("rbind", list(obesedrugs201212, allsubstancedep201212, alcoholdep201212, 
#                                                nicotinedep201212,opioddep201212, bronchodilators201212,
#                                                antidep201212, diabetes201212, dementia201212))
# 
# 
# write.csv(prescribemaster201212, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201212.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201211 <- read_csv("H:/prescription data/T201211PDPI BNFT.csv")
# prescribe201211$drugcode <- parse_number(prescribe201211$`BNF CODE`)
# prescribe201211$drugcode <- substr(prescribe201211$drugcode, 0, 6)
# antidep201211 <- prescribe201211[which(prescribe201211$drugcode>=403000&prescribe201211$drugcode<404000),]
# obesedrugs201211 <- prescribe201211[which(prescribe201211$drugcode>=405000&prescribe201211$drugcode<406000),]
# allsubstancedep201211 <- prescribe201211[which(prescribe201211$drugcode>=410000&prescribe201211$drugcode<411000),]
# alcoholdep201211 <- prescribe201211[which(prescribe201211$drugcode>=410010&prescribe201211$drugcode<410020),]
# nicotinedep201211 <- prescribe201211[which(prescribe201211$drugcode>=410020&prescribe201211$drugcode<410030),]
# opioddep201211 <- prescribe201211[which(prescribe201211$drugcode>=410030&prescribe201211$drugcode<411000),]
# bronchodilators201211 <- prescribe201211[which(prescribe201211$drugcode>=310000&prescribe201211$drugcode<320000),]
# dementia201211 <- prescribe201211[which(prescribe201211$drugcode>=411000&prescribe201211$drugcode<500000),]
# diabetes201211 <- prescribe201211[which(prescribe201211$drugcode>=601000&prescribe201211$drugcode<602000),]
# 
# antidep201211 <- aggregate(antidep201211[-c(1:5, 11)], antidep201211["PRACTICE"], sum)
# antidep201211$PERIOD <- 201211
# antidep201211$Druggroup <- "Antidepressant"
# dementia201211 <- aggregate(dementia201211[-c(1:5, 11)], dementia201211["PRACTICE"], sum)
# dementia201211$PERIOD <- 201211
# dementia201211$Druggroup <- "Dementia"
# diabetes201211 <- aggregate(diabetes201211[-c(1:5, 11)], diabetes201211["PRACTICE"], sum)
# diabetes201211$PERIOD <- 201211
# diabetes201211$Druggroup <- "Diabetes"
# 
# bronchodilators201211 <- aggregate(bronchodilators201211[-c(1:5, 11)], bronchodilators201211["PRACTICE"], sum)
# bronchodilators201211$PERIOD <- 201211
# bronchodilators201211$Druggroup <- "Bronchodilators"
# opioddep201211 <- aggregate(opioddep201211[-c(1:5, 11)], opioddep201211["PRACTICE"], sum)
# opioddep201211$PERIOD <- 201211
# opioddep201211$Druggroup <- "Opiod"
# nicotinedep201211 <- aggregate(nicotinedep201211[-c(1:5, 11)], nicotinedep201211["PRACTICE"], sum)
# nicotinedep201211$PERIOD <- 201211
# nicotinedep201211$Druggroup <- "Nicotine"
# alcoholdep201211 <- aggregate(alcoholdep201211[-c(1:5, 11)], alcoholdep201211["PRACTICE"], sum)
# alcoholdep201211$PERIOD <- 201211
# alcoholdep201211$Druggroup <- "Alcohol"
# allsubstancedep201211 <- aggregate(allsubstancedep201211[-c(1:5, 11)], allsubstancedep201211["PRACTICE"], sum)
# allsubstancedep201211$PERIOD <- 201211
# allsubstancedep201211$Druggroup <- "SubstanceDep"
# obesedrugs201211 <- aggregate(obesedrugs201211[-c(1:5, 11)], obesedrugs201211["PRACTICE"], sum)
# obesedrugs201211$PERIOD <- 201211
# obesedrugs201211$Druggroup <- "Obesity"
# 
# prescribemaster201211 <- do.call("rbind", list(obesedrugs201211, allsubstancedep201211, alcoholdep201211, 
#                                                nicotinedep201211,opioddep201211, bronchodilators201211,
#                                                antidep201211, diabetes201211, dementia201211))
# 
# 
# write.csv(prescribemaster201211, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201211.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201210 <- read_csv("H:/prescription data/T201210PDPI BNFT.csv")
# prescribe201210$drugcode <- parse_number(prescribe201210$`BNF CODE`)
# prescribe201210$drugcode <- substr(prescribe201210$drugcode, 0, 6)
# antidep201210 <- prescribe201210[which(prescribe201210$drugcode>=403000&prescribe201210$drugcode<404000),]
# obesedrugs201210 <- prescribe201210[which(prescribe201210$drugcode>=405000&prescribe201210$drugcode<406000),]
# allsubstancedep201210 <- prescribe201210[which(prescribe201210$drugcode>=410000&prescribe201210$drugcode<411000),]
# alcoholdep201210 <- prescribe201210[which(prescribe201210$drugcode>=410010&prescribe201210$drugcode<410020),]
# nicotinedep201210 <- prescribe201210[which(prescribe201210$drugcode>=410020&prescribe201210$drugcode<410030),]
# opioddep201210 <- prescribe201210[which(prescribe201210$drugcode>=410030&prescribe201210$drugcode<411000),]
# bronchodilators201210 <- prescribe201210[which(prescribe201210$drugcode>=310000&prescribe201210$drugcode<320000),]
# dementia201210 <- prescribe201210[which(prescribe201210$drugcode>=411000&prescribe201210$drugcode<500000),]
# diabetes201210 <- prescribe201210[which(prescribe201210$drugcode>=601000&prescribe201210$drugcode<602000),]
# 
# antidep201210 <- aggregate(antidep201210[-c(1:5, 11)], antidep201210["PRACTICE"], sum)
# antidep201210$PERIOD <- 201210
# antidep201210$Druggroup <- "Antidepressant"
# dementia201210 <- aggregate(dementia201210[-c(1:5, 11)], dementia201210["PRACTICE"], sum)
# dementia201210$PERIOD <- 201210
# dementia201210$Druggroup <- "Dementia"
# diabetes201210 <- aggregate(diabetes201210[-c(1:5, 11)], diabetes201210["PRACTICE"], sum)
# diabetes201210$PERIOD <- 201210
# diabetes201210$Druggroup <- "Diabetes"
# 
# bronchodilators201210 <- aggregate(bronchodilators201210[-c(1:5, 11)], bronchodilators201210["PRACTICE"], sum)
# bronchodilators201210$PERIOD <- 201210
# bronchodilators201210$Druggroup <- "Bronchodilators"
# opioddep201210 <- aggregate(opioddep201210[-c(1:5, 11)], opioddep201210["PRACTICE"], sum)
# opioddep201210$PERIOD <- 201210
# opioddep201210$Druggroup <- "Opiod"
# nicotinedep201210 <- aggregate(nicotinedep201210[-c(1:5, 11)], nicotinedep201210["PRACTICE"], sum)
# nicotinedep201210$PERIOD <- 201210
# nicotinedep201210$Druggroup <- "Nicotine"
# alcoholdep201210 <- aggregate(alcoholdep201210[-c(1:5, 11)], alcoholdep201210["PRACTICE"], sum)
# alcoholdep201210$PERIOD <- 201210
# alcoholdep201210$Druggroup <- "Alcohol"
# allsubstancedep201210 <- aggregate(allsubstancedep201210[-c(1:5, 11)], allsubstancedep201210["PRACTICE"], sum)
# allsubstancedep201210$PERIOD <- 201210
# allsubstancedep201210$Druggroup <- "SubstanceDep"
# obesedrugs201210 <- aggregate(obesedrugs201210[-c(1:5, 11)], obesedrugs201210["PRACTICE"], sum)
# obesedrugs201210$PERIOD <- 201210
# obesedrugs201210$Druggroup <- "Obesity"
# 
# prescribemaster201210 <- do.call("rbind", list(obesedrugs201210, allsubstancedep201210, alcoholdep201210, 
#                                                nicotinedep201210,opioddep201210, bronchodilators201210,
#                                                antidep201210, diabetes201210, dementia201210))
# 
# 
# write.csv(prescribemaster201210, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201210.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201209 <- read_csv("H:/prescription data/T201209PDPI BNFT.csv")
# prescribe201209$drugcode <- parse_number(prescribe201209$`BNF CODE`)
# prescribe201209$drugcode <- substr(prescribe201209$drugcode, 0, 6)
# antidep201209 <- prescribe201209[which(prescribe201209$drugcode>=403000&prescribe201209$drugcode<404000),]
# obesedrugs201209 <- prescribe201209[which(prescribe201209$drugcode>=405000&prescribe201209$drugcode<406000),]
# allsubstancedep201209 <- prescribe201209[which(prescribe201209$drugcode>=410000&prescribe201209$drugcode<411000),]
# alcoholdep201209 <- prescribe201209[which(prescribe201209$drugcode>=410010&prescribe201209$drugcode<410020),]
# nicotinedep201209 <- prescribe201209[which(prescribe201209$drugcode>=410020&prescribe201209$drugcode<410030),]
# opioddep201209 <- prescribe201209[which(prescribe201209$drugcode>=410030&prescribe201209$drugcode<411000),]
# bronchodilators201209 <- prescribe201209[which(prescribe201209$drugcode>=310000&prescribe201209$drugcode<320000),]
# dementia201209 <- prescribe201209[which(prescribe201209$drugcode>=411000&prescribe201209$drugcode<500000),]
# diabetes201209 <- prescribe201209[which(prescribe201209$drugcode>=601000&prescribe201209$drugcode<602000),]
# 
# antidep201209 <- aggregate(antidep201209[-c(1:5, 11)], antidep201209["PRACTICE"], sum)
# antidep201209$PERIOD <- 201209
# antidep201209$Druggroup <- "Antidepressant"
# dementia201209 <- aggregate(dementia201209[-c(1:5, 11)], dementia201209["PRACTICE"], sum)
# dementia201209$PERIOD <- 201209
# dementia201209$Druggroup <- "Dementia"
# diabetes201209 <- aggregate(diabetes201209[-c(1:5, 11)], diabetes201209["PRACTICE"], sum)
# diabetes201209$PERIOD <- 201209
# diabetes201209$Druggroup <- "Diabetes"
# 
# bronchodilators201209 <- aggregate(bronchodilators201209[-c(1:5, 11)], bronchodilators201209["PRACTICE"], sum)
# bronchodilators201209$PERIOD <- 201209
# bronchodilators201209$Druggroup <- "Bronchodilators"
# opioddep201209 <- aggregate(opioddep201209[-c(1:5, 11)], opioddep201209["PRACTICE"], sum)
# opioddep201209$PERIOD <- 201209
# opioddep201209$Druggroup <- "Opiod"
# nicotinedep201209 <- aggregate(nicotinedep201209[-c(1:5, 11)], nicotinedep201209["PRACTICE"], sum)
# nicotinedep201209$PERIOD <- 201209
# nicotinedep201209$Druggroup <- "Nicotine"
# alcoholdep201209 <- aggregate(alcoholdep201209[-c(1:5, 11)], alcoholdep201209["PRACTICE"], sum)
# alcoholdep201209$PERIOD <- 201209
# alcoholdep201209$Druggroup <- "Alcohol"
# allsubstancedep201209 <- aggregate(allsubstancedep201209[-c(1:5, 11)], allsubstancedep201209["PRACTICE"], sum)
# allsubstancedep201209$PERIOD <- 201209
# allsubstancedep201209$Druggroup <- "SubstanceDep"
# obesedrugs201209 <- aggregate(obesedrugs201209[-c(1:5, 11)], obesedrugs201209["PRACTICE"], sum)
# obesedrugs201209$PERIOD <- 201209
# obesedrugs201209$Druggroup <- "Obesity"
# 
# prescribemaster201209 <- do.call("rbind", list(obesedrugs201209, allsubstancedep201209, alcoholdep201209, 
#                                                nicotinedep201209,opioddep201209, bronchodilators201209,
#                                                antidep201209, diabetes201209, dementia201209))
# 
# 
# write.csv(prescribemaster201209, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201209.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201208 <- read_csv("H:/prescription data/T201208PDPI BNFT.csv")
# prescribe201208$drugcode <- parse_number(prescribe201208$`BNF CODE`)
# prescribe201208$drugcode <- substr(prescribe201208$drugcode, 0, 6)
# antidep201208 <- prescribe201208[which(prescribe201208$drugcode>=403000&prescribe201208$drugcode<404000),]
# obesedrugs201208 <- prescribe201208[which(prescribe201208$drugcode>=405000&prescribe201208$drugcode<406000),]
# allsubstancedep201208 <- prescribe201208[which(prescribe201208$drugcode>=410000&prescribe201208$drugcode<411000),]
# alcoholdep201208 <- prescribe201208[which(prescribe201208$drugcode>=410010&prescribe201208$drugcode<410020),]
# nicotinedep201208 <- prescribe201208[which(prescribe201208$drugcode>=410020&prescribe201208$drugcode<410030),]
# opioddep201208 <- prescribe201208[which(prescribe201208$drugcode>=410030&prescribe201208$drugcode<411000),]
# bronchodilators201208 <- prescribe201208[which(prescribe201208$drugcode>=310000&prescribe201208$drugcode<320000),]
# dementia201208 <- prescribe201208[which(prescribe201208$drugcode>=411000&prescribe201208$drugcode<500000),]
# diabetes201208 <- prescribe201208[which(prescribe201208$drugcode>=601000&prescribe201208$drugcode<602000),]
# 
# antidep201208 <- aggregate(antidep201208[-c(1:5, 11)], antidep201208["PRACTICE"], sum)
# antidep201208$PERIOD <- 201208
# antidep201208$Druggroup <- "Antidepressant"
# dementia201208 <- aggregate(dementia201208[-c(1:5, 11)], dementia201208["PRACTICE"], sum)
# dementia201208$PERIOD <- 201208
# dementia201208$Druggroup <- "Dementia"
# diabetes201208 <- aggregate(diabetes201208[-c(1:5, 11)], diabetes201208["PRACTICE"], sum)
# diabetes201208$PERIOD <- 201208
# diabetes201208$Druggroup <- "Diabetes"
# 
# bronchodilators201208 <- aggregate(bronchodilators201208[-c(1:5, 11)], bronchodilators201208["PRACTICE"], sum)
# bronchodilators201208$PERIOD <- 201208
# bronchodilators201208$Druggroup <- "Bronchodilators"
# opioddep201208 <- aggregate(opioddep201208[-c(1:5, 11)], opioddep201208["PRACTICE"], sum)
# opioddep201208$PERIOD <- 201208
# opioddep201208$Druggroup <- "Opiod"
# nicotinedep201208 <- aggregate(nicotinedep201208[-c(1:5, 11)], nicotinedep201208["PRACTICE"], sum)
# nicotinedep201208$PERIOD <- 201208
# nicotinedep201208$Druggroup <- "Nicotine"
# alcoholdep201208 <- aggregate(alcoholdep201208[-c(1:5, 11)], alcoholdep201208["PRACTICE"], sum)
# alcoholdep201208$PERIOD <- 201208
# alcoholdep201208$Druggroup <- "Alcohol"
# allsubstancedep201208 <- aggregate(allsubstancedep201208[-c(1:5, 11)], allsubstancedep201208["PRACTICE"], sum)
# allsubstancedep201208$PERIOD <- 201208
# allsubstancedep201208$Druggroup <- "SubstanceDep"
# obesedrugs201208 <- aggregate(obesedrugs201208[-c(1:5, 11)], obesedrugs201208["PRACTICE"], sum)
# obesedrugs201208$PERIOD <- 201208
# obesedrugs201208$Druggroup <- "Obesity"
# 
# prescribemaster201208 <- do.call("rbind", list(obesedrugs201208, allsubstancedep201208, alcoholdep201208, 
#                                                nicotinedep201208,opioddep201208, bronchodilators201208,
#                                                antidep201208, diabetes201208, dementia201208))
# 
# 
# write.csv(prescribemaster201208, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201208.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201207 <- read_csv("H:/prescription data/T201207PDPI BNFT.csv")
# prescribe201207$drugcode <- parse_number(prescribe201207$`BNF CODE`)
# prescribe201207$drugcode <- substr(prescribe201207$drugcode, 0, 6)
# antidep201207 <- prescribe201207[which(prescribe201207$drugcode>=403000&prescribe201207$drugcode<404000),]
# obesedrugs201207 <- prescribe201207[which(prescribe201207$drugcode>=405000&prescribe201207$drugcode<406000),]
# allsubstancedep201207 <- prescribe201207[which(prescribe201207$drugcode>=410000&prescribe201207$drugcode<411000),]
# alcoholdep201207 <- prescribe201207[which(prescribe201207$drugcode>=410010&prescribe201207$drugcode<410020),]
# nicotinedep201207 <- prescribe201207[which(prescribe201207$drugcode>=410020&prescribe201207$drugcode<410030),]
# opioddep201207 <- prescribe201207[which(prescribe201207$drugcode>=410030&prescribe201207$drugcode<411000),]
# bronchodilators201207 <- prescribe201207[which(prescribe201207$drugcode>=310000&prescribe201207$drugcode<320000),]
# dementia201207 <- prescribe201207[which(prescribe201207$drugcode>=411000&prescribe201207$drugcode<500000),]
# diabetes201207 <- prescribe201207[which(prescribe201207$drugcode>=601000&prescribe201207$drugcode<602000),]
# 
# antidep201207 <- aggregate(antidep201207[-c(1:5, 11)], antidep201207["PRACTICE"], sum)
# antidep201207$PERIOD <- 201207
# antidep201207$Druggroup <- "Antidepressant"
# dementia201207 <- aggregate(dementia201207[-c(1:5, 11)], dementia201207["PRACTICE"], sum)
# dementia201207$PERIOD <- 201207
# dementia201207$Druggroup <- "Dementia"
# diabetes201207 <- aggregate(diabetes201207[-c(1:5, 11)], diabetes201207["PRACTICE"], sum)
# diabetes201207$PERIOD <- 201207
# diabetes201207$Druggroup <- "Diabetes"
# 
# bronchodilators201207 <- aggregate(bronchodilators201207[-c(1:5, 11)], bronchodilators201207["PRACTICE"], sum)
# bronchodilators201207$PERIOD <- 201207
# bronchodilators201207$Druggroup <- "Bronchodilators"
# opioddep201207 <- aggregate(opioddep201207[-c(1:5, 11)], opioddep201207["PRACTICE"], sum)
# opioddep201207$PERIOD <- 201207
# opioddep201207$Druggroup <- "Opiod"
# nicotinedep201207 <- aggregate(nicotinedep201207[-c(1:5, 11)], nicotinedep201207["PRACTICE"], sum)
# nicotinedep201207$PERIOD <- 201207
# nicotinedep201207$Druggroup <- "Nicotine"
# alcoholdep201207 <- aggregate(alcoholdep201207[-c(1:5, 11)], alcoholdep201207["PRACTICE"], sum)
# alcoholdep201207$PERIOD <- 201207
# alcoholdep201207$Druggroup <- "Alcohol"
# allsubstancedep201207 <- aggregate(allsubstancedep201207[-c(1:5, 11)], allsubstancedep201207["PRACTICE"], sum)
# allsubstancedep201207$PERIOD <- 201207
# allsubstancedep201207$Druggroup <- "SubstanceDep"
# obesedrugs201207 <- aggregate(obesedrugs201207[-c(1:5, 11)], obesedrugs201207["PRACTICE"], sum)
# obesedrugs201207$PERIOD <- 201207
# obesedrugs201207$Druggroup <- "Obesity"
# 
# prescribemaster201207 <- do.call("rbind", list(obesedrugs201207, allsubstancedep201207, alcoholdep201207, 
#                                                nicotinedep201207,opioddep201207, bronchodilators201207,
#                                                antidep201207, diabetes201207, dementia201207))
# 
# 
# write.csv(prescribemaster201207, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201207.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201206 <- read_csv("H:/prescription data/T201206PDPI BNFT.csv")
# prescribe201206$drugcode <- parse_number(prescribe201206$`BNF CODE`)
# prescribe201206$drugcode <- substr(prescribe201206$drugcode, 0, 6)
# antidep201206 <- prescribe201206[which(prescribe201206$drugcode>=403000&prescribe201206$drugcode<404000),]
# obesedrugs201206 <- prescribe201206[which(prescribe201206$drugcode>=405000&prescribe201206$drugcode<406000),]
# allsubstancedep201206 <- prescribe201206[which(prescribe201206$drugcode>=410000&prescribe201206$drugcode<411000),]
# alcoholdep201206 <- prescribe201206[which(prescribe201206$drugcode>=410010&prescribe201206$drugcode<410020),]
# nicotinedep201206 <- prescribe201206[which(prescribe201206$drugcode>=410020&prescribe201206$drugcode<410030),]
# opioddep201206 <- prescribe201206[which(prescribe201206$drugcode>=410030&prescribe201206$drugcode<411000),]
# bronchodilators201206 <- prescribe201206[which(prescribe201206$drugcode>=310000&prescribe201206$drugcode<320000),]
# dementia201206 <- prescribe201206[which(prescribe201206$drugcode>=411000&prescribe201206$drugcode<500000),]
# diabetes201206 <- prescribe201206[which(prescribe201206$drugcode>=601000&prescribe201206$drugcode<602000),]
# 
# antidep201206 <- aggregate(antidep201206[-c(1:5, 11)], antidep201206["PRACTICE"], sum)
# antidep201206$PERIOD <- 201206
# antidep201206$Druggroup <- "Antidepressant"
# dementia201206 <- aggregate(dementia201206[-c(1:5, 11)], dementia201206["PRACTICE"], sum)
# dementia201206$PERIOD <- 201206
# dementia201206$Druggroup <- "Dementia"
# diabetes201206 <- aggregate(diabetes201206[-c(1:5, 11)], diabetes201206["PRACTICE"], sum)
# diabetes201206$PERIOD <- 201206
# diabetes201206$Druggroup <- "Diabetes"
# 
# bronchodilators201206 <- aggregate(bronchodilators201206[-c(1:5, 11)], bronchodilators201206["PRACTICE"], sum)
# bronchodilators201206$PERIOD <- 201206
# bronchodilators201206$Druggroup <- "Bronchodilators"
# opioddep201206 <- aggregate(opioddep201206[-c(1:5, 11)], opioddep201206["PRACTICE"], sum)
# opioddep201206$PERIOD <- 201206
# opioddep201206$Druggroup <- "Opiod"
# nicotinedep201206 <- aggregate(nicotinedep201206[-c(1:5, 11)], nicotinedep201206["PRACTICE"], sum)
# nicotinedep201206$PERIOD <- 201206
# nicotinedep201206$Druggroup <- "Nicotine"
# alcoholdep201206 <- aggregate(alcoholdep201206[-c(1:5, 11)], alcoholdep201206["PRACTICE"], sum)
# alcoholdep201206$PERIOD <- 201206
# alcoholdep201206$Druggroup <- "Alcohol"
# allsubstancedep201206 <- aggregate(allsubstancedep201206[-c(1:5, 11)], allsubstancedep201206["PRACTICE"], sum)
# allsubstancedep201206$PERIOD <- 201206
# allsubstancedep201206$Druggroup <- "SubstanceDep"
# obesedrugs201206 <- aggregate(obesedrugs201206[-c(1:5, 11)], obesedrugs201206["PRACTICE"], sum)
# obesedrugs201206$PERIOD <- 201206
# obesedrugs201206$Druggroup <- "Obesity"
# 
# prescribemaster201206 <- do.call("rbind", list(obesedrugs201206, allsubstancedep201206, alcoholdep201206, 
#                                                nicotinedep201206,opioddep201206, bronchodilators201206,
#                                                antidep201206, diabetes201206, dementia201206))
# 
# 
# write.csv(prescribemaster201206, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201206.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201205 <- read_csv("H:/prescription data/T201205PDPI BNFT.csv")
# prescribe201205$drugcode <- parse_number(prescribe201205$`BNF CODE`)
# prescribe201205$drugcode <- substr(prescribe201205$drugcode, 0, 6)
# antidep201205 <- prescribe201205[which(prescribe201205$drugcode>=403000&prescribe201205$drugcode<404000),]
# obesedrugs201205 <- prescribe201205[which(prescribe201205$drugcode>=405000&prescribe201205$drugcode<406000),]
# allsubstancedep201205 <- prescribe201205[which(prescribe201205$drugcode>=410000&prescribe201205$drugcode<411000),]
# alcoholdep201205 <- prescribe201205[which(prescribe201205$drugcode>=410010&prescribe201205$drugcode<410020),]
# nicotinedep201205 <- prescribe201205[which(prescribe201205$drugcode>=410020&prescribe201205$drugcode<410030),]
# opioddep201205 <- prescribe201205[which(prescribe201205$drugcode>=410030&prescribe201205$drugcode<411000),]
# bronchodilators201205 <- prescribe201205[which(prescribe201205$drugcode>=310000&prescribe201205$drugcode<320000),]
# dementia201205 <- prescribe201205[which(prescribe201205$drugcode>=411000&prescribe201205$drugcode<500000),]
# diabetes201205 <- prescribe201205[which(prescribe201205$drugcode>=601000&prescribe201205$drugcode<602000),]
# 
# antidep201205 <- aggregate(antidep201205[-c(1:5, 11)], antidep201205["PRACTICE"], sum)
# antidep201205$PERIOD <- 201205
# antidep201205$Druggroup <- "Antidepressant"
# dementia201205 <- aggregate(dementia201205[-c(1:5, 11)], dementia201205["PRACTICE"], sum)
# dementia201205$PERIOD <- 201205
# dementia201205$Druggroup <- "Dementia"
# diabetes201205 <- aggregate(diabetes201205[-c(1:5, 11)], diabetes201205["PRACTICE"], sum)
# diabetes201205$PERIOD <- 201205
# diabetes201205$Druggroup <- "Diabetes"
# 
# bronchodilators201205 <- aggregate(bronchodilators201205[-c(1:5, 11)], bronchodilators201205["PRACTICE"], sum)
# bronchodilators201205$PERIOD <- 201205
# bronchodilators201205$Druggroup <- "Bronchodilators"
# opioddep201205 <- aggregate(opioddep201205[-c(1:5, 11)], opioddep201205["PRACTICE"], sum)
# opioddep201205$PERIOD <- 201205
# opioddep201205$Druggroup <- "Opiod"
# nicotinedep201205 <- aggregate(nicotinedep201205[-c(1:5, 11)], nicotinedep201205["PRACTICE"], sum)
# nicotinedep201205$PERIOD <- 201205
# nicotinedep201205$Druggroup <- "Nicotine"
# alcoholdep201205 <- aggregate(alcoholdep201205[-c(1:5, 11)], alcoholdep201205["PRACTICE"], sum)
# alcoholdep201205$PERIOD <- 201205
# alcoholdep201205$Druggroup <- "Alcohol"
# allsubstancedep201205 <- aggregate(allsubstancedep201205[-c(1:5, 11)], allsubstancedep201205["PRACTICE"], sum)
# allsubstancedep201205$PERIOD <- 201205
# allsubstancedep201205$Druggroup <- "SubstanceDep"
# obesedrugs201205 <- aggregate(obesedrugs201205[-c(1:5, 11)], obesedrugs201205["PRACTICE"], sum)
# obesedrugs201205$PERIOD <- 201205
# obesedrugs201205$Druggroup <- "Obesity"
# 
# prescribemaster201205 <- do.call("rbind", list(obesedrugs201205, allsubstancedep201205, alcoholdep201205, 
#                                                nicotinedep201205,opioddep201205, bronchodilators201205,
#                                                antidep201205, diabetes201205, dementia201205))
# 
# 
# write.csv(prescribemaster201205, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201205.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# 
# prescribe201204 <- read_csv("H:/prescription data/T201204PDPI BNFT.csv")
# prescribe201204$drugcode <- parse_number(prescribe201204$`BNF CODE`)
# prescribe201204$drugcode <- substr(prescribe201204$drugcode, 0, 6)
# antidep201204 <- prescribe201204[which(prescribe201204$drugcode>=403000&prescribe201204$drugcode<404000),]
# obesedrugs201204 <- prescribe201204[which(prescribe201204$drugcode>=405000&prescribe201204$drugcode<406000),]
# allsubstancedep201204 <- prescribe201204[which(prescribe201204$drugcode>=410000&prescribe201204$drugcode<411000),]
# alcoholdep201204 <- prescribe201204[which(prescribe201204$drugcode>=410010&prescribe201204$drugcode<410020),]
# nicotinedep201204 <- prescribe201204[which(prescribe201204$drugcode>=410020&prescribe201204$drugcode<410030),]
# opioddep201204 <- prescribe201204[which(prescribe201204$drugcode>=410030&prescribe201204$drugcode<411000),]
# bronchodilators201204 <- prescribe201204[which(prescribe201204$drugcode>=310000&prescribe201204$drugcode<320000),]
# dementia201204 <- prescribe201204[which(prescribe201204$drugcode>=411000&prescribe201204$drugcode<500000),]
# diabetes201204 <- prescribe201204[which(prescribe201204$drugcode>=601000&prescribe201204$drugcode<602000),]
# 
# antidep201204 <- aggregate(antidep201204[-c(1:5, 11)], antidep201204["PRACTICE"], sum)
# antidep201204$PERIOD <- 201204
# antidep201204$Druggroup <- "Antidepressant"
# dementia201204 <- aggregate(dementia201204[-c(1:5, 11)], dementia201204["PRACTICE"], sum)
# dementia201204$PERIOD <- 201204
# dementia201204$Druggroup <- "Dementia"
# diabetes201204 <- aggregate(diabetes201204[-c(1:5, 11)], diabetes201204["PRACTICE"], sum)
# diabetes201204$PERIOD <- 201204
# diabetes201204$Druggroup <- "Diabetes"
# 
# bronchodilators201204 <- aggregate(bronchodilators201204[-c(1:5, 11)], bronchodilators201204["PRACTICE"], sum)
# bronchodilators201204$PERIOD <- 201204
# bronchodilators201204$Druggroup <- "Bronchodilators"
# opioddep201204 <- aggregate(opioddep201204[-c(1:5, 11)], opioddep201204["PRACTICE"], sum)
# opioddep201204$PERIOD <- 201204
# opioddep201204$Druggroup <- "Opiod"
# nicotinedep201204 <- aggregate(nicotinedep201204[-c(1:5, 11)], nicotinedep201204["PRACTICE"], sum)
# nicotinedep201204$PERIOD <- 201204
# nicotinedep201204$Druggroup <- "Nicotine"
# alcoholdep201204 <- aggregate(alcoholdep201204[-c(1:5, 11)], alcoholdep201204["PRACTICE"], sum)
# alcoholdep201204$PERIOD <- 201204
# alcoholdep201204$Druggroup <- "Alcohol"
# allsubstancedep201204 <- aggregate(allsubstancedep201204[-c(1:5, 11)], allsubstancedep201204["PRACTICE"], sum)
# allsubstancedep201204$PERIOD <- 201204
# allsubstancedep201204$Druggroup <- "SubstanceDep"
# obesedrugs201204 <- aggregate(obesedrugs201204[-c(1:5, 11)], obesedrugs201204["PRACTICE"], sum)
# obesedrugs201204$PERIOD <- 201204
# obesedrugs201204$Druggroup <- "Obesity"
# 
# prescribemaster201204 <- do.call("rbind", list(obesedrugs201204, allsubstancedep201204, alcoholdep201204, 
#                                                nicotinedep201204,opioddep201204, bronchodilators201204,
#                                                antidep201204, diabetes201204, dementia201204))
# 
# 
# write.csv(prescribemaster201204, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201204.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201203 <- read_csv("H:/prescription data/T201203PDPI BNFT.csv")
# prescribe201203$drugcode <- parse_number(prescribe201203$`BNF CODE`)
# prescribe201203$drugcode <- substr(prescribe201203$drugcode, 0, 6)
# antidep201203 <- prescribe201203[which(prescribe201203$drugcode>=403000&prescribe201203$drugcode<404000),]
# obesedrugs201203 <- prescribe201203[which(prescribe201203$drugcode>=405000&prescribe201203$drugcode<406000),]
# allsubstancedep201203 <- prescribe201203[which(prescribe201203$drugcode>=410000&prescribe201203$drugcode<411000),]
# alcoholdep201203 <- prescribe201203[which(prescribe201203$drugcode>=410010&prescribe201203$drugcode<410020),]
# nicotinedep201203 <- prescribe201203[which(prescribe201203$drugcode>=410020&prescribe201203$drugcode<410030),]
# opioddep201203 <- prescribe201203[which(prescribe201203$drugcode>=410030&prescribe201203$drugcode<411000),]
# bronchodilators201203 <- prescribe201203[which(prescribe201203$drugcode>=310000&prescribe201203$drugcode<320000),]
# dementia201203 <- prescribe201203[which(prescribe201203$drugcode>=411000&prescribe201203$drugcode<500000),]
# diabetes201203 <- prescribe201203[which(prescribe201203$drugcode>=601000&prescribe201203$drugcode<602000),]
# 
# antidep201203 <- aggregate(antidep201203[-c(1:5, 11)], antidep201203["PRACTICE"], sum)
# antidep201203$PERIOD <- 201203
# antidep201203$Druggroup <- "Antidepressant"
# dementia201203 <- aggregate(dementia201203[-c(1:5, 11)], dementia201203["PRACTICE"], sum)
# dementia201203$PERIOD <- 201203
# dementia201203$Druggroup <- "Dementia"
# diabetes201203 <- aggregate(diabetes201203[-c(1:5, 11)], diabetes201203["PRACTICE"], sum)
# diabetes201203$PERIOD <- 201203
# diabetes201203$Druggroup <- "Diabetes"
# 
# bronchodilators201203 <- aggregate(bronchodilators201203[-c(1:5, 11)], bronchodilators201203["PRACTICE"], sum)
# bronchodilators201203$PERIOD <- 201203
# bronchodilators201203$Druggroup <- "Bronchodilators"
# opioddep201203 <- aggregate(opioddep201203[-c(1:5, 11)], opioddep201203["PRACTICE"], sum)
# opioddep201203$PERIOD <- 201203
# opioddep201203$Druggroup <- "Opiod"
# nicotinedep201203 <- aggregate(nicotinedep201203[-c(1:5, 11)], nicotinedep201203["PRACTICE"], sum)
# nicotinedep201203$PERIOD <- 201203
# nicotinedep201203$Druggroup <- "Nicotine"
# alcoholdep201203 <- aggregate(alcoholdep201203[-c(1:5, 11)], alcoholdep201203["PRACTICE"], sum)
# alcoholdep201203$PERIOD <- 201203
# alcoholdep201203$Druggroup <- "Alcohol"
# allsubstancedep201203 <- aggregate(allsubstancedep201203[-c(1:5, 11)], allsubstancedep201203["PRACTICE"], sum)
# allsubstancedep201203$PERIOD <- 201203
# allsubstancedep201203$Druggroup <- "SubstanceDep"
# obesedrugs201203 <- aggregate(obesedrugs201203[-c(1:5, 11)], obesedrugs201203["PRACTICE"], sum)
# obesedrugs201203$PERIOD <- 201203
# obesedrugs201203$Druggroup <- "Obesity"
# 
# prescribemaster201203 <- do.call("rbind", list(obesedrugs201203, allsubstancedep201203, alcoholdep201203, 
#                                                nicotinedep201203,opioddep201203, bronchodilators201203,
#                                                antidep201203, diabetes201203, dementia201203))
# 
# 
# write.csv(prescribemaster201203, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201203.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201202 <- read_csv("H:/prescription data/T201202PDPI BNFT.csv")
# prescribe201202$drugcode <- parse_number(prescribe201202$`BNF CODE`)
# prescribe201202$drugcode <- substr(prescribe201202$drugcode, 0, 6)
# antidep201202 <- prescribe201202[which(prescribe201202$drugcode>=403000&prescribe201202$drugcode<404000),]
# obesedrugs201202 <- prescribe201202[which(prescribe201202$drugcode>=405000&prescribe201202$drugcode<406000),]
# allsubstancedep201202 <- prescribe201202[which(prescribe201202$drugcode>=410000&prescribe201202$drugcode<411000),]
# alcoholdep201202 <- prescribe201202[which(prescribe201202$drugcode>=410010&prescribe201202$drugcode<410020),]
# nicotinedep201202 <- prescribe201202[which(prescribe201202$drugcode>=410020&prescribe201202$drugcode<410030),]
# opioddep201202 <- prescribe201202[which(prescribe201202$drugcode>=410030&prescribe201202$drugcode<411000),]
# bronchodilators201202 <- prescribe201202[which(prescribe201202$drugcode>=310000&prescribe201202$drugcode<320000),]
# dementia201202 <- prescribe201202[which(prescribe201202$drugcode>=411000&prescribe201202$drugcode<500000),]
# diabetes201202 <- prescribe201202[which(prescribe201202$drugcode>=601000&prescribe201202$drugcode<602000),]
# 
# antidep201202 <- aggregate(antidep201202[-c(1:5, 11)], antidep201202["PRACTICE"], sum)
# antidep201202$PERIOD <- 201202
# antidep201202$Druggroup <- "Antidepressant"
# dementia201202 <- aggregate(dementia201202[-c(1:5, 11)], dementia201202["PRACTICE"], sum)
# dementia201202$PERIOD <- 201202
# dementia201202$Druggroup <- "Dementia"
# diabetes201202 <- aggregate(diabetes201202[-c(1:5, 11)], diabetes201202["PRACTICE"], sum)
# diabetes201202$PERIOD <- 201202
# diabetes201202$Druggroup <- "Diabetes"
# 
# bronchodilators201202 <- aggregate(bronchodilators201202[-c(1:5, 11)], bronchodilators201202["PRACTICE"], sum)
# bronchodilators201202$PERIOD <- 201202
# bronchodilators201202$Druggroup <- "Bronchodilators"
# opioddep201202 <- aggregate(opioddep201202[-c(1:5, 11)], opioddep201202["PRACTICE"], sum)
# opioddep201202$PERIOD <- 201202
# opioddep201202$Druggroup <- "Opiod"
# nicotinedep201202 <- aggregate(nicotinedep201202[-c(1:5, 11)], nicotinedep201202["PRACTICE"], sum)
# nicotinedep201202$PERIOD <- 201202
# nicotinedep201202$Druggroup <- "Nicotine"
# alcoholdep201202 <- aggregate(alcoholdep201202[-c(1:5, 11)], alcoholdep201202["PRACTICE"], sum)
# alcoholdep201202$PERIOD <- 201202
# alcoholdep201202$Druggroup <- "Alcohol"
# allsubstancedep201202 <- aggregate(allsubstancedep201202[-c(1:5, 11)], allsubstancedep201202["PRACTICE"], sum)
# allsubstancedep201202$PERIOD <- 201202
# allsubstancedep201202$Druggroup <- "SubstanceDep"
# obesedrugs201202 <- aggregate(obesedrugs201202[-c(1:5, 11)], obesedrugs201202["PRACTICE"], sum)
# obesedrugs201202$PERIOD <- 201202
# obesedrugs201202$Druggroup <- "Obesity"
# 
# prescribemaster201202 <- do.call("rbind", list(obesedrugs201202, allsubstancedep201202, alcoholdep201202, 
#                                                nicotinedep201202,opioddep201202, bronchodilators201202,
#                                                antidep201202, diabetes201202, dementia201202))
# 
# 
# write.csv(prescribemaster201202, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201202.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201201 <- read_csv("H:/prescription data/T201201PDPI BNFT.csv")
# prescribe201201$drugcode <- parse_number(prescribe201201$`BNF CODE`)
# prescribe201201$drugcode <- substr(prescribe201201$drugcode, 0, 6)
# antidep201201 <- prescribe201201[which(prescribe201201$drugcode>=403000&prescribe201201$drugcode<404000),]
# obesedrugs201201 <- prescribe201201[which(prescribe201201$drugcode>=405000&prescribe201201$drugcode<406000),]
# allsubstancedep201201 <- prescribe201201[which(prescribe201201$drugcode>=410000&prescribe201201$drugcode<411000),]
# alcoholdep201201 <- prescribe201201[which(prescribe201201$drugcode>=410010&prescribe201201$drugcode<410020),]
# nicotinedep201201 <- prescribe201201[which(prescribe201201$drugcode>=410020&prescribe201201$drugcode<410030),]
# opioddep201201 <- prescribe201201[which(prescribe201201$drugcode>=410030&prescribe201201$drugcode<411000),]
# bronchodilators201201 <- prescribe201201[which(prescribe201201$drugcode>=310000&prescribe201201$drugcode<320000),]
# dementia201201 <- prescribe201201[which(prescribe201201$drugcode>=411000&prescribe201201$drugcode<500000),]
# diabetes201201 <- prescribe201201[which(prescribe201201$drugcode>=601000&prescribe201201$drugcode<602000),]
# 
# antidep201201 <- aggregate(antidep201201[-c(1:5, 11)], antidep201201["PRACTICE"], sum)
# antidep201201$PERIOD <- 201201
# antidep201201$Druggroup <- "Antidepressant"
# dementia201201 <- aggregate(dementia201201[-c(1:5, 11)], dementia201201["PRACTICE"], sum)
# dementia201201$PERIOD <- 201201
# dementia201201$Druggroup <- "Dementia"
# diabetes201201 <- aggregate(diabetes201201[-c(1:5, 11)], diabetes201201["PRACTICE"], sum)
# diabetes201201$PERIOD <- 201201
# diabetes201201$Druggroup <- "Diabetes"
# 
# bronchodilators201201 <- aggregate(bronchodilators201201[-c(1:5, 11)], bronchodilators201201["PRACTICE"], sum)
# bronchodilators201201$PERIOD <- 201201
# bronchodilators201201$Druggroup <- "Bronchodilators"
# opioddep201201 <- aggregate(opioddep201201[-c(1:5, 11)], opioddep201201["PRACTICE"], sum)
# opioddep201201$PERIOD <- 201201
# opioddep201201$Druggroup <- "Opiod"
# nicotinedep201201 <- aggregate(nicotinedep201201[-c(1:5, 11)], nicotinedep201201["PRACTICE"], sum)
# nicotinedep201201$PERIOD <- 201201
# nicotinedep201201$Druggroup <- "Nicotine"
# alcoholdep201201 <- aggregate(alcoholdep201201[-c(1:5, 11)], alcoholdep201201["PRACTICE"], sum)
# alcoholdep201201$PERIOD <- 201201
# alcoholdep201201$Druggroup <- "Alcohol"
# allsubstancedep201201 <- aggregate(allsubstancedep201201[-c(1:5, 11)], allsubstancedep201201["PRACTICE"], sum)
# allsubstancedep201201$PERIOD <- 201201
# allsubstancedep201201$Druggroup <- "SubstanceDep"
# obesedrugs201201 <- aggregate(obesedrugs201201[-c(1:5, 11)], obesedrugs201201["PRACTICE"], sum)
# obesedrugs201201$PERIOD <- 201201
# obesedrugs201201$Druggroup <- "Obesity"
# 
# prescribemaster201201 <- do.call("rbind", list(obesedrugs201201, allsubstancedep201201, alcoholdep201201, 
#                                                nicotinedep201201,opioddep201201, bronchodilators201201,
#                                                antidep201201, diabetes201201, dementia201201))
# 
# 
# write.csv(prescribemaster201201, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201201.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201112 <- read_csv("H:/prescription data/T201112PDPI BNFT.csv")
# prescribe201112$drugcode <- parse_number(prescribe201112$`BNF CODE`)
# prescribe201112$drugcode <- substr(prescribe201112$drugcode, 0, 6)
# antidep201112 <- prescribe201112[which(prescribe201112$drugcode>=403000&prescribe201112$drugcode<404000),]
# obesedrugs201112 <- prescribe201112[which(prescribe201112$drugcode>=405000&prescribe201112$drugcode<406000),]
# allsubstancedep201112 <- prescribe201112[which(prescribe201112$drugcode>=410000&prescribe201112$drugcode<411000),]
# alcoholdep201112 <- prescribe201112[which(prescribe201112$drugcode>=410010&prescribe201112$drugcode<410020),]
# nicotinedep201112 <- prescribe201112[which(prescribe201112$drugcode>=410020&prescribe201112$drugcode<410030),]
# opioddep201112 <- prescribe201112[which(prescribe201112$drugcode>=410030&prescribe201112$drugcode<411000),]
# bronchodilators201112 <- prescribe201112[which(prescribe201112$drugcode>=310000&prescribe201112$drugcode<320000),]
# dementia201112 <- prescribe201112[which(prescribe201112$drugcode>=411000&prescribe201112$drugcode<500000),]
# diabetes201112 <- prescribe201112[which(prescribe201112$drugcode>=601000&prescribe201112$drugcode<602000),]
# 
# antidep201112 <- aggregate(antidep201112[-c(1:5, 11)], antidep201112["PRACTICE"], sum)
# antidep201112$PERIOD <- 201112
# antidep201112$Druggroup <- "Antidepressant"
# dementia201112 <- aggregate(dementia201112[-c(1:5, 11)], dementia201112["PRACTICE"], sum)
# dementia201112$PERIOD <- 201112
# dementia201112$Druggroup <- "Dementia"
# diabetes201112 <- aggregate(diabetes201112[-c(1:5, 11)], diabetes201112["PRACTICE"], sum)
# diabetes201112$PERIOD <- 201112
# diabetes201112$Druggroup <- "Diabetes"
# 
# bronchodilators201112 <- aggregate(bronchodilators201112[-c(1:5, 11)], bronchodilators201112["PRACTICE"], sum)
# bronchodilators201112$PERIOD <- 201112
# bronchodilators201112$Druggroup <- "Bronchodilators"
# opioddep201112 <- aggregate(opioddep201112[-c(1:5, 11)], opioddep201112["PRACTICE"], sum)
# opioddep201112$PERIOD <- 201112
# opioddep201112$Druggroup <- "Opiod"
# nicotinedep201112 <- aggregate(nicotinedep201112[-c(1:5, 11)], nicotinedep201112["PRACTICE"], sum)
# nicotinedep201112$PERIOD <- 201112
# nicotinedep201112$Druggroup <- "Nicotine"
# alcoholdep201112 <- aggregate(alcoholdep201112[-c(1:5, 11)], alcoholdep201112["PRACTICE"], sum)
# alcoholdep201112$PERIOD <- 201112
# alcoholdep201112$Druggroup <- "Alcohol"
# allsubstancedep201112 <- aggregate(allsubstancedep201112[-c(1:5, 11)], allsubstancedep201112["PRACTICE"], sum)
# allsubstancedep201112$PERIOD <- 201112
# allsubstancedep201112$Druggroup <- "SubstanceDep"
# obesedrugs201112 <- aggregate(obesedrugs201112[-c(1:5, 11)], obesedrugs201112["PRACTICE"], sum)
# obesedrugs201112$PERIOD <- 201112
# obesedrugs201112$Druggroup <- "Obesity"
# 
# prescribemaster201112 <- do.call("rbind", list(obesedrugs201112, allsubstancedep201112, alcoholdep201112, 
#                                                nicotinedep201112,opioddep201112, bronchodilators201112,
#                                                antidep201112, diabetes201112, dementia201112))
# 
# 
# write.csv(prescribemaster201112, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201112.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201111 <- read_csv("H:/prescription data/T201111PDPI BNFT.csv")
# prescribe201111$drugcode <- parse_number(prescribe201111$`BNF CODE`)
# prescribe201111$drugcode <- substr(prescribe201111$drugcode, 0, 6)
# antidep201111 <- prescribe201111[which(prescribe201111$drugcode>=403000&prescribe201111$drugcode<404000),]
# obesedrugs201111 <- prescribe201111[which(prescribe201111$drugcode>=405000&prescribe201111$drugcode<406000),]
# allsubstancedep201111 <- prescribe201111[which(prescribe201111$drugcode>=410000&prescribe201111$drugcode<411000),]
# alcoholdep201111 <- prescribe201111[which(prescribe201111$drugcode>=410010&prescribe201111$drugcode<410020),]
# nicotinedep201111 <- prescribe201111[which(prescribe201111$drugcode>=410020&prescribe201111$drugcode<410030),]
# opioddep201111 <- prescribe201111[which(prescribe201111$drugcode>=410030&prescribe201111$drugcode<411000),]
# bronchodilators201111 <- prescribe201111[which(prescribe201111$drugcode>=310000&prescribe201111$drugcode<320000),]
# dementia201111 <- prescribe201111[which(prescribe201111$drugcode>=411000&prescribe201111$drugcode<500000),]
# diabetes201111 <- prescribe201111[which(prescribe201111$drugcode>=601000&prescribe201111$drugcode<602000),]
# 
# antidep201111 <- aggregate(antidep201111[-c(1:5, 11)], antidep201111["PRACTICE"], sum)
# antidep201111$PERIOD <- 201111
# antidep201111$Druggroup <- "Antidepressant"
# dementia201111 <- aggregate(dementia201111[-c(1:5, 11)], dementia201111["PRACTICE"], sum)
# dementia201111$PERIOD <- 201111
# dementia201111$Druggroup <- "Dementia"
# diabetes201111 <- aggregate(diabetes201111[-c(1:5, 11)], diabetes201111["PRACTICE"], sum)
# diabetes201111$PERIOD <- 201111
# diabetes201111$Druggroup <- "Diabetes"
# 
# bronchodilators201111 <- aggregate(bronchodilators201111[-c(1:5, 11)], bronchodilators201111["PRACTICE"], sum)
# bronchodilators201111$PERIOD <- 201111
# bronchodilators201111$Druggroup <- "Bronchodilators"
# opioddep201111 <- aggregate(opioddep201111[-c(1:5, 11)], opioddep201111["PRACTICE"], sum)
# opioddep201111$PERIOD <- 201111
# opioddep201111$Druggroup <- "Opiod"
# nicotinedep201111 <- aggregate(nicotinedep201111[-c(1:5, 11)], nicotinedep201111["PRACTICE"], sum)
# nicotinedep201111$PERIOD <- 201111
# nicotinedep201111$Druggroup <- "Nicotine"
# alcoholdep201111 <- aggregate(alcoholdep201111[-c(1:5, 11)], alcoholdep201111["PRACTICE"], sum)
# alcoholdep201111$PERIOD <- 201111
# alcoholdep201111$Druggroup <- "Alcohol"
# allsubstancedep201111 <- aggregate(allsubstancedep201111[-c(1:5, 11)], allsubstancedep201111["PRACTICE"], sum)
# allsubstancedep201111$PERIOD <- 201111
# allsubstancedep201111$Druggroup <- "SubstanceDep"
# obesedrugs201111 <- aggregate(obesedrugs201111[-c(1:5, 11)], obesedrugs201111["PRACTICE"], sum)
# obesedrugs201111$PERIOD <- 201111
# obesedrugs201111$Druggroup <- "Obesity"
# 
# prescribemaster201111 <- do.call("rbind", list(obesedrugs201111, allsubstancedep201111, alcoholdep201111, 
#                                                nicotinedep201111,opioddep201111, bronchodilators201111,
#                                                antidep201111, diabetes201111, dementia201111))
# 
# 
# write.csv(prescribemaster201111, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201111.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201110 <- read_csv("H:/prescription data/T201110PDPI BNFT.csv")
# prescribe201110$drugcode <- parse_number(prescribe201110$`BNF CODE`)
# prescribe201110$drugcode <- substr(prescribe201110$drugcode, 0, 6)
# antidep201110 <- prescribe201110[which(prescribe201110$drugcode>=403000&prescribe201110$drugcode<404000),]
# obesedrugs201110 <- prescribe201110[which(prescribe201110$drugcode>=405000&prescribe201110$drugcode<406000),]
# allsubstancedep201110 <- prescribe201110[which(prescribe201110$drugcode>=410000&prescribe201110$drugcode<411000),]
# alcoholdep201110 <- prescribe201110[which(prescribe201110$drugcode>=410010&prescribe201110$drugcode<410020),]
# nicotinedep201110 <- prescribe201110[which(prescribe201110$drugcode>=410020&prescribe201110$drugcode<410030),]
# opioddep201110 <- prescribe201110[which(prescribe201110$drugcode>=410030&prescribe201110$drugcode<411000),]
# bronchodilators201110 <- prescribe201110[which(prescribe201110$drugcode>=310000&prescribe201110$drugcode<320000),]
# dementia201110 <- prescribe201110[which(prescribe201110$drugcode>=411000&prescribe201110$drugcode<500000),]
# diabetes201110 <- prescribe201110[which(prescribe201110$drugcode>=601000&prescribe201110$drugcode<602000),]
# 
# antidep201110 <- aggregate(antidep201110[-c(1:5, 11)], antidep201110["PRACTICE"], sum)
# antidep201110$PERIOD <- 201110
# antidep201110$Druggroup <- "Antidepressant"
# dementia201110 <- aggregate(dementia201110[-c(1:5, 11)], dementia201110["PRACTICE"], sum)
# dementia201110$PERIOD <- 201110
# dementia201110$Druggroup <- "Dementia"
# diabetes201110 <- aggregate(diabetes201110[-c(1:5, 11)], diabetes201110["PRACTICE"], sum)
# diabetes201110$PERIOD <- 201110
# diabetes201110$Druggroup <- "Diabetes"
# 
# bronchodilators201110 <- aggregate(bronchodilators201110[-c(1:5, 11)], bronchodilators201110["PRACTICE"], sum)
# bronchodilators201110$PERIOD <- 201110
# bronchodilators201110$Druggroup <- "Bronchodilators"
# opioddep201110 <- aggregate(opioddep201110[-c(1:5, 11)], opioddep201110["PRACTICE"], sum)
# opioddep201110$PERIOD <- 201110
# opioddep201110$Druggroup <- "Opiod"
# nicotinedep201110 <- aggregate(nicotinedep201110[-c(1:5, 11)], nicotinedep201110["PRACTICE"], sum)
# nicotinedep201110$PERIOD <- 201110
# nicotinedep201110$Druggroup <- "Nicotine"
# alcoholdep201110 <- aggregate(alcoholdep201110[-c(1:5, 11)], alcoholdep201110["PRACTICE"], sum)
# alcoholdep201110$PERIOD <- 201110
# alcoholdep201110$Druggroup <- "Alcohol"
# allsubstancedep201110 <- aggregate(allsubstancedep201110[-c(1:5, 11)], allsubstancedep201110["PRACTICE"], sum)
# allsubstancedep201110$PERIOD <- 201110
# allsubstancedep201110$Druggroup <- "SubstanceDep"
# obesedrugs201110 <- aggregate(obesedrugs201110[-c(1:5, 11)], obesedrugs201110["PRACTICE"], sum)
# obesedrugs201110$PERIOD <- 201110
# obesedrugs201110$Druggroup <- "Obesity"
# 
# prescribemaster201110 <- do.call("rbind", list(obesedrugs201110, allsubstancedep201110, alcoholdep201110, 
#                                                nicotinedep201110,opioddep201110, bronchodilators201110,
#                                                antidep201110, diabetes201110, dementia201110))
# 
# 
# write.csv(prescribemaster201110, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201110.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201109 <- read_csv("H:/prescription data/T201109PDPI BNFT.csv")
# prescribe201109$drugcode <- parse_number(prescribe201109$`BNF CODE`)
# prescribe201109$drugcode <- substr(prescribe201109$drugcode, 0, 6)
# antidep201109 <- prescribe201109[which(prescribe201109$drugcode>=403000&prescribe201109$drugcode<404000),]
# obesedrugs201109 <- prescribe201109[which(prescribe201109$drugcode>=405000&prescribe201109$drugcode<406000),]
# allsubstancedep201109 <- prescribe201109[which(prescribe201109$drugcode>=410000&prescribe201109$drugcode<411000),]
# alcoholdep201109 <- prescribe201109[which(prescribe201109$drugcode>=410010&prescribe201109$drugcode<410020),]
# nicotinedep201109 <- prescribe201109[which(prescribe201109$drugcode>=410020&prescribe201109$drugcode<410030),]
# opioddep201109 <- prescribe201109[which(prescribe201109$drugcode>=410030&prescribe201109$drugcode<411000),]
# bronchodilators201109 <- prescribe201109[which(prescribe201109$drugcode>=310000&prescribe201109$drugcode<320000),]
# dementia201109 <- prescribe201109[which(prescribe201109$drugcode>=411000&prescribe201109$drugcode<500000),]
# diabetes201109 <- prescribe201109[which(prescribe201109$drugcode>=601000&prescribe201109$drugcode<602000),]
# 
# antidep201109 <- aggregate(antidep201109[-c(1:5, 11)], antidep201109["PRACTICE"], sum)
# antidep201109$PERIOD <- 201109
# antidep201109$Druggroup <- "Antidepressant"
# dementia201109 <- aggregate(dementia201109[-c(1:5, 11)], dementia201109["PRACTICE"], sum)
# dementia201109$PERIOD <- 201109
# dementia201109$Druggroup <- "Dementia"
# diabetes201109 <- aggregate(diabetes201109[-c(1:5, 11)], diabetes201109["PRACTICE"], sum)
# diabetes201109$PERIOD <- 201109
# diabetes201109$Druggroup <- "Diabetes"
# 
# bronchodilators201109 <- aggregate(bronchodilators201109[-c(1:5, 11)], bronchodilators201109["PRACTICE"], sum)
# bronchodilators201109$PERIOD <- 201109
# bronchodilators201109$Druggroup <- "Bronchodilators"
# opioddep201109 <- aggregate(opioddep201109[-c(1:5, 11)], opioddep201109["PRACTICE"], sum)
# opioddep201109$PERIOD <- 201109
# opioddep201109$Druggroup <- "Opiod"
# nicotinedep201109 <- aggregate(nicotinedep201109[-c(1:5, 11)], nicotinedep201109["PRACTICE"], sum)
# nicotinedep201109$PERIOD <- 201109
# nicotinedep201109$Druggroup <- "Nicotine"
# alcoholdep201109 <- aggregate(alcoholdep201109[-c(1:5, 11)], alcoholdep201109["PRACTICE"], sum)
# alcoholdep201109$PERIOD <- 201109
# alcoholdep201109$Druggroup <- "Alcohol"
# allsubstancedep201109 <- aggregate(allsubstancedep201109[-c(1:5, 11)], allsubstancedep201109["PRACTICE"], sum)
# allsubstancedep201109$PERIOD <- 201109
# allsubstancedep201109$Druggroup <- "SubstanceDep"
# obesedrugs201109 <- aggregate(obesedrugs201109[-c(1:5, 11)], obesedrugs201109["PRACTICE"], sum)
# obesedrugs201109$PERIOD <- 201109
# obesedrugs201109$Druggroup <- "Obesity"
# 
# prescribemaster201109 <- do.call("rbind", list(obesedrugs201109, allsubstancedep201109, alcoholdep201109, 
#                                                nicotinedep201109,opioddep201109, bronchodilators201109,
#                                                antidep201109, diabetes201109, dementia201109))
# 
# 
# write.csv(prescribemaster201109, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201109.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201108 <- read_csv("H:/prescription data/T201108PDPI BNFT.csv")
# prescribe201108$drugcode <- parse_number(prescribe201108$`BNF CODE`)
# prescribe201108$drugcode <- substr(prescribe201108$drugcode, 0, 6)
# antidep201108 <- prescribe201108[which(prescribe201108$drugcode>=403000&prescribe201108$drugcode<404000),]
# obesedrugs201108 <- prescribe201108[which(prescribe201108$drugcode>=405000&prescribe201108$drugcode<406000),]
# allsubstancedep201108 <- prescribe201108[which(prescribe201108$drugcode>=410000&prescribe201108$drugcode<411000),]
# alcoholdep201108 <- prescribe201108[which(prescribe201108$drugcode>=410010&prescribe201108$drugcode<410020),]
# nicotinedep201108 <- prescribe201108[which(prescribe201108$drugcode>=410020&prescribe201108$drugcode<410030),]
# opioddep201108 <- prescribe201108[which(prescribe201108$drugcode>=410030&prescribe201108$drugcode<411000),]
# bronchodilators201108 <- prescribe201108[which(prescribe201108$drugcode>=310000&prescribe201108$drugcode<320000),]
# dementia201108 <- prescribe201108[which(prescribe201108$drugcode>=411000&prescribe201108$drugcode<500000),]
# diabetes201108 <- prescribe201108[which(prescribe201108$drugcode>=601000&prescribe201108$drugcode<602000),]
# 
# antidep201108 <- aggregate(antidep201108[-c(1:5, 11)], antidep201108["PRACTICE"], sum)
# antidep201108$PERIOD <- 201108
# antidep201108$Druggroup <- "Antidepressant"
# dementia201108 <- aggregate(dementia201108[-c(1:5, 11)], dementia201108["PRACTICE"], sum)
# dementia201108$PERIOD <- 201108
# dementia201108$Druggroup <- "Dementia"
# diabetes201108 <- aggregate(diabetes201108[-c(1:5, 11)], diabetes201108["PRACTICE"], sum)
# diabetes201108$PERIOD <- 201108
# diabetes201108$Druggroup <- "Diabetes"
# 
# bronchodilators201108 <- aggregate(bronchodilators201108[-c(1:5, 11)], bronchodilators201108["PRACTICE"], sum)
# bronchodilators201108$PERIOD <- 201108
# bronchodilators201108$Druggroup <- "Bronchodilators"
# opioddep201108 <- aggregate(opioddep201108[-c(1:5, 11)], opioddep201108["PRACTICE"], sum)
# opioddep201108$PERIOD <- 201108
# opioddep201108$Druggroup <- "Opiod"
# nicotinedep201108 <- aggregate(nicotinedep201108[-c(1:5, 11)], nicotinedep201108["PRACTICE"], sum)
# nicotinedep201108$PERIOD <- 201108
# nicotinedep201108$Druggroup <- "Nicotine"
# alcoholdep201108 <- aggregate(alcoholdep201108[-c(1:5, 11)], alcoholdep201108["PRACTICE"], sum)
# alcoholdep201108$PERIOD <- 201108
# alcoholdep201108$Druggroup <- "Alcohol"
# allsubstancedep201108 <- aggregate(allsubstancedep201108[-c(1:5, 11)], allsubstancedep201108["PRACTICE"], sum)
# allsubstancedep201108$PERIOD <- 201108
# allsubstancedep201108$Druggroup <- "SubstanceDep"
# obesedrugs201108 <- aggregate(obesedrugs201108[-c(1:5, 11)], obesedrugs201108["PRACTICE"], sum)
# obesedrugs201108$PERIOD <- 201108
# obesedrugs201108$Druggroup <- "Obesity"
# 
# prescribemaster201108 <- do.call("rbind", list(obesedrugs201108, allsubstancedep201108, alcoholdep201108, 
#                                                nicotinedep201108,opioddep201108, bronchodilators201108,
#                                                antidep201108, diabetes201108, dementia201108))
# 
# 
# write.csv(prescribemaster201108, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201108.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201107 <- read_csv("H:/prescription data/T201107PDPI BNFT.csv")
# prescribe201107$drugcode <- parse_number(prescribe201107$`BNF CODE`)
# prescribe201107$drugcode <- substr(prescribe201107$drugcode, 0, 6)
# antidep201107 <- prescribe201107[which(prescribe201107$drugcode>=403000&prescribe201107$drugcode<404000),]
# obesedrugs201107 <- prescribe201107[which(prescribe201107$drugcode>=405000&prescribe201107$drugcode<406000),]
# allsubstancedep201107 <- prescribe201107[which(prescribe201107$drugcode>=410000&prescribe201107$drugcode<411000),]
# alcoholdep201107 <- prescribe201107[which(prescribe201107$drugcode>=410010&prescribe201107$drugcode<410020),]
# nicotinedep201107 <- prescribe201107[which(prescribe201107$drugcode>=410020&prescribe201107$drugcode<410030),]
# opioddep201107 <- prescribe201107[which(prescribe201107$drugcode>=410030&prescribe201107$drugcode<411000),]
# bronchodilators201107 <- prescribe201107[which(prescribe201107$drugcode>=310000&prescribe201107$drugcode<320000),]
# dementia201107 <- prescribe201107[which(prescribe201107$drugcode>=411000&prescribe201107$drugcode<500000),]
# diabetes201107 <- prescribe201107[which(prescribe201107$drugcode>=601000&prescribe201107$drugcode<602000),]
# 
# antidep201107 <- aggregate(antidep201107[-c(1:5, 11)], antidep201107["PRACTICE"], sum)
# antidep201107$PERIOD <- 201107
# antidep201107$Druggroup <- "Antidepressant"
# dementia201107 <- aggregate(dementia201107[-c(1:5, 11)], dementia201107["PRACTICE"], sum)
# dementia201107$PERIOD <- 201107
# dementia201107$Druggroup <- "Dementia"
# diabetes201107 <- aggregate(diabetes201107[-c(1:5, 11)], diabetes201107["PRACTICE"], sum)
# diabetes201107$PERIOD <- 201107
# diabetes201107$Druggroup <- "Diabetes"
# 
# bronchodilators201107 <- aggregate(bronchodilators201107[-c(1:5, 11)], bronchodilators201107["PRACTICE"], sum)
# bronchodilators201107$PERIOD <- 201107
# bronchodilators201107$Druggroup <- "Bronchodilators"
# opioddep201107 <- aggregate(opioddep201107[-c(1:5, 11)], opioddep201107["PRACTICE"], sum)
# opioddep201107$PERIOD <- 201107
# opioddep201107$Druggroup <- "Opiod"
# nicotinedep201107 <- aggregate(nicotinedep201107[-c(1:5, 11)], nicotinedep201107["PRACTICE"], sum)
# nicotinedep201107$PERIOD <- 201107
# nicotinedep201107$Druggroup <- "Nicotine"
# alcoholdep201107 <- aggregate(alcoholdep201107[-c(1:5, 11)], alcoholdep201107["PRACTICE"], sum)
# alcoholdep201107$PERIOD <- 201107
# alcoholdep201107$Druggroup <- "Alcohol"
# allsubstancedep201107 <- aggregate(allsubstancedep201107[-c(1:5, 11)], allsubstancedep201107["PRACTICE"], sum)
# allsubstancedep201107$PERIOD <- 201107
# allsubstancedep201107$Druggroup <- "SubstanceDep"
# obesedrugs201107 <- aggregate(obesedrugs201107[-c(1:5, 11)], obesedrugs201107["PRACTICE"], sum)
# obesedrugs201107$PERIOD <- 201107
# obesedrugs201107$Druggroup <- "Obesity"
# 
# prescribemaster201107 <- do.call("rbind", list(obesedrugs201107, allsubstancedep201107, alcoholdep201107, 
#                                                nicotinedep201107,opioddep201107, bronchodilators201107,
#                                                antidep201107, diabetes201107, dementia201107))
# 
# 
# write.csv(prescribemaster201107, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201107.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201106 <- read_csv("H:/prescription data/T201106PDPI BNFT.csv")
# prescribe201106$drugcode <- parse_number(prescribe201106$`BNF CODE`)
# prescribe201106$drugcode <- substr(prescribe201106$drugcode, 0, 6)
# antidep201106 <- prescribe201106[which(prescribe201106$drugcode>=403000&prescribe201106$drugcode<404000),]
# obesedrugs201106 <- prescribe201106[which(prescribe201106$drugcode>=405000&prescribe201106$drugcode<406000),]
# allsubstancedep201106 <- prescribe201106[which(prescribe201106$drugcode>=410000&prescribe201106$drugcode<411000),]
# alcoholdep201106 <- prescribe201106[which(prescribe201106$drugcode>=410010&prescribe201106$drugcode<410020),]
# nicotinedep201106 <- prescribe201106[which(prescribe201106$drugcode>=410020&prescribe201106$drugcode<410030),]
# opioddep201106 <- prescribe201106[which(prescribe201106$drugcode>=410030&prescribe201106$drugcode<411000),]
# bronchodilators201106 <- prescribe201106[which(prescribe201106$drugcode>=310000&prescribe201106$drugcode<320000),]
# dementia201106 <- prescribe201106[which(prescribe201106$drugcode>=411000&prescribe201106$drugcode<500000),]
# diabetes201106 <- prescribe201106[which(prescribe201106$drugcode>=601000&prescribe201106$drugcode<602000),]
# 
# antidep201106 <- aggregate(antidep201106[-c(1:5, 11)], antidep201106["PRACTICE"], sum)
# antidep201106$PERIOD <- 201106
# antidep201106$Druggroup <- "Antidepressant"
# dementia201106 <- aggregate(dementia201106[-c(1:5, 11)], dementia201106["PRACTICE"], sum)
# dementia201106$PERIOD <- 201106
# dementia201106$Druggroup <- "Dementia"
# diabetes201106 <- aggregate(diabetes201106[-c(1:5, 11)], diabetes201106["PRACTICE"], sum)
# diabetes201106$PERIOD <- 201106
# diabetes201106$Druggroup <- "Diabetes"
# 
# bronchodilators201106 <- aggregate(bronchodilators201106[-c(1:5, 11)], bronchodilators201106["PRACTICE"], sum)
# bronchodilators201106$PERIOD <- 201106
# bronchodilators201106$Druggroup <- "Bronchodilators"
# opioddep201106 <- aggregate(opioddep201106[-c(1:5, 11)], opioddep201106["PRACTICE"], sum)
# opioddep201106$PERIOD <- 201106
# opioddep201106$Druggroup <- "Opiod"
# nicotinedep201106 <- aggregate(nicotinedep201106[-c(1:5, 11)], nicotinedep201106["PRACTICE"], sum)
# nicotinedep201106$PERIOD <- 201106
# nicotinedep201106$Druggroup <- "Nicotine"
# alcoholdep201106 <- aggregate(alcoholdep201106[-c(1:5, 11)], alcoholdep201106["PRACTICE"], sum)
# alcoholdep201106$PERIOD <- 201106
# alcoholdep201106$Druggroup <- "Alcohol"
# allsubstancedep201106 <- aggregate(allsubstancedep201106[-c(1:5, 11)], allsubstancedep201106["PRACTICE"], sum)
# allsubstancedep201106$PERIOD <- 201106
# allsubstancedep201106$Druggroup <- "SubstanceDep"
# obesedrugs201106 <- aggregate(obesedrugs201106[-c(1:5, 11)], obesedrugs201106["PRACTICE"], sum)
# obesedrugs201106$PERIOD <- 201106
# obesedrugs201106$Druggroup <- "Obesity"
# 
# prescribemaster201106 <- do.call("rbind", list(obesedrugs201106, allsubstancedep201106, alcoholdep201106, 
#                                                nicotinedep201106,opioddep201106, bronchodilators201106,
#                                                antidep201106, diabetes201106, dementia201106))
# 
# 
# write.csv(prescribemaster201106, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201106.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201105 <- read_csv("H:/prescription data/T201105PDPI BNFT.csv")
# prescribe201105$drugcode <- parse_number(prescribe201105$`BNF CODE`)
# prescribe201105$drugcode <- substr(prescribe201105$drugcode, 0, 6)
# antidep201105 <- prescribe201105[which(prescribe201105$drugcode>=403000&prescribe201105$drugcode<404000),]
# obesedrugs201105 <- prescribe201105[which(prescribe201105$drugcode>=405000&prescribe201105$drugcode<406000),]
# allsubstancedep201105 <- prescribe201105[which(prescribe201105$drugcode>=410000&prescribe201105$drugcode<411000),]
# alcoholdep201105 <- prescribe201105[which(prescribe201105$drugcode>=410010&prescribe201105$drugcode<410020),]
# nicotinedep201105 <- prescribe201105[which(prescribe201105$drugcode>=410020&prescribe201105$drugcode<410030),]
# opioddep201105 <- prescribe201105[which(prescribe201105$drugcode>=410030&prescribe201105$drugcode<411000),]
# bronchodilators201105 <- prescribe201105[which(prescribe201105$drugcode>=310000&prescribe201105$drugcode<320000),]
# dementia201105 <- prescribe201105[which(prescribe201105$drugcode>=411000&prescribe201105$drugcode<500000),]
# diabetes201105 <- prescribe201105[which(prescribe201105$drugcode>=601000&prescribe201105$drugcode<602000),]
# 
# antidep201105 <- aggregate(antidep201105[-c(1:5, 11)], antidep201105["PRACTICE"], sum)
# antidep201105$PERIOD <- 201105
# antidep201105$Druggroup <- "Antidepressant"
# dementia201105 <- aggregate(dementia201105[-c(1:5, 11)], dementia201105["PRACTICE"], sum)
# dementia201105$PERIOD <- 201105
# dementia201105$Druggroup <- "Dementia"
# diabetes201105 <- aggregate(diabetes201105[-c(1:5, 11)], diabetes201105["PRACTICE"], sum)
# diabetes201105$PERIOD <- 201105
# diabetes201105$Druggroup <- "Diabetes"
# 
# bronchodilators201105 <- aggregate(bronchodilators201105[-c(1:5, 11)], bronchodilators201105["PRACTICE"], sum)
# bronchodilators201105$PERIOD <- 201105
# bronchodilators201105$Druggroup <- "Bronchodilators"
# opioddep201105 <- aggregate(opioddep201105[-c(1:5, 11)], opioddep201105["PRACTICE"], sum)
# opioddep201105$PERIOD <- 201105
# opioddep201105$Druggroup <- "Opiod"
# nicotinedep201105 <- aggregate(nicotinedep201105[-c(1:5, 11)], nicotinedep201105["PRACTICE"], sum)
# nicotinedep201105$PERIOD <- 201105
# nicotinedep201105$Druggroup <- "Nicotine"
# alcoholdep201105 <- aggregate(alcoholdep201105[-c(1:5, 11)], alcoholdep201105["PRACTICE"], sum)
# alcoholdep201105$PERIOD <- 201105
# alcoholdep201105$Druggroup <- "Alcohol"
# allsubstancedep201105 <- aggregate(allsubstancedep201105[-c(1:5, 11)], allsubstancedep201105["PRACTICE"], sum)
# allsubstancedep201105$PERIOD <- 201105
# allsubstancedep201105$Druggroup <- "SubstanceDep"
# obesedrugs201105 <- aggregate(obesedrugs201105[-c(1:5, 11)], obesedrugs201105["PRACTICE"], sum)
# obesedrugs201105$PERIOD <- 201105
# obesedrugs201105$Druggroup <- "Obesity"
# 
# prescribemaster201105 <- do.call("rbind", list(obesedrugs201105, allsubstancedep201105, alcoholdep201105, 
#                                                nicotinedep201105,opioddep201105, bronchodilators201105,
#                                                antidep201105, diabetes201105, dementia201105))
# 
# 
# write.csv(prescribemaster201105, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201105.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201104 <- read_csv("H:/prescription data/T201104PDPI BNFT.csv")
# prescribe201104$drugcode <- parse_number(prescribe201104$`BNF CODE`)
# prescribe201104$drugcode <- substr(prescribe201104$drugcode, 0, 6)
# antidep201104 <- prescribe201104[which(prescribe201104$drugcode>=403000&prescribe201104$drugcode<404000),]
# obesedrugs201104 <- prescribe201104[which(prescribe201104$drugcode>=405000&prescribe201104$drugcode<406000),]
# allsubstancedep201104 <- prescribe201104[which(prescribe201104$drugcode>=410000&prescribe201104$drugcode<411000),]
# alcoholdep201104 <- prescribe201104[which(prescribe201104$drugcode>=410010&prescribe201104$drugcode<410020),]
# nicotinedep201104 <- prescribe201104[which(prescribe201104$drugcode>=410020&prescribe201104$drugcode<410030),]
# opioddep201104 <- prescribe201104[which(prescribe201104$drugcode>=410030&prescribe201104$drugcode<411000),]
# bronchodilators201104 <- prescribe201104[which(prescribe201104$drugcode>=310000&prescribe201104$drugcode<320000),]
# dementia201104 <- prescribe201104[which(prescribe201104$drugcode>=411000&prescribe201104$drugcode<500000),]
# diabetes201104 <- prescribe201104[which(prescribe201104$drugcode>=601000&prescribe201104$drugcode<602000),]
# 
# antidep201104 <- aggregate(antidep201104[-c(1:5, 11)], antidep201104["PRACTICE"], sum)
# antidep201104$PERIOD <- 201104
# antidep201104$Druggroup <- "Antidepressant"
# dementia201104 <- aggregate(dementia201104[-c(1:5, 11)], dementia201104["PRACTICE"], sum)
# dementia201104$PERIOD <- 201104
# dementia201104$Druggroup <- "Dementia"
# diabetes201104 <- aggregate(diabetes201104[-c(1:5, 11)], diabetes201104["PRACTICE"], sum)
# diabetes201104$PERIOD <- 201104
# diabetes201104$Druggroup <- "Diabetes"
# 
# bronchodilators201104 <- aggregate(bronchodilators201104[-c(1:5, 11)], bronchodilators201104["PRACTICE"], sum)
# bronchodilators201104$PERIOD <- 201104
# bronchodilators201104$Druggroup <- "Bronchodilators"
# opioddep201104 <- aggregate(opioddep201104[-c(1:5, 11)], opioddep201104["PRACTICE"], sum)
# opioddep201104$PERIOD <- 201104
# opioddep201104$Druggroup <- "Opiod"
# nicotinedep201104 <- aggregate(nicotinedep201104[-c(1:5, 11)], nicotinedep201104["PRACTICE"], sum)
# nicotinedep201104$PERIOD <- 201104
# nicotinedep201104$Druggroup <- "Nicotine"
# alcoholdep201104 <- aggregate(alcoholdep201104[-c(1:5, 11)], alcoholdep201104["PRACTICE"], sum)
# alcoholdep201104$PERIOD <- 201104
# alcoholdep201104$Druggroup <- "Alcohol"
# allsubstancedep201104 <- aggregate(allsubstancedep201104[-c(1:5, 11)], allsubstancedep201104["PRACTICE"], sum)
# allsubstancedep201104$PERIOD <- 201104
# allsubstancedep201104$Druggroup <- "SubstanceDep"
# obesedrugs201104 <- aggregate(obesedrugs201104[-c(1:5, 11)], obesedrugs201104["PRACTICE"], sum)
# obesedrugs201104$PERIOD <- 201104
# obesedrugs201104$Druggroup <- "Obesity"
# 
# prescribemaster201104 <- do.call("rbind", list(obesedrugs201104, allsubstancedep201104, alcoholdep201104, 
#                                                nicotinedep201104,opioddep201104, bronchodilators201104,
#                                                antidep201104, diabetes201104, dementia201104))
# 
# 
# write.csv(prescribemaster201104, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201104.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201103 <- read_csv("H:/prescription data/T201103PDPI BNFT.csv")
# prescribe201103$drugcode <- parse_number(prescribe201103$`BNF CODE`)
# prescribe201103$drugcode <- substr(prescribe201103$drugcode, 0, 6)
# antidep201103 <- prescribe201103[which(prescribe201103$drugcode>=403000&prescribe201103$drugcode<404000),]
# obesedrugs201103 <- prescribe201103[which(prescribe201103$drugcode>=405000&prescribe201103$drugcode<406000),]
# allsubstancedep201103 <- prescribe201103[which(prescribe201103$drugcode>=410000&prescribe201103$drugcode<411000),]
# alcoholdep201103 <- prescribe201103[which(prescribe201103$drugcode>=410010&prescribe201103$drugcode<410020),]
# nicotinedep201103 <- prescribe201103[which(prescribe201103$drugcode>=410020&prescribe201103$drugcode<410030),]
# opioddep201103 <- prescribe201103[which(prescribe201103$drugcode>=410030&prescribe201103$drugcode<411000),]
# bronchodilators201103 <- prescribe201103[which(prescribe201103$drugcode>=310000&prescribe201103$drugcode<320000),]
# dementia201103 <- prescribe201103[which(prescribe201103$drugcode>=411000&prescribe201103$drugcode<500000),]
# diabetes201103 <- prescribe201103[which(prescribe201103$drugcode>=601000&prescribe201103$drugcode<602000),]
# 
# antidep201103 <- aggregate(antidep201103[-c(1:5, 11)], antidep201103["PRACTICE"], sum)
# antidep201103$PERIOD <- 201103
# antidep201103$Druggroup <- "Antidepressant"
# dementia201103 <- aggregate(dementia201103[-c(1:5, 11)], dementia201103["PRACTICE"], sum)
# dementia201103$PERIOD <- 201103
# dementia201103$Druggroup <- "Dementia"
# diabetes201103 <- aggregate(diabetes201103[-c(1:5, 11)], diabetes201103["PRACTICE"], sum)
# diabetes201103$PERIOD <- 201103
# diabetes201103$Druggroup <- "Diabetes"
# 
# bronchodilators201103 <- aggregate(bronchodilators201103[-c(1:5, 11)], bronchodilators201103["PRACTICE"], sum)
# bronchodilators201103$PERIOD <- 201103
# bronchodilators201103$Druggroup <- "Bronchodilators"
# opioddep201103 <- aggregate(opioddep201103[-c(1:5, 11)], opioddep201103["PRACTICE"], sum)
# opioddep201103$PERIOD <- 201103
# opioddep201103$Druggroup <- "Opiod"
# nicotinedep201103 <- aggregate(nicotinedep201103[-c(1:5, 11)], nicotinedep201103["PRACTICE"], sum)
# nicotinedep201103$PERIOD <- 201103
# nicotinedep201103$Druggroup <- "Nicotine"
# alcoholdep201103 <- aggregate(alcoholdep201103[-c(1:5, 11)], alcoholdep201103["PRACTICE"], sum)
# alcoholdep201103$PERIOD <- 201103
# alcoholdep201103$Druggroup <- "Alcohol"
# allsubstancedep201103 <- aggregate(allsubstancedep201103[-c(1:5, 11)], allsubstancedep201103["PRACTICE"], sum)
# allsubstancedep201103$PERIOD <- 201103
# allsubstancedep201103$Druggroup <- "SubstanceDep"
# obesedrugs201103 <- aggregate(obesedrugs201103[-c(1:5, 11)], obesedrugs201103["PRACTICE"], sum)
# obesedrugs201103$PERIOD <- 201103
# obesedrugs201103$Druggroup <- "Obesity"
# 
# prescribemaster201103 <- do.call("rbind", list(obesedrugs201103, allsubstancedep201103, alcoholdep201103, 
#                                                nicotinedep201103,opioddep201103, bronchodilators201103,
#                                                antidep201103, diabetes201103, dementia201103))
# 
# 
# write.csv(prescribemaster201103, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201103.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201102 <- read_csv("H:/prescription data/T201102PDPI BNFT.csv")
# prescribe201102$drugcode <- parse_number(prescribe201102$`BNF CODE`)
# prescribe201102$drugcode <- substr(prescribe201102$drugcode, 0, 6)
# antidep201102 <- prescribe201102[which(prescribe201102$drugcode>=403000&prescribe201102$drugcode<404000),]
# obesedrugs201102 <- prescribe201102[which(prescribe201102$drugcode>=405000&prescribe201102$drugcode<406000),]
# allsubstancedep201102 <- prescribe201102[which(prescribe201102$drugcode>=410000&prescribe201102$drugcode<411000),]
# alcoholdep201102 <- prescribe201102[which(prescribe201102$drugcode>=410010&prescribe201102$drugcode<410020),]
# nicotinedep201102 <- prescribe201102[which(prescribe201102$drugcode>=410020&prescribe201102$drugcode<410030),]
# opioddep201102 <- prescribe201102[which(prescribe201102$drugcode>=410030&prescribe201102$drugcode<411000),]
# bronchodilators201102 <- prescribe201102[which(prescribe201102$drugcode>=310000&prescribe201102$drugcode<320000),]
# dementia201102 <- prescribe201102[which(prescribe201102$drugcode>=411000&prescribe201102$drugcode<500000),]
# diabetes201102 <- prescribe201102[which(prescribe201102$drugcode>=601000&prescribe201102$drugcode<602000),]
# 
# antidep201102 <- aggregate(antidep201102[-c(1:5, 11)], antidep201102["PRACTICE"], sum)
# antidep201102$PERIOD <- 201102
# antidep201102$Druggroup <- "Antidepressant"
# dementia201102 <- aggregate(dementia201102[-c(1:5, 11)], dementia201102["PRACTICE"], sum)
# dementia201102$PERIOD <- 201102
# dementia201102$Druggroup <- "Dementia"
# diabetes201102 <- aggregate(diabetes201102[-c(1:5, 11)], diabetes201102["PRACTICE"], sum)
# diabetes201102$PERIOD <- 201102
# diabetes201102$Druggroup <- "Diabetes"
# 
# bronchodilators201102 <- aggregate(bronchodilators201102[-c(1:5, 11)], bronchodilators201102["PRACTICE"], sum)
# bronchodilators201102$PERIOD <- 201102
# bronchodilators201102$Druggroup <- "Bronchodilators"
# opioddep201102 <- aggregate(opioddep201102[-c(1:5, 11)], opioddep201102["PRACTICE"], sum)
# opioddep201102$PERIOD <- 201102
# opioddep201102$Druggroup <- "Opiod"
# nicotinedep201102 <- aggregate(nicotinedep201102[-c(1:5, 11)], nicotinedep201102["PRACTICE"], sum)
# nicotinedep201102$PERIOD <- 201102
# nicotinedep201102$Druggroup <- "Nicotine"
# alcoholdep201102 <- aggregate(alcoholdep201102[-c(1:5, 11)], alcoholdep201102["PRACTICE"], sum)
# alcoholdep201102$PERIOD <- 201102
# alcoholdep201102$Druggroup <- "Alcohol"
# allsubstancedep201102 <- aggregate(allsubstancedep201102[-c(1:5, 11)], allsubstancedep201102["PRACTICE"], sum)
# allsubstancedep201102$PERIOD <- 201102
# allsubstancedep201102$Druggroup <- "SubstanceDep"
# obesedrugs201102 <- aggregate(obesedrugs201102[-c(1:5, 11)], obesedrugs201102["PRACTICE"], sum)
# obesedrugs201102$PERIOD <- 201102
# obesedrugs201102$Druggroup <- "Obesity"
# 
# prescribemaster201102 <- do.call("rbind", list(obesedrugs201102, allsubstancedep201102, alcoholdep201102, 
#                                                nicotinedep201102,opioddep201102, bronchodilators201102,
#                                                antidep201102, diabetes201102, dementia201102))
# 
# 
# write.csv(prescribemaster201102, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201102.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201101 <- read_csv("H:/prescription data/T201101PDPI BNFT.csv")
# prescribe201101$drugcode <- parse_number(prescribe201101$`BNF CODE`)
# prescribe201101$drugcode <- substr(prescribe201101$drugcode, 0, 6)
# antidep201101 <- prescribe201101[which(prescribe201101$drugcode>=403000&prescribe201101$drugcode<404000),]
# obesedrugs201101 <- prescribe201101[which(prescribe201101$drugcode>=405000&prescribe201101$drugcode<406000),]
# allsubstancedep201101 <- prescribe201101[which(prescribe201101$drugcode>=410000&prescribe201101$drugcode<411000),]
# alcoholdep201101 <- prescribe201101[which(prescribe201101$drugcode>=410010&prescribe201101$drugcode<410020),]
# nicotinedep201101 <- prescribe201101[which(prescribe201101$drugcode>=410020&prescribe201101$drugcode<410030),]
# opioddep201101 <- prescribe201101[which(prescribe201101$drugcode>=410030&prescribe201101$drugcode<411000),]
# bronchodilators201101 <- prescribe201101[which(prescribe201101$drugcode>=310000&prescribe201101$drugcode<320000),]
# dementia201101 <- prescribe201101[which(prescribe201101$drugcode>=411000&prescribe201101$drugcode<500000),]
# diabetes201101 <- prescribe201101[which(prescribe201101$drugcode>=601000&prescribe201101$drugcode<602000),]
# 
# antidep201101 <- aggregate(antidep201101[-c(1:5, 11)], antidep201101["PRACTICE"], sum)
# antidep201101$PERIOD <- 201101
# antidep201101$Druggroup <- "Antidepressant"
# dementia201101 <- aggregate(dementia201101[-c(1:5, 11)], dementia201101["PRACTICE"], sum)
# dementia201101$PERIOD <- 201101
# dementia201101$Druggroup <- "Dementia"
# diabetes201101 <- aggregate(diabetes201101[-c(1:5, 11)], diabetes201101["PRACTICE"], sum)
# diabetes201101$PERIOD <- 201101
# diabetes201101$Druggroup <- "Diabetes"
# 
# bronchodilators201101 <- aggregate(bronchodilators201101[-c(1:5, 11)], bronchodilators201101["PRACTICE"], sum)
# bronchodilators201101$PERIOD <- 201101
# bronchodilators201101$Druggroup <- "Bronchodilators"
# opioddep201101 <- aggregate(opioddep201101[-c(1:5, 11)], opioddep201101["PRACTICE"], sum)
# opioddep201101$PERIOD <- 201101
# opioddep201101$Druggroup <- "Opiod"
# nicotinedep201101 <- aggregate(nicotinedep201101[-c(1:5, 11)], nicotinedep201101["PRACTICE"], sum)
# nicotinedep201101$PERIOD <- 201101
# nicotinedep201101$Druggroup <- "Nicotine"
# alcoholdep201101 <- aggregate(alcoholdep201101[-c(1:5, 11)], alcoholdep201101["PRACTICE"], sum)
# alcoholdep201101$PERIOD <- 201101
# alcoholdep201101$Druggroup <- "Alcohol"
# allsubstancedep201101 <- aggregate(allsubstancedep201101[-c(1:5, 11)], allsubstancedep201101["PRACTICE"], sum)
# allsubstancedep201101$PERIOD <- 201101
# allsubstancedep201101$Druggroup <- "SubstanceDep"
# obesedrugs201101 <- aggregate(obesedrugs201101[-c(1:5, 11)], obesedrugs201101["PRACTICE"], sum)
# obesedrugs201101$PERIOD <- 201101
# obesedrugs201101$Druggroup <- "Obesity"
# 
# prescribemaster201101 <- do.call("rbind", list(obesedrugs201101, allsubstancedep201101, alcoholdep201101, 
#                                                nicotinedep201101,opioddep201101, bronchodilators201101,
#                                                antidep201101, diabetes201101, dementia201101))
# 
# 
# write.csv(prescribemaster201101, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201101.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201012 <- read_csv("H:/prescription data/T201012PDPI BNFT.csv")
# prescribe201012$drugcode <- parse_number(prescribe201012$`BNF CODE`)
# prescribe201012$drugcode <- substr(prescribe201012$drugcode, 0, 6)
# antidep201012 <- prescribe201012[which(prescribe201012$drugcode>=403000&prescribe201012$drugcode<404000),]
# obesedrugs201012 <- prescribe201012[which(prescribe201012$drugcode>=405000&prescribe201012$drugcode<406000),]
# allsubstancedep201012 <- prescribe201012[which(prescribe201012$drugcode>=410000&prescribe201012$drugcode<411000),]
# alcoholdep201012 <- prescribe201012[which(prescribe201012$drugcode>=410010&prescribe201012$drugcode<410020),]
# nicotinedep201012 <- prescribe201012[which(prescribe201012$drugcode>=410020&prescribe201012$drugcode<410030),]
# opioddep201012 <- prescribe201012[which(prescribe201012$drugcode>=410030&prescribe201012$drugcode<411000),]
# bronchodilators201012 <- prescribe201012[which(prescribe201012$drugcode>=310000&prescribe201012$drugcode<320000),]
# dementia201012 <- prescribe201012[which(prescribe201012$drugcode>=411000&prescribe201012$drugcode<500000),]
# diabetes201012 <- prescribe201012[which(prescribe201012$drugcode>=601000&prescribe201012$drugcode<602000),]
# 
# antidep201012 <- aggregate(antidep201012[-c(1:5, 11)], antidep201012["PRACTICE"], sum)
# antidep201012$PERIOD <- 201012
# antidep201012$Druggroup <- "Antidepressant"
# dementia201012 <- aggregate(dementia201012[-c(1:5, 11)], dementia201012["PRACTICE"], sum)
# dementia201012$PERIOD <- 201012
# dementia201012$Druggroup <- "Dementia"
# diabetes201012 <- aggregate(diabetes201012[-c(1:5, 11)], diabetes201012["PRACTICE"], sum)
# diabetes201012$PERIOD <- 201012
# diabetes201012$Druggroup <- "Diabetes"
# 
# bronchodilators201012 <- aggregate(bronchodilators201012[-c(1:5, 11)], bronchodilators201012["PRACTICE"], sum)
# bronchodilators201012$PERIOD <- 201012
# bronchodilators201012$Druggroup <- "Bronchodilators"
# opioddep201012 <- aggregate(opioddep201012[-c(1:5, 11)], opioddep201012["PRACTICE"], sum)
# opioddep201012$PERIOD <- 201012
# opioddep201012$Druggroup <- "Opiod"
# nicotinedep201012 <- aggregate(nicotinedep201012[-c(1:5, 11)], nicotinedep201012["PRACTICE"], sum)
# nicotinedep201012$PERIOD <- 201012
# nicotinedep201012$Druggroup <- "Nicotine"
# alcoholdep201012 <- aggregate(alcoholdep201012[-c(1:5, 11)], alcoholdep201012["PRACTICE"], sum)
# alcoholdep201012$PERIOD <- 201012
# alcoholdep201012$Druggroup <- "Alcohol"
# allsubstancedep201012 <- aggregate(allsubstancedep201012[-c(1:5, 11)], allsubstancedep201012["PRACTICE"], sum)
# allsubstancedep201012$PERIOD <- 201012
# allsubstancedep201012$Druggroup <- "SubstanceDep"
# obesedrugs201012 <- aggregate(obesedrugs201012[-c(1:5, 11)], obesedrugs201012["PRACTICE"], sum)
# obesedrugs201012$PERIOD <- 201012
# obesedrugs201012$Druggroup <- "Obesity"
# 
# prescribemaster201012 <- do.call("rbind", list(obesedrugs201012, allsubstancedep201012, alcoholdep201012, 
#                                                nicotinedep201012,opioddep201012, bronchodilators201012,
#                                                antidep201012, diabetes201012, dementia201012))
# 
# 
# write.csv(prescribemaster201012, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201012.csv")
# rm(list = ls(all.names = TRUE))
# 
# 
# prescribe201011 <- read_csv("H:/prescription data/T201011PDPI BNFT.csv")
# prescribe201011$drugcode <- parse_number(prescribe201011$`BNF CODE`)
# prescribe201011$drugcode <- substr(prescribe201011$drugcode, 0, 6)
# antidep201011 <- prescribe201011[which(prescribe201011$drugcode>=403000&prescribe201011$drugcode<404000),]
# obesedrugs201011 <- prescribe201011[which(prescribe201011$drugcode>=405000&prescribe201011$drugcode<406000),]
# allsubstancedep201011 <- prescribe201011[which(prescribe201011$drugcode>=410000&prescribe201011$drugcode<411000),]
# alcoholdep201011 <- prescribe201011[which(prescribe201011$drugcode>=410010&prescribe201011$drugcode<410020),]
# nicotinedep201011 <- prescribe201011[which(prescribe201011$drugcode>=410020&prescribe201011$drugcode<410030),]
# opioddep201011 <- prescribe201011[which(prescribe201011$drugcode>=410030&prescribe201011$drugcode<411000),]
# bronchodilators201011 <- prescribe201011[which(prescribe201011$drugcode>=310000&prescribe201011$drugcode<320000),]
# dementia201011 <- prescribe201011[which(prescribe201011$drugcode>=411000&prescribe201011$drugcode<500000),]
# diabetes201011 <- prescribe201011[which(prescribe201011$drugcode>=601000&prescribe201011$drugcode<602000),]
# 
# antidep201011 <- aggregate(antidep201011[-c(1:5, 11)], antidep201011["PRACTICE"], sum)
# antidep201011$PERIOD <- 201011
# antidep201011$Druggroup <- "Antidepressant"
# dementia201011 <- aggregate(dementia201011[-c(1:5, 11)], dementia201011["PRACTICE"], sum)
# dementia201011$PERIOD <- 201011
# dementia201011$Druggroup <- "Dementia"
# diabetes201011 <- aggregate(diabetes201011[-c(1:5, 11)], diabetes201011["PRACTICE"], sum)
# diabetes201011$PERIOD <- 201011
# diabetes201011$Druggroup <- "Diabetes"
# 
# bronchodilators201011 <- aggregate(bronchodilators201011[-c(1:5, 11)], bronchodilators201011["PRACTICE"], sum)
# bronchodilators201011$PERIOD <- 201011
# bronchodilators201011$Druggroup <- "Bronchodilators"
# opioddep201011 <- aggregate(opioddep201011[-c(1:5, 11)], opioddep201011["PRACTICE"], sum)
# opioddep201011$PERIOD <- 201011
# opioddep201011$Druggroup <- "Opiod"
# nicotinedep201011 <- aggregate(nicotinedep201011[-c(1:5, 11)], nicotinedep201011["PRACTICE"], sum)
# nicotinedep201011$PERIOD <- 201011
# nicotinedep201011$Druggroup <- "Nicotine"
# alcoholdep201011 <- aggregate(alcoholdep201011[-c(1:5, 11)], alcoholdep201011["PRACTICE"], sum)
# alcoholdep201011$PERIOD <- 201011
# alcoholdep201011$Druggroup <- "Alcohol"
# allsubstancedep201011 <- aggregate(allsubstancedep201011[-c(1:5, 11)], allsubstancedep201011["PRACTICE"], sum)
# allsubstancedep201011$PERIOD <- 201011
# allsubstancedep201011$Druggroup <- "SubstanceDep"
# obesedrugs201011 <- aggregate(obesedrugs201011[-c(1:5, 11)], obesedrugs201011["PRACTICE"], sum)
# obesedrugs201011$PERIOD <- 201011
# obesedrugs201011$Druggroup <- "Obesity"
# 
# prescribemaster201011 <- do.call("rbind", list(obesedrugs201011, allsubstancedep201011, alcoholdep201011, 
#                                                nicotinedep201011,opioddep201011, bronchodilators201011,
#                                                antidep201011, diabetes201011, dementia201011))
# 
# 
# write.csv(prescribemaster201011, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201011.csv")
# rm(list = ls(all.names = TRUE))
# 
# prescribe201010 <- read_csv("H:/prescription data/T201010PDPI BNFT.csv")
# prescribe201010$drugcode <- parse_number(prescribe201010$`BNF CODE`)
# prescribe201010$drugcode <- substr(prescribe201010$drugcode, 0, 6)
# antidep201010 <- prescribe201010[which(prescribe201010$drugcode>=403000&prescribe201010$drugcode<404000),]
# obesedrugs201010 <- prescribe201010[which(prescribe201010$drugcode>=405000&prescribe201010$drugcode<406000),]
# allsubstancedep201010 <- prescribe201010[which(prescribe201010$drugcode>=410000&prescribe201010$drugcode<411000),]
# # alcoholdep201010 <- prescribe201010[which(prescribe201010$drugcode>=410010&prescribe201010$drugcode<410020),]
# # nicotinedep201010 <- prescribe201010[which(prescribe201010$drugcode>=410020&prescribe201010$drugcode<410030),]
# # opioddep201010 <- prescribe201010[which(prescribe201010$drugcode>=410030&prescribe201010$drugcode<411000),]
# # bronchodilators201010 <- prescribe201010[which(prescribe201010$drugcode>=310000&prescribe201010$drugcode<320000),]
# # dementia201010 <- prescribe201010[which(prescribe201010$drugcode>=411000&prescribe201010$drugcode<500000),]
# # diabetes201010 <- prescribe201010[which(prescribe201010$drugcode>=601000&prescribe201010$drugcode<602000),]
# # 
# # antidep201010 <- aggregate(antidep201010[-c(1:5, 11)], antidep201010["PRACTICE"], sum)
# # antidep201010$PERIOD <- 201010
# # antidep201010$Druggroup <- "Antidepressant"
# # dementia201010 <- aggregate(dementia201010[-c(1:5, 11)], dementia201010["PRACTICE"], sum)
# # dementia201010$PERIOD <- 201010
# # dementia201010$Druggroup <- "Dementia"
# # diabetes201010 <- aggregate(diabetes201010[-c(1:5, 11)], diabetes201010["PRACTICE"], sum)
# # diabetes201010$PERIOD <- 201010
# # diabetes201010$Druggroup <- "Diabetes"
# # 
# # bronchodilators201010 <- aggregate(bronchodilators201010[-c(1:5, 11)], bronchodilators201010["PRACTICE"], sum)
# # bronchodilators201010$PERIOD <- 201010
# # bronchodilators201010$Druggroup <- "Bronchodilators"
# # opioddep201010 <- aggregate(opioddep201010[-c(1:5, 11)], opioddep201010["PRACTICE"], sum)
# # opioddep201010$PERIOD <- 201010
# # opioddep201010$Druggroup <- "Opiod"
# # nicotinedep201010 <- aggregate(nicotinedep201010[-c(1:5, 11)], nicotinedep201010["PRACTICE"], sum)
# # nicotinedep201010$PERIOD <- 201010
# # nicotinedep201010$Druggroup <- "Nicotine"
# # alcoholdep201010 <- aggregate(alcoholdep201010[-c(1:5, 11)], alcoholdep201010["PRACTICE"], sum)
# # alcoholdep201010$PERIOD <- 201010
# # alcoholdep201010$Druggroup <- "Alcohol"
# # allsubstancedep201010 <- aggregate(allsubstancedep201010[-c(1:5, 11)], allsubstancedep201010["PRACTICE"], sum)
# # allsubstancedep201010$PERIOD <- 201010
# # allsubstancedep201010$Druggroup <- "SubstanceDep"
# # obesedrugs201010 <- aggregate(obesedrugs201010[-c(1:5, 11)], obesedrugs201010["PRACTICE"], sum)
# # obesedrugs201010$PERIOD <- 201010
# # obesedrugs201010$Druggroup <- "Obesity"
# # 
# # prescribemaster201010 <- do.call("rbind", list(obesedrugs201010, allsubstancedep201010, alcoholdep201010, 
# #                                                nicotinedep201010,opioddep201010, bronchodilators201010,
# #                                                antidep201010, diabetes201010, dementia201010))
# # 
# # 
# # write.csv(prescribemaster201010, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201010.csv")
# # rm(list = ls(all.names = TRUE))
# # 
# # prescribe201009 <- read_csv("H:/prescription data/T201009PDPI BNFT.csv")
# # prescribe201009$drugcode <- parse_number(prescribe201009$`BNF CODE`)
# # prescribe201009$drugcode <- substr(prescribe201009$drugcode, 0, 6)
# # antidep201009 <- prescribe201009[which(prescribe201009$drugcode>=403000&prescribe201009$drugcode<404000),]
# # obesedrugs201009 <- prescribe201009[which(prescribe201009$drugcode>=405000&prescribe201009$drugcode<406000),]
# # allsubstancedep201009 <- prescribe201009[which(prescribe201009$drugcode>=410000&prescribe201009$drugcode<411000),]
# # alcoholdep201009 <- prescribe201009[which(prescribe201009$drugcode>=410010&prescribe201009$drugcode<410020),]
# # nicotinedep201009 <- prescribe201009[which(prescribe201009$drugcode>=410020&prescribe201009$drugcode<410030),]
# # opioddep201009 <- prescribe201009[which(prescribe201009$drugcode>=410030&prescribe201009$drugcode<411000),]
# # bronchodilators201009 <- prescribe201009[which(prescribe201009$drugcode>=310000&prescribe201009$drugcode<320000),]
# # dementia201009 <- prescribe201009[which(prescribe201009$drugcode>=411000&prescribe201009$drugcode<500000),]
# # diabetes201009 <- prescribe201009[which(prescribe201009$drugcode>=601000&prescribe201009$drugcode<602000),]
# # 
# # antidep201009 <- aggregate(antidep201009[-c(1:5, 11)], antidep201009["PRACTICE"], sum)
# # antidep201009$PERIOD <- 201009
# # antidep201009$Druggroup <- "Antidepressant"
# # dementia201009 <- aggregate(dementia201009[-c(1:5, 11)], dementia201009["PRACTICE"], sum)
# # dementia201009$PERIOD <- 201009
# # dementia201009$Druggroup <- "Dementia"
# # diabetes201009 <- aggregate(diabetes201009[-c(1:5, 11)], diabetes201009["PRACTICE"], sum)
# # diabetes201009$PERIOD <- 201009
# # diabetes201009$Druggroup <- "Diabetes"
# # 
# # bronchodilators201009 <- aggregate(bronchodilators201009[-c(1:5, 11)], bronchodilators201009["PRACTICE"], sum)
# # bronchodilators201009$PERIOD <- 201009
# # bronchodilators201009$Druggroup <- "Bronchodilators"
# # opioddep201009 <- aggregate(opioddep201009[-c(1:5, 11)], opioddep201009["PRACTICE"], sum)
# # opioddep201009$PERIOD <- 201009
# # opioddep201009$Druggroup <- "Opiod"
# # nicotinedep201009 <- aggregate(nicotinedep201009[-c(1:5, 11)], nicotinedep201009["PRACTICE"], sum)
# # nicotinedep201009$PERIOD <- 201009
# # nicotinedep201009$Druggroup <- "Nicotine"
# # alcoholdep201009 <- aggregate(alcoholdep201009[-c(1:5, 11)], alcoholdep201009["PRACTICE"], sum)
# # alcoholdep201009$PERIOD <- 201009
# # alcoholdep201009$Druggroup <- "Alcohol"
# # allsubstancedep201009 <- aggregate(allsubstancedep201009[-c(1:5, 11)], allsubstancedep201009["PRACTICE"], sum)
# # allsubstancedep201009$PERIOD <- 201009
# # allsubstancedep201009$Druggroup <- "SubstanceDep"
# # obesedrugs201009 <- aggregate(obesedrugs201009[-c(1:5, 11)], obesedrugs201009["PRACTICE"], sum)
# # obesedrugs201009$PERIOD <- 201009
# # obesedrugs201009$Druggroup <- "Obesity"
# # 
# # prescribemaster201009 <- do.call("rbind", list(obesedrugs201009, allsubstancedep201009, alcoholdep201009, 
# #                                                nicotinedep201009,opioddep201009, bronchodilators201009,
# #                                                antidep201009, diabetes201009, dementia201009))
# # 
# # 
# # write.csv(prescribemaster201009, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201009.csv")
# # rm(list = ls(all.names = TRUE))
# # 
# # 
# # prescribe201008 <- read_csv("H:/prescription data/T201008PDPI BNFT.csv")
# # prescribe201008$drugcode <- parse_number(prescribe201008$`BNF CODE`)
# # prescribe201008$drugcode <- substr(prescribe201008$drugcode, 0, 6)
# # antidep201008 <- prescribe201008[which(prescribe201008$drugcode>=403000&prescribe201008$drugcode<404000),]
# # obesedrugs201008 <- prescribe201008[which(prescribe201008$drugcode>=405000&prescribe201008$drugcode<406000),]
# # allsubstancedep201008 <- prescribe201008[which(prescribe201008$drugcode>=410000&prescribe201008$drugcode<411000),]
# # alcoholdep201008 <- prescribe201008[which(prescribe201008$drugcode>=410010&prescribe201008$drugcode<410020),]
# # nicotinedep201008 <- prescribe201008[which(prescribe201008$drugcode>=410020&prescribe201008$drugcode<410030),]
# # opioddep201008 <- prescribe201008[which(prescribe201008$drugcode>=410030&prescribe201008$drugcode<411000),]
# # bronchodilators201008 <- prescribe201008[which(prescribe201008$drugcode>=310000&prescribe201008$drugcode<320000),]
# # dementia201008 <- prescribe201008[which(prescribe201008$drugcode>=411000&prescribe201008$drugcode<500000),]
# # diabetes201008 <- prescribe201008[which(prescribe201008$drugcode>=601000&prescribe201008$drugcode<602000),]
# # 
# # antidep201008 <- aggregate(antidep201008[-c(1:5, 11)], antidep201008["PRACTICE"], sum)
# # antidep201008$PERIOD <- 201008
# # antidep201008$Druggroup <- "Antidepressant"
# # dementia201008 <- aggregate(dementia201008[-c(1:5, 11)], dementia201008["PRACTICE"], sum)
# # dementia201008$PERIOD <- 201008
# # dementia201008$Druggroup <- "Dementia"
# # diabetes201008 <- aggregate(diabetes201008[-c(1:5, 11)], diabetes201008["PRACTICE"], sum)
# # diabetes201008$PERIOD <- 201008
# # diabetes201008$Druggroup <- "Diabetes"
# # 
# # bronchodilators201008 <- aggregate(bronchodilators201008[-c(1:5, 11)], bronchodilators201008["PRACTICE"], sum)
# # bronchodilators201008$PERIOD <- 201008
# # bronchodilators201008$Druggroup <- "Bronchodilators"
# # opioddep201008 <- aggregate(opioddep201008[-c(1:5, 11)], opioddep201008["PRACTICE"], sum)
# # opioddep201008$PERIOD <- 201008
# # opioddep201008$Druggroup <- "Opiod"
# # nicotinedep201008 <- aggregate(nicotinedep201008[-c(1:5, 11)], nicotinedep201008["PRACTICE"], sum)
# # nicotinedep201008$PERIOD <- 201008
# # nicotinedep201008$Druggroup <- "Nicotine"
# # alcoholdep201008 <- aggregate(alcoholdep201008[-c(1:5, 11)], alcoholdep201008["PRACTICE"], sum)
# # alcoholdep201008$PERIOD <- 201008
# # alcoholdep201008$Druggroup <- "Alcohol"
# # allsubstancedep201008 <- aggregate(allsubstancedep201008[-c(1:5, 11)], allsubstancedep201008["PRACTICE"], sum)
# # allsubstancedep201008$PERIOD <- 201008
# # allsubstancedep201008$Druggroup <- "SubstanceDep"
# # obesedrugs201008 <- aggregate(obesedrugs201008[-c(1:5, 11)], obesedrugs201008["PRACTICE"], sum)
# # obesedrugs201008$PERIOD <- 201008
# # obesedrugs201008$Druggroup <- "Obesity"
# # 
# # prescribemaster201008 <- do.call("rbind", list(obesedrugs201008, allsubstancedep201008, alcoholdep201008, 
# #                                                nicotinedep201008,opioddep201008, bronchodilators201008,
# #                                                antidep201008, diabetes201008, dementia201008))
# # 
# # 
# # write.csv(prescribemaster201008, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescribemaster201008.csv")
# # rm(list = ls(all.names = TRUE))
# # 
# 
# 
# 
# 
# 
# ####Prescription to lsoa conversion####
# 
 prescribe201912 <- read_csv("prescribemaster201912.csv")
 prescribe201912 <- prescribe201912[-c(1)]
 names(prescribe201912)[names(prescribe201912)=="PRACTICE"] <- "PRACTICE_CODE"
 gpusersoct19 <- read_csv("gp-reg-pat-prac-lsoa-all-oct19.csv")
 names(gpusersoct19)[names(gpusersoct19)=="LSOA_CODE"] <- "LSOA11CD"
 
 gpusersoct19 <- merge(gpusersoct19, lsoalookup, by="LSOA11CD", all.x=TRUE)
 
 buagppop <- aggregate(gpusersoct19[-c(1:6,8,9)], gpusersoct19["BUASD11CD"], sum)
 names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
 
 prescribe201912 <- merge(gpusersoct19, prescribe201912, by="PRACTICE_CODE", all.x=TRUE)
 prescribe201912 <- merge(prescribe201912, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201912$itemsper <- prescribe201912$ITEMS*(prescribe201912$`Number of Patients`/prescribe201912$total_patients)
# prescribe201912$nicper <- prescribe201912$NIC*(prescribe201912$`Number of Patients`/prescribe201912$total_patients)
# prescribe201912$actcostper <- prescribe201912$`ACT COST`*(prescribe201912$`Number of Patients`/prescribe201912$total_patients)
# prescribe201912$quantityper <- prescribe201912$QUANTITY*(prescribe201912$`Number of Patients`/prescribe201912$total_patients)
# 
# prescribe201912 <- prescribe201912[-c(2:14, 16)]
# 
# prescribe201912 <- aggregate(prescribe201912[-c(1,2)], by=list(factor(prescribe201912$BUASD11CD), factor(prescribe201912$Druggroup)), sum)
# 
# names(prescribe201912)[names(prescribe201912)=="Group.1"] <- "BUASD11CD"
# names(prescribe201912)[names(prescribe201912)=="Group.2"] <- "Druggroup"
# prescribe201912$PERIOD <- 201912
# 
# prescribe201911 <- read_csv("prescribemaster201911.csv")
# prescribe201911 <- prescribe201911[-c(1)]
# names(prescribe201911)[names(prescribe201911)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct19 <- read_csv("gp-reg-pat-prac-lsoa-all-oct19.csv")
# names(gpusersoct19)[names(gpusersoct19)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct19 <- merge(gpusersoct19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct19[-c(1:6,8,9)], gpusersoct19["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201911 <- merge(gpusersoct19, prescribe201911, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201911 <- merge(prescribe201911, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201911$itemsper <- prescribe201911$ITEMS*(prescribe201911$`Number of Patients`/prescribe201911$total_patients)
# prescribe201911$nicper <- prescribe201911$NIC*(prescribe201911$`Number of Patients`/prescribe201911$total_patients)
# prescribe201911$actcostper <- prescribe201911$`ACT COST`*(prescribe201911$`Number of Patients`/prescribe201911$total_patients)
# prescribe201911$quantityper <- prescribe201911$QUANTITY*(prescribe201911$`Number of Patients`/prescribe201911$total_patients)
# 
# prescribe201911 <- prescribe201911[-c(2:14, 16)]
# 
# prescribe201911 <- aggregate(prescribe201911[-c(1,2)], by=list(factor(prescribe201911$BUASD11CD), factor(prescribe201911$Druggroup)), sum)
# 
# names(prescribe201911)[names(prescribe201911)=="Group.1"] <- "BUASD11CD"
# names(prescribe201911)[names(prescribe201911)=="Group.2"] <- "Druggroup"
# prescribe201911$PERIOD <- 201911
# 
# prescription <- rbind(prescribe201912, prescribe201911)
# 
# prescribe201910 <- read_csv("prescribemaster201910.csv")
# prescribe201910 <- prescribe201910[-c(1)]
# names(prescribe201910)[names(prescribe201910)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct19 <- read_csv("gp-reg-pat-prac-lsoa-all-oct19.csv")
# names(gpusersoct19)[names(gpusersoct19)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct19 <- merge(gpusersoct19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct19[-c(1:6,8,9)], gpusersoct19["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201910 <- merge(gpusersoct19, prescribe201910, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201910 <- merge(prescribe201910, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201910$itemsper <- prescribe201910$ITEMS*(prescribe201910$`Number of Patients`/prescribe201910$total_patients)
# prescribe201910$nicper <- prescribe201910$NIC*(prescribe201910$`Number of Patients`/prescribe201910$total_patients)
# prescribe201910$actcostper <- prescribe201910$`ACT COST`*(prescribe201910$`Number of Patients`/prescribe201910$total_patients)
# prescribe201910$quantityper <- prescribe201910$QUANTITY*(prescribe201910$`Number of Patients`/prescribe201910$total_patients)
# 
# prescribe201910 <- prescribe201910[-c(2:14, 16)]
# 
# prescribe201910 <- aggregate(prescribe201910[-c(1,2)], by=list(factor(prescribe201910$BUASD11CD), factor(prescribe201910$Druggroup)), sum)
# 
# names(prescribe201910)[names(prescribe201910)=="Group.1"] <- "BUASD11CD"
# names(prescribe201910)[names(prescribe201910)=="Group.2"] <- "Druggroup"
# prescribe201910$PERIOD <- 201910
# 
# prescription <- rbind(prescription, prescribe201910)
# 
# 
# 
# prescribe201909 <- read_csv("prescribemaster201909.csv")
# prescribe201909 <- prescribe201909[-c(1)]
# names(prescribe201909)[names(prescribe201909)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct19 <- read_csv("gp-reg-pat-prac-lsoa-all-oct19.csv")
# names(gpusersoct19)[names(gpusersoct19)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct19 <- merge(gpusersoct19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct19[-c(1:6,8,9)], gpusersoct19["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201909 <- merge(gpusersoct19, prescribe201909, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201909 <- merge(prescribe201909, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201909$itemsper <- prescribe201909$ITEMS*(prescribe201909$`Number of Patients`/prescribe201909$total_patients)
# prescribe201909$nicper <- prescribe201909$NIC*(prescribe201909$`Number of Patients`/prescribe201909$total_patients)
# prescribe201909$actcostper <- prescribe201909$`ACT COST`*(prescribe201909$`Number of Patients`/prescribe201909$total_patients)
# prescribe201909$quantityper <- prescribe201909$QUANTITY*(prescribe201909$`Number of Patients`/prescribe201909$total_patients)
# 
# prescribe201909 <- prescribe201909[-c(2:14, 16)]
# 
# prescribe201909 <- aggregate(prescribe201909[-c(1,2)], by=list(factor(prescribe201909$BUASD11CD), factor(prescribe201909$Druggroup)), sum)
# 
# names(prescribe201909)[names(prescribe201909)=="Group.1"] <- "BUASD11CD"
# names(prescribe201909)[names(prescribe201909)=="Group.2"] <- "Druggroup"
# prescribe201909$PERIOD <- 201909
# 
# prescription <- rbind(prescription, prescribe201909)
# 
# 
# 
# 
# prescribe201908 <- read_csv("prescribemaster201908.csv")
# prescribe201908 <- prescribe201908[-c(1)]
# names(prescribe201908)[names(prescribe201908)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul19 <- read_csv("gp-reg-pat-prac-lsoa-all-jul19.csv")
# names(gpusersjul19)[names(gpusersjul19)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul19 <- merge(gpusersjul19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul19[-c(1:6,8,9)], gpusersjul19["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201908 <- merge(gpusersjul19, prescribe201908, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201908 <- merge(prescribe201908, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201908$itemsper <- prescribe201908$ITEMS*(prescribe201908$`Number of Patients`/prescribe201908$total_patients)
# prescribe201908$nicper <- prescribe201908$NIC*(prescribe201908$`Number of Patients`/prescribe201908$total_patients)
# prescribe201908$actcostper <- prescribe201908$`ACT COST`*(prescribe201908$`Number of Patients`/prescribe201908$total_patients)
# prescribe201908$quantityper <- prescribe201908$QUANTITY*(prescribe201908$`Number of Patients`/prescribe201908$total_patients)
# 
# prescribe201908 <- prescribe201908[-c(2:14, 16)]
# 
# prescribe201908 <- aggregate(prescribe201908[-c(1,2)], by=list(factor(prescribe201908$BUASD11CD), factor(prescribe201908$Druggroup)), sum)
# 
# names(prescribe201908)[names(prescribe201908)=="Group.1"] <- "BUASD11CD"
# names(prescribe201908)[names(prescribe201908)=="Group.2"] <- "Druggroup"
# prescribe201908$PERIOD <- 201908
# 
# prescription <- rbind(prescription, prescribe201908)
# 
# 
# prescribe201907 <- read_csv("prescribemaster201907.csv")
# prescribe201907 <- prescribe201907[-c(1)]
# names(prescribe201907)[names(prescribe201907)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul19 <- read_csv("gp-reg-pat-prac-lsoa-all-jul19.csv")
# names(gpusersjul19)[names(gpusersjul19)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul19 <- merge(gpusersjul19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul19[-c(1:6,8,9)], gpusersjul19["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201907 <- merge(gpusersjul19, prescribe201907, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201907 <- merge(prescribe201907, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201907$itemsper <- prescribe201907$ITEMS*(prescribe201907$`Number of Patients`/prescribe201907$total_patients)
# prescribe201907$nicper <- prescribe201907$NIC*(prescribe201907$`Number of Patients`/prescribe201907$total_patients)
# prescribe201907$actcostper <- prescribe201907$`ACT COST`*(prescribe201907$`Number of Patients`/prescribe201907$total_patients)
# prescribe201907$quantityper <- prescribe201907$QUANTITY*(prescribe201907$`Number of Patients`/prescribe201907$total_patients)
# 
# prescribe201907 <- prescribe201907[-c(2:14, 16)]
# 
# prescribe201907 <- aggregate(prescribe201907[-c(1,2)], by=list(factor(prescribe201907$BUASD11CD), factor(prescribe201907$Druggroup)), sum)
# 
# names(prescribe201907)[names(prescribe201907)=="Group.1"] <- "BUASD11CD"
# names(prescribe201907)[names(prescribe201907)=="Group.2"] <- "Druggroup"
# prescribe201907$PERIOD <- 201907
# 
# prescription <- rbind(prescription, prescribe201907)
# 
# 
# 
# prescribe201906 <- read_csv("prescribemaster201906.csv")
# prescribe201906 <- prescribe201906[-c(1)]
# names(prescribe201906)[names(prescribe201906)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul19 <- read_csv("gp-reg-pat-prac-lsoa-all-jul19.csv")
# names(gpusersjul19)[names(gpusersjul19)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul19 <- merge(gpusersjul19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul19[-c(1:6,8,9)], gpusersjul19["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201906 <- merge(gpusersjul19, prescribe201906, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201906 <- merge(prescribe201906, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201906$itemsper <- prescribe201906$ITEMS*(prescribe201906$`Number of Patients`/prescribe201906$total_patients)
# prescribe201906$nicper <- prescribe201906$NIC*(prescribe201906$`Number of Patients`/prescribe201906$total_patients)
# prescribe201906$actcostper <- prescribe201906$`ACT COST`*(prescribe201906$`Number of Patients`/prescribe201906$total_patients)
# prescribe201906$quantityper <- prescribe201906$QUANTITY*(prescribe201906$`Number of Patients`/prescribe201906$total_patients)
# 
# prescribe201906 <- prescribe201906[-c(2:14, 16)]
# 
# prescribe201906 <- aggregate(prescribe201906[-c(1,2)], by=list(factor(prescribe201906$BUASD11CD), factor(prescribe201906$Druggroup)), sum)
# 
# names(prescribe201906)[names(prescribe201906)=="Group.1"] <- "BUASD11CD"
# names(prescribe201906)[names(prescribe201906)=="Group.2"] <- "Druggroup"
# prescribe201906$PERIOD <- 201906
# 
# prescription <- rbind(prescription, prescribe201906)
# 
# 
# 
# prescribe201905 <- read_csv("prescribemaster201905.csv")
# prescribe201905 <- prescribe201905[-c(1)]
# names(prescribe201905)[names(prescribe201905)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr19 <- read_csv("gp-reg-pat-prac-lsoa-all-apr19.csv")
# names(gpusersapr19)[names(gpusersapr19)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr19 <- merge(gpusersapr19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr19[-c(1:6,8,9)], gpusersapr19["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201905 <- merge(gpusersapr19, prescribe201905, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201905 <- merge(prescribe201905, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201905$itemsper <- prescribe201905$ITEMS*(prescribe201905$`Number of Patients`/prescribe201905$total_patients)
# prescribe201905$nicper <- prescribe201905$NIC*(prescribe201905$`Number of Patients`/prescribe201905$total_patients)
# prescribe201905$actcostper <- prescribe201905$`ACT COST`*(prescribe201905$`Number of Patients`/prescribe201905$total_patients)
# prescribe201905$quantityper <- prescribe201905$QUANTITY*(prescribe201905$`Number of Patients`/prescribe201905$total_patients)
# 
# prescribe201905 <- prescribe201905[-c(2:14, 16)]
# 
# prescribe201905 <- aggregate(prescribe201905[-c(1,2)], by=list(factor(prescribe201905$BUASD11CD), factor(prescribe201905$Druggroup)), sum)
# 
# names(prescribe201905)[names(prescribe201905)=="Group.1"] <- "BUASD11CD"
# names(prescribe201905)[names(prescribe201905)=="Group.2"] <- "Druggroup"
# prescribe201905$PERIOD <- 201905
# 
# prescription <- rbind(prescription, prescribe201905)
# 
# 
# 
# 
# prescribe201904 <- read_csv("prescribemaster201904.csv")
# prescribe201904 <- prescribe201904[-c(1)]
# names(prescribe201904)[names(prescribe201904)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr19 <- read_csv("gp-reg-pat-prac-lsoa-all-apr19.csv")
# names(gpusersapr19)[names(gpusersapr19)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr19 <- merge(gpusersapr19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr19[-c(1:6,8,9)], gpusersapr19["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201904 <- merge(gpusersapr19, prescribe201904, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201904 <- merge(prescribe201904, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201904$itemsper <- prescribe201904$ITEMS*(prescribe201904$`Number of Patients`/prescribe201904$total_patients)
# prescribe201904$nicper <- prescribe201904$NIC*(prescribe201904$`Number of Patients`/prescribe201904$total_patients)
# prescribe201904$actcostper <- prescribe201904$`ACT COST`*(prescribe201904$`Number of Patients`/prescribe201904$total_patients)
# prescribe201904$quantityper <- prescribe201904$QUANTITY*(prescribe201904$`Number of Patients`/prescribe201904$total_patients)
# 
# prescribe201904 <- prescribe201904[-c(2:14, 16)]
# 
# prescribe201904 <- aggregate(prescribe201904[-c(1,2)], by=list(factor(prescribe201904$BUASD11CD), factor(prescribe201904$Druggroup)), sum)
# 
# names(prescribe201904)[names(prescribe201904)=="Group.1"] <- "BUASD11CD"
# names(prescribe201904)[names(prescribe201904)=="Group.2"] <- "Druggroup"
# prescribe201904$PERIOD <- 201904
# 
# prescription <- rbind(prescription, prescribe201904)
# 
# 
# 
# 
# 
# prescribe201903 <- read_csv("prescribemaster201903.csv")
# prescribe201903 <- prescribe201903[-c(1)]
# names(prescribe201903)[names(prescribe201903)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr19 <- read_csv("gp-reg-pat-prac-lsoa-all-apr19.csv")
# names(gpusersapr19)[names(gpusersapr19)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr19 <- merge(gpusersapr19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr19[-c(1:6,8,9)], gpusersapr19["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201903 <- merge(gpusersapr19, prescribe201903, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201903 <- merge(prescribe201903, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201903$itemsper <- prescribe201903$ITEMS*(prescribe201903$`Number of Patients`/prescribe201903$total_patients)
# prescribe201903$nicper <- prescribe201903$NIC*(prescribe201903$`Number of Patients`/prescribe201903$total_patients)
# prescribe201903$actcostper <- prescribe201903$`ACT COST`*(prescribe201903$`Number of Patients`/prescribe201903$total_patients)
# prescribe201903$quantityper <- prescribe201903$QUANTITY*(prescribe201903$`Number of Patients`/prescribe201903$total_patients)
# 
# prescribe201903 <- prescribe201903[-c(2:14, 16)]
# 
# prescribe201903 <- aggregate(prescribe201903[-c(1,2)], by=list(factor(prescribe201903$BUASD11CD), factor(prescribe201903$Druggroup)), sum)
# 
# names(prescribe201903)[names(prescribe201903)=="Group.1"] <- "BUASD11CD"
# names(prescribe201903)[names(prescribe201903)=="Group.2"] <- "Druggroup"
# prescribe201903$PERIOD <- 201903
# 
# prescription <- rbind(prescription, prescribe201903)
# 
# 
# prescribe201902 <- read_csv("prescribemaster201902.csv")
# prescribe201902 <- prescribe201902[-c(1)]
# names(prescribe201902)[names(prescribe201902)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjan19 <- read_csv("gp-reg-pat-prac-lsoa-all-jan19.csv")
# names(gpusersjan19)[names(gpusersjan19)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjan19 <- merge(gpusersjan19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjan19[-c(1:6,8,9)], gpusersjan19["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201902 <- merge(gpusersjan19, prescribe201902, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201902 <- merge(prescribe201902, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201902$itemsper <- prescribe201902$ITEMS*(prescribe201902$`Number of Patients`/prescribe201902$total_patients)
# prescribe201902$nicper <- prescribe201902$NIC*(prescribe201902$`Number of Patients`/prescribe201902$total_patients)
# prescribe201902$actcostper <- prescribe201902$`ACT COST`*(prescribe201902$`Number of Patients`/prescribe201902$total_patients)
# prescribe201902$quantityper <- prescribe201902$QUANTITY*(prescribe201902$`Number of Patients`/prescribe201902$total_patients)
# 
# prescribe201902 <- prescribe201902[-c(2:14, 16)]
# 
# prescribe201902 <- aggregate(prescribe201902[-c(1,2)], by=list(factor(prescribe201902$BUASD11CD), factor(prescribe201902$Druggroup)), sum)
# 
# names(prescribe201902)[names(prescribe201902)=="Group.1"] <- "BUASD11CD"
# names(prescribe201902)[names(prescribe201902)=="Group.2"] <- "Druggroup"
# prescribe201902$PERIOD <- 201902
# 
# prescription <- rbind(prescription, prescribe201902)
# 
# prescribe201901 <- read_csv("prescribemaster201901.csv")
# prescribe201901 <- prescribe201901[-c(1)]
# names(prescribe201901)[names(prescribe201901)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjan19 <- read_csv("gp-reg-pat-prac-lsoa-all-jan19.csv")
# names(gpusersjan19)[names(gpusersjan19)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjan19 <- merge(gpusersjan19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjan19[-c(1:6,8,9)], gpusersjan19["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201901 <- merge(gpusersjan19, prescribe201901, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201901 <- merge(prescribe201901, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201901$itemsper <- prescribe201901$ITEMS*(prescribe201901$`Number of Patients`/prescribe201901$total_patients)
# prescribe201901$nicper <- prescribe201901$NIC*(prescribe201901$`Number of Patients`/prescribe201901$total_patients)
# prescribe201901$actcostper <- prescribe201901$`ACT COST`*(prescribe201901$`Number of Patients`/prescribe201901$total_patients)
# prescribe201901$quantityper <- prescribe201901$QUANTITY*(prescribe201901$`Number of Patients`/prescribe201901$total_patients)
# 
# prescribe201901 <- prescribe201901[-c(2:14, 16)]
# 
# prescribe201901 <- aggregate(prescribe201901[-c(1,2)], by=list(factor(prescribe201901$BUASD11CD), factor(prescribe201901$Druggroup)), sum)
# 
# names(prescribe201901)[names(prescribe201901)=="Group.1"] <- "BUASD11CD"
# names(prescribe201901)[names(prescribe201901)=="Group.2"] <- "Druggroup"
# prescribe201901$PERIOD <- 201901
# 
# prescription <- rbind(prescription, prescribe201901)
# 
# prescribe201812 <- read_csv("prescribemaster201812.csv")
# prescribe201812 <- prescribe201812[-c(1)]
# names(prescribe201812)[names(prescribe201812)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjan19 <- read_csv("gp-reg-pat-prac-lsoa-all-jan19.csv")
# names(gpusersjan19)[names(gpusersjan19)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjan19 <- merge(gpusersjan19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjan19[-c(1:6,8,9)], gpusersjan19["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201812 <- merge(gpusersjan19, prescribe201812, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201812 <- merge(prescribe201812, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201812$itemsper <- prescribe201812$ITEMS*(prescribe201812$`Number of Patients`/prescribe201812$total_patients)
# prescribe201812$nicper <- prescribe201812$NIC*(prescribe201812$`Number of Patients`/prescribe201812$total_patients)
# prescribe201812$actcostper <- prescribe201812$`ACT COST`*(prescribe201812$`Number of Patients`/prescribe201812$total_patients)
# prescribe201812$quantityper <- prescribe201812$QUANTITY*(prescribe201812$`Number of Patients`/prescribe201812$total_patients)
# 
# prescribe201812 <- prescribe201812[-c(2:14, 16)]
# 
# prescribe201812 <- aggregate(prescribe201812[-c(1,2)], by=list(factor(prescribe201812$BUASD11CD), factor(prescribe201812$Druggroup)), sum)
# 
# names(prescribe201812)[names(prescribe201812)=="Group.1"] <- "BUASD11CD"
# names(prescribe201812)[names(prescribe201812)=="Group.2"] <- "Druggroup"
# prescribe201812$PERIOD <- 201812
# 
# prescription <- rbind(prescription, prescribe201812)
# 
# 
# prescribe201811 <- read_csv("prescribemaster201811.csv")
# prescribe201811 <- prescribe201811[-c(1)]
# names(prescribe201811)[names(prescribe201811)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct18 <- read_csv("gp-reg-pat-prac-lsoa-all-oct18.csv")
# names(gpusersoct18)[names(gpusersoct18)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct18 <- merge(gpusersoct18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct18[-c(1:6,8,9)], gpusersoct18["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201811 <- merge(gpusersoct18, prescribe201811, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201811 <- merge(prescribe201811, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201811$itemsper <- prescribe201811$ITEMS*(prescribe201811$`Number of Patients`/prescribe201811$total_patients)
# prescribe201811$nicper <- prescribe201811$NIC*(prescribe201811$`Number of Patients`/prescribe201811$total_patients)
# prescribe201811$actcostper <- prescribe201811$`ACT COST`*(prescribe201811$`Number of Patients`/prescribe201811$total_patients)
# prescribe201811$quantityper <- prescribe201811$QUANTITY*(prescribe201811$`Number of Patients`/prescribe201811$total_patients)
# 
# prescribe201811 <- prescribe201811[-c(2:14, 16)]
# 
# prescribe201811 <- aggregate(prescribe201811[-c(1,2)], by=list(factor(prescribe201811$BUASD11CD), factor(prescribe201811$Druggroup)), sum)
# 
# names(prescribe201811)[names(prescribe201811)=="Group.1"] <- "BUASD11CD"
# names(prescribe201811)[names(prescribe201811)=="Group.2"] <- "Druggroup"
# prescribe201811$PERIOD <- 201811
# 
# prescription <- rbind(prescription, prescribe201811)
# 
# 
# 
# prescribe201810 <- read_csv("prescribemaster201810.csv")
# prescribe201810 <- prescribe201810[-c(1)]
# names(prescribe201810)[names(prescribe201810)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct18 <- read_csv("gp-reg-pat-prac-lsoa-all-oct18.csv")
# names(gpusersoct18)[names(gpusersoct18)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct18 <- merge(gpusersoct18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct18[-c(1:6,8,9)], gpusersoct18["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201810 <- merge(gpusersoct18, prescribe201810, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201810 <- merge(prescribe201810, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201810$itemsper <- prescribe201810$ITEMS*(prescribe201810$`Number of Patients`/prescribe201810$total_patients)
# prescribe201810$nicper <- prescribe201810$NIC*(prescribe201810$`Number of Patients`/prescribe201810$total_patients)
# prescribe201810$actcostper <- prescribe201810$`ACT COST`*(prescribe201810$`Number of Patients`/prescribe201810$total_patients)
# prescribe201810$quantityper <- prescribe201810$QUANTITY*(prescribe201810$`Number of Patients`/prescribe201810$total_patients)
# 
# prescribe201810 <- prescribe201810[-c(2:14, 16)]
# 
# prescribe201810 <- aggregate(prescribe201810[-c(1,2)], by=list(factor(prescribe201810$BUASD11CD), factor(prescribe201810$Druggroup)), sum)
# 
# names(prescribe201810)[names(prescribe201810)=="Group.1"] <- "BUASD11CD"
# names(prescribe201810)[names(prescribe201810)=="Group.2"] <- "Druggroup"
# prescribe201810$PERIOD <- 201810
# 
# prescription <- rbind(prescription, prescribe201810)
# 
# 
# 
# 
# prescribe201809 <- read_csv("prescribemaster201809.csv")
# prescribe201809 <- prescribe201809[-c(1)]
# names(prescribe201809)[names(prescribe201809)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct18 <- read_csv("gp-reg-pat-prac-lsoa-all-oct18.csv")
# names(gpusersoct18)[names(gpusersoct18)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct18 <- merge(gpusersoct18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct18[-c(1:6,8,9)], gpusersoct18["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201809 <- merge(gpusersoct18, prescribe201809, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201809 <- merge(prescribe201809, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201809$itemsper <- prescribe201809$ITEMS*(prescribe201809$`Number of Patients`/prescribe201809$total_patients)
# prescribe201809$nicper <- prescribe201809$NIC*(prescribe201809$`Number of Patients`/prescribe201809$total_patients)
# prescribe201809$actcostper <- prescribe201809$`ACT COST`*(prescribe201809$`Number of Patients`/prescribe201809$total_patients)
# prescribe201809$quantityper <- prescribe201809$QUANTITY*(prescribe201809$`Number of Patients`/prescribe201809$total_patients)
# 
# prescribe201809 <- prescribe201809[-c(2:14, 16)]
# 
# prescribe201809 <- aggregate(prescribe201809[-c(1,2)], by=list(factor(prescribe201809$BUASD11CD), factor(prescribe201809$Druggroup)), sum)
# 
# names(prescribe201809)[names(prescribe201809)=="Group.1"] <- "BUASD11CD"
# names(prescribe201809)[names(prescribe201809)=="Group.2"] <- "Druggroup"
# prescribe201809$PERIOD <- 201809
# 
# prescription <- rbind(prescription, prescribe201809)
# 
# 
# 
# prescribe201808 <- read_csv("prescribemaster201808.csv")
# prescribe201808 <- prescribe201808[-c(1)]
# names(prescribe201808)[names(prescribe201808)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul18 <- read_csv("gp-reg-pat-prac-lsoa-all-jul18.csv")
# names(gpusersjul18)[names(gpusersjul18)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul18 <- merge(gpusersjul18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul18[-c(1:6,8,9)], gpusersjul18["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201808 <- merge(gpusersjul18, prescribe201808, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201808 <- merge(prescribe201808, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201808$itemsper <- prescribe201808$ITEMS*(prescribe201808$`Number of Patients`/prescribe201808$total_patients)
# prescribe201808$nicper <- prescribe201808$NIC*(prescribe201808$`Number of Patients`/prescribe201808$total_patients)
# prescribe201808$actcostper <- prescribe201808$`ACT COST`*(prescribe201808$`Number of Patients`/prescribe201808$total_patients)
# prescribe201808$quantityper <- prescribe201808$QUANTITY*(prescribe201808$`Number of Patients`/prescribe201808$total_patients)
# 
# prescribe201808 <- prescribe201808[-c(2:14, 16)]
# 
# prescribe201808 <- aggregate(prescribe201808[-c(1,2)], by=list(factor(prescribe201808$BUASD11CD), factor(prescribe201808$Druggroup)), sum)
# 
# names(prescribe201808)[names(prescribe201808)=="Group.1"] <- "BUASD11CD"
# names(prescribe201808)[names(prescribe201808)=="Group.2"] <- "Druggroup"
# prescribe201808$PERIOD <- 201808
# 
# prescription <- rbind(prescription, prescribe201808)
# 
# 
# prescribe201807 <- read_csv("prescribemaster201807.csv")
# prescribe201807 <- prescribe201807[-c(1)]
# names(prescribe201807)[names(prescribe201807)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul18 <- read_csv("gp-reg-pat-prac-lsoa-all-jul18.csv")
# names(gpusersjul18)[names(gpusersjul18)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul18 <- merge(gpusersjul18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul18[-c(1:6,8,9)], gpusersjul18["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201807 <- merge(gpusersjul18, prescribe201807, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201807 <- merge(prescribe201807, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201807$itemsper <- prescribe201807$ITEMS*(prescribe201807$`Number of Patients`/prescribe201807$total_patients)
# prescribe201807$nicper <- prescribe201807$NIC*(prescribe201807$`Number of Patients`/prescribe201807$total_patients)
# prescribe201807$actcostper <- prescribe201807$`ACT COST`*(prescribe201807$`Number of Patients`/prescribe201807$total_patients)
# prescribe201807$quantityper <- prescribe201807$QUANTITY*(prescribe201807$`Number of Patients`/prescribe201807$total_patients)
# 
# prescribe201807 <- prescribe201807[-c(2:14, 16)]
# 
# prescribe201807 <- aggregate(prescribe201807[-c(1,2)], by=list(factor(prescribe201807$BUASD11CD), factor(prescribe201807$Druggroup)), sum)
# 
# names(prescribe201807)[names(prescribe201807)=="Group.1"] <- "BUASD11CD"
# names(prescribe201807)[names(prescribe201807)=="Group.2"] <- "Druggroup"
# prescribe201807$PERIOD <- 201807
# 
# prescription <- rbind(prescription, prescribe201807)
# 
# 
# 
# prescribe201806 <- read_csv("prescribemaster201806.csv")
# prescribe201806 <- prescribe201806[-c(1)]
# names(prescribe201806)[names(prescribe201806)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul18 <- read_csv("gp-reg-pat-prac-lsoa-all-jul18.csv")
# names(gpusersjul18)[names(gpusersjul18)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul18 <- merge(gpusersjul18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul18[-c(1:6,8,9)], gpusersjul18["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201806 <- merge(gpusersjul18, prescribe201806, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201806 <- merge(prescribe201806, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201806$itemsper <- prescribe201806$ITEMS*(prescribe201806$`Number of Patients`/prescribe201806$total_patients)
# prescribe201806$nicper <- prescribe201806$NIC*(prescribe201806$`Number of Patients`/prescribe201806$total_patients)
# prescribe201806$actcostper <- prescribe201806$`ACT COST`*(prescribe201806$`Number of Patients`/prescribe201806$total_patients)
# prescribe201806$quantityper <- prescribe201806$QUANTITY*(prescribe201806$`Number of Patients`/prescribe201806$total_patients)
# 
# prescribe201806 <- prescribe201806[-c(2:14, 16)]
# 
# prescribe201806 <- aggregate(prescribe201806[-c(1,2)], by=list(factor(prescribe201806$BUASD11CD), factor(prescribe201806$Druggroup)), sum)
# 
# names(prescribe201806)[names(prescribe201806)=="Group.1"] <- "BUASD11CD"
# names(prescribe201806)[names(prescribe201806)=="Group.2"] <- "Druggroup"
# prescribe201806$PERIOD <- 201806
# 
# prescription <- rbind(prescription, prescribe201806)
# 
# 
# 
# prescribe201805 <- read_csv("prescribemaster201805.csv")
# prescribe201805 <- prescribe201805[-c(1)]
# names(prescribe201805)[names(prescribe201805)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr18 <- read_csv("gp-reg-pat-prac-lsoa-all-apr18.csv")
# names(gpusersapr18)[names(gpusersapr18)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr18 <- merge(gpusersapr18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr18[-c(1:6,8,9)], gpusersapr18["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201805 <- merge(gpusersapr18, prescribe201805, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201805 <- merge(prescribe201805, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201805$itemsper <- prescribe201805$ITEMS*(prescribe201805$`Number of Patients`/prescribe201805$total_patients)
# prescribe201805$nicper <- prescribe201805$NIC*(prescribe201805$`Number of Patients`/prescribe201805$total_patients)
# prescribe201805$actcostper <- prescribe201805$`ACT COST`*(prescribe201805$`Number of Patients`/prescribe201805$total_patients)
# prescribe201805$quantityper <- prescribe201805$QUANTITY*(prescribe201805$`Number of Patients`/prescribe201805$total_patients)
# 
# prescribe201805 <- prescribe201805[-c(2:14, 16)]
# 
# prescribe201805 <- aggregate(prescribe201805[-c(1,2)], by=list(factor(prescribe201805$BUASD11CD), factor(prescribe201805$Druggroup)), sum)
# 
# names(prescribe201805)[names(prescribe201805)=="Group.1"] <- "BUASD11CD"
# names(prescribe201805)[names(prescribe201805)=="Group.2"] <- "Druggroup"
# prescribe201805$PERIOD <- 201805
# 
# prescription <- rbind(prescription, prescribe201805)
# 
# 
# 
# prescribe201804 <- read_csv("prescribemaster201804.csv")
# prescribe201804 <- prescribe201804[-c(1)]
# names(prescribe201804)[names(prescribe201804)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr18 <- read_csv("gp-reg-pat-prac-lsoa-all-apr18.csv")
# names(gpusersapr18)[names(gpusersapr18)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr18 <- merge(gpusersapr18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr18[-c(1:6,8,9)], gpusersapr18["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201804 <- merge(gpusersapr18, prescribe201804, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201804 <- merge(prescribe201804, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201804$itemsper <- prescribe201804$ITEMS*(prescribe201804$`Number of Patients`/prescribe201804$total_patients)
# prescribe201804$nicper <- prescribe201804$NIC*(prescribe201804$`Number of Patients`/prescribe201804$total_patients)
# prescribe201804$actcostper <- prescribe201804$`ACT COST`*(prescribe201804$`Number of Patients`/prescribe201804$total_patients)
# prescribe201804$quantityper <- prescribe201804$QUANTITY*(prescribe201804$`Number of Patients`/prescribe201804$total_patients)
# 
# prescribe201804 <- prescribe201804[-c(2:14, 16)]
# 
# prescribe201804 <- aggregate(prescribe201804[-c(1,2)], by=list(factor(prescribe201804$BUASD11CD), factor(prescribe201804$Druggroup)), sum)
# 
# names(prescribe201804)[names(prescribe201804)=="Group.1"] <- "BUASD11CD"
# names(prescribe201804)[names(prescribe201804)=="Group.2"] <- "Druggroup"
# prescribe201804$PERIOD <- 201804
# 
# prescription <- rbind(prescription, prescribe201804)
# 
# 
# 
# 
# prescribe201803 <- read_csv("prescribemaster201803.csv")
# prescribe201803 <- prescribe201803[-c(1)]
# names(prescribe201803)[names(prescribe201803)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr18 <- read_csv("gp-reg-pat-prac-lsoa-all-apr18.csv")
# names(gpusersapr18)[names(gpusersapr18)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr18 <- merge(gpusersapr18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr18[-c(1:6,8,9)], gpusersapr18["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201803 <- merge(gpusersapr18, prescribe201803, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201803 <- merge(prescribe201803, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201803$itemsper <- prescribe201803$ITEMS*(prescribe201803$`Number of Patients`/prescribe201803$total_patients)
# prescribe201803$nicper <- prescribe201803$NIC*(prescribe201803$`Number of Patients`/prescribe201803$total_patients)
# prescribe201803$actcostper <- prescribe201803$`ACT COST`*(prescribe201803$`Number of Patients`/prescribe201803$total_patients)
# prescribe201803$quantityper <- prescribe201803$QUANTITY*(prescribe201803$`Number of Patients`/prescribe201803$total_patients)
# 
# prescribe201803 <- prescribe201803[-c(2:14, 16)]
# 
# prescribe201803 <- aggregate(prescribe201803[-c(1,2)], by=list(factor(prescribe201803$BUASD11CD), factor(prescribe201803$Druggroup)), sum)
# 
# names(prescribe201803)[names(prescribe201803)=="Group.1"] <- "BUASD11CD"
# names(prescribe201803)[names(prescribe201803)=="Group.2"] <- "Druggroup"
# prescribe201803$PERIOD <- 201803
# 
# prescription <- rbind(prescription, prescribe201803)
# 
# 
# 
# 
# 
# prescribe201802 <- read_csv("prescribemaster201802.csv")
# prescribe201802 <- prescribe201802[-c(1)]
# names(prescribe201802)[names(prescribe201802)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjan18 <- read_csv("gp-reg-pat-prac-lsoa-all-jan18.csv")
# names(gpusersjan18)[names(gpusersjan18)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjan18 <- merge(gpusersjan18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjan18[-c(1:6,8,9)], gpusersjan18["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201802 <- merge(gpusersjan18, prescribe201802, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201802 <- merge(prescribe201802, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201802$itemsper <- prescribe201802$ITEMS*(prescribe201802$`Number of Patients`/prescribe201802$total_patients)
# prescribe201802$nicper <- prescribe201802$NIC*(prescribe201802$`Number of Patients`/prescribe201802$total_patients)
# prescribe201802$actcostper <- prescribe201802$`ACT COST`*(prescribe201802$`Number of Patients`/prescribe201802$total_patients)
# prescribe201802$quantityper <- prescribe201802$QUANTITY*(prescribe201802$`Number of Patients`/prescribe201802$total_patients)
# 
# prescribe201802 <- prescribe201802[-c(2:14, 16)]
# 
# prescribe201802 <- aggregate(prescribe201802[-c(1,2)], by=list(factor(prescribe201802$BUASD11CD), factor(prescribe201802$Druggroup)), sum)
# 
# names(prescribe201802)[names(prescribe201802)=="Group.1"] <- "BUASD11CD"
# names(prescribe201802)[names(prescribe201802)=="Group.2"] <- "Druggroup"
# prescribe201802$PERIOD <- 201802
# 
# prescription <- rbind(prescription, prescribe201802)
# 
# 
# 
# 
# prescribe201801 <- read_csv("prescribemaster201801.csv")
# prescribe201801 <- prescribe201801[-c(1)]
# names(prescribe201801)[names(prescribe201801)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjan18 <- read_csv("gp-reg-pat-prac-lsoa-all-jan18.csv")
# names(gpusersjan18)[names(gpusersjan18)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjan18 <- merge(gpusersjan18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjan18[-c(1:6,8,9)], gpusersjan18["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201801 <- merge(gpusersjan18, prescribe201801, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201801 <- merge(prescribe201801, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201801$itemsper <- prescribe201801$ITEMS*(prescribe201801$`Number of Patients`/prescribe201801$total_patients)
# prescribe201801$nicper <- prescribe201801$NIC*(prescribe201801$`Number of Patients`/prescribe201801$total_patients)
# prescribe201801$actcostper <- prescribe201801$`ACT COST`*(prescribe201801$`Number of Patients`/prescribe201801$total_patients)
# prescribe201801$quantityper <- prescribe201801$QUANTITY*(prescribe201801$`Number of Patients`/prescribe201801$total_patients)
# 
# prescribe201801 <- prescribe201801[-c(2:14, 16)]
# 
# prescribe201801 <- aggregate(prescribe201801[-c(1,2)], by=list(factor(prescribe201801$BUASD11CD), factor(prescribe201801$Druggroup)), sum)
# 
# names(prescribe201801)[names(prescribe201801)=="Group.1"] <- "BUASD11CD"
# names(prescribe201801)[names(prescribe201801)=="Group.2"] <- "Druggroup"
# prescribe201801$PERIOD <- 201801
# 
# prescription <- rbind(prescription, prescribe201801)
# 
# 
# prescribe201712 <- read_csv("prescribemaster201712.csv")
# prescribe201712 <- prescribe201712[-c(1)]
# names(prescribe201712)[names(prescribe201712)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjan18 <- read_csv("gp-reg-pat-prac-lsoa-all-jan18.csv")
# names(gpusersjan18)[names(gpusersjan18)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjan18 <- merge(gpusersjan18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjan18[-c(1:6,8,9)], gpusersjan18["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201712 <- merge(gpusersjan18, prescribe201712, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201712 <- merge(prescribe201712, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201712$itemsper <- prescribe201712$ITEMS*(prescribe201712$`Number of Patients`/prescribe201712$total_patients)
# prescribe201712$nicper <- prescribe201712$NIC*(prescribe201712$`Number of Patients`/prescribe201712$total_patients)
# prescribe201712$actcostper <- prescribe201712$`ACT COST`*(prescribe201712$`Number of Patients`/prescribe201712$total_patients)
# prescribe201712$quantityper <- prescribe201712$QUANTITY*(prescribe201712$`Number of Patients`/prescribe201712$total_patients)
# 
# prescribe201712 <- prescribe201712[-c(2:14, 16)]
# 
# prescribe201712 <- aggregate(prescribe201712[-c(1,2)], by=list(factor(prescribe201712$BUASD11CD), factor(prescribe201712$Druggroup)), sum)
# 
# names(prescribe201712)[names(prescribe201712)=="Group.1"] <- "BUASD11CD"
# names(prescribe201712)[names(prescribe201712)=="Group.2"] <- "Druggroup"
# prescribe201712$PERIOD <- 201712
# 
# prescription <- rbind(prescription, prescribe201712)
# 
# 
# 
# prescribe201711 <- read_csv("prescribemaster201711.csv")
# prescribe201711 <- prescribe201711[-c(1)]
# names(prescribe201711)[names(prescribe201711)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct17 <- read_csv("gp-reg-pat-prac-lsoa-all-oct17.csv")
# names(gpusersoct17)[names(gpusersoct17)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct17 <- merge(gpusersoct17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct17[-c(1:6,8,9)], gpusersoct17["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201711 <- merge(gpusersoct17, prescribe201711, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201711 <- merge(prescribe201711, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201711$itemsper <- prescribe201711$ITEMS*(prescribe201711$`Number of Patients`/prescribe201711$total_patients)
# prescribe201711$nicper <- prescribe201711$NIC*(prescribe201711$`Number of Patients`/prescribe201711$total_patients)
# prescribe201711$actcostper <- prescribe201711$`ACT COST`*(prescribe201711$`Number of Patients`/prescribe201711$total_patients)
# prescribe201711$quantityper <- prescribe201711$QUANTITY*(prescribe201711$`Number of Patients`/prescribe201711$total_patients)
# 
# prescribe201711 <- prescribe201711[-c(2:14, 16)]
# 
# prescribe201711 <- aggregate(prescribe201711[-c(1,2)], by=list(factor(prescribe201711$BUASD11CD), factor(prescribe201711$Druggroup)), sum)
# 
# names(prescribe201711)[names(prescribe201711)=="Group.1"] <- "BUASD11CD"
# names(prescribe201711)[names(prescribe201711)=="Group.2"] <- "Druggroup"
# prescribe201711$PERIOD <- 201711
# 
# prescription <- rbind(prescription, prescribe201711)
# 
# 
# 
# prescribe201710 <- read_csv("prescribemaster201710.csv")
# prescribe201710 <- prescribe201710[-c(1)]
# names(prescribe201710)[names(prescribe201710)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct17 <- read_csv("gp-reg-pat-prac-lsoa-all-oct17.csv")
# names(gpusersoct17)[names(gpusersoct17)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct17 <- merge(gpusersoct17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct17[-c(1:6,8,9)], gpusersoct17["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201710 <- merge(gpusersoct17, prescribe201710, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201710 <- merge(prescribe201710, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201710$itemsper <- prescribe201710$ITEMS*(prescribe201710$`Number of Patients`/prescribe201710$total_patients)
# prescribe201710$nicper <- prescribe201710$NIC*(prescribe201710$`Number of Patients`/prescribe201710$total_patients)
# prescribe201710$actcostper <- prescribe201710$`ACT COST`*(prescribe201710$`Number of Patients`/prescribe201710$total_patients)
# prescribe201710$quantityper <- prescribe201710$QUANTITY*(prescribe201710$`Number of Patients`/prescribe201710$total_patients)
# 
# prescribe201710 <- prescribe201710[-c(2:14, 16)]
# 
# prescribe201710 <- aggregate(prescribe201710[-c(1,2)], by=list(factor(prescribe201710$BUASD11CD), factor(prescribe201710$Druggroup)), sum)
# 
# names(prescribe201710)[names(prescribe201710)=="Group.1"] <- "BUASD11CD"
# names(prescribe201710)[names(prescribe201710)=="Group.2"] <- "Druggroup"
# prescribe201710$PERIOD <- 201710
# 
# prescription <- rbind(prescription, prescribe201710)
# 
# 
# 
# 
# prescribe201709 <- read_csv("prescribemaster201709.csv")
# prescribe201709 <- prescribe201709[-c(1)]
# names(prescribe201709)[names(prescribe201709)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct17 <- read_csv("gp-reg-pat-prac-lsoa-all-oct17.csv")
# names(gpusersoct17)[names(gpusersoct17)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct17 <- merge(gpusersoct17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct17[-c(1:6,8,9)], gpusersoct17["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201709 <- merge(gpusersoct17, prescribe201709, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201709 <- merge(prescribe201709, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201709$itemsper <- prescribe201709$ITEMS*(prescribe201709$`Number of Patients`/prescribe201709$total_patients)
# prescribe201709$nicper <- prescribe201709$NIC*(prescribe201709$`Number of Patients`/prescribe201709$total_patients)
# prescribe201709$actcostper <- prescribe201709$`ACT COST`*(prescribe201709$`Number of Patients`/prescribe201709$total_patients)
# prescribe201709$quantityper <- prescribe201709$QUANTITY*(prescribe201709$`Number of Patients`/prescribe201709$total_patients)
# 
# prescribe201709 <- prescribe201709[-c(2:14, 16)]
# 
# prescribe201709 <- aggregate(prescribe201709[-c(1,2)], by=list(factor(prescribe201709$BUASD11CD), factor(prescribe201709$Druggroup)), sum)
# 
# names(prescribe201709)[names(prescribe201709)=="Group.1"] <- "BUASD11CD"
# names(prescribe201709)[names(prescribe201709)=="Group.2"] <- "Druggroup"
# prescribe201709$PERIOD <- 201709
# 
# prescription <- rbind(prescription, prescribe201709)
# 
# 
# 
# prescribe201708 <- read_csv("prescribemaster201708.csv")
# prescribe201708 <- prescribe201708[-c(1)]
# names(prescribe201708)[names(prescribe201708)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul17 <- read_csv("gp-reg-pat-prac-lsoa-all-jul17.csv")
# names(gpusersjul17)[names(gpusersjul17)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul17 <- merge(gpusersjul17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul17[-c(1:6,8,9)], gpusersjul17["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201708 <- merge(gpusersjul17, prescribe201708, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201708 <- merge(prescribe201708, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201708$itemsper <- prescribe201708$ITEMS*(prescribe201708$`Number of Patients`/prescribe201708$total_patients)
# prescribe201708$nicper <- prescribe201708$NIC*(prescribe201708$`Number of Patients`/prescribe201708$total_patients)
# prescribe201708$actcostper <- prescribe201708$`ACT COST`*(prescribe201708$`Number of Patients`/prescribe201708$total_patients)
# prescribe201708$quantityper <- prescribe201708$QUANTITY*(prescribe201708$`Number of Patients`/prescribe201708$total_patients)
# 
# prescribe201708 <- prescribe201708[-c(2:14, 16)]
# 
# prescribe201708 <- aggregate(prescribe201708[-c(1,2)], by=list(factor(prescribe201708$BUASD11CD), factor(prescribe201708$Druggroup)), sum)
# 
# names(prescribe201708)[names(prescribe201708)=="Group.1"] <- "BUASD11CD"
# names(prescribe201708)[names(prescribe201708)=="Group.2"] <- "Druggroup"
# prescribe201708$PERIOD <- 201708
# 
# prescription <- rbind(prescription, prescribe201708)
# 
# 
# 
# 
# prescribe201707 <- read_csv("prescribemaster201707.csv")
# prescribe201707 <- prescribe201707[-c(1)]
# names(prescribe201707)[names(prescribe201707)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul17 <- read_csv("gp-reg-pat-prac-lsoa-all-jul17.csv")
# names(gpusersjul17)[names(gpusersjul17)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul17 <- merge(gpusersjul17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul17[-c(1:6,8,9)], gpusersjul17["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201707 <- merge(gpusersjul17, prescribe201707, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201707 <- merge(prescribe201707, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201707$itemsper <- prescribe201707$ITEMS*(prescribe201707$`Number of Patients`/prescribe201707$total_patients)
# prescribe201707$nicper <- prescribe201707$NIC*(prescribe201707$`Number of Patients`/prescribe201707$total_patients)
# prescribe201707$actcostper <- prescribe201707$`ACT COST`*(prescribe201707$`Number of Patients`/prescribe201707$total_patients)
# prescribe201707$quantityper <- prescribe201707$QUANTITY*(prescribe201707$`Number of Patients`/prescribe201707$total_patients)
# 
# prescribe201707 <- prescribe201707[-c(2:14, 16)]
# 
# prescribe201707 <- aggregate(prescribe201707[-c(1,2)], by=list(factor(prescribe201707$BUASD11CD), factor(prescribe201707$Druggroup)), sum)
# 
# names(prescribe201707)[names(prescribe201707)=="Group.1"] <- "BUASD11CD"
# names(prescribe201707)[names(prescribe201707)=="Group.2"] <- "Druggroup"
# prescribe201707$PERIOD <- 201707
# 
# prescription <- rbind(prescription, prescribe201707)
# 
# 
# 
# 
# prescribe201706 <- read_csv("prescribemaster201706.csv")
# prescribe201706 <- prescribe201706[-c(1)]
# names(prescribe201706)[names(prescribe201706)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul17 <- read_csv("gp-reg-pat-prac-lsoa-all-jul17.csv")
# names(gpusersjul17)[names(gpusersjul17)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul17 <- merge(gpusersjul17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul17[-c(1:6,8,9)], gpusersjul17["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201706 <- merge(gpusersjul17, prescribe201706, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201706 <- merge(prescribe201706, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201706$itemsper <- prescribe201706$ITEMS*(prescribe201706$`Number of Patients`/prescribe201706$total_patients)
# prescribe201706$nicper <- prescribe201706$NIC*(prescribe201706$`Number of Patients`/prescribe201706$total_patients)
# prescribe201706$actcostper <- prescribe201706$`ACT COST`*(prescribe201706$`Number of Patients`/prescribe201706$total_patients)
# prescribe201706$quantityper <- prescribe201706$QUANTITY*(prescribe201706$`Number of Patients`/prescribe201706$total_patients)
# 
# prescribe201706 <- prescribe201706[-c(2:14, 16)]
# 
# prescribe201706 <- aggregate(prescribe201706[-c(1,2)], by=list(factor(prescribe201706$BUASD11CD), factor(prescribe201706$Druggroup)), sum)
# 
# names(prescribe201706)[names(prescribe201706)=="Group.1"] <- "BUASD11CD"
# names(prescribe201706)[names(prescribe201706)=="Group.2"] <- "Druggroup"
# prescribe201706$PERIOD <- 201706
# 
# prescription <- rbind(prescription, prescribe201706)
# 
# 
# 
# 
# prescribe201705 <- read_csv("prescribemaster201705.csv")
# prescribe201705 <- prescribe201705[-c(1)]
# names(prescribe201705)[names(prescribe201705)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr17 <- read_csv("gp-reg-pat-prac-lsoa-all-apr17.csv")
# names(gpusersapr17)[names(gpusersapr17)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr17 <- merge(gpusersapr17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr17[-c(1:6,8,9)], gpusersapr17["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="NUMBER_OF_PATIENTS"] <- "total_patients"
# 
# prescribe201705 <- merge(gpusersapr17, prescribe201705, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201705 <- merge(prescribe201705, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201705$itemsper <- prescribe201705$ITEMS*(prescribe201705$NUMBER_OF_PATIENTS/prescribe201705$total_patients)
# prescribe201705$nicper <- prescribe201705$NIC*(prescribe201705$NUMBER_OF_PATIENTS/prescribe201705$total_patients)
# prescribe201705$actcostper <- prescribe201705$`ACT COST`*(prescribe201705$NUMBER_OF_PATIENTS/prescribe201705$total_patients)
# prescribe201705$quantityper <- prescribe201705$QUANTITY*(prescribe201705$NUMBER_OF_PATIENTS/prescribe201705$total_patients)
# 
# prescribe201705 <- prescribe201705[-c(2:14, 16)]
# 
# prescribe201705 <- aggregate(prescribe201705[-c(1,2)], by=list(factor(prescribe201705$BUASD11CD), factor(prescribe201705$Druggroup)), sum)
# 
# names(prescribe201705)[names(prescribe201705)=="Group.1"] <- "BUASD11CD"
# names(prescribe201705)[names(prescribe201705)=="Group.2"] <- "Druggroup"
# prescribe201705$PERIOD <- 201705
# 
# prescription <- rbind(prescription, prescribe201705)
# 
# prescribe201704 <- read_csv("prescribemaster201704.csv")
# prescribe201704 <- prescribe201704[-c(1)]
# names(prescribe201704)[names(prescribe201704)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr17 <- read_csv("gp-reg-pat-prac-lsoa-all-apr17.csv")
# names(gpusersapr17)[names(gpusersapr17)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr17 <- merge(gpusersapr17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr17[-c(1:6,8,9)], gpusersapr17["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="NUMBER_OF_PATIENTS"] <- "total_patients"
# 
# prescribe201704 <- merge(gpusersapr17, prescribe201704, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201704 <- merge(prescribe201704, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201704$itemsper <- prescribe201704$ITEMS*(prescribe201704$NUMBER_OF_PATIENTS/prescribe201704$total_patients)
# prescribe201704$nicper <- prescribe201704$NIC*(prescribe201704$NUMBER_OF_PATIENTS/prescribe201704$total_patients)
# prescribe201704$actcostper <- prescribe201704$`ACT COST`*(prescribe201704$NUMBER_OF_PATIENTS/prescribe201704$total_patients)
# prescribe201704$quantityper <- prescribe201704$QUANTITY*(prescribe201704$NUMBER_OF_PATIENTS/prescribe201704$total_patients)
# 
# prescribe201704 <- prescribe201704[-c(2:14, 16)]
# 
# prescribe201704 <- aggregate(prescribe201704[-c(1,2)], by=list(factor(prescribe201704$BUASD11CD), factor(prescribe201704$Druggroup)), sum)
# 
# names(prescribe201704)[names(prescribe201704)=="Group.1"] <- "BUASD11CD"
# names(prescribe201704)[names(prescribe201704)=="Group.2"] <- "Druggroup"
# prescribe201704$PERIOD <- 201704
# 
# prescription <- rbind(prescription, prescribe201704)
# 
# 
# prescribe201703 <- read_csv("prescribemaster201703.csv")
# prescribe201703 <- prescribe201703[-c(1)]
# names(prescribe201703)[names(prescribe201703)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr17 <- read_csv("gp-reg-pat-prac-lsoa-all-apr17.csv")
# names(gpusersapr17)[names(gpusersapr17)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr17 <- merge(gpusersapr17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr17[-c(1:6,8,9)], gpusersapr17["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="NUMBER_OF_PATIENTS"] <- "total_patients"
# 
# prescribe201703 <- merge(gpusersapr17, prescribe201703, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201703 <- merge(prescribe201703, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201703$itemsper <- prescribe201703$ITEMS*(prescribe201703$NUMBER_OF_PATIENTS/prescribe201703$total_patients)
# prescribe201703$nicper <- prescribe201703$NIC*(prescribe201703$NUMBER_OF_PATIENTS/prescribe201703$total_patients)
# prescribe201703$actcostper <- prescribe201703$`ACT COST`*(prescribe201703$NUMBER_OF_PATIENTS/prescribe201703$total_patients)
# prescribe201703$quantityper <- prescribe201703$QUANTITY*(prescribe201703$NUMBER_OF_PATIENTS/prescribe201703$total_patients)
# 
# prescribe201703 <- prescribe201703[-c(2:14, 16)]
# 
# prescribe201703 <- aggregate(prescribe201703[-c(1,2)], by=list(factor(prescribe201703$BUASD11CD), factor(prescribe201703$Druggroup)), sum)
# 
# names(prescribe201703)[names(prescribe201703)=="Group.1"] <- "BUASD11CD"
# names(prescribe201703)[names(prescribe201703)=="Group.2"] <- "Druggroup"
# prescribe201703$PERIOD <- 201703
# 
# prescription <- rbind(prescription, prescribe201703)
# 
# prescribe201702 <- read_csv("prescribemaster201702.csv")
# prescribe201702 <- prescribe201702[-c(1)]
# names(prescribe201702)[names(prescribe201702)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjan17 <- read_csv("gp-reg-pat-prac-lsoa-all-jan17.csv")
# names(gpusersjan17)[names(gpusersjan17)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjan17 <- merge(gpusersjan17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjan17[-c(1:5,7,8)], gpusersjan17["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="ALL_PATIENTS"] <- "total_patients"
# 
# prescribe201702 <- merge(gpusersjan17, prescribe201702, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201702 <- merge(prescribe201702, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201702$itemsper <- prescribe201702$ITEMS*(prescribe201702$ALL_PATIENTS/prescribe201702$total_patients)
# prescribe201702$nicper <- prescribe201702$NIC*(prescribe201702$ALL_PATIENTS/prescribe201702$total_patients)
# prescribe201702$actcostper <- prescribe201702$`ACT COST`*(prescribe201702$ALL_PATIENTS/prescribe201702$total_patients)
# prescribe201702$quantityper <- prescribe201702$QUANTITY*(prescribe201702$ALL_PATIENTS/prescribe201702$total_patients)
# 
# prescribe201702 <- prescribe201702[-c(2:13)]
# 
# prescribe201702 <- aggregate(prescribe201702[-c(1,2)], by=list(factor(prescribe201702$BUASD11CD), factor(prescribe201702$Druggroup)), sum)
# 
# names(prescribe201702)[names(prescribe201702)=="Group.1"] <- "BUASD11CD"
# names(prescribe201702)[names(prescribe201702)=="Group.2"] <- "Druggroup"
# prescribe201702$PERIOD <- 201702
# 
# prescription <- rbind(prescription, prescribe201702)
# 
# 
# 
# prescribe201701 <- read_csv("prescribemaster201701.csv")
# prescribe201701 <- prescribe201701[-c(1)]
# names(prescribe201701)[names(prescribe201701)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjan17 <- read_csv("gp-reg-pat-prac-lsoa-all-jan17.csv")
# names(gpusersjan17)[names(gpusersjan17)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjan17 <- merge(gpusersjan17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjan17[-c(1:5,7,8)], gpusersjan17["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="ALL_PATIENTS"] <- "total_patients"
# 
# prescribe201701 <- merge(gpusersjan17, prescribe201701, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201701 <- merge(prescribe201701, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201701$itemsper <- prescribe201701$ITEMS*(prescribe201701$ALL_PATIENTS/prescribe201701$total_patients)
# prescribe201701$nicper <- prescribe201701$NIC*(prescribe201701$ALL_PATIENTS/prescribe201701$total_patients)
# prescribe201701$actcostper <- prescribe201701$`ACT COST`*(prescribe201701$ALL_PATIENTS/prescribe201701$total_patients)
# prescribe201701$quantityper <- prescribe201701$QUANTITY*(prescribe201701$ALL_PATIENTS/prescribe201701$total_patients)
# 
# prescribe201701 <- prescribe201701[-c(2:13)]
# 
# prescribe201701 <- aggregate(prescribe201701[-c(1,2)], by=list(factor(prescribe201701$BUASD11CD), factor(prescribe201701$Druggroup)), sum)
# 
# names(prescribe201701)[names(prescribe201701)=="Group.1"] <- "BUASD11CD"
# names(prescribe201701)[names(prescribe201701)=="Group.2"] <- "Druggroup"
# prescribe201701$PERIOD <- 201701
# 
# prescription <- rbind(prescription, prescribe201701)
# 
# 
# 
# prescribe201612 <- read_csv("prescribemaster201612.csv")
# prescribe201612 <- prescribe201612[-c(1)]
# names(prescribe201612)[names(prescribe201612)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjan17 <- read_csv("gp-reg-pat-prac-lsoa-all-jan17.csv")
# names(gpusersjan17)[names(gpusersjan17)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjan17 <- merge(gpusersjan17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjan17[-c(1:5,7,8)], gpusersjan17["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="ALL_PATIENTS"] <- "total_patients"
# 
# prescribe201612 <- merge(gpusersjan17, prescribe201612, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201612 <- merge(prescribe201612, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201612$itemsper <- prescribe201612$ITEMS*(prescribe201612$ALL_PATIENTS/prescribe201612$total_patients)
# prescribe201612$nicper <- prescribe201612$NIC*(prescribe201612$ALL_PATIENTS/prescribe201612$total_patients)
# prescribe201612$actcostper <- prescribe201612$`ACT COST`*(prescribe201612$ALL_PATIENTS/prescribe201612$total_patients)
# prescribe201612$quantityper <- prescribe201612$QUANTITY*(prescribe201612$ALL_PATIENTS/prescribe201612$total_patients)
# 
# prescribe201612 <- prescribe201612[-c(2:13)]
# 
# prescribe201612 <- aggregate(prescribe201612[-c(1,2)], by=list(factor(prescribe201612$BUASD11CD), factor(prescribe201612$Druggroup)), sum)
# 
# names(prescribe201612)[names(prescribe201612)=="Group.1"] <- "BUASD11CD"
# names(prescribe201612)[names(prescribe201612)=="Group.2"] <- "Druggroup"
# prescribe201612$PERIOD <- 201612
# 
# prescription <- rbind(prescription, prescribe201612)
# 
# 
# prescribe201611 <- read_csv("prescribemaster201611.csv")
# prescribe201611 <- prescribe201611[-c(1)]
# names(prescribe201611)[names(prescribe201611)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct16 <- read_csv("gp-reg-pat-prac-lsoa-all-oct16.csv")
# names(gpusersoct16)[names(gpusersoct16)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct16 <- merge(gpusersoct16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct16[-c(1:5,7,8)], gpusersoct16["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201611 <- merge(gpusersoct16, prescribe201611, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201611 <- merge(prescribe201611, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201611$itemsper <- prescribe201611$ITEMS*(prescribe201611$`All Patients`/prescribe201611$total_patients)
# prescribe201611$nicper <- prescribe201611$NIC*(prescribe201611$`All Patients`/prescribe201611$total_patients)
# prescribe201611$actcostper <- prescribe201611$`ACT COST`*(prescribe201611$`All Patients`/prescribe201611$total_patients)
# prescribe201611$quantityper <- prescribe201611$QUANTITY*(prescribe201611$`All Patients`/prescribe201611$total_patients)
# 
# prescribe201611 <- prescribe201611[-c(2:13)]
# 
# prescribe201611 <- aggregate(prescribe201611[-c(1,2)], by=list(factor(prescribe201611$BUASD11CD), factor(prescribe201611$Druggroup)), sum)
# 
# names(prescribe201611)[names(prescribe201611)=="Group.1"] <- "BUASD11CD"
# names(prescribe201611)[names(prescribe201611)=="Group.2"] <- "Druggroup"
# prescribe201611$PERIOD <- 201611
# 
# prescription <- rbind(prescription, prescribe201611)
# 
# 
# 
# 
# prescribe201609 <- read_csv("prescribemaster201609.csv")
# prescribe201609 <- prescribe201609[-c(1)]
# names(prescribe201609)[names(prescribe201609)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct16 <- read_csv("gp-reg-pat-prac-lsoa-all-oct16.csv")
# names(gpusersoct16)[names(gpusersoct16)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct16 <- merge(gpusersoct16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct16[-c(1:5,7,8)], gpusersoct16["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201609 <- merge(gpusersoct16, prescribe201609, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201609 <- merge(prescribe201609, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201609$itemsper <- prescribe201609$ITEMS*(prescribe201609$`All Patients`/prescribe201609$total_patients)
# prescribe201609$nicper <- prescribe201609$NIC*(prescribe201609$`All Patients`/prescribe201609$total_patients)
# prescribe201609$actcostper <- prescribe201609$`ACT COST`*(prescribe201609$`All Patients`/prescribe201609$total_patients)
# prescribe201609$quantityper <- prescribe201609$QUANTITY*(prescribe201609$`All Patients`/prescribe201609$total_patients)
# 
# prescribe201609 <- prescribe201609[-c(2:13)]
# 
# prescribe201609 <- aggregate(prescribe201609[-c(1,2)], by=list(factor(prescribe201609$BUASD11CD), factor(prescribe201609$Druggroup)), sum)
# 
# names(prescribe201609)[names(prescribe201609)=="Group.1"] <- "BUASD11CD"
# names(prescribe201609)[names(prescribe201609)=="Group.2"] <- "Druggroup"
# prescribe201609$PERIOD <- 201609
# 
# prescription <- rbind(prescription, prescribe201609)
# 
# 
# 
# prescribe201610 <- read_csv("prescribemaster201610.csv")
# prescribe201610 <- prescribe201610[-c(1)]
# names(prescribe201610)[names(prescribe201610)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct16 <- read_csv("gp-reg-pat-prac-lsoa-all-oct16.csv")
# names(gpusersoct16)[names(gpusersoct16)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct16 <- merge(gpusersoct16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct16[-c(1:5,7,8)], gpusersoct16["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201610 <- merge(gpusersoct16, prescribe201610, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201610 <- merge(prescribe201610, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201610$itemsper <- prescribe201610$ITEMS*(prescribe201610$`All Patients`/prescribe201610$total_patients)
# prescribe201610$nicper <- prescribe201610$NIC*(prescribe201610$`All Patients`/prescribe201610$total_patients)
# prescribe201610$actcostper <- prescribe201610$`ACT COST`*(prescribe201610$`All Patients`/prescribe201610$total_patients)
# prescribe201610$quantityper <- prescribe201610$QUANTITY*(prescribe201610$`All Patients`/prescribe201610$total_patients)
# 
# prescribe201610 <- prescribe201610[-c(2:13)]
# 
# prescribe201610 <- aggregate(prescribe201610[-c(1,2)], by=list(factor(prescribe201610$BUASD11CD), factor(prescribe201610$Druggroup)), sum)
# 
# names(prescribe201610)[names(prescribe201610)=="Group.1"] <- "BUASD11CD"
# names(prescribe201610)[names(prescribe201610)=="Group.2"] <- "Druggroup"
# prescribe201610$PERIOD <- 201610
# 
# prescription <- rbind(prescription, prescribe201610)
# 
# 
# 
# prescribe201608 <- read_csv("prescribemaster201608.csv")
# prescribe201608 <- prescribe201608[-c(1)]
# names(prescribe201608)[names(prescribe201608)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul16 <- read_csv("gp-reg-pat-prac-lsoa-all-jul16.csv")
# names(gpusersjul16)[names(gpusersjul16)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul16 <- merge(gpusersjul16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul16[-c(1:5,7,8)], gpusersjul16["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201608 <- merge(gpusersjul16, prescribe201608, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201608 <- merge(prescribe201608, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201608$itemsper <- prescribe201608$ITEMS*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# prescribe201608$nicper <- prescribe201608$NIC*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# prescribe201608$actcostper <- prescribe201608$`ACT COST`*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# prescribe201608$quantityper <- prescribe201608$QUANTITY*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# 
# prescribe201608 <- prescribe201608[-c(2:13)]
# 
# prescribe201608 <- aggregate(prescribe201608[-c(1,2)], by=list(factor(prescribe201608$BUASD11CD), factor(prescribe201608$Druggroup)), sum)
# 
# names(prescribe201608)[names(prescribe201608)=="Group.1"] <- "BUASD11CD"
# names(prescribe201608)[names(prescribe201608)=="Group.2"] <- "Druggroup"
# prescribe201608$PERIOD <- 201608
# 
# prescription <- rbind(prescription, prescribe201608)
# 
# 
# 
# prescribe201608 <- read_csv("prescribemaster201608.csv")
# prescribe201608 <- prescribe201608[-c(1)]
# names(prescribe201608)[names(prescribe201608)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul16 <- read_csv("gp-reg-pat-prac-lsoa-all-jul16.csv")
# names(gpusersjul16)[names(gpusersjul16)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul16 <- merge(gpusersjul16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul16[-c(1:5,7,8)], gpusersjul16["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201608 <- merge(gpusersjul16, prescribe201608, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201608 <- merge(prescribe201608, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201608$itemsper <- prescribe201608$ITEMS*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# prescribe201608$nicper <- prescribe201608$NIC*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# prescribe201608$actcostper <- prescribe201608$`ACT COST`*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# prescribe201608$quantityper <- prescribe201608$QUANTITY*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# 
# prescribe201608 <- prescribe201608[-c(2:13)]
# 
# prescribe201608 <- aggregate(prescribe201608[-c(1,2)], by=list(factor(prescribe201608$BUASD11CD), factor(prescribe201608$Druggroup)), sum)
# 
# names(prescribe201608)[names(prescribe201608)=="Group.1"] <- "BUASD11CD"
# names(prescribe201608)[names(prescribe201608)=="Group.2"] <- "Druggroup"
# prescribe201608$PERIOD <- 201608
# 
# prescription <- rbind(prescription, prescribe201608)
# 
# 
# prescribe201607 <- read_csv("prescribemaster201607.csv")
# prescribe201607 <- prescribe201607[-c(1)]
# names(prescribe201607)[names(prescribe201607)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul16 <- read_csv("gp-reg-pat-prac-lsoa-all-jul16.csv")
# names(gpusersjul16)[names(gpusersjul16)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul16 <- merge(gpusersjul16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul16[-c(1:5,7,8)], gpusersjul16["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201607 <- merge(gpusersjul16, prescribe201607, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201607 <- merge(prescribe201607, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201607$itemsper <- prescribe201607$ITEMS*(prescribe201607$`All Patients`/prescribe201607$total_patients)
# prescribe201607$nicper <- prescribe201607$NIC*(prescribe201607$`All Patients`/prescribe201607$total_patients)
# prescribe201607$actcostper <- prescribe201607$`ACT COST`*(prescribe201607$`All Patients`/prescribe201607$total_patients)
# prescribe201607$quantityper <- prescribe201607$QUANTITY*(prescribe201607$`All Patients`/prescribe201607$total_patients)
# 
# prescribe201607 <- prescribe201607[-c(2:13)]
# 
# prescribe201607 <- aggregate(prescribe201607[-c(1,2)], by=list(factor(prescribe201607$BUASD11CD), factor(prescribe201607$Druggroup)), sum)
# 
# names(prescribe201607)[names(prescribe201607)=="Group.1"] <- "BUASD11CD"
# names(prescribe201607)[names(prescribe201607)=="Group.2"] <- "Druggroup"
# prescribe201607 <- 201607
# 
# prescription <- rbind(prescription, prescribe201607)
# 
# 
# 
# prescribe201606 <- read_csv("prescribemaster201606.csv")
# prescribe201606 <- prescribe201606[-c(1)]
# names(prescribe201606)[names(prescribe201606)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul16 <- read_csv("gp-reg-pat-prac-lsoa-all-jul16.csv")
# names(gpusersjul16)[names(gpusersjul16)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul16 <- merge(gpusersjul16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul16[-c(1:5,7,8)], gpusersjul16["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201606 <- merge(gpusersjul16, prescribe201606, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201606 <- merge(prescribe201606, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201606$itemsper <- prescribe201606$ITEMS*(prescribe201606$`All Patients`/prescribe201606$total_patients)
# prescribe201606$nicper <- prescribe201606$NIC*(prescribe201606$`All Patients`/prescribe201606$total_patients)
# prescribe201606$actcostper <- prescribe201606$`ACT COST`*(prescribe201606$`All Patients`/prescribe201606$total_patients)
# prescribe201606$quantityper <- prescribe201606$QUANTITY*(prescribe201606$`All Patients`/prescribe201606$total_patients)
# 
# prescribe201606 <- prescribe201606[-c(2:13)]
# 
# prescribe201606 <- aggregate(prescribe201606[-c(1,2)], by=list(factor(prescribe201606$BUASD11CD), factor(prescribe201606$Druggroup)), sum)
# 
# names(prescribe201606)[names(prescribe201606)=="Group.1"] <- "BUASD11CD"
# names(prescribe201606)[names(prescribe201606)=="Group.2"] <- "Druggroup"
# prescribe201606   <- 201606
# 
# prescription <- rbind(prescription, prescribe201606)
# 
# 
# prescribe201605 <- read_csv("prescribemaster201605.csv")
# prescribe201605 <- prescribe201605[-c(1)]
# names(prescribe201605)[names(prescribe201605)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr16 <- read_csv("gp-reg-pat-prac-lsoa-all-apr16.csv")
# names(gpusersapr16)[names(gpusersapr16)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr16 <- merge(gpusersapr16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr16[-c(1:5,7,8)], gpusersapr16["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201605 <- merge(gpusersapr16, prescribe201605, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201605 <- merge(prescribe201605, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201605$itemsper <- prescribe201605$ITEMS*(prescribe201605$`All Patients`/prescribe201605$total_patients)
# prescribe201605$nicper <- prescribe201605$NIC*(prescribe201605$`All Patients`/prescribe201605$total_patients)
# prescribe201605$actcostper <- prescribe201605$`ACT COST`*(prescribe201605$`All Patients`/prescribe201605$total_patients)
# prescribe201605$quantityper <- prescribe201605$QUANTITY*(prescribe201605$`All Patients`/prescribe201605$total_patients)
# 
# prescribe201605 <- prescribe201605[-c(2:13)]
# 
# prescribe201605 <- aggregate(prescribe201605[-c(1,2)], by=list(factor(prescribe201605$BUASD11CD), factor(prescribe201605$Druggroup)), sum)
# 
# names(prescribe201605)[names(prescribe201605)=="Group.1"] <- "BUASD11CD"
# names(prescribe201605)[names(prescribe201605)=="Group.2"] <- "Druggroup"
# prescribe201605  gg <- 201605
# 
# prescription <- rbind(prescription, prescribe201605)
# 
# 
# prescribe201604 <- read_csv("prescribemaster201604.csv")
# prescribe201604 <- prescribe201604[-c(1)]
# names(prescribe201604)[names(prescribe201604)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr16 <- read_csv("gp-reg-pat-prac-lsoa-all-apr16.csv")
# names(gpusersapr16)[names(gpusersapr16)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr16 <- merge(gpusersapr16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr16[-c(1:5,7,8)], gpusersapr16["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201604 <- merge(gpusersapr16, prescribe201604, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201604 <- merge(prescribe201604, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201604$itemsper <- prescribe201604$ITEMS*(prescribe201604$`All Patients`/prescribe201604$total_patients)
# prescribe201604$nicper <- prescribe201604$NIC*(prescribe201604$`All Patients`/prescribe201604$total_patients)
# prescribe201604$actcostper <- prescribe201604$`ACT COST`*(prescribe201604$`All Patients`/prescribe201604$total_patients)
# prescribe201604$quantityper <- prescribe201604$QUANTITY*(prescribe201604$`All Patients`/prescribe201604$total_patients)
# 
# prescribe201604 <- prescribe201604[-c(2:13)]
# 
# prescribe201604 <- aggregate(prescribe201604[-c(1,2)], by=list(factor(prescribe201604$BUASD11CD), factor(prescribe201604$Druggroup)), sum)
# 
# names(prescribe201604)[names(prescribe201604)=="Group.1"] <- "BUASD11CD"
# names(prescribe201604)[names(prescribe201604)=="Group.2"] <- "Druggroup"
# prescribe201604  gg <- 201604
# 
# prescription <- rbind(prescription, prescribe201604)
# 
# 
# 
# prescribe201603 <- read_csv("prescribemaster201603.csv")
# prescribe201603 <- prescribe201603[-c(1)]
# names(prescribe201603)[names(prescribe201603)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr16 <- read_csv("gp-reg-pat-prac-lsoa-all-apr16.csv")
# names(gpusersapr16)[names(gpusersapr16)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr16 <- merge(gpusersapr16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr16[-c(1:5,7,8)], gpusersapr16["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201603 <- merge(gpusersapr16, prescribe201603, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201603 <- merge(prescribe201603, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201603$itemsper <- prescribe201603$ITEMS*(prescribe201603$`All Patients`/prescribe201603$total_patients)
# prescribe201603$nicper <- prescribe201603$NIC*(prescribe201603$`All Patients`/prescribe201603$total_patients)
# prescribe201603$actcostper <- prescribe201603$`ACT COST`*(prescribe201603$`All Patients`/prescribe201603$total_patients)
# prescribe201603$quantityper <- prescribe201603$QUANTITY*(prescribe201603$`All Patients`/prescribe201603$total_patients)
# 
# prescribe201603 <- prescribe201603[-c(2:13)]
# 
# prescribe201603 <- aggregate(prescribe201603[-c(1,2)], by=list(factor(prescribe201603$BUASD11CD), factor(prescribe201603$Druggroup)), sum)
# 
# names(prescribe201603)[names(prescribe201603)=="Group.1"] <- "BUASD11CD"
# names(prescribe201603)[names(prescribe201603)=="Group.2"] <- "Druggroup"
# prescribe201603  gg <- 201603
# 
# prescription <- rbind(prescription, prescribe201603)
# 
# 
# 
# prescribe201602 <- read_csv("prescribemaster201602.csv")
# prescribe201602 <- prescribe201602[-c(1)]
# names(prescribe201602)[names(prescribe201602)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjan16 <- read_csv("gp-reg-pat-prac-lsoa-all-jan16.csv")
# names(gpusersjan16)[names(gpusersjan16)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjan16 <- merge(gpusersjan16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjan16[-c(1:5,7,8)], gpusersjan16["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201602 <- merge(gpusersjan16, prescribe201602, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201602 <- merge(prescribe201602, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201602$itemsper <- prescribe201602$ITEMS*(prescribe201602$`All Patients`/prescribe201602$total_patients)
# prescribe201602$nicper <- prescribe201602$NIC*(prescribe201602$`All Patients`/prescribe201602$total_patients)
# prescribe201602$actcostper <- prescribe201602$`ACT COST`*(prescribe201602$`All Patients`/prescribe201602$total_patients)
# prescribe201602$quantityper <- prescribe201602$QUANTITY*(prescribe201602$`All Patients`/prescribe201602$total_patients)
# 
# prescribe201602 <- prescribe201602[-c(2:13)]
# 
# prescribe201602 <- aggregate(prescribe201602[-c(1,2)], by=list(factor(prescribe201602$BUASD11CD), factor(prescribe201602$Druggroup)), sum)
# 
# names(prescribe201602)[names(prescribe201602)=="Group.1"] <- "BUASD11CD"
# names(prescribe201602)[names(prescribe201602)=="Group.2"] <- "Druggroup"
# prescribe201602  gg <- 201602
# 
# prescription <- rbind(prescription, prescribe201602)
# 
# 
# prescribe201512 <- read_csv("prescribemaster201512.csv")
# prescribe201512 <- prescribe201512[-c(1)]
# names(prescribe201512)[names(prescribe201512)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjan16 <- read_csv("gp-reg-pat-prac-lsoa-all-jan16.csv")
# names(gpusersjan16)[names(gpusersjan16)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjan16 <- merge(gpusersjan16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjan16[-c(1:5,7,8)], gpusersjan16["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201512 <- merge(gpusersjan16, prescribe201512, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201512 <- merge(prescribe201512, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201512$itemsper <- prescribe201512$ITEMS*(prescribe201512$`All Patients`/prescribe201512$total_patients)
# prescribe201512$nicper <- prescribe201512$NIC*(prescribe201512$`All Patients`/prescribe201512$total_patients)
# prescribe201512$actcostper <- prescribe201512$`ACT COST`*(prescribe201512$`All Patients`/prescribe201512$total_patients)
# prescribe201512$quantityper <- prescribe201512$QUANTITY*(prescribe201512$`All Patients`/prescribe201512$total_patients)
# 
# prescribe201512 <- prescribe201512[-c(2:13)]
# 
# prescribe201512 <- aggregate(prescribe201512[-c(1,2)], by=list(factor(prescribe201512$BUASD11CD), factor(prescribe201512$Druggroup)), sum)
# 
# names(prescribe201512)[names(prescribe201512)=="Group.1"] <- "BUASD11CD"
# names(prescribe201512)[names(prescribe201512)=="Group.2"] <- "Druggroup"
# prescribe201512  gg <- 201512
# 
# prescription <- rbind(prescription, prescribe201512)
# prescribe201601 <- read_csv("prescribemaster201601.csv")
# prescribe201601 <- prescribe201601[-c(1)]
# names(prescribe201601)[names(prescribe201601)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjan16 <- read_csv("gp-reg-pat-prac-lsoa-all-jan16.csv")
# names(gpusersjan16)[names(gpusersjan16)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjan16 <- merge(gpusersjan16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjan16[-c(1:5,7,8)], gpusersjan16["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201601 <- merge(gpusersjan16, prescribe201601, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201601 <- merge(prescribe201601, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201601$itemsper <- prescribe201601$ITEMS*(prescribe201601$`All Patients`/prescribe201601$total_patients)
# prescribe201601$nicper <- prescribe201601$NIC*(prescribe201601$`All Patients`/prescribe201601$total_patients)
# prescribe201601$actcostper <- prescribe201601$`ACT COST`*(prescribe201601$`All Patients`/prescribe201601$total_patients)
# prescribe201601$quantityper <- prescribe201601$QUANTITY*(prescribe201601$`All Patients`/prescribe201601$total_patients)
# 
# prescribe201601 <- prescribe201601[-c(2:13)]
# 
# prescribe201601 <- aggregate(prescribe201601[-c(1,2)], by=list(factor(prescribe201601$BUASD11CD), factor(prescribe201601$Druggroup)), sum)
# 
# names(prescribe201601)[names(prescribe201601)=="Group.1"] <- "BUASD11CD"
# names(prescribe201601)[names(prescribe201601)=="Group.2"] <- "Druggroup"
# prescribe201601  gg <- 201601
# 
# prescription <- rbind(prescription, prescribe201601)
# 
# 
# 
# prescribe201511 <- read_csv("prescribemaster201511.csv")
# prescribe201511 <- prescribe201511[-c(1)]
# names(prescribe201511)[names(prescribe201511)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct15 <- read_csv("gp-reg-pat-prac-lsoa-all-oct15.csv")
# names(gpusersoct15)[names(gpusersoct15)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct15 <- merge(gpusersoct15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct15[-c(1:5,7,8)], gpusersoct15["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201511 <- merge(gpusersoct15, prescribe201511, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201511 <- merge(prescribe201511, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201511$itemsper <- prescribe201511$ITEMS*(prescribe201511$`All Patients`/prescribe201511$total_patients)
# prescribe201511$nicper <- prescribe201511$NIC*(prescribe201511$`All Patients`/prescribe201511$total_patients)
# prescribe201511$actcostper <- prescribe201511$`ACT COST`*(prescribe201511$`All Patients`/prescribe201511$total_patients)
# prescribe201511$quantityper <- prescribe201511$QUANTITY*(prescribe201511$`All Patients`/prescribe201511$total_patients)
# 
# prescribe201511 <- prescribe201511[-c(2:13)]
# 
# prescribe201511 <- aggregate(prescribe201511[-c(1,2)], by=list(factor(prescribe201511$BUASD11CD), factor(prescribe201511$Druggroup)), sum)
# 
# names(prescribe201511)[names(prescribe201511)=="Group.1"] <- "BUASD11CD"
# names(prescribe201511)[names(prescribe201511)=="Group.2"] <- "Druggroup"
# prescribe201511$PERIOD <- 201511
# 
# prescription <- rbind(prescription, prescribe201511)
# 
# 
# 
# prescribe201509 <- read_csv("prescribemaster201509.csv")
# prescribe201509 <- prescribe201509[-c(1)]
# names(prescribe201509)[names(prescribe201509)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct15 <- read_csv("gp-reg-pat-prac-lsoa-all-oct15.csv")
# names(gpusersoct15)[names(gpusersoct15)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct15 <- merge(gpusersoct15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct15[-c(1:5,7,8)], gpusersoct15["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201509 <- merge(gpusersoct15, prescribe201509, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201509 <- merge(prescribe201509, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201509$itemsper <- prescribe201509$ITEMS*(prescribe201509$`All Patients`/prescribe201509$total_patients)
# prescribe201509$nicper <- prescribe201509$NIC*(prescribe201509$`All Patients`/prescribe201509$total_patients)
# prescribe201509$actcostper <- prescribe201509$`ACT COST`*(prescribe201509$`All Patients`/prescribe201509$total_patients)
# prescribe201509$quantityper <- prescribe201509$QUANTITY*(prescribe201509$`All Patients`/prescribe201509$total_patients)
# 
# prescribe201509 <- prescribe201509[-c(2:13)]
# 
# prescribe201509 <- aggregate(prescribe201509[-c(1,2)], by=list(factor(prescribe201509$BUASD11CD), factor(prescribe201509$Druggroup)), sum)
# 
# names(prescribe201509)[names(prescribe201509)=="Group.1"] <- "BUASD11CD"
# names(prescribe201509)[names(prescribe201509)=="Group.2"] <- "Druggroup"
# prescribe201509$PERIOD <- 201509
# 
# prescription <- rbind(prescription, prescribe201509)
# 
# 
# 
# 
# prescribe201510 <- read_csv("prescribemaster201510.csv")
# prescribe201510 <- prescribe201510[-c(1)]
# names(prescribe201510)[names(prescribe201510)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct15 <- read_csv("gp-reg-pat-prac-lsoa-all-oct15.csv")
# names(gpusersoct15)[names(gpusersoct15)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct15 <- merge(gpusersoct15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct15[-c(1:5,7,8)], gpusersoct15["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201510 <- merge(gpusersoct15, prescribe201510, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201510 <- merge(prescribe201510, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201510$itemsper <- prescribe201510$ITEMS*(prescribe201510$`All Patients`/prescribe201510$total_patients)
# prescribe201510$nicper <- prescribe201510$NIC*(prescribe201510$`All Patients`/prescribe201510$total_patients)
# prescribe201510$actcostper <- prescribe201510$`ACT COST`*(prescribe201510$`All Patients`/prescribe201510$total_patients)
# prescribe201510$quantityper <- prescribe201510$QUANTITY*(prescribe201510$`All Patients`/prescribe201510$total_patients)
# 
# prescribe201510 <- prescribe201510[-c(2:13)]
# 
# prescribe201510 <- aggregate(prescribe201510[-c(1,2)], by=list(factor(prescribe201510$BUASD11CD), factor(prescribe201510$Druggroup)), sum)
# 
# names(prescribe201510)[names(prescribe201510)=="Group.1"] <- "BUASD11CD"
# names(prescribe201510)[names(prescribe201510)=="Group.2"] <- "Druggroup"
# prescribe201510$PERIOD <- 201510
# 
# prescription <- rbind(prescription, prescribe201510)
# 
# 
# 
# prescribe201508 <- read_csv("prescribemaster201508.csv")
# prescribe201508 <- prescribe201508[-c(1)]
# names(prescribe201508)[names(prescribe201508)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul15 <- read_csv("gp-reg-pat-prac-lsoa-all-jul15.csv")
# names(gpusersjul15)[names(gpusersjul15)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul15 <- merge(gpusersjul15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul15[-c(1:5,7,8)], gpusersjul15["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201508 <- merge(gpusersjul15, prescribe201508, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201508 <- merge(prescribe201508, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201508$itemsper <- prescribe201508$ITEMS*(prescribe201508$`All Patients`/prescribe201508$total_patients)
# prescribe201508$nicper <- prescribe201508$NIC*(prescribe201508$`All Patients`/prescribe201508$total_patients)
# prescribe201508$actcostper <- prescribe201508$`ACT COST`*(prescribe201508$`All Patients`/prescribe201508$total_patients)
# prescribe201508$quantityper <- prescribe201508$QUANTITY*(prescribe201508$`All Patients`/prescribe201508$total_patients)
# 
# prescribe201508 <- prescribe201508[-c(2:13)]
# 
# prescribe201508 <- aggregate(prescribe201508[-c(1,2)], by=list(factor(prescribe201508$BUASD11CD), factor(prescribe201508$Druggroup)), sum)
# 
# names(prescribe201508)[names(prescribe201508)=="Group.1"] <- "BUASD11CD"
# names(prescribe201508)[names(prescribe201508)=="Group.2"] <- "Druggroup"
# prescribe201508$PERIOD <- 201508
# 
# prescription <- rbind(prescription, prescribe201508)
# 
# 
# prescribe201506 <- read_csv("prescribemaster201506.csv")
# prescribe201506 <- prescribe201506[-c(1)]
# names(prescribe201506)[names(prescribe201506)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul15 <- read_csv("gp-reg-pat-prac-lsoa-all-jul15.csv")
# names(gpusersjul15)[names(gpusersjul15)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul15 <- merge(gpusersjul15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul15[-c(1:5,7,8)], gpusersjul15["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201506 <- merge(gpusersjul15, prescribe201506, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201506 <- merge(prescribe201506, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201506$itemsper <- prescribe201506$ITEMS*(prescribe201506$`All Patients`/prescribe201506$total_patients)
# prescribe201506$nicper <- prescribe201506$NIC*(prescribe201506$`All Patients`/prescribe201506$total_patients)
# prescribe201506$actcostper <- prescribe201506$`ACT COST`*(prescribe201506$`All Patients`/prescribe201506$total_patients)
# prescribe201506$quantityper <- prescribe201506$QUANTITY*(prescribe201506$`All Patients`/prescribe201506$total_patients)
# 
# prescribe201506 <- prescribe201506[-c(2:13)]
# 
# prescribe201506 <- aggregate(prescribe201506[-c(1,2)], by=list(factor(prescribe201506$BUASD11CD), factor(prescribe201506$Druggroup)), sum)
# 
# names(prescribe201506)[names(prescribe201506)=="Group.1"] <- "BUASD11CD"
# names(prescribe201506)[names(prescribe201506)=="Group.2"] <- "Druggroup"
# prescribe201506$PERIOD <- 201506
# 
# prescription <- rbind(prescription, prescribe201506)
# 
# 
# prescribe201507 <- read_csv("prescribemaster201507.csv")
# prescribe201507 <- prescribe201507[-c(1)]
# names(prescribe201507)[names(prescribe201507)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul15 <- read_csv("gp-reg-pat-prac-lsoa-all-jul15.csv")
# names(gpusersjul15)[names(gpusersjul15)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul15 <- merge(gpusersjul15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul15[-c(1:5,7,8)], gpusersjul15["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201507 <- merge(gpusersjul15, prescribe201507, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201507 <- merge(prescribe201507, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201507$itemsper <- prescribe201507$ITEMS*(prescribe201507$`All Patients`/prescribe201507$total_patients)
# prescribe201507$nicper <- prescribe201507$NIC*(prescribe201507$`All Patients`/prescribe201507$total_patients)
# prescribe201507$actcostper <- prescribe201507$`ACT COST`*(prescribe201507$`All Patients`/prescribe201507$total_patients)
# prescribe201507$quantityper <- prescribe201507$QUANTITY*(prescribe201507$`All Patients`/prescribe201507$total_patients)
# 
# prescribe201507 <- prescribe201507[-c(2:13)]
# 
# prescribe201507 <- aggregate(prescribe201507[-c(1,2)], by=list(factor(prescribe201507$BUASD11CD), factor(prescribe201507$Druggroup)), sum)
# 
# names(prescribe201507)[names(prescribe201507)=="Group.1"] <- "BUASD11CD"
# names(prescribe201507)[names(prescribe201507)=="Group.2"] <- "Druggroup"
# prescribe201507$PERIOD <- 201507
# 
# prescription <- rbind(prescription, prescribe201507)
# 
# prescribe201607 <- prescribe201607[-c(3)]
# 
# prescribe201505 <- read_csv("prescribemaster201505.csv")
# prescribe201505 <- prescribe201505[-c(1)]
# names(prescribe201505)[names(prescribe201505)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr15 <- read_csv("gp-reg-pat-prac-lsoa-all-apr15.csv")
# names(gpusersapr15)[names(gpusersapr15)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr15 <- merge(gpusersapr15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr15[-c(1:5,7,8)], gpusersapr15["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201505 <- merge(gpusersapr15, prescribe201505, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201505 <- merge(prescribe201505, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201505$itemsper <- prescribe201505$ITEMS*(prescribe201505$`All Patients`/prescribe201505$total_patients)
# prescribe201505$nicper <- prescribe201505$NIC*(prescribe201505$`All Patients`/prescribe201505$total_patients)
# prescribe201505$actcostper <- prescribe201505$`ACT COST`*(prescribe201505$`All Patients`/prescribe201505$total_patients)
# prescribe201505$quantityper <- prescribe201505$QUANTITY*(prescribe201505$`All Patients`/prescribe201505$total_patients)
# 
# prescribe201505 <- prescribe201505[-c(2:13)]
# 
# prescribe201505 <- aggregate(prescribe201505[-c(1,2)], by=list(factor(prescribe201505$BUASD11CD), factor(prescribe201505$Druggroup)), sum)
# 
# names(prescribe201505)[names(prescribe201505)=="Group.1"] <- "BUASD11CD"
# names(prescribe201505)[names(prescribe201505)=="Group.2"] <- "Druggroup"
# prescribe201505$PERIOD <- 201505
# 
# prescription <- rbind(prescription, prescribe201505)
# 
# 
# 
# 
# prescribe201504 <- read_csv("prescribemaster201504.csv")
# prescribe201504 <- prescribe201504[-c(1)]
# names(prescribe201504)[names(prescribe201504)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr15 <- read_csv("gp-reg-pat-prac-lsoa-all-apr15.csv")
# names(gpusersapr15)[names(gpusersapr15)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr15 <- merge(gpusersapr15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr15[-c(1:5,7,8)], gpusersapr15["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201504 <- merge(gpusersapr15, prescribe201504, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201504 <- merge(prescribe201504, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201504$itemsper <- prescribe201504$ITEMS*(prescribe201504$`All Patients`/prescribe201504$total_patients)
# prescribe201504$nicper <- prescribe201504$NIC*(prescribe201504$`All Patients`/prescribe201504$total_patients)
# prescribe201504$actcostper <- prescribe201504$`ACT COST`*(prescribe201504$`All Patients`/prescribe201504$total_patients)
# prescribe201504$quantityper <- prescribe201504$QUANTITY*(prescribe201504$`All Patients`/prescribe201504$total_patients)
# 
# prescribe201504 <- prescribe201504[-c(2:13)]
# 
# prescribe201504 <- aggregate(prescribe201504[-c(1,2)], by=list(factor(prescribe201504$BUASD11CD), factor(prescribe201504$Druggroup)), sum)
# 
# names(prescribe201504)[names(prescribe201504)=="Group.1"] <- "BUASD11CD"
# names(prescribe201504)[names(prescribe201504)=="Group.2"] <- "Druggroup"
# prescribe201504$PERIOD <- 201504
# 
# prescription <- rbind(prescription, prescribe201504)
# 
# 
# 
# 
# prescribe201503 <- read_csv("prescribemaster201503.csv")
# prescribe201503 <- prescribe201503[-c(1)]
# names(prescribe201503)[names(prescribe201503)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr15 <- read_csv("gp-reg-pat-prac-lsoa-all-apr15.csv")
# names(gpusersapr15)[names(gpusersapr15)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr15 <- merge(gpusersapr15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr15[-c(1:5,7,8)], gpusersapr15["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201503 <- merge(gpusersapr15, prescribe201503, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201503 <- merge(prescribe201503, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201503$itemsper <- prescribe201503$ITEMS*(prescribe201503$`All Patients`/prescribe201503$total_patients)
# prescribe201503$nicper <- prescribe201503$NIC*(prescribe201503$`All Patients`/prescribe201503$total_patients)
# prescribe201503$actcostper <- prescribe201503$`ACT COST`*(prescribe201503$`All Patients`/prescribe201503$total_patients)
# prescribe201503$quantityper <- prescribe201503$QUANTITY*(prescribe201503$`All Patients`/prescribe201503$total_patients)
# 
# prescribe201503 <- prescribe201503[-c(2:13)]
# 
# prescribe201503 <- aggregate(prescribe201503[-c(1,2)], by=list(factor(prescribe201503$BUASD11CD), factor(prescribe201503$Druggroup)), sum)
# 
# names(prescribe201503)[names(prescribe201503)=="Group.1"] <- "BUASD11CD"
# names(prescribe201503)[names(prescribe201503)=="Group.2"] <- "Druggroup"
# prescribe201503$PERIOD <- 201503
# 
# prescription <- rbind(prescription, prescribe201503)
# 
# 
# 
# 
# prescribe201502 <- read_csv("prescribemaster201502.csv")
# prescribe201502 <- prescribe201502[-c(1)]
# names(prescribe201502)[names(prescribe201502)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjan15 <- read_csv("gp-reg-pat-prac-lsoa-all-jan15.csv")
# names(gpusersjan15)[names(gpusersjan15)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjan15 <- merge(gpusersjan15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjan15[-c(1:5,7,8)], gpusersjan15["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201502 <- merge(gpusersjan15, prescribe201502, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201502 <- merge(prescribe201502, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201502$itemsper <- prescribe201502$ITEMS*(prescribe201502$`All Patients`/prescribe201502$total_patients)
# prescribe201502$nicper <- prescribe201502$NIC*(prescribe201502$`All Patients`/prescribe201502$total_patients)
# prescribe201502$actcostper <- prescribe201502$`ACT COST`*(prescribe201502$`All Patients`/prescribe201502$total_patients)
# prescribe201502$quantityper <- prescribe201502$QUANTITY*(prescribe201502$`All Patients`/prescribe201502$total_patients)
# 
# prescribe201502 <- prescribe201502[-c(2:13)]
# 
# prescribe201502 <- aggregate(prescribe201502[-c(1,2)], by=list(factor(prescribe201502$BUASD11CD), factor(prescribe201502$Druggroup)), sum)
# 
# names(prescribe201502)[names(prescribe201502)=="Group.1"] <- "BUASD11CD"
# names(prescribe201502)[names(prescribe201502)=="Group.2"] <- "Druggroup"
# prescribe201502$PERIOD <- 201502
# 
# prescription <- rbind(prescription, prescribe201502)
# 
# 
# 
# 
# 
# 
# prescribe201501 <- read_csv("prescribemaster201501.csv")
# prescribe201501 <- prescribe201501[-c(1)]
# names(prescribe201501)[names(prescribe201501)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjan15 <- read_csv("gp-reg-pat-prac-lsoa-all-jan15.csv")
# names(gpusersjan15)[names(gpusersjan15)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjan15 <- merge(gpusersjan15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjan15[-c(1:5,7,8)], gpusersjan15["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201501 <- merge(gpusersjan15, prescribe201501, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201501 <- merge(prescribe201501, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201501$itemsper <- prescribe201501$ITEMS*(prescribe201501$`All Patients`/prescribe201501$total_patients)
# prescribe201501$nicper <- prescribe201501$NIC*(prescribe201501$`All Patients`/prescribe201501$total_patients)
# prescribe201501$actcostper <- prescribe201501$`ACT COST`*(prescribe201501$`All Patients`/prescribe201501$total_patients)
# prescribe201501$quantityper <- prescribe201501$QUANTITY*(prescribe201501$`All Patients`/prescribe201501$total_patients)
# 
# prescribe201501 <- prescribe201501[-c(2:13)]
# 
# prescribe201501 <- aggregate(prescribe201501[-c(1,2)], by=list(factor(prescribe201501$BUASD11CD), factor(prescribe201501$Druggroup)), sum)
# 
# names(prescribe201501)[names(prescribe201501)=="Group.1"] <- "BUASD11CD"
# names(prescribe201501)[names(prescribe201501)=="Group.2"] <- "Druggroup"
# prescribe201501$PERIOD <- 201501
# 
# prescription <- rbind(prescription, prescribe201501)
# 
# 
# 
# 
# 
# 
# prescribe201412 <- read_csv("prescribemaster201412.csv")
# prescribe201412 <- prescribe201412[-c(1)]
# names(prescribe201412)[names(prescribe201412)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjan15 <- read_csv("gp-reg-pat-prac-lsoa-all-jan15.csv")
# names(gpusersjan15)[names(gpusersjan15)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjan15 <- merge(gpusersjan15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjan15[-c(1:5,7,8)], gpusersjan15["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201412 <- merge(gpusersjan15, prescribe201412, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201412 <- merge(prescribe201412, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201412$itemsper <- prescribe201412$ITEMS*(prescribe201412$`All Patients`/prescribe201412$total_patients)
# prescribe201412$nicper <- prescribe201412$NIC*(prescribe201412$`All Patients`/prescribe201412$total_patients)
# prescribe201412$actcostper <- prescribe201412$`ACT COST`*(prescribe201412$`All Patients`/prescribe201412$total_patients)
# prescribe201412$quantityper <- prescribe201412$QUANTITY*(prescribe201412$`All Patients`/prescribe201412$total_patients)
# 
# prescribe201412 <- prescribe201412[-c(2:13)]
# 
# prescribe201412 <- aggregate(prescribe201412[-c(1,2)], by=list(factor(prescribe201412$BUASD11CD), factor(prescribe201412$Druggroup)), sum)
# 
# names(prescribe201412)[names(prescribe201412)=="Group.1"] <- "BUASD11CD"
# names(prescribe201412)[names(prescribe201412)=="Group.2"] <- "Druggroup"
# prescribe201412$PERIOD <- 201412
# 
# prescription <- rbind(prescription, prescribe201412)
# 
# 
# 
# 
# 
# 
# prescribe201411 <- read_csv("prescribemaster201411.csv")
# prescribe201411 <- prescribe201411[-c(1)]
# names(prescribe201411)[names(prescribe201411)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct14 <- read_csv("gp-reg-pat-prac-lsoa-all-oct14.csv")
# names(gpusersoct14)[names(gpusersoct14)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct14 <- merge(gpusersoct14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct14[-c(1:5,7,8)], gpusersoct14["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201411 <- merge(gpusersoct14, prescribe201411, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201411 <- merge(prescribe201411, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201411$itemsper <- prescribe201411$ITEMS*(prescribe201411$`All Patients`/prescribe201411$total_patients)
# prescribe201411$nicper <- prescribe201411$NIC*(prescribe201411$`All Patients`/prescribe201411$total_patients)
# prescribe201411$actcostper <- prescribe201411$`ACT COST`*(prescribe201411$`All Patients`/prescribe201411$total_patients)
# prescribe201411$quantityper <- prescribe201411$QUANTITY*(prescribe201411$`All Patients`/prescribe201411$total_patients)
# 
# prescribe201411 <- prescribe201411[-c(2:13)]
# 
# prescribe201411 <- aggregate(prescribe201411[-c(1,2)], by=list(factor(prescribe201411$BUASD11CD), factor(prescribe201411$Druggroup)), sum)
# 
# names(prescribe201411)[names(prescribe201411)=="Group.1"] <- "BUASD11CD"
# names(prescribe201411)[names(prescribe201411)=="Group.2"] <- "Druggroup"
# prescribe201411$PERIOD <- 201411
# 
# prescription <- rbind(prescription, prescribe201411)
# 
# 
# 
# 
# 
# prescribe201410 <- read_csv("prescribemaster201410.csv")
# prescribe201410 <- prescribe201410[-c(1)]
# names(prescribe201410)[names(prescribe201410)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct14 <- read_csv("gp-reg-pat-prac-lsoa-all-oct14.csv")
# names(gpusersoct14)[names(gpusersoct14)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct14 <- merge(gpusersoct14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct14[-c(1:5,7,8)], gpusersoct14["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201410 <- merge(gpusersoct14, prescribe201410, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201410 <- merge(prescribe201410, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201410$itemsper <- prescribe201410$ITEMS*(prescribe201410$`All Patients`/prescribe201410$total_patients)
# prescribe201410$nicper <- prescribe201410$NIC*(prescribe201410$`All Patients`/prescribe201410$total_patients)
# prescribe201410$actcostper <- prescribe201410$`ACT COST`*(prescribe201410$`All Patients`/prescribe201410$total_patients)
# prescribe201410$quantityper <- prescribe201410$QUANTITY*(prescribe201410$`All Patients`/prescribe201410$total_patients)
# 
# prescribe201410 <- prescribe201410[-c(2:13)]
# 
# prescribe201410 <- aggregate(prescribe201410[-c(1,2)], by=list(factor(prescribe201410$BUASD11CD), factor(prescribe201410$Druggroup)), sum)
# 
# names(prescribe201410)[names(prescribe201410)=="Group.1"] <- "BUASD11CD"
# names(prescribe201410)[names(prescribe201410)=="Group.2"] <- "Druggroup"
# prescribe201410$PERIOD <- 201410
# 
# prescription <- rbind(prescription, prescribe201410)
# 
# 
# 
# 
# 
# prescribe201409 <- read_csv("prescribemaster201409.csv")
# prescribe201409 <- prescribe201409[-c(1)]
# names(prescribe201409)[names(prescribe201409)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersoct14 <- read_csv("gp-reg-pat-prac-lsoa-all-oct14.csv")
# names(gpusersoct14)[names(gpusersoct14)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersoct14 <- merge(gpusersoct14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersoct14[-c(1:5,7,8)], gpusersoct14["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201409 <- merge(gpusersoct14, prescribe201409, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201409 <- merge(prescribe201409, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201409$itemsper <- prescribe201409$ITEMS*(prescribe201409$`All Patients`/prescribe201409$total_patients)
# prescribe201409$nicper <- prescribe201409$NIC*(prescribe201409$`All Patients`/prescribe201409$total_patients)
# prescribe201409$actcostper <- prescribe201409$`ACT COST`*(prescribe201409$`All Patients`/prescribe201409$total_patients)
# prescribe201409$quantityper <- prescribe201409$QUANTITY*(prescribe201409$`All Patients`/prescribe201409$total_patients)
# 
# prescribe201409 <- prescribe201409[-c(2:13)]
# 
# prescribe201409 <- aggregate(prescribe201409[-c(1,2)], by=list(factor(prescribe201409$BUASD11CD), factor(prescribe201409$Druggroup)), sum)
# 
# names(prescribe201409)[names(prescribe201409)=="Group.1"] <- "BUASD11CD"
# names(prescribe201409)[names(prescribe201409)=="Group.2"] <- "Druggroup"
# prescribe201409$PERIOD <- 201409
# 
# prescription <- rbind(prescription, prescribe201409)
# 
# 
# 
# 
# 
# 
# prescribe201408 <- read_csv("prescribemaster201408.csv")
# prescribe201408 <- prescribe201408[-c(1)]
# names(prescribe201408)[names(prescribe201408)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul14 <- read_csv("gp-reg-pat-prac-lsoa-all-jul14.csv")
# names(gpusersjul14)[names(gpusersjul14)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul14 <- merge(gpusersjul14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul14[-c(1:5,7,8)], gpusersjul14["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201408 <- merge(gpusersjul14, prescribe201408, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201408 <- merge(prescribe201408, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201408$itemsper <- prescribe201408$ITEMS*(prescribe201408$`All Patients`/prescribe201408$total_patients)
# prescribe201408$nicper <- prescribe201408$NIC*(prescribe201408$`All Patients`/prescribe201408$total_patients)
# prescribe201408$actcostper <- prescribe201408$`ACT COST`*(prescribe201408$`All Patients`/prescribe201408$total_patients)
# prescribe201408$quantityper <- prescribe201408$QUANTITY*(prescribe201408$`All Patients`/prescribe201408$total_patients)
# 
# prescribe201408 <- prescribe201408[-c(2:13)]
# 
# prescribe201408 <- aggregate(prescribe201408[-c(1,2)], by=list(factor(prescribe201408$BUASD11CD), factor(prescribe201408$Druggroup)), sum)
# 
# names(prescribe201408)[names(prescribe201408)=="Group.1"] <- "BUASD11CD"
# names(prescribe201408)[names(prescribe201408)=="Group.2"] <- "Druggroup"
# prescribe201408$PERIOD <- 201408
# 
# prescription <- rbind(prescription, prescribe201408)
# 
# 
# 
# 
# prescribe201407 <- read_csv("prescribemaster201407.csv")
# prescribe201407 <- prescribe201407[-c(1)]
# names(prescribe201407)[names(prescribe201407)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul14 <- read_csv("gp-reg-pat-prac-lsoa-all-jul14.csv")
# names(gpusersjul14)[names(gpusersjul14)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul14 <- merge(gpusersjul14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul14[-c(1:5,7,8)], gpusersjul14["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201407 <- merge(gpusersjul14, prescribe201407, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201407 <- merge(prescribe201407, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201407$itemsper <- prescribe201407$ITEMS*(prescribe201407$`All Patients`/prescribe201407$total_patients)
# prescribe201407$nicper <- prescribe201407$NIC*(prescribe201407$`All Patients`/prescribe201407$total_patients)
# prescribe201407$actcostper <- prescribe201407$`ACT COST`*(prescribe201407$`All Patients`/prescribe201407$total_patients)
# prescribe201407$quantityper <- prescribe201407$QUANTITY*(prescribe201407$`All Patients`/prescribe201407$total_patients)
# 
# prescribe201407 <- prescribe201407[-c(2:13)]
# 
# prescribe201407 <- aggregate(prescribe201407[-c(1,2)], by=list(factor(prescribe201407$BUASD11CD), factor(prescribe201407$Druggroup)), sum)
# 
# names(prescribe201407)[names(prescribe201407)=="Group.1"] <- "BUASD11CD"
# names(prescribe201407)[names(prescribe201407)=="Group.2"] <- "Druggroup"
# prescribe201407$PERIOD <- 201407
# 
# prescription <- rbind(prescription, prescribe201407)
# 
# 
# 
# 
# 
# 
# prescribe201406 <- read_csv("prescribemaster201406.csv")
# prescribe201406 <- prescribe201406[-c(1)]
# names(prescribe201406)[names(prescribe201406)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersjul14 <- read_csv("gp-reg-pat-prac-lsoa-all-jul14.csv")
# names(gpusersjul14)[names(gpusersjul14)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersjul14 <- merge(gpusersjul14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersjul14[-c(1:5,7,8)], gpusersjul14["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201406 <- merge(gpusersjul14, prescribe201406, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201406 <- merge(prescribe201406, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201406$itemsper <- prescribe201406$ITEMS*(prescribe201406$`All Patients`/prescribe201406$total_patients)
# prescribe201406$nicper <- prescribe201406$NIC*(prescribe201406$`All Patients`/prescribe201406$total_patients)
# prescribe201406$actcostper <- prescribe201406$`ACT COST`*(prescribe201406$`All Patients`/prescribe201406$total_patients)
# prescribe201406$quantityper <- prescribe201406$QUANTITY*(prescribe201406$`All Patients`/prescribe201406$total_patients)
# 
# prescribe201406 <- prescribe201406[-c(2:13)]
# 
# prescribe201406 <- aggregate(prescribe201406[-c(1,2)], by=list(factor(prescribe201406$BUASD11CD), factor(prescribe201406$Druggroup)), sum)
# 
# names(prescribe201406)[names(prescribe201406)=="Group.1"] <- "BUASD11CD"
# names(prescribe201406)[names(prescribe201406)=="Group.2"] <- "Druggroup"
# prescribe201406$PERIOD <- 201406
# 
# prescription <- rbind(prescription, prescribe201406)
# 
# 
# 
# 
# 
# prescribe201405 <- read_csv("prescribemaster201405.csv")
# prescribe201405 <- prescribe201405[-c(1)]
# names(prescribe201405)[names(prescribe201405)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr14 <- read_csv("gp-reg-pat-prac-lsoa-all-apr14.csv")
# names(gpusersapr14)[names(gpusersapr14)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr14 <- merge(gpusersapr14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr14[-c(1:5,7,8)], gpusersapr14["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201405 <- merge(gpusersapr14, prescribe201405, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201405 <- merge(prescribe201405, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201405$itemsper <- prescribe201405$ITEMS*(prescribe201405$`All Patients`/prescribe201405$total_patients)
# prescribe201405$nicper <- prescribe201405$NIC*(prescribe201405$`All Patients`/prescribe201405$total_patients)
# prescribe201405$actcostper <- prescribe201405$`ACT COST`*(prescribe201405$`All Patients`/prescribe201405$total_patients)
# prescribe201405$quantityper <- prescribe201405$QUANTITY*(prescribe201405$`All Patients`/prescribe201405$total_patients)
# 
# prescribe201405 <- prescribe201405[-c(2:13)]
# 
# prescribe201405 <- aggregate(prescribe201405[-c(1,2)], by=list(factor(prescribe201405$BUASD11CD), factor(prescribe201405$Druggroup)), sum)
# 
# names(prescribe201405)[names(prescribe201405)=="Group.1"] <- "BUASD11CD"
# names(prescribe201405)[names(prescribe201405)=="Group.2"] <- "Druggroup"
# prescribe201405$PERIOD <- 201405
# 
# prescription <- rbind(prescription, prescribe201405)
# 
# 
# 
# 
# prescribe201404 <- read_csv("prescribemaster201404.csv")
# prescribe201404 <- prescribe201404[-c(1)]
# names(prescribe201404)[names(prescribe201404)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr14 <- read_csv("gp-reg-pat-prac-lsoa-all-apr14.csv")
# names(gpusersapr14)[names(gpusersapr14)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr14 <- merge(gpusersapr14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr14[-c(1:5,7,8)], gpusersapr14["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201404 <- merge(gpusersapr14, prescribe201404, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201404 <- merge(prescribe201404, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201404$itemsper <- prescribe201404$ITEMS*(prescribe201404$`All Patients`/prescribe201404$total_patients)
# prescribe201404$nicper <- prescribe201404$NIC*(prescribe201404$`All Patients`/prescribe201404$total_patients)
# prescribe201404$actcostper <- prescribe201404$`ACT COST`*(prescribe201404$`All Patients`/prescribe201404$total_patients)
# prescribe201404$quantityper <- prescribe201404$QUANTITY*(prescribe201404$`All Patients`/prescribe201404$total_patients)
# 
# prescribe201404 <- prescribe201404[-c(2:13)]
# 
# prescribe201404 <- aggregate(prescribe201404[-c(1,2)], by=list(factor(prescribe201404$BUASD11CD), factor(prescribe201404$Druggroup)), sum)
# 
# names(prescribe201404)[names(prescribe201404)=="Group.1"] <- "BUASD11CD"
# names(prescribe201404)[names(prescribe201404)=="Group.2"] <- "Druggroup"
# prescribe201404$PERIOD <- 201404
# 
# prescription <- rbind(prescription, prescribe201404)
# 
# 
# prescribe201403 <- read_csv("prescribemaster201403.csv")
# prescribe201403 <- prescribe201403[-c(1)]
# names(prescribe201403)[names(prescribe201403)=="PRACTICE"] <- "PRACTICE_CODE"
# gpusersapr14 <- read_csv("gp-reg-pat-prac-lsoa-all-apr14.csv")
# names(gpusersapr14)[names(gpusersapr14)=="LSOA_CODE"] <- "LSOA11CD"
# 
# gpusersapr14 <- merge(gpusersapr14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
# buagppop <- aggregate(gpusersapr14[-c(1:5,7,8)], gpusersapr14["BUASD11CD"], sum)
# names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201403 <- merge(gpusersapr14, prescribe201403, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201403 <- merge(prescribe201403, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201403$itemsper <- prescribe201403$ITEMS*(prescribe201403$`All Patients`/prescribe201403$total_patients)
# prescribe201403$nicper <- prescribe201403$NIC*(prescribe201403$`All Patients`/prescribe201403$total_patients)
# prescribe201403$actcostper <- prescribe201403$`ACT COST`*(prescribe201403$`All Patients`/prescribe201403$total_patients)
# prescribe201403$quantityper <- prescribe201403$QUANTITY*(prescribe201403$`All Patients`/prescribe201403$total_patients)
# 
# prescribe201403 <- prescribe201403[-c(2:13)]
# 
# prescribe201403 <- aggregate(prescribe201403[-c(1,2)], by=list(factor(prescribe201403$BUASD11CD), factor(prescribe201403$Druggroup)), sum)
# 
# names(prescribe201403)[names(prescribe201403)=="Group.1"] <- "BUASD11CD"
# names(prescribe201403)[names(prescribe201403)=="Group.2"] <- "Druggroup"
# prescribe201403$PERIOD <- 201403
# 
# prescription <- rbind(prescription, prescribe201403)
# 
# 
# 
# 
# # 
# # prescribe201402 <- read_csv("prescribemaster201402.csv")
# # prescribe201402 <- prescribe201402[-c(1)]
# # names(prescribe201402)[names(prescribe201402)=="PRACTICE"] <- "PRACTICE_CODE"
# # gpusersjan14 <- read_csv("gp-reg-pat-prac-lsoa-all-jan14.csv")
# # names(gpusersjan14)[names(gpusersjan14)=="LSOA_CODE"] <- "LSOA11CD"
# # 
# # gpusersjan14 <- merge(gpusersjan14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# # 
# # buagppop <- aggregate(gpusersjan14[-c(1:5,7,8)], gpusersjan14["BUASD11CD"], sum)
# # names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# # 
# # prescribe201402 <- merge(gpusersjan14, prescribe201402, by="PRACTICE_CODE", all.x=TRUE)
# # prescribe201402 <- merge(prescribe201402, buagppop, by="BUASD11CD", all.x=TRUE)
# # 
# # prescribe201402$itemsper <- prescribe201402$ITEMS*(prescribe201402$`All Patients`/prescribe201402$total_patients)
# # prescribe201402$nicper <- prescribe201402$NIC*(prescribe201402$`All Patients`/prescribe201402$total_patients)
# # prescribe201402$actcostper <- prescribe201402$`ACT COST`*(prescribe201402$`All Patients`/prescribe201402$total_patients)
# # prescribe201402$quantityper <- prescribe201402$QUANTITY*(prescribe201402$`All Patients`/prescribe201402$total_patients)
# # 
# # prescribe201402 <- prescribe201402[-c(2:13)]
# # 
# # prescribe201402 <- aggregate(prescribe201402[-c(1,2)], by=list(factor(prescribe201402$BUASD11CD), factor(prescribe201402$Druggroup)), sum)
# # 
# # names(prescribe201402)[names(prescribe201402)=="Group.1"] <- "BUASD11CD"
# # names(prescribe201402)[names(prescribe201402)=="Group.2"] <- "Druggroup"
# # prescribe201402$PERIOD <- 201402
# # 
# # prescription <- rbind(prescription, prescribe201402)
# # 
# # 
# # 
# # 
# # prescribe201401 <- read_csv("prescribemaster201401.csv")
# # prescribe201401 <- prescribe201401[-c(1)]
# # names(prescribe201401)[names(prescribe201401)=="PRACTICE"] <- "PRACTICE_CODE"
# # gpusersjan14 <- read_csv("gp-reg-pat-prac-lsoa-all-jan14.csv")
# # names(gpusersjan14)[names(gpusersjan14)=="LSOA_CODE"] <- "LSOA11CD"
# # 
# # gpusersjan14 <- merge(gpusersjan14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# # 
# # buagppop <- aggregate(gpusersjan14[-c(1:5,7,8)], gpusersjan14["BUASD11CD"], sum)
# # names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# # 
# # prescribe201401 <- merge(gpusersjan14, prescribe201401, by="PRACTICE_CODE", all.x=TRUE)
# # prescribe201401 <- merge(prescribe201401, buagppop, by="BUASD11CD", all.x=TRUE)
# # 
# # prescribe201401$itemsper <- prescribe201401$ITEMS*(prescribe201401$`All Patients`/prescribe201401$total_patients)
# # prescribe201401$nicper <- prescribe201401$NIC*(prescribe201401$`All Patients`/prescribe201401$total_patients)
# # prescribe201401$actcostper <- prescribe201401$`ACT COST`*(prescribe201401$`All Patients`/prescribe201401$total_patients)
# # prescribe201401$quantityper <- prescribe201401$QUANTITY*(prescribe201401$`All Patients`/prescribe201401$total_patients)
# # 
# # prescribe201401 <- prescribe201401[-c(2:13)]
# # 
# # prescribe201401 <- aggregate(prescribe201401[-c(1,2)], by=list(factor(prescribe201401$BUASD11CD), factor(prescribe201401$Druggroup)), sum)
# # 
# # names(prescribe201401)[names(prescribe201401)=="Group.1"] <- "BUASD11CD"
# # names(prescribe201401)[names(prescribe201401)=="Group.2"] <- "Druggroup"
# # prescribe201401$PERIOD <- 201401
# # 
# # prescription <- rbind(prescription, prescribe201401)
# # 
# # prescribe201312 <- read_csv("prescribemaster201312.csv")
# # prescribe201312 <- prescribe201312[-c(1)]
# # names(prescribe201312)[names(prescribe201312)=="PRACTICE"] <- "PRACTICE_CODE"
# # gpusersjan14 <- read_csv("gp-reg-pat-prac-lsoa-all-jan14.csv")
# # names(gpusersjan14)[names(gpusersjan14)=="LSOA_CODE"] <- "LSOA11CD"
# # 
# # gpusersjan14 <- merge(gpusersjan14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# # 
# # buagppop <- aggregate(gpusersjan14[-c(1:5,7,8)], gpusersjan14["BUASD11CD"], sum)
# # names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# # 
# # prescribe201312 <- merge(gpusersjan14, prescribe201312, by="PRACTICE_CODE", all.x=TRUE)
# # prescribe201312 <- merge(prescribe201312, buagppop, by="BUASD11CD", all.x=TRUE)
# # 
# # prescribe201312$itemsper <- prescribe201312$ITEMS*(prescribe201312$`All Patients`/prescribe201312$total_patients)
# # prescribe201312$nicper <- prescribe201312$NIC*(prescribe201312$`All Patients`/prescribe201312$total_patients)
# # prescribe201312$actcostper <- prescribe201312$`ACT COST`*(prescribe201312$`All Patients`/prescribe201312$total_patients)
# # prescribe201312$quantityper <- prescribe201312$QUANTITY*(prescribe201312$`All Patients`/prescribe201312$total_patients)
# # 
# # prescribe201312 <- prescribe201312[-c(2:13)]
# # 
# # prescribe201312 <- aggregate(prescribe201312[-c(1,2)], by=list(factor(prescribe201312$BUASD11CD), factor(prescribe201312$Druggroup)), sum)
# # 
# # names(prescribe201312)[names(prescribe201312)=="Group.1"] <- "BUASD11CD"
# # names(prescribe201312)[names(prescribe201312)=="Group.2"] <- "Druggroup"
# # prescribe201312$PERIOD <- 201312
# # 
# # prescription <- rbind(prescription, prescribe201312)
# # 
# # 
# # 
# # 
# # prescribe201311 <- read_csv("prescribemaster201311.csv")
# # prescribe201311 <- prescribe201311[-c(1)]
# # names(prescribe201311)[names(prescribe201311)=="PRACTICE"] <- "PRACTICE_CODE"
# # gpusersoct13 <- read_csv("gp-reg-pat-prac-lsoa-all-oct13.csv")
# # names(gpusersoct13)[names(gpusersoct13)=="LSOA_CODE"] <- "LSOA11CD"
# # 
# # gpusersoct13 <- merge(gpusersoct13, lsoalookup, by="LSOA11CD", all.x=TRUE)
# # 
# # buagppop <- aggregate(gpusersoct13[-c(1:5,7,8)], gpusersoct13["BUASD11CD"], sum)
# # names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# # 
# # prescribe201311 <- merge(gpusersoct13, prescribe201311, by="PRACTICE_CODE", all.x=TRUE)
# # prescribe201311 <- merge(prescribe201311, buagppop, by="BUASD11CD", all.x=TRUE)
# # 
# # prescribe201311$itemsper <- prescribe201311$ITEMS*(prescribe201311$`All Patients`/prescribe201311$total_patients)
# # prescribe201311$nicper <- prescribe201311$NIC*(prescribe201311$`All Patients`/prescribe201311$total_patients)
# # prescribe201311$actcostper <- prescribe201311$`ACT COST`*(prescribe201311$`All Patients`/prescribe201311$total_patients)
# # prescribe201311$quantityper <- prescribe201311$QUANTITY*(prescribe201311$`All Patients`/prescribe201311$total_patients)
# # 
# # prescribe201311 <- prescribe201311[-c(2:13)]
# # 
# # prescribe201311 <- aggregate(prescribe201311[-c(1,2)], by=list(factor(prescribe201311$BUASD11CD), factor(prescribe201311$Druggroup)), sum)
# # 
# # names(prescribe201311)[names(prescribe201311)=="Group.1"] <- "BUASD11CD"
# # names(prescribe201311)[names(prescribe201311)=="Group.2"] <- "Druggroup"
# # prescribe201311$PERIOD <- 201311
# # 
# # prescription <- rbind(prescription, prescribe201311)
# # 
# # 
# # 
# # 
# # 
# # prescribe201310 <- read_csv("prescribemaster201310.csv")
# # prescribe201310 <- prescribe201310[-c(1)]
# # names(prescribe201310)[names(prescribe201310)=="PRACTICE"] <- "PRACTICE_CODE"
# # gpusersoct13 <- read_csv("gp-reg-pat-prac-lsoa-all-oct13.csv")
# # names(gpusersoct13)[names(gpusersoct13)=="LSOA_CODE"] <- "LSOA11CD"
# # 
# # gpusersoct13 <- merge(gpusersoct13, lsoalookup, by="LSOA11CD", all.x=TRUE)
# # 
# # buagppop <- aggregate(gpusersoct13[-c(1:5,7,8)], gpusersoct13["BUASD11CD"], sum)
# # names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# # 
# # prescribe201310 <- merge(gpusersoct13, prescribe201310, by="PRACTICE_CODE", all.x=TRUE)
# # prescribe201310 <- merge(prescribe201310, buagppop, by="BUASD11CD", all.x=TRUE)
# # 
# # prescribe201310$itemsper <- prescribe201310$ITEMS*(prescribe201310$`All Patients`/prescribe201310$total_patients)
# # prescribe201310$nicper <- prescribe201310$NIC*(prescribe201310$`All Patients`/prescribe201310$total_patients)
# # prescribe201310$actcostper <- prescribe201310$`ACT COST`*(prescribe201310$`All Patients`/prescribe201310$total_patients)
# # prescribe201310$quantityper <- prescribe201310$QUANTITY*(prescribe201310$`All Patients`/prescribe201310$total_patients)
# # 
# # prescribe201310 <- prescribe201310[-c(2:13)]
# # 
# # prescribe201310 <- aggregate(prescribe201310[-c(1,2)], by=list(factor(prescribe201310$BUASD11CD), factor(prescribe201310$Druggroup)), sum)
# # 
# # names(prescribe201310)[names(prescribe201310)=="Group.1"] <- "BUASD11CD"
# # names(prescribe201310)[names(prescribe201310)=="Group.2"] <- "Druggroup"
# # prescribe201310$PERIOD <- 201310
# # 
# # prescription <- rbind(prescription, prescribe201310)
# # 
# # 
# # 
# # prescribe201309 <- read_csv("prescribemaster201309.csv")
# # prescribe201309 <- prescribe201309[-c(1)]
# # names(prescribe201309)[names(prescribe201309)=="PRACTICE"] <- "PRACTICE_CODE"
# # gpusersoct13 <- read_csv("gp-reg-pat-prac-lsoa-all-oct13.csv")
# # names(gpusersoct13)[names(gpusersoct13)=="LSOA_CODE"] <- "LSOA11CD"
# # 
# # gpusersoct13 <- merge(gpusersoct13, lsoalookup, by="LSOA11CD", all.x=TRUE)
# # 
# # buagppop <- aggregate(gpusersoct13[-c(1:5,7,8)], gpusersoct13["BUASD11CD"], sum)
# # names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# # 
# # prescribe201309 <- merge(gpusersoct13, prescribe201309, by="PRACTICE_CODE", all.x=TRUE)
# # prescribe201309 <- merge(prescribe201309, buagppop, by="BUASD11CD", all.x=TRUE)
# # 
# # prescribe201309$itemsper <- prescribe201309$ITEMS*(prescribe201309$`All Patients`/prescribe201309$total_patients)
# # prescribe201309$nicper <- prescribe201309$NIC*(prescribe201309$`All Patients`/prescribe201309$total_patients)
# # prescribe201309$actcostper <- prescribe201309$`ACT COST`*(prescribe201309$`All Patients`/prescribe201309$total_patients)
# # prescribe201309$quantityper <- prescribe201309$QUANTITY*(prescribe201309$`All Patients`/prescribe201309$total_patients)
# # 
# # prescribe201309 <- prescribe201309[-c(2:13)]
# # 
# # prescribe201309 <- aggregate(prescribe201309[-c(1,2)], by=list(factor(prescribe201309$BUASD11CD), factor(prescribe201309$Druggroup)), sum)
# # 
# # names(prescribe201309)[names(prescribe201309)=="Group.1"] <- "BUASD11CD"
# # names(prescribe201309)[names(prescribe201309)=="Group.2"] <- "Druggroup"
# # prescribe201309$PERIOD <- 201309
# # 
# # prescription <- rbind(prescription, prescribe201309)
# # 
# # 
# # 
# # prescribe201308 <- read_csv("prescribemaster201308.csv")
# # prescribe201308 <- prescribe201308[-c(1)]
# # names(prescribe201308)[names(prescribe201308)=="PRACTICE"] <- "PRACTICE_CODE"
# # gpusersjul13 <- read_csv("gp-reg-pat-prac-lsoa-all-jul13.csv")
# # names(gpusersjul13)[names(gpusersjul13)=="LSOA_CODE"] <- "LSOA11CD"
# # 
# # gpusersjul13 <- merge(gpusersjul13, lsoalookup, by="LSOA11CD", all.x=TRUE)
# # 
# # buagppop <- aggregate(gpusersjul13[-c(1:5,7,8)], gpusersjul13["BUASD11CD"], sum)
# # names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# # 
# # prescribe201308 <- merge(gpusersjul13, prescribe201308, by="PRACTICE_CODE", all.x=TRUE)
# # prescribe201308 <- merge(prescribe201308, buagppop, by="BUASD11CD", all.x=TRUE)
# # 
# # prescribe201308$itemsper <- prescribe201308$ITEMS*(prescribe201308$`All Patients`/prescribe201308$total_patients)
# # prescribe201308$nicper <- prescribe201308$NIC*(prescribe201308$`All Patients`/prescribe201308$total_patients)
# # prescribe201308$actcostper <- prescribe201308$`ACT COST`*(prescribe201308$`All Patients`/prescribe201308$total_patients)
# # prescribe201308$quantityper <- prescribe201308$QUANTITY*(prescribe201308$`All Patients`/prescribe201308$total_patients)
# # 
# # prescribe201308 <- prescribe201308[-c(2:13)]
# # 
# # prescribe201308 <- aggregate(prescribe201308[-c(1,2)], by=list(factor(prescribe201308$BUASD11CD), factor(prescribe201308$Druggroup)), sum)
# # 
# # names(prescribe201308)[names(prescribe201308)=="Group.1"] <- "BUASD11CD"
# # names(prescribe201308)[names(prescribe201308)=="Group.2"] <- "Druggroup"
# # prescribe201308$PERIOD <- 201308
# # 
# # prescription <- rbind(prescription, prescribe201308)
# # 
# # 
# # 
# # 
# # 
# # prescribe201307 <- read_csv("prescribemaster201307.csv")
# # prescribe201307 <- prescribe201307[-c(1)]
# # names(prescribe201307)[names(prescribe201307)=="PRACTICE"] <- "PRACTICE_CODE"
# # gpusersjul13 <- read_csv("gp-reg-pat-prac-lsoa-all-jul13.csv")
# # names(gpusersjul13)[names(gpusersjul13)=="LSOA_CODE"] <- "LSOA11CD"
# # 
# # gpusersjul13 <- merge(gpusersjul13, lsoalookup, by="LSOA11CD", all.x=TRUE)
# # 
# # buagppop <- aggregate(gpusersjul13[-c(1:5,7,8)], gpusersjul13["BUASD11CD"], sum)
# # names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# # 
# # prescribe201307 <- merge(gpusersjul13, prescribe201307, by="PRACTICE_CODE", all.x=TRUE)
# # prescribe201307 <- merge(prescribe201307, buagppop, by="BUASD11CD", all.x=TRUE)
# # 
# # prescribe201307$itemsper <- prescribe201307$ITEMS*(prescribe201307$`All Patients`/prescribe201307$total_patients)
# # prescribe201307$nicper <- prescribe201307$NIC*(prescribe201307$`All Patients`/prescribe201307$total_patients)
# # prescribe201307$actcostper <- prescribe201307$`ACT COST`*(prescribe201307$`All Patients`/prescribe201307$total_patients)
# # prescribe201307$quantityper <- prescribe201307$QUANTITY*(prescribe201307$`All Patients`/prescribe201307$total_patients)
# # 
# # prescribe201307 <- prescribe201307[-c(2:13)]
# # 
# # prescribe201307 <- aggregate(prescribe201307[-c(1,2)], by=list(factor(prescribe201307$BUASD11CD), factor(prescribe201307$Druggroup)), sum)
# # 
# # names(prescribe201307)[names(prescribe201307)=="Group.1"] <- "BUASD11CD"
# # names(prescribe201307)[names(prescribe201307)=="Group.2"] <- "Druggroup"
# # prescribe201307$PERIOD <- 201307
# # 
# # prescription <- rbind(prescription, prescribe201307)
# # 
# # 
# # 
# # 
# # 
# # prescribe201306 <- read_csv("prescribemaster201306.csv")
# # prescribe201306 <- prescribe201306[-c(1)]
# # names(prescribe201306)[names(prescribe201306)=="PRACTICE"] <- "PRACTICE_CODE"
# # gpusersjul13 <- read_csv("gp-reg-pat-prac-lsoa-all-jul13.csv")
# # names(gpusersjul13)[names(gpusersjul13)=="LSOA_CODE"] <- "LSOA11CD"
# # 
# # gpusersjul13 <- merge(gpusersjul13, lsoalookup, by="LSOA11CD", all.x=TRUE)
# # 
# # buagppop <- aggregate(gpusersjul13[-c(1:5,7,8)], gpusersjul13["BUASD11CD"], sum)
# # names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# # 
# # prescribe201306 <- merge(gpusersjul13, prescribe201306, by="PRACTICE_CODE", all.x=TRUE)
# # prescribe201306 <- merge(prescribe201306, buagppop, by="BUASD11CD", all.x=TRUE)
# # 
# # prescribe201306$itemsper <- prescribe201306$ITEMS*(prescribe201306$`All Patients`/prescribe201306$total_patients)
# # prescribe201306$nicper <- prescribe201306$NIC*(prescribe201306$`All Patients`/prescribe201306$total_patients)
# # prescribe201306$actcostper <- prescribe201306$`ACT COST`*(prescribe201306$`All Patients`/prescribe201306$total_patients)
# # prescribe201306$quantityper <- prescribe201306$QUANTITY*(prescribe201306$`All Patients`/prescribe201306$total_patients)
# # 
# # prescribe201306 <- prescribe201306[-c(2:13)]
# # 
# # prescribe201306 <- aggregate(prescribe201306[-c(1,2)], by=list(factor(prescribe201306$BUASD11CD), factor(prescribe201306$Druggroup)), sum)
# # 
# # names(prescribe201306)[names(prescribe201306)=="Group.1"] <- "BUASD11CD"
# # names(prescribe201306)[names(prescribe201306)=="Group.2"] <- "Druggroup"
# # prescribe201306$PERIOD <- 201306
# # 
# # prescription <- rbind(prescription, prescribe201306)
# # 
# # 
# # 
# # 
# # 
# # prescribe201305 <- read_csv("prescribemaster201305.csv")
# # prescribe201305 <- prescribe201305[-c(1)]
# # names(prescribe201305)[names(prescribe201305)=="PRACTICE"] <- "PRACTICE_CODE"
# # gpusersapr13 <- read_csv("gp-reg-pat-prac-lsoa-all-apr13.csv")
# # names(gpusersapr13)[names(gpusersapr13)=="LSOA_CODE"] <- "LSOA11CD"
# # 
# # gpusersapr13 <- merge(gpusersapr13, lsoalookup, by="LSOA11CD", all.x=TRUE)
# # 
# # buagppop <- aggregate(gpusersapr13[-c(1:5,7,8)], gpusersapr13["BUASD11CD"], sum)
# # names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# # 
# # prescribe201305 <- merge(gpusersapr13, prescribe201305, by="PRACTICE_CODE", all.x=TRUE)
# # prescribe201305 <- merge(prescribe201305, buagppop, by="BUASD11CD", all.x=TRUE)
# # 
# # prescribe201305$itemsper <- prescribe201305$ITEMS*(prescribe201305$`All Patients`/prescribe201305$total_patients)
# # prescribe201305$nicper <- prescribe201305$NIC*(prescribe201305$`All Patients`/prescribe201305$total_patients)
# # prescribe201305$actcostper <- prescribe201305$`ACT COST`*(prescribe201305$`All Patients`/prescribe201305$total_patients)
# # prescribe201305$quantityper <- prescribe201305$QUANTITY*(prescribe201305$`All Patients`/prescribe201305$total_patients)
# # 
# # prescribe201305 <- prescribe201305[-c(2:13)]
# # 
# # prescribe201305 <- aggregate(prescribe201305[-c(1,2)], by=list(factor(prescribe201305$BUASD11CD), factor(prescribe201305$Druggroup)), sum)
# # 
# # names(prescribe201305)[names(prescribe201305)=="Group.1"] <- "BUASD11CD"
# # names(prescribe201305)[names(prescribe201305)=="Group.2"] <- "Druggroup"
# # prescribe201305$PERIOD <- 201305
# # 
# # prescription <- rbind(prescription, prescribe201305)
# # 
# # 
# # 
# # 
# # prescribe201304 <- read_csv("prescribemaster201304.csv")
# # prescribe201304 <- prescribe201304[-c(1)]
# # names(prescribe201304)[names(prescribe201304)=="PRACTICE"] <- "PRACTICE_CODE"
# # gpusersapr13 <- read_csv("gp-reg-pat-prac-lsoa-all-apr13.csv")
# # names(gpusersapr13)[names(gpusersapr13)=="LSOA_CODE"] <- "LSOA11CD"
# # 
# # gpusersapr13 <- merge(gpusersapr13, lsoalookup, by="LSOA11CD", all.x=TRUE)
# # 
# # buagppop <- aggregate(gpusersapr13[-c(1:5,7,8)], gpusersapr13["BUASD11CD"], sum)
# # names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# # 
# # prescribe201304 <- merge(gpusersapr13, prescribe201304, by="PRACTICE_CODE", all.x=TRUE)
# # prescribe201304 <- merge(prescribe201304, buagppop, by="BUASD11CD", all.x=TRUE)
# # 
# # prescribe201304$itemsper <- prescribe201304$ITEMS*(prescribe201304$`All Patients`/prescribe201304$total_patients)
# # prescribe201304$nicper <- prescribe201304$NIC*(prescribe201304$`All Patients`/prescribe201304$total_patients)
# # prescribe201304$actcostper <- prescribe201304$`ACT COST`*(prescribe201304$`All Patients`/prescribe201304$total_patients)
# # prescribe201304$quantityper <- prescribe201304$QUANTITY*(prescribe201304$`All Patients`/prescribe201304$total_patients)
# # 
# # prescribe201304 <- prescribe201304[-c(2:13)]
# # 
# # prescribe201304 <- aggregate(prescribe201304[-c(1,2)], by=list(factor(prescribe201304$BUASD11CD), factor(prescribe201304$Druggroup)), sum)
# # 
# # names(prescribe201304)[names(prescribe201304)=="Group.1"] <- "BUASD11CD"
# # names(prescribe201304)[names(prescribe201304)=="Group.2"] <- "Druggroup"
# # prescribe201304$PERIOD <- 201304
# # 
# # prescription <- rbind(prescription, prescribe201304)
# # 
# # 
# # 
# # 
# # 
# # prescribe201303 <- read_csv("prescribemaster201303.csv")
# # prescribe201303 <- prescribe201303[-c(1)]
# # names(prescribe201303)[names(prescribe201303)=="PRACTICE"] <- "PRACTICE_CODE"
# # gpusersapr13 <- read_csv("gp-reg-pat-prac-lsoa-all-apr13.csv")
# # names(gpusersapr13)[names(gpusersapr13)=="LSOA_CODE"] <- "LSOA11CD"
# # 
# # gpusersapr13 <- merge(gpusersapr13, lsoalookup, by="LSOA11CD", all.x=TRUE)
# # 
# # buagppop <- aggregate(gpusersapr13[-c(1:5,7,8)], gpusersapr13["BUASD11CD"], sum)
# # names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# # 
# # prescribe201303 <- merge(gpusersapr13, prescribe201303, by="PRACTICE_CODE", all.x=TRUE)
# # prescribe201303 <- merge(prescribe201303, buagppop, by="BUASD11CD", all.x=TRUE)
# # 
# # prescribe201303$itemsper <- prescribe201303$ITEMS*(prescribe201303$`All Patients`/prescribe201303$total_patients)
# # prescribe201303$nicper <- prescribe201303$NIC*(prescribe201303$`All Patients`/prescribe201303$total_patients)
# # prescribe201303$actcostper <- prescribe201303$`ACT COST`*(prescribe201303$`All Patients`/prescribe201303$total_patients)
# # prescribe201303$quantityper <- prescribe201303$QUANTITY*(prescribe201303$`All Patients`/prescribe201303$total_patients)
# # 
# # prescribe201303 <- prescribe201303[-c(2:13)]
# # 
# # prescribe201303 <- aggregate(prescribe201303[-c(1,2)], by=list(factor(prescribe201303$BUASD11CD), factor(prescribe201303$Druggroup)), sum)
# # 
# # names(prescribe201303)[names(prescribe201303)=="Group.1"] <- "BUASD11CD"
# # names(prescribe201303)[names(prescribe201303)=="Group.2"] <- "Druggroup"
# # prescribe201303$PERIOD <- 201303
# # 
# # prescription <- rbind(prescription, prescribe201303)
# 
# prescribe201702 <- prescribe201702[-c(3)]
# prescribe201701 <- prescribe201701[-c(3)]
# prescribe201612 <- prescribe201612[-c(3)]
# prescribe201611 <- prescribe201611[-c(3)]
# prescribe201610 <- prescribe201610[-c(3)]
# prescribe201609 <- prescribe201609[-c(3)]
# prescribe201608 <- prescribe201608[-c(3)]
# prescribe201607 <- prescribe201607[-c(3)]
# prescribe201606 <- prescribe201606[-c(3)]
# prescribe201605 <- prescribe201605[-c(3)]
# prescribe201604 <- prescribe201604[-c(3)]
# prescribe201603 <- prescribe201603[-c(3)]
# prescribe201602 <- prescribe201602[-c(3)]
# prescribe201601 <- prescribe201601[-c(3)]
# prescribe201512 <- prescribe201512[-c(3)]
# prescribe201511 <- prescribe201511[-c(3)]
# prescribe201510 <- prescribe201510[-c(3)]
# prescribe201509 <- prescribe201509[-c(3)]
# prescribe201508 <- prescribe201508[-c(3)]
# prescribe201507 <- prescribe201507[-c(3)]
# prescribe201506 <- prescribe201506[-c(3)]
# prescribe201505 <- prescribe201505[-c(3)]
# prescribe201504 <- prescribe201504[-c(3)]
# prescribe201503 <- prescribe201503[-c(3)]
# prescribe201502 <- prescribe201502[-c(3)]
# prescribe201501 <- prescribe201501[-c(3)]
# prescribe201412 <- prescribe201412[-c(3)]
# prescribe201411 <- prescribe201411[-c(3)]
# prescribe201410 <- prescribe201410[-c(3)]
# prescribe201409 <- prescribe201409[-c(3)]
# prescribe201408 <- prescribe201408[-c(3)]
# prescribe201407 <- prescribe201407[-c(3)]
# prescribe201406 <- prescribe201406[-c(3)]
# prescribe201405 <- prescribe201405[-c(3)]
# prescribe201404 <- prescribe201404[-c(3)]
# prescribe201403 <- prescribe201403[-c(3)]
# 
# prescription <- rbind(prescription, prescribe201702)
# prescription <- rbind(prescription, prescribe201701)
# prescription <- rbind(prescription, prescribe201612)
# prescription <- rbind(prescription, prescribe201611)
# prescription <- rbind(prescription, prescribe201610)
# prescription <- rbind(prescription, prescribe201609)
# prescription <- rbind(prescription, prescribe201608)
# prescription <- rbind(prescription, prescribe201607)
# prescription <- rbind(prescription, prescribe201606)
# prescription <- rbind(prescription, prescribe201605)
# prescription <- rbind(prescription, prescribe201604)
# prescription <- rbind(prescription, prescribe201603)
# prescription <- rbind(prescription, prescribe201602)
# prescription <- rbind(prescription, prescribe201601)
# prescription <- rbind(prescription, prescribe201512)
# prescription <- rbind(prescription, prescribe201511)
# prescription <- rbind(prescription, prescribe201510)
# prescription <- rbind(prescription, prescribe201509)
# prescription <- rbind(prescription, prescribe201508)
# prescription <- rbind(prescription, prescribe201507)
# prescription <- rbind(prescription, prescribe201506)
# prescription <- rbind(prescription, prescribe201505)
# prescription <- rbind(prescription, prescribe201504)
# prescription <- rbind(prescription, prescribe201503)
# prescription <- rbind(prescription, prescribe201502)
# prescription <- rbind(prescription, prescribe201501)
# prescription <- rbind(prescription, prescribe201412)
# prescription <- rbind(prescription, prescribe201411)
# prescription <- rbind(prescription, prescribe201410)
# prescription <- rbind(prescription, prescribe201409)
# prescription <- rbind(prescription, prescribe201408)
# prescription <- rbind(prescription, prescribe201407)
# prescription <- rbind(prescription, prescribe201406)
# prescription <- rbind(prescription, prescribe201405)
# prescription <- rbind(prescription, prescribe201404)
# prescription <- rbind(prescription, prescribe201403)
# 
# 
# 
# write.csv(prescription, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescriptionfinal.csv")
# write.csv(prescription, "C:\\Users\\bengo\\OneDrive\\Documents\\prescriptionfinal.csv")
# 
# prescription4dm <- format(prescription, digits=4, nsmall=4)
# 
# write.csv(prescription4dm, "C:\\Users\\bjg55\\Documents\\Towns\\Town Health\\Town Health\\prescriptionfinalshort.csv")
# write.csv(prescription4dm, "C:\\Users\\bengo\\OneDrive\\Documents\\prescriptionfinalshort.csv")
# 

####test load####

try <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\prescriptionfinal.csv")

#####you fucking idiot#####

# prescribe201912 <- read_csv("prescribemaster201912.csv")
# prescribe201912 <- prescribe201912[-c(1)]
# names(prescribe201912)[names(prescribe201912)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct19 <- read_csv("gp-reg-pat-prac-lsoa-all-oct19.csv")
names(gpusersoct19)[names(gpusersoct19)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct19 <- merge(gpusersoct19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct19[-c(1:6,8,9)], gpusersoct19["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201912 <- merge(gpusersoct19, prescribe201912, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201912 <- merge(prescribe201912, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201912$itemsper <- prescribe201912$ITEMS*(prescribe201912$`Number of Patients`/prescribe201912$total_patients)
# prescribe201912$nicper <- prescribe201912$NIC*(prescribe201912$`Number of Patients`/prescribe201912$total_patients)
# prescribe201912$actcostper <- prescribe201912$`ACT COST`*(prescribe201912$`Number of Patients`/prescribe201912$total_patients)
# prescribe201912$quantityper <- prescribe201912$QUANTITY*(prescribe201912$`Number of Patients`/prescribe201912$total_patients)
# 
# prescribe201912 <- prescribe201912[-c(2:14, 16)]
# 
# prescribe201912 <- aggregate(prescribe201912[-c(1,2)], by=list(factor(prescribe201912$BUASD11CD), factor(prescribe201912$Druggroup)), sum)
# 
# names(prescribe201912)[names(prescribe201912)=="Group.1"] <- "BUASD11CD"
# names(prescribe201912)[names(prescribe201912)=="Group.2"] <- "Druggroup"
# prescribe201912  gg \n trykk <- 201912
# 

buagppop$PERIOD <- 201912

populationgps <- buagppop



# prescribe201911 <- read_csv("prescribemaster201911.csv")
# prescribe201911 <- prescribe201911[-c(1)]
# names(prescribe201911)[names(prescribe201911)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct19 <- read_csv("gp-reg-pat-prac-lsoa-all-oct19.csv")
names(gpusersoct19)[names(gpusersoct19)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct19 <- merge(gpusersoct19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct19[-c(1:6,8,9)], gpusersoct19["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201911 <- merge(gpusersoct19, prescribe201911, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201911 <- merge(prescribe201911, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201911$itemsper <- prescribe201911$ITEMS*(prescribe201911$`Number of Patients`/prescribe201911$total_patients)
# prescribe201911$nicper <- prescribe201911$NIC*(prescribe201911$`Number of Patients`/prescribe201911$total_patients)
# prescribe201911$actcostper <- prescribe201911$`ACT COST`*(prescribe201911$`Number of Patients`/prescribe201911$total_patients)
# prescribe201911$quantityper <- prescribe201911$QUANTITY*(prescribe201911$`Number of Patients`/prescribe201911$total_patients)
# 
# prescribe201911 <- prescribe201911[-c(2:14, 16)]
# 
# prescribe201911 <- aggregate(prescribe201911[-c(1,2)], by=list(factor(prescribe201911$BUASD11CD), factor(prescribe201911$Druggroup)), sum)
# 
# names(prescribe201911)[names(prescribe201911)=="Group.1"] <- "BUASD11CD"
# names(prescribe201911)[names(prescribe201911)=="Group.2"] <- "Druggroup"
# prescribe201911$PERIOD <- 201911
# 
# prescription <- rbind(prescribe201912, prescribe201911)
# 


buagppop$PERIOD <- 201911


populationgps <- rbind(populationgps, buagppop)

# prescribe201910 <- read_csv("prescribemaster201910.csv")
# prescribe201910 <- prescribe201910[-c(1)]
# names(prescribe201910)[names(prescribe201910)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct19 <- read_csv("gp-reg-pat-prac-lsoa-all-oct19.csv")
names(gpusersoct19)[names(gpusersoct19)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct19 <- merge(gpusersoct19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct19[-c(1:6,8,9)], gpusersoct19["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"


# 
# prescribe201910 <- merge(gpusersoct19, prescribe201910, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201910 <- merge(prescribe201910, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201910$itemsper <- prescribe201910$ITEMS*(prescribe201910$`Number of Patients`/prescribe201910$total_patients)
# prescribe201910$nicper <- prescribe201910$NIC*(prescribe201910$`Number of Patients`/prescribe201910$total_patients)
# prescribe201910$actcostper <- prescribe201910$`ACT COST`*(prescribe201910$`Number of Patients`/prescribe201910$total_patients)
# prescribe201910$quantityper <- prescribe201910$QUANTITY*(prescribe201910$`Number of Patients`/prescribe201910$total_patients)
# 
# prescribe201910 <- prescribe201910[-c(2:14, 16)]
# 
# prescribe201910 <- aggregate(prescribe201910[-c(1,2)], by=list(factor(prescribe201910$BUASD11CD), factor(prescribe201910$Druggroup)), sum)
# 
# names(prescribe201910)[names(prescribe201910)=="Group.1"] <- "BUASD11CD"
# names(prescribe201910)[names(prescribe201910)=="Group.2"] <- "Druggroup"
# prescribe201910$PERIOD <- 201910
# 
# prescription <- rbind(prescription, prescribe201910)
# 

buagppop$PERIOD <- 201910


populationgps <- rbind(populationgps, buagppop)




# 
# 
# prescribe201909 <- read_csv("prescribemaster201909.csv")
# prescribe201909 <- prescribe201909[-c(1)]
# names(prescribe201909)[names(prescribe201909)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct19 <- read_csv("gp-reg-pat-prac-lsoa-all-oct19.csv")
names(gpusersoct19)[names(gpusersoct19)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct19 <- merge(gpusersoct19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct19[-c(1:6,8,9)], gpusersoct19["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201909 <- merge(gpusersoct19, prescribe201909, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201909 <- merge(prescribe201909, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201909$itemsper <- prescribe201909$ITEMS*(prescribe201909$`Number of Patients`/prescribe201909$total_patients)
# prescribe201909$nicper <- prescribe201909$NIC*(prescribe201909$`Number of Patients`/prescribe201909$total_patients)
# prescribe201909$actcostper <- prescribe201909$`ACT COST`*(prescribe201909$`Number of Patients`/prescribe201909$total_patients)
# prescribe201909$quantityper <- prescribe201909$QUANTITY*(prescribe201909$`Number of Patients`/prescribe201909$total_patients)
# 
# prescribe201909 <- prescribe201909[-c(2:14, 16)]
# 
# prescribe201909 <- aggregate(prescribe201909[-c(1,2)], by=list(factor(prescribe201909$BUASD11CD), factor(prescribe201909$Druggroup)), sum)
# 
# names(prescribe201909)[names(prescribe201909)=="Group.1"] <- "BUASD11CD"
# names(prescribe201909)[names(prescribe201909)=="Group.2"] <- "Druggroup"
# prescribe201909$PERIOD <- 201909
# 
# prescription <- rbind(prescription, prescribe201909)
# 
# 
buagppop$PERIOD <- 201909


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201908 <- read_csv("prescribemaster201908.csv")
# prescribe201908 <- prescribe201908[-c(1)]
# names(prescribe201908)[names(prescribe201908)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul19 <- read_csv("gp-reg-pat-prac-lsoa-all-jul19.csv")
names(gpusersjul19)[names(gpusersjul19)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul19 <- merge(gpusersjul19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul19[-c(1:6,8,9)], gpusersjul19["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201908 <- merge(gpusersjul19, prescribe201908, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201908 <- merge(prescribe201908, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201908$itemsper <- prescribe201908$ITEMS*(prescribe201908$`Number of Patients`/prescribe201908$total_patients)
# prescribe201908$nicper <- prescribe201908$NIC*(prescribe201908$`Number of Patients`/prescribe201908$total_patients)
# prescribe201908$actcostper <- prescribe201908$`ACT COST`*(prescribe201908$`Number of Patients`/prescribe201908$total_patients)
# prescribe201908$quantityper <- prescribe201908$QUANTITY*(prescribe201908$`Number of Patients`/prescribe201908$total_patients)
# 
# prescribe201908 <- prescribe201908[-c(2:14, 16)]
# 
# prescribe201908 <- aggregate(prescribe201908[-c(1,2)], by=list(factor(prescribe201908$BUASD11CD), factor(prescribe201908$Druggroup)), sum)
# 
# names(prescribe201908)[names(prescribe201908)=="Group.1"] <- "BUASD11CD"
# names(prescribe201908)[names(prescribe201908)=="Group.2"] <- "Druggroup"
# prescribe201908$PERIOD <- 201908
# 
# prescription <- rbind(prescription, prescribe201908)
# 
buagppop$PERIOD <- 201908


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201907 <- read_csv("prescribemaster201907.csv")
# prescribe201907 <- prescribe201907[-c(1)]
# names(prescribe201907)[names(prescribe201907)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul19 <- read_csv("gp-reg-pat-prac-lsoa-all-jul19.csv")
names(gpusersjul19)[names(gpusersjul19)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul19 <- merge(gpusersjul19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul19[-c(1:6,8,9)], gpusersjul19["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201907 <- merge(gpusersjul19, prescribe201907, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201907 <- merge(prescribe201907, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201907$itemsper <- prescribe201907$ITEMS*(prescribe201907$`Number of Patients`/prescribe201907$total_patients)
# prescribe201907$nicper <- prescribe201907$NIC*(prescribe201907$`Number of Patients`/prescribe201907$total_patients)
# prescribe201907$actcostper <- prescribe201907$`ACT COST`*(prescribe201907$`Number of Patients`/prescribe201907$total_patients)
# prescribe201907$quantityper <- prescribe201907$QUANTITY*(prescribe201907$`Number of Patients`/prescribe201907$total_patients)
# 
# prescribe201907 <- prescribe201907[-c(2:14, 16)]
# 
# prescribe201907 <- aggregate(prescribe201907[-c(1,2)], by=list(factor(prescribe201907$BUASD11CD), factor(prescribe201907$Druggroup)), sum)
# 
# names(prescribe201907)[names(prescribe201907)=="Group.1"] <- "BUASD11CD"
# names(prescribe201907)[names(prescribe201907)=="Group.2"] <- "Druggroup"
# prescribe201907$PERIOD <- 201907
# 
# prescription <- rbind(prescription, prescribe201907)
# 
buagppop$PERIOD <- 201907


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201906 <- read_csv("prescribemaster201906.csv")
# prescribe201906 <- prescribe201906[-c(1)]
# names(prescribe201906)[names(prescribe201906)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul19 <- read_csv("gp-reg-pat-prac-lsoa-all-jul19.csv")
names(gpusersjul19)[names(gpusersjul19)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul19 <- merge(gpusersjul19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul19[-c(1:6,8,9)], gpusersjul19["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201906 <- merge(gpusersjul19, prescribe201906, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201906 <- merge(prescribe201906, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201906$itemsper <- prescribe201906$ITEMS*(prescribe201906$`Number of Patients`/prescribe201906$total_patients)
# prescribe201906$nicper <- prescribe201906$NIC*(prescribe201906$`Number of Patients`/prescribe201906$total_patients)
# prescribe201906$actcostper <- prescribe201906$`ACT COST`*(prescribe201906$`Number of Patients`/prescribe201906$total_patients)
# prescribe201906$quantityper <- prescribe201906$QUANTITY*(prescribe201906$`Number of Patients`/prescribe201906$total_patients)
# 
# prescribe201906 <- prescribe201906[-c(2:14, 16)]
# 
# prescribe201906 <- aggregate(prescribe201906[-c(1,2)], by=list(factor(prescribe201906$BUASD11CD), factor(prescribe201906$Druggroup)), sum)
# 
# names(prescribe201906)[names(prescribe201906)=="Group.1"] <- "BUASD11CD"
# names(prescribe201906)[names(prescribe201906)=="Group.2"] <- "Druggroup"
# prescribe201906$PERIOD <- 201906
# 
# prescription <- rbind(prescription, prescribe201906)
# 
# 
buagppop$PERIOD <- 201906


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201905 <- read_csv("prescribemaster201905.csv")
# prescribe201905 <- prescribe201905[-c(1)]
# names(prescribe201905)[names(prescribe201905)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr19 <- read_csv("gp-reg-pat-prac-lsoa-all-apr19.csv")
names(gpusersapr19)[names(gpusersapr19)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr19 <- merge(gpusersapr19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr19[-c(1:6,8,9)], gpusersapr19["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201905 <- merge(gpusersapr19, prescribe201905, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201905 <- merge(prescribe201905, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201905$itemsper <- prescribe201905$ITEMS*(prescribe201905$`Number of Patients`/prescribe201905$total_patients)
# prescribe201905$nicper <- prescribe201905$NIC*(prescribe201905$`Number of Patients`/prescribe201905$total_patients)
# prescribe201905$actcostper <- prescribe201905$`ACT COST`*(prescribe201905$`Number of Patients`/prescribe201905$total_patients)
# prescribe201905$quantityper <- prescribe201905$QUANTITY*(prescribe201905$`Number of Patients`/prescribe201905$total_patients)
# 
# prescribe201905 <- prescribe201905[-c(2:14, 16)]
# 
# prescribe201905 <- aggregate(prescribe201905[-c(1,2)], by=list(factor(prescribe201905$BUASD11CD), factor(prescribe201905$Druggroup)), sum)
# 
# names(prescribe201905)[names(prescribe201905)=="Group.1"] <- "BUASD11CD"
# names(prescribe201905)[names(prescribe201905)=="Group.2"] <- "Druggroup"
# prescribe201905$PERIOD <- 201905
# 
# prescription <- rbind(prescription, prescribe201905)
# 
# 
buagppop$PERIOD <- 201905


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201904 <- read_csv("prescribemaster201904.csv")
# prescribe201904 <- prescribe201904[-c(1)]
# names(prescribe201904)[names(prescribe201904)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr19 <- read_csv("gp-reg-pat-prac-lsoa-all-apr19.csv")
names(gpusersapr19)[names(gpusersapr19)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr19 <- merge(gpusersapr19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr19[-c(1:6,8,9)], gpusersapr19["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201904 <- merge(gpusersapr19, prescribe201904, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201904 <- merge(prescribe201904, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201904$itemsper <- prescribe201904$ITEMS*(prescribe201904$`Number of Patients`/prescribe201904$total_patients)
# prescribe201904$nicper <- prescribe201904$NIC*(prescribe201904$`Number of Patients`/prescribe201904$total_patients)
# prescribe201904$actcostper <- prescribe201904$`ACT COST`*(prescribe201904$`Number of Patients`/prescribe201904$total_patients)
# prescribe201904$quantityper <- prescribe201904$QUANTITY*(prescribe201904$`Number of Patients`/prescribe201904$total_patients)
# 
# prescribe201904 <- prescribe201904[-c(2:14, 16)]
# 
# prescribe201904 <- aggregate(prescribe201904[-c(1,2)], by=list(factor(prescribe201904$BUASD11CD), factor(prescribe201904$Druggroup)), sum)
# 
# names(prescribe201904)[names(prescribe201904)=="Group.1"] <- "BUASD11CD"
# names(prescribe201904)[names(prescribe201904)=="Group.2"] <- "Druggroup"
# prescribe201904$PERIOD <- 201904
# 
# prescription <- rbind(prescription, prescribe201904)
# 
# 
buagppop$PERIOD <- 201904


populationgps <- rbind(populationgps, buagppop)

# 
# 
# 
# prescribe201903 <- read_csv("prescribemaster201903.csv")
# prescribe201903 <- prescribe201903[-c(1)]
# names(prescribe201903)[names(prescribe201903)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr19 <- read_csv("gp-reg-pat-prac-lsoa-all-apr19.csv")
names(gpusersapr19)[names(gpusersapr19)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr19 <- merge(gpusersapr19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr19[-c(1:6,8,9)], gpusersapr19["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201903 <- merge(gpusersapr19, prescribe201903, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201903 <- merge(prescribe201903, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201903$itemsper <- prescribe201903$ITEMS*(prescribe201903$`Number of Patients`/prescribe201903$total_patients)
# prescribe201903$nicper <- prescribe201903$NIC*(prescribe201903$`Number of Patients`/prescribe201903$total_patients)
# prescribe201903$actcostper <- prescribe201903$`ACT COST`*(prescribe201903$`Number of Patients`/prescribe201903$total_patients)
# prescribe201903$quantityper <- prescribe201903$QUANTITY*(prescribe201903$`Number of Patients`/prescribe201903$total_patients)
# 
# prescribe201903 <- prescribe201903[-c(2:14, 16)]
# 
# prescribe201903 <- aggregate(prescribe201903[-c(1,2)], by=list(factor(prescribe201903$BUASD11CD), factor(prescribe201903$Druggroup)), sum)
# 
# names(prescribe201903)[names(prescribe201903)=="Group.1"] <- "BUASD11CD"
# names(prescribe201903)[names(prescribe201903)=="Group.2"] <- "Druggroup"
# prescribe201903$PERIOD <- 201903
# 
# prescription <- rbind(prescription, prescribe201903)
# 
buagppop$PERIOD <- 201903


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201902 <- read_csv("prescribemaster201902.csv")
# prescribe201902 <- prescribe201902[-c(1)]
# names(prescribe201902)[names(prescribe201902)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjan19 <- read_csv("gp-reg-pat-prac-lsoa-all-jan19.csv")
names(gpusersjan19)[names(gpusersjan19)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjan19 <- merge(gpusersjan19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjan19[-c(1:6,8,9)], gpusersjan19["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201902 <- merge(gpusersjan19, prescribe201902, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201902 <- merge(prescribe201902, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201902$itemsper <- prescribe201902$ITEMS*(prescribe201902$`Number of Patients`/prescribe201902$total_patients)
# prescribe201902$nicper <- prescribe201902$NIC*(prescribe201902$`Number of Patients`/prescribe201902$total_patients)
# prescribe201902$actcostper <- prescribe201902$`ACT COST`*(prescribe201902$`Number of Patients`/prescribe201902$total_patients)
# prescribe201902$quantityper <- prescribe201902$QUANTITY*(prescribe201902$`Number of Patients`/prescribe201902$total_patients)
# 
# prescribe201902 <- prescribe201902[-c(2:14, 16)]
# 
# prescribe201902 <- aggregate(prescribe201902[-c(1,2)], by=list(factor(prescribe201902$BUASD11CD), factor(prescribe201902$Druggroup)), sum)
# 
# names(prescribe201902)[names(prescribe201902)=="Group.1"] <- "BUASD11CD"
# names(prescribe201902)[names(prescribe201902)=="Group.2"] <- "Druggroup"
# prescribe201902$PERIOD <- 201902
# 
# prescription <- rbind(prescription, prescribe201902)
# 
buagppop$PERIOD <- 201902


populationgps <- rbind(populationgps, buagppop)

# prescribe201901 <- read_csv("prescribemaster201901.csv")
# prescribe201901 <- prescribe201901[-c(1)]
# names(prescribe201901)[names(prescribe201901)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjan19 <- read_csv("gp-reg-pat-prac-lsoa-all-jan19.csv")
names(gpusersjan19)[names(gpusersjan19)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjan19 <- merge(gpusersjan19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjan19[-c(1:6,8,9)], gpusersjan19["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201901 <- merge(gpusersjan19, prescribe201901, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201901 <- merge(prescribe201901, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201901$itemsper <- prescribe201901$ITEMS*(prescribe201901$`Number of Patients`/prescribe201901$total_patients)
# prescribe201901$nicper <- prescribe201901$NIC*(prescribe201901$`Number of Patients`/prescribe201901$total_patients)
# prescribe201901$actcostper <- prescribe201901$`ACT COST`*(prescribe201901$`Number of Patients`/prescribe201901$total_patients)
# prescribe201901$quantityper <- prescribe201901$QUANTITY*(prescribe201901$`Number of Patients`/prescribe201901$total_patients)
# 
# prescribe201901 <- prescribe201901[-c(2:14, 16)]
# 
# prescribe201901 <- aggregate(prescribe201901[-c(1,2)], by=list(factor(prescribe201901$BUASD11CD), factor(prescribe201901$Druggroup)), sum)
# 
# names(prescribe201901)[names(prescribe201901)=="Group.1"] <- "BUASD11CD"
# names(prescribe201901)[names(prescribe201901)=="Group.2"] <- "Druggroup"
# prescribe201901$PERIOD <- 201901
# 
# prescription <- rbind(prescription, prescribe201901)
# 
buagppop$PERIOD <- 201901


populationgps <- rbind(populationgps, buagppop)

# prescribe201812 <- read_csv("prescribemaster201812.csv")
# prescribe201812 <- prescribe201812[-c(1)]
# names(prescribe201812)[names(prescribe201812)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjan19 <- read_csv("gp-reg-pat-prac-lsoa-all-jan19.csv")
names(gpusersjan19)[names(gpusersjan19)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjan19 <- merge(gpusersjan19, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjan19[-c(1:6,8,9)], gpusersjan19["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201812 <- merge(gpusersjan19, prescribe201812, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201812 <- merge(prescribe201812, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201812$itemsper <- prescribe201812$ITEMS*(prescribe201812$`Number of Patients`/prescribe201812$total_patients)
# prescribe201812$nicper <- prescribe201812$NIC*(prescribe201812$`Number of Patients`/prescribe201812$total_patients)
# prescribe201812$actcostper <- prescribe201812$`ACT COST`*(prescribe201812$`Number of Patients`/prescribe201812$total_patients)
# prescribe201812$quantityper <- prescribe201812$QUANTITY*(prescribe201812$`Number of Patients`/prescribe201812$total_patients)
# 
# prescribe201812 <- prescribe201812[-c(2:14, 16)]
# 
# prescribe201812 <- aggregate(prescribe201812[-c(1,2)], by=list(factor(prescribe201812$BUASD11CD), factor(prescribe201812$Druggroup)), sum)
# 
# names(prescribe201812)[names(prescribe201812)=="Group.1"] <- "BUASD11CD"
# names(prescribe201812)[names(prescribe201812)=="Group.2"] <- "Druggroup"
# prescribe201812$PERIOD <- 201812
# 
# prescription <- rbind(prescription, prescribe201812)
# 
buagppop$PERIOD <- 201812


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201811 <- read_csv("prescribemaster201811.csv")
# prescribe201811 <- prescribe201811[-c(1)]
# names(prescribe201811)[names(prescribe201811)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct18 <- read_csv("gp-reg-pat-prac-lsoa-all-oct18.csv")
names(gpusersoct18)[names(gpusersoct18)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct18 <- merge(gpusersoct18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct18[-c(1:6,8,9)], gpusersoct18["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201811 <- merge(gpusersoct18, prescribe201811, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201811 <- merge(prescribe201811, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201811$itemsper <- prescribe201811$ITEMS*(prescribe201811$`Number of Patients`/prescribe201811$total_patients)
# prescribe201811$nicper <- prescribe201811$NIC*(prescribe201811$`Number of Patients`/prescribe201811$total_patients)
# prescribe201811$actcostper <- prescribe201811$`ACT COST`*(prescribe201811$`Number of Patients`/prescribe201811$total_patients)
# prescribe201811$quantityper <- prescribe201811$QUANTITY*(prescribe201811$`Number of Patients`/prescribe201811$total_patients)
# 
# prescribe201811 <- prescribe201811[-c(2:14, 16)]
# 
# prescribe201811 <- aggregate(prescribe201811[-c(1,2)], by=list(factor(prescribe201811$BUASD11CD), factor(prescribe201811$Druggroup)), sum)
# 
# names(prescribe201811)[names(prescribe201811)=="Group.1"] <- "BUASD11CD"
# names(prescribe201811)[names(prescribe201811)=="Group.2"] <- "Druggroup"
# prescribe201811$PERIOD <- 201811
# 
# prescription <- rbind(prescription, prescribe201811)
# 
# 
# 
buagppop$PERIOD <- 201811


populationgps <- rbind(populationgps, buagppop)

# prescribe201810 <- read_csv("prescribemaster201810.csv")
# prescribe201810 <- prescribe201810[-c(1)]
# names(prescribe201810)[names(prescribe201810)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct18 <- read_csv("gp-reg-pat-prac-lsoa-all-oct18.csv")
names(gpusersoct18)[names(gpusersoct18)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct18 <- merge(gpusersoct18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct18[-c(1:6,8,9)], gpusersoct18["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201810 <- merge(gpusersoct18, prescribe201810, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201810 <- merge(prescribe201810, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201810$itemsper <- prescribe201810$ITEMS*(prescribe201810$`Number of Patients`/prescribe201810$total_patients)
# prescribe201810$nicper <- prescribe201810$NIC*(prescribe201810$`Number of Patients`/prescribe201810$total_patients)
# prescribe201810$actcostper <- prescribe201810$`ACT COST`*(prescribe201810$`Number of Patients`/prescribe201810$total_patients)
# prescribe201810$quantityper <- prescribe201810$QUANTITY*(prescribe201810$`Number of Patients`/prescribe201810$total_patients)
# 
# prescribe201810 <- prescribe201810[-c(2:14, 16)]
# 
# prescribe201810 <- aggregate(prescribe201810[-c(1,2)], by=list(factor(prescribe201810$BUASD11CD), factor(prescribe201810$Druggroup)), sum)
# 
# names(prescribe201810)[names(prescribe201810)=="Group.1"] <- "BUASD11CD"
# names(prescribe201810)[names(prescribe201810)=="Group.2"] <- "Druggroup"
# prescribe201810$PERIOD <- 201810
# 
# prescription <- rbind(prescription, prescribe201810)
# 
buagppop$PERIOD <- 201810


populationgps <- rbind(populationgps, buagppop)

# 
# 
# 
# prescribe201809 <- read_csv("prescribemaster201809.csv")
# prescribe201809 <- prescribe201809[-c(1)]
# names(prescribe201809)[names(prescribe201809)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct18 <- read_csv("gp-reg-pat-prac-lsoa-all-oct18.csv")
names(gpusersoct18)[names(gpusersoct18)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct18 <- merge(gpusersoct18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct18[-c(1:6,8,9)], gpusersoct18["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201809 <- merge(gpusersoct18, prescribe201809, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201809 <- merge(prescribe201809, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201809$itemsper <- prescribe201809$ITEMS*(prescribe201809$`Number of Patients`/prescribe201809$total_patients)
# prescribe201809$nicper <- prescribe201809$NIC*(prescribe201809$`Number of Patients`/prescribe201809$total_patients)
# prescribe201809$actcostper <- prescribe201809$`ACT COST`*(prescribe201809$`Number of Patients`/prescribe201809$total_patients)
# prescribe201809$quantityper <- prescribe201809$QUANTITY*(prescribe201809$`Number of Patients`/prescribe201809$total_patients)
# 
# prescribe201809 <- prescribe201809[-c(2:14, 16)]
# 
# prescribe201809 <- aggregate(prescribe201809[-c(1,2)], by=list(factor(prescribe201809$BUASD11CD), factor(prescribe201809$Druggroup)), sum)
# 
# names(prescribe201809)[names(prescribe201809)=="Group.1"] <- "BUASD11CD"
# names(prescribe201809)[names(prescribe201809)=="Group.2"] <- "Druggroup"
# prescribe201809$PERIOD <- 201809
# 
# prescription <- rbind(prescription, prescribe201809)
# 
# 
buagppop$PERIOD <- 201809


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201808 <- read_csv("prescribemaster201808.csv")
# prescribe201808 <- prescribe201808[-c(1)]
# names(prescribe201808)[names(prescribe201808)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul18 <- read_csv("gp-reg-pat-prac-lsoa-all-jul18.csv")
names(gpusersjul18)[names(gpusersjul18)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul18 <- merge(gpusersjul18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul18[-c(1:6,8,9)], gpusersjul18["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201808 <- merge(gpusersjul18, prescribe201808, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201808 <- merge(prescribe201808, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201808$itemsper <- prescribe201808$ITEMS*(prescribe201808$`Number of Patients`/prescribe201808$total_patients)
# prescribe201808$nicper <- prescribe201808$NIC*(prescribe201808$`Number of Patients`/prescribe201808$total_patients)
# prescribe201808$actcostper <- prescribe201808$`ACT COST`*(prescribe201808$`Number of Patients`/prescribe201808$total_patients)
# prescribe201808$quantityper <- prescribe201808$QUANTITY*(prescribe201808$`Number of Patients`/prescribe201808$total_patients)
# 
# prescribe201808 <- prescribe201808[-c(2:14, 16)]
# 
# prescribe201808 <- aggregate(prescribe201808[-c(1,2)], by=list(factor(prescribe201808$BUASD11CD), factor(prescribe201808$Druggroup)), sum)
# 
# names(prescribe201808)[names(prescribe201808)=="Group.1"] <- "BUASD11CD"
# names(prescribe201808)[names(prescribe201808)=="Group.2"] <- "Druggroup"
# prescribe201808$PERIOD <- 201808
# 
# prescription <- rbind(prescription, prescribe201808)
# 
buagppop$PERIOD <- 201808


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201807 <- read_csv("prescribemaster201807.csv")
# prescribe201807 <- prescribe201807[-c(1)]
# names(prescribe201807)[names(prescribe201807)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul18 <- read_csv("gp-reg-pat-prac-lsoa-all-jul18.csv")
names(gpusersjul18)[names(gpusersjul18)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul18 <- merge(gpusersjul18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul18[-c(1:6,8,9)], gpusersjul18["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201807 <- merge(gpusersjul18, prescribe201807, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201807 <- merge(prescribe201807, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201807$itemsper <- prescribe201807$ITEMS*(prescribe201807$`Number of Patients`/prescribe201807$total_patients)
# prescribe201807$nicper <- prescribe201807$NIC*(prescribe201807$`Number of Patients`/prescribe201807$total_patients)
# prescribe201807$actcostper <- prescribe201807$`ACT COST`*(prescribe201807$`Number of Patients`/prescribe201807$total_patients)
# prescribe201807$quantityper <- prescribe201807$QUANTITY*(prescribe201807$`Number of Patients`/prescribe201807$total_patients)
# 
# prescribe201807 <- prescribe201807[-c(2:14, 16)]
# 
# prescribe201807 <- aggregate(prescribe201807[-c(1,2)], by=list(factor(prescribe201807$BUASD11CD), factor(prescribe201807$Druggroup)), sum)
# 
# names(prescribe201807)[names(prescribe201807)=="Group.1"] <- "BUASD11CD"
# names(prescribe201807)[names(prescribe201807)=="Group.2"] <- "Druggroup"
# prescribe201807$PERIOD <- 201807
# 
# prescription <- rbind(prescription, prescribe201807)
# 
# 
buagppop$PERIOD <- 201807


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201806 <- read_csv("prescribemaster201806.csv")
# prescribe201806 <- prescribe201806[-c(1)]
# names(prescribe201806)[names(prescribe201806)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul18 <- read_csv("gp-reg-pat-prac-lsoa-all-jul18.csv")
names(gpusersjul18)[names(gpusersjul18)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul18 <- merge(gpusersjul18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul18[-c(1:6,8,9)], gpusersjul18["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201806 <- merge(gpusersjul18, prescribe201806, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201806 <- merge(prescribe201806, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201806$itemsper <- prescribe201806$ITEMS*(prescribe201806$`Number of Patients`/prescribe201806$total_patients)
# prescribe201806$nicper <- prescribe201806$NIC*(prescribe201806$`Number of Patients`/prescribe201806$total_patients)
# prescribe201806$actcostper <- prescribe201806$`ACT COST`*(prescribe201806$`Number of Patients`/prescribe201806$total_patients)
# prescribe201806$quantityper <- prescribe201806$QUANTITY*(prescribe201806$`Number of Patients`/prescribe201806$total_patients)
# 
# prescribe201806 <- prescribe201806[-c(2:14, 16)]
# 
# prescribe201806 <- aggregate(prescribe201806[-c(1,2)], by=list(factor(prescribe201806$BUASD11CD), factor(prescribe201806$Druggroup)), sum)
# 
# names(prescribe201806)[names(prescribe201806)=="Group.1"] <- "BUASD11CD"
# names(prescribe201806)[names(prescribe201806)=="Group.2"] <- "Druggroup"
# prescribe201806$PERIOD <- 201806
# 
# prescription <- rbind(prescription, prescribe201806)
# 
# 
buagppop$PERIOD <- 201806


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201805 <- read_csv("prescribemaster201805.csv")
# prescribe201805 <- prescribe201805[-c(1)]
# names(prescribe201805)[names(prescribe201805)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr18 <- read_csv("gp-reg-pat-prac-lsoa-all-apr18.csv")
names(gpusersapr18)[names(gpusersapr18)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr18 <- merge(gpusersapr18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr18[-c(1:6,8,9)], gpusersapr18["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201805 <- merge(gpusersapr18, prescribe201805, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201805 <- merge(prescribe201805, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201805$itemsper <- prescribe201805$ITEMS*(prescribe201805$`Number of Patients`/prescribe201805$total_patients)
# prescribe201805$nicper <- prescribe201805$NIC*(prescribe201805$`Number of Patients`/prescribe201805$total_patients)
# prescribe201805$actcostper <- prescribe201805$`ACT COST`*(prescribe201805$`Number of Patients`/prescribe201805$total_patients)
# prescribe201805$quantityper <- prescribe201805$QUANTITY*(prescribe201805$`Number of Patients`/prescribe201805$total_patients)
# 
# prescribe201805 <- prescribe201805[-c(2:14, 16)]
# 
# prescribe201805 <- aggregate(prescribe201805[-c(1,2)], by=list(factor(prescribe201805$BUASD11CD), factor(prescribe201805$Druggroup)), sum)
# 
# names(prescribe201805)[names(prescribe201805)=="Group.1"] <- "BUASD11CD"
# names(prescribe201805)[names(prescribe201805)=="Group.2"] <- "Druggroup"
# prescribe201805$PERIOD <- 201805
# 
# prescription <- rbind(prescription, prescribe201805)
# 
# 
buagppop$PERIOD <- 201805


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201804 <- read_csv("prescribemaster201804.csv")
# prescribe201804 <- prescribe201804[-c(1)]
# names(prescribe201804)[names(prescribe201804)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr18 <- read_csv("gp-reg-pat-prac-lsoa-all-apr18.csv")
names(gpusersapr18)[names(gpusersapr18)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr18 <- merge(gpusersapr18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr18[-c(1:6,8,9)], gpusersapr18["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201804 <- merge(gpusersapr18, prescribe201804, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201804 <- merge(prescribe201804, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201804$itemsper <- prescribe201804$ITEMS*(prescribe201804$`Number of Patients`/prescribe201804$total_patients)
# prescribe201804$nicper <- prescribe201804$NIC*(prescribe201804$`Number of Patients`/prescribe201804$total_patients)
# prescribe201804$actcostper <- prescribe201804$`ACT COST`*(prescribe201804$`Number of Patients`/prescribe201804$total_patients)
# prescribe201804$quantityper <- prescribe201804$QUANTITY*(prescribe201804$`Number of Patients`/prescribe201804$total_patients)
# 
# prescribe201804 <- prescribe201804[-c(2:14, 16)]
# 
# prescribe201804 <- aggregate(prescribe201804[-c(1,2)], by=list(factor(prescribe201804$BUASD11CD), factor(prescribe201804$Druggroup)), sum)
# 
# names(prescribe201804)[names(prescribe201804)=="Group.1"] <- "BUASD11CD"
# names(prescribe201804)[names(prescribe201804)=="Group.2"] <- "Druggroup"
# prescribe201804$PERIOD <- 201804
# 
# prescription <- rbind(prescription, prescribe201804)
# 
# 
buagppop$PERIOD <- 201804


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201803 <- read_csv("prescribemaster201803.csv")
# prescribe201803 <- prescribe201803[-c(1)]
# names(prescribe201803)[names(prescribe201803)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr18 <- read_csv("gp-reg-pat-prac-lsoa-all-apr18.csv")
names(gpusersapr18)[names(gpusersapr18)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr18 <- merge(gpusersapr18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr18[-c(1:6,8,9)], gpusersapr18["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201803 <- merge(gpusersapr18, prescribe201803, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201803 <- merge(prescribe201803, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201803$itemsper <- prescribe201803$ITEMS*(prescribe201803$`Number of Patients`/prescribe201803$total_patients)
# prescribe201803$nicper <- prescribe201803$NIC*(prescribe201803$`Number of Patients`/prescribe201803$total_patients)
# prescribe201803$actcostper <- prescribe201803$`ACT COST`*(prescribe201803$`Number of Patients`/prescribe201803$total_patients)
# prescribe201803$quantityper <- prescribe201803$QUANTITY*(prescribe201803$`Number of Patients`/prescribe201803$total_patients)
# 
# prescribe201803 <- prescribe201803[-c(2:14, 16)]
# 
# prescribe201803 <- aggregate(prescribe201803[-c(1,2)], by=list(factor(prescribe201803$BUASD11CD), factor(prescribe201803$Druggroup)), sum)
# 
# names(prescribe201803)[names(prescribe201803)=="Group.1"] <- "BUASD11CD"
# names(prescribe201803)[names(prescribe201803)=="Group.2"] <- "Druggroup"
# prescribe201803$PERIOD <- 201803
# 
# prescription <- rbind(prescription, prescribe201803)
# 
# 
buagppop$PERIOD <- 201803


populationgps <- rbind(populationgps, buagppop)

# 
# 
# 
# prescribe201802 <- read_csv("prescribemaster201802.csv")
# prescribe201802 <- prescribe201802[-c(1)]
# names(prescribe201802)[names(prescribe201802)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjan18 <- read_csv("gp-reg-pat-prac-lsoa-all-jan18.csv")
names(gpusersjan18)[names(gpusersjan18)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjan18 <- merge(gpusersjan18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjan18[-c(1:6,8,9)], gpusersjan18["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201802 <- merge(gpusersjan18, prescribe201802, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201802 <- merge(prescribe201802, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201802$itemsper <- prescribe201802$ITEMS*(prescribe201802$`Number of Patients`/prescribe201802$total_patients)
# prescribe201802$nicper <- prescribe201802$NIC*(prescribe201802$`Number of Patients`/prescribe201802$total_patients)
# prescribe201802$actcostper <- prescribe201802$`ACT COST`*(prescribe201802$`Number of Patients`/prescribe201802$total_patients)
# prescribe201802$quantityper <- prescribe201802$QUANTITY*(prescribe201802$`Number of Patients`/prescribe201802$total_patients)
# 
# prescribe201802 <- prescribe201802[-c(2:14, 16)]
# 
# prescribe201802 <- aggregate(prescribe201802[-c(1,2)], by=list(factor(prescribe201802$BUASD11CD), factor(prescribe201802$Druggroup)), sum)
# 
# names(prescribe201802)[names(prescribe201802)=="Group.1"] <- "BUASD11CD"
# names(prescribe201802)[names(prescribe201802)=="Group.2"] <- "Druggroup"
# prescribe201802$PERIOD <- 201802
# 
# prescription <- rbind(prescription, prescribe201802)
# 
# 
buagppop$PERIOD <- 201802


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201801 <- read_csv("prescribemaster201801.csv")
# prescribe201801 <- prescribe201801[-c(1)]
# names(prescribe201801)[names(prescribe201801)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjan18 <- read_csv("gp-reg-pat-prac-lsoa-all-jan18.csv")
names(gpusersjan18)[names(gpusersjan18)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjan18 <- merge(gpusersjan18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjan18[-c(1:6,8,9)], gpusersjan18["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201801 <- merge(gpusersjan18, prescribe201801, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201801 <- merge(prescribe201801, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201801$itemsper <- prescribe201801$ITEMS*(prescribe201801$`Number of Patients`/prescribe201801$total_patients)
# prescribe201801$nicper <- prescribe201801$NIC*(prescribe201801$`Number of Patients`/prescribe201801$total_patients)
# prescribe201801$actcostper <- prescribe201801$`ACT COST`*(prescribe201801$`Number of Patients`/prescribe201801$total_patients)
# prescribe201801$quantityper <- prescribe201801$QUANTITY*(prescribe201801$`Number of Patients`/prescribe201801$total_patients)
# 
# prescribe201801 <- prescribe201801[-c(2:14, 16)]
# 
# prescribe201801 <- aggregate(prescribe201801[-c(1,2)], by=list(factor(prescribe201801$BUASD11CD), factor(prescribe201801$Druggroup)), sum)
# 
# names(prescribe201801)[names(prescribe201801)=="Group.1"] <- "BUASD11CD"
# names(prescribe201801)[names(prescribe201801)=="Group.2"] <- "Druggroup"
# prescribe201801$PERIOD <- 201801
# 
# prescription <- rbind(prescription, prescribe201801)
# 
# 
buagppop$PERIOD <- 201801


populationgps <- rbind(populationgps, buagppop)

# prescribe201712 <- read_csv("prescribemaster201712.csv")
# prescribe201712 <- prescribe201712[-c(1)]
# names(prescribe201712)[names(prescribe201712)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjan18 <- read_csv("gp-reg-pat-prac-lsoa-all-jan18.csv")
names(gpusersjan18)[names(gpusersjan18)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjan18 <- merge(gpusersjan18, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjan18[-c(1:6,8,9)], gpusersjan18["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201712 <- merge(gpusersjan18, prescribe201712, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201712 <- merge(prescribe201712, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201712$itemsper <- prescribe201712$ITEMS*(prescribe201712$`Number of Patients`/prescribe201712$total_patients)
# prescribe201712$nicper <- prescribe201712$NIC*(prescribe201712$`Number of Patients`/prescribe201712$total_patients)
# prescribe201712$actcostper <- prescribe201712$`ACT COST`*(prescribe201712$`Number of Patients`/prescribe201712$total_patients)
# prescribe201712$quantityper <- prescribe201712$QUANTITY*(prescribe201712$`Number of Patients`/prescribe201712$total_patients)
# 
# prescribe201712 <- prescribe201712[-c(2:14, 16)]
# 
# prescribe201712 <- aggregate(prescribe201712[-c(1,2)], by=list(factor(prescribe201712$BUASD11CD), factor(prescribe201712$Druggroup)), sum)
# 
# names(prescribe201712)[names(prescribe201712)=="Group.1"] <- "BUASD11CD"
# names(prescribe201712)[names(prescribe201712)=="Group.2"] <- "Druggroup"
# prescribe201712$PERIOD <- 201712
# 
# prescription <- rbind(prescription, prescribe201712)
# 
# 
buagppop$PERIOD <- 201712


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201711 <- read_csv("prescribemaster201711.csv")
# prescribe201711 <- prescribe201711[-c(1)]
# names(prescribe201711)[names(prescribe201711)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct17 <- read_csv("gp-reg-pat-prac-lsoa-all-oct17.csv")
names(gpusersoct17)[names(gpusersoct17)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct17 <- merge(gpusersoct17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct17[-c(1:6,8,9)], gpusersoct17["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201711 <- merge(gpusersoct17, prescribe201711, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201711 <- merge(prescribe201711, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201711$itemsper <- prescribe201711$ITEMS*(prescribe201711$`Number of Patients`/prescribe201711$total_patients)
# prescribe201711$nicper <- prescribe201711$NIC*(prescribe201711$`Number of Patients`/prescribe201711$total_patients)
# prescribe201711$actcostper <- prescribe201711$`ACT COST`*(prescribe201711$`Number of Patients`/prescribe201711$total_patients)
# prescribe201711$quantityper <- prescribe201711$QUANTITY*(prescribe201711$`Number of Patients`/prescribe201711$total_patients)
# 
# prescribe201711 <- prescribe201711[-c(2:14, 16)]
# 
# prescribe201711 <- aggregate(prescribe201711[-c(1,2)], by=list(factor(prescribe201711$BUASD11CD), factor(prescribe201711$Druggroup)), sum)
# 
# names(prescribe201711)[names(prescribe201711)=="Group.1"] <- "BUASD11CD"
# names(prescribe201711)[names(prescribe201711)=="Group.2"] <- "Druggroup"
# prescribe201711$PERIOD <- 201711
# 
# prescription <- rbind(prescription, prescribe201711)
# 
# 
buagppop$PERIOD <- 201711


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201710 <- read_csv("prescribemaster201710.csv")
# prescribe201710 <- prescribe201710[-c(1)]
# names(prescribe201710)[names(prescribe201710)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct17 <- read_csv("gp-reg-pat-prac-lsoa-all-oct17.csv")
names(gpusersoct17)[names(gpusersoct17)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct17 <- merge(gpusersoct17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct17[-c(1:6,8,9)], gpusersoct17["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201710 <- merge(gpusersoct17, prescribe201710, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201710 <- merge(prescribe201710, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201710$itemsper <- prescribe201710$ITEMS*(prescribe201710$`Number of Patients`/prescribe201710$total_patients)
# prescribe201710$nicper <- prescribe201710$NIC*(prescribe201710$`Number of Patients`/prescribe201710$total_patients)
# prescribe201710$actcostper <- prescribe201710$`ACT COST`*(prescribe201710$`Number of Patients`/prescribe201710$total_patients)
# prescribe201710$quantityper <- prescribe201710$QUANTITY*(prescribe201710$`Number of Patients`/prescribe201710$total_patients)
# 
# prescribe201710 <- prescribe201710[-c(2:14, 16)]
# 
# prescribe201710 <- aggregate(prescribe201710[-c(1,2)], by=list(factor(prescribe201710$BUASD11CD), factor(prescribe201710$Druggroup)), sum)
# 
# names(prescribe201710)[names(prescribe201710)=="Group.1"] <- "BUASD11CD"
# names(prescribe201710)[names(prescribe201710)=="Group.2"] <- "Druggroup"
# prescribe201710$PERIOD <- 201710
# 
# prescription <- rbind(prescription, prescribe201710)
# 
#
buagppop$PERIOD <- 201710


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201709 <- read_csv("prescribemaster201709.csv")
# prescribe201709 <- prescribe201709[-c(1)]
# names(prescribe201709)[names(prescribe201709)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct17 <- read_csv("gp-reg-pat-prac-lsoa-all-oct17.csv")
names(gpusersoct17)[names(gpusersoct17)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct17 <- merge(gpusersoct17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct17[-c(1:6,8,9)], gpusersoct17["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201709 <- merge(gpusersoct17, prescribe201709, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201709 <- merge(prescribe201709, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201709$itemsper <- prescribe201709$ITEMS*(prescribe201709$`Number of Patients`/prescribe201709$total_patients)
# prescribe201709$nicper <- prescribe201709$NIC*(prescribe201709$`Number of Patients`/prescribe201709$total_patients)
# prescribe201709$actcostper <- prescribe201709$`ACT COST`*(prescribe201709$`Number of Patients`/prescribe201709$total_patients)
# prescribe201709$quantityper <- prescribe201709$QUANTITY*(prescribe201709$`Number of Patients`/prescribe201709$total_patients)
# 
# prescribe201709 <- prescribe201709[-c(2:14, 16)]
# 
# prescribe201709 <- aggregate(prescribe201709[-c(1,2)], by=list(factor(prescribe201709$BUASD11CD), factor(prescribe201709$Druggroup)), sum)
# 
# names(prescribe201709)[names(prescribe201709)=="Group.1"] <- "BUASD11CD"
# names(prescribe201709)[names(prescribe201709)=="Group.2"] <- "Druggroup"
# prescribe201709$PERIOD <- 201709
# 
# prescription <- rbind(prescription, prescribe201709)
# 
# 
buagppop$PERIOD <- 201709


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201708 <- read_csv("prescribemaster201708.csv")
# prescribe201708 <- prescribe201708[-c(1)]
# names(prescribe201708)[names(prescribe201708)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul17 <- read_csv("gp-reg-pat-prac-lsoa-all-jul17.csv")
names(gpusersjul17)[names(gpusersjul17)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul17 <- merge(gpusersjul17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul17[-c(1:6,8,9)], gpusersjul17["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201708 <- merge(gpusersjul17, prescribe201708, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201708 <- merge(prescribe201708, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201708$itemsper <- prescribe201708$ITEMS*(prescribe201708$`Number of Patients`/prescribe201708$total_patients)
# prescribe201708$nicper <- prescribe201708$NIC*(prescribe201708$`Number of Patients`/prescribe201708$total_patients)
# prescribe201708$actcostper <- prescribe201708$`ACT COST`*(prescribe201708$`Number of Patients`/prescribe201708$total_patients)
# prescribe201708$quantityper <- prescribe201708$QUANTITY*(prescribe201708$`Number of Patients`/prescribe201708$total_patients)
# 
# prescribe201708 <- prescribe201708[-c(2:14, 16)]
# 
# prescribe201708 <- aggregate(prescribe201708[-c(1,2)], by=list(factor(prescribe201708$BUASD11CD), factor(prescribe201708$Druggroup)), sum)
# 
# names(prescribe201708)[names(prescribe201708)=="Group.1"] <- "BUASD11CD"
# names(prescribe201708)[names(prescribe201708)=="Group.2"] <- "Druggroup"
# prescribe201708$PERIOD <- 201708
# 
# prescription <- rbind(prescription, prescribe201708)
# 
# 
buagppop$PERIOD <- 201708


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201707 <- read_csv("prescribemaster201707.csv")
# prescribe201707 <- prescribe201707[-c(1)]
# names(prescribe201707)[names(prescribe201707)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul17 <- read_csv("gp-reg-pat-prac-lsoa-all-jul17.csv")
names(gpusersjul17)[names(gpusersjul17)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul17 <- merge(gpusersjul17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul17[-c(1:6,8,9)], gpusersjul17["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201707 <- merge(gpusersjul17, prescribe201707, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201707 <- merge(prescribe201707, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201707$itemsper <- prescribe201707$ITEMS*(prescribe201707$`Number of Patients`/prescribe201707$total_patients)
# prescribe201707$nicper <- prescribe201707$NIC*(prescribe201707$`Number of Patients`/prescribe201707$total_patients)
# prescribe201707$actcostper <- prescribe201707$`ACT COST`*(prescribe201707$`Number of Patients`/prescribe201707$total_patients)
# prescribe201707$quantityper <- prescribe201707$QUANTITY*(prescribe201707$`Number of Patients`/prescribe201707$total_patients)
# 
# prescribe201707 <- prescribe201707[-c(2:14, 16)]
# 
# prescribe201707 <- aggregate(prescribe201707[-c(1,2)], by=list(factor(prescribe201707$BUASD11CD), factor(prescribe201707$Druggroup)), sum)
# 
# names(prescribe201707)[names(prescribe201707)=="Group.1"] <- "BUASD11CD"
# names(prescribe201707)[names(prescribe201707)=="Group.2"] <- "Druggroup"
# prescribe201707$PERIOD <- 201707
# 
# prescription <- rbind(prescription, prescribe201707)
# 
# 
buagppop$PERIOD <- 201707


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201706 <- read_csv("prescribemaster201706.csv")
# prescribe201706 <- prescribe201706[-c(1)]
# names(prescribe201706)[names(prescribe201706)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul17 <- read_csv("gp-reg-pat-prac-lsoa-all-jul17.csv")
names(gpusersjul17)[names(gpusersjul17)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul17 <- merge(gpusersjul17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul17[-c(1:6,8,9)], gpusersjul17["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="Number of Patients"] <- "total_patients"
# 
# prescribe201706 <- merge(gpusersjul17, prescribe201706, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201706 <- merge(prescribe201706, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201706$itemsper <- prescribe201706$ITEMS*(prescribe201706$`Number of Patients`/prescribe201706$total_patients)
# prescribe201706$nicper <- prescribe201706$NIC*(prescribe201706$`Number of Patients`/prescribe201706$total_patients)
# prescribe201706$actcostper <- prescribe201706$`ACT COST`*(prescribe201706$`Number of Patients`/prescribe201706$total_patients)
# prescribe201706$quantityper <- prescribe201706$QUANTITY*(prescribe201706$`Number of Patients`/prescribe201706$total_patients)
# 
# prescribe201706 <- prescribe201706[-c(2:14, 16)]
# 
# prescribe201706 <- aggregate(prescribe201706[-c(1,2)], by=list(factor(prescribe201706$BUASD11CD), factor(prescribe201706$Druggroup)), sum)
# 
# names(prescribe201706)[names(prescribe201706)=="Group.1"] <- "BUASD11CD"
# names(prescribe201706)[names(prescribe201706)=="Group.2"] <- "Druggroup"
# prescribe201706$PERIOD <- 201706
# 
# prescription <- rbind(prescription, prescribe201706)
# 
# 
buagppop$PERIOD <- 201706


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201705 <- read_csv("prescribemaster201705.csv")
# prescribe201705 <- prescribe201705[-c(1)]
# names(prescribe201705)[names(prescribe201705)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr17 <- read_csv("gp-reg-pat-prac-lsoa-all-apr17.csv")
names(gpusersapr17)[names(gpusersapr17)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr17 <- merge(gpusersapr17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr17[-c(1:6,8,9)], gpusersapr17["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="NUMBER_OF_PATIENTS"] <- "total_patients"
# 
# prescribe201705 <- merge(gpusersapr17, prescribe201705, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201705 <- merge(prescribe201705, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201705$itemsper <- prescribe201705$ITEMS*(prescribe201705$NUMBER_OF_PATIENTS/prescribe201705$total_patients)
# prescribe201705$nicper <- prescribe201705$NIC*(prescribe201705$NUMBER_OF_PATIENTS/prescribe201705$total_patients)
# prescribe201705$actcostper <- prescribe201705$`ACT COST`*(prescribe201705$NUMBER_OF_PATIENTS/prescribe201705$total_patients)
# prescribe201705$quantityper <- prescribe201705$QUANTITY*(prescribe201705$NUMBER_OF_PATIENTS/prescribe201705$total_patients)
# 
# prescribe201705 <- prescribe201705[-c(2:14, 16)]
# 
# prescribe201705 <- aggregate(prescribe201705[-c(1,2)], by=list(factor(prescribe201705$BUASD11CD), factor(prescribe201705$Druggroup)), sum)
# 
# names(prescribe201705)[names(prescribe201705)=="Group.1"] <- "BUASD11CD"
# names(prescribe201705)[names(prescribe201705)=="Group.2"] <- "Druggroup"
# prescribe201705$PERIOD <- 201705
# 
# prescription <- rbind(prescription, prescribe201705)
# 
buagppop$PERIOD <- 201705


populationgps <- rbind(populationgps, buagppop)

# prescribe201704 <- read_csv("prescribemaster201704.csv")
# prescribe201704 <- prescribe201704[-c(1)]
# names(prescribe201704)[names(prescribe201704)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr17 <- read_csv("gp-reg-pat-prac-lsoa-all-apr17.csv")
names(gpusersapr17)[names(gpusersapr17)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr17 <- merge(gpusersapr17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr17[-c(1:6,8,9)], gpusersapr17["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="NUMBER_OF_PATIENTS"] <- "total_patients"
# 
# prescribe201704 <- merge(gpusersapr17, prescribe201704, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201704 <- merge(prescribe201704, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201704$itemsper <- prescribe201704$ITEMS*(prescribe201704$NUMBER_OF_PATIENTS/prescribe201704$total_patients)
# prescribe201704$nicper <- prescribe201704$NIC*(prescribe201704$NUMBER_OF_PATIENTS/prescribe201704$total_patients)
# prescribe201704$actcostper <- prescribe201704$`ACT COST`*(prescribe201704$NUMBER_OF_PATIENTS/prescribe201704$total_patients)
# prescribe201704$quantityper <- prescribe201704$QUANTITY*(prescribe201704$NUMBER_OF_PATIENTS/prescribe201704$total_patients)
# 
# prescribe201704 <- prescribe201704[-c(2:14, 16)]
# 
# prescribe201704 <- aggregate(prescribe201704[-c(1,2)], by=list(factor(prescribe201704$BUASD11CD), factor(prescribe201704$Druggroup)), sum)
# 
# names(prescribe201704)[names(prescribe201704)=="Group.1"] <- "BUASD11CD"
# names(prescribe201704)[names(prescribe201704)=="Group.2"] <- "Druggroup"
# prescribe201704$PERIOD <- 201704
# 
# prescription <- rbind(prescription, prescribe201704)
# 
buagppop$PERIOD <- 201704


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201703 <- read_csv("prescribemaster201703.csv")
# prescribe201703 <- prescribe201703[-c(1)]
# names(prescribe201703)[names(prescribe201703)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr17 <- read_csv("gp-reg-pat-prac-lsoa-all-apr17.csv")
names(gpusersapr17)[names(gpusersapr17)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr17 <- merge(gpusersapr17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr17[-c(1:6,8,9)], gpusersapr17["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="NUMBER_OF_PATIENTS"] <- "total_patients"
# 
# prescribe201703 <- merge(gpusersapr17, prescribe201703, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201703 <- merge(prescribe201703, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201703$itemsper <- prescribe201703$ITEMS*(prescribe201703$NUMBER_OF_PATIENTS/prescribe201703$total_patients)
# prescribe201703$nicper <- prescribe201703$NIC*(prescribe201703$NUMBER_OF_PATIENTS/prescribe201703$total_patients)
# prescribe201703$actcostper <- prescribe201703$`ACT COST`*(prescribe201703$NUMBER_OF_PATIENTS/prescribe201703$total_patients)
# prescribe201703$quantityper <- prescribe201703$QUANTITY*(prescribe201703$NUMBER_OF_PATIENTS/prescribe201703$total_patients)
# 
# prescribe201703 <- prescribe201703[-c(2:14, 16)]
# 
# prescribe201703 <- aggregate(prescribe201703[-c(1,2)], by=list(factor(prescribe201703$BUASD11CD), factor(prescribe201703$Druggroup)), sum)
# 
# names(prescribe201703)[names(prescribe201703)=="Group.1"] <- "BUASD11CD"
# names(prescribe201703)[names(prescribe201703)=="Group.2"] <- "Druggroup"
# prescribe201703$PERIOD <- 201703
# 
# prescription <- rbind(prescription, prescribe201703)
# 
buagppop$PERIOD <- 201703


populationgps <- rbind(populationgps, buagppop)

# prescribe201702 <- read_csv("prescribemaster201702.csv")
# prescribe201702 <- prescribe201702[-c(1)]
# names(prescribe201702)[names(prescribe201702)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjan17 <- read_csv("gp-reg-pat-prac-lsoa-all-jan17.csv")
names(gpusersjan17)[names(gpusersjan17)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjan17 <- merge(gpusersjan17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjan17[-c(1:5,7,8)], gpusersjan17["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="ALL_PATIENTS"] <- "total_patients"
# 
# prescribe201702 <- merge(gpusersjan17, prescribe201702, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201702 <- merge(prescribe201702, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201702$itemsper <- prescribe201702$ITEMS*(prescribe201702$ALL_PATIENTS/prescribe201702$total_patients)
# prescribe201702$nicper <- prescribe201702$NIC*(prescribe201702$ALL_PATIENTS/prescribe201702$total_patients)
# prescribe201702$actcostper <- prescribe201702$`ACT COST`*(prescribe201702$ALL_PATIENTS/prescribe201702$total_patients)
# prescribe201702$quantityper <- prescribe201702$QUANTITY*(prescribe201702$ALL_PATIENTS/prescribe201702$total_patients)
# 
# prescribe201702 <- prescribe201702[-c(2:13)]
# 
# prescribe201702 <- aggregate(prescribe201702[-c(1,2)], by=list(factor(prescribe201702$BUASD11CD), factor(prescribe201702$Druggroup)), sum)
# 
# names(prescribe201702)[names(prescribe201702)=="Group.1"] <- "BUASD11CD"
# names(prescribe201702)[names(prescribe201702)=="Group.2"] <- "Druggroup"
# prescribe201702$PERIOD <- 201702
# 
# prescription <- rbind(prescription, prescribe201702)
# 
# 
buagppop$PERIOD <- 201702


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201701 <- read_csv("prescribemaster201701.csv")
# prescribe201701 <- prescribe201701[-c(1)]
# names(prescribe201701)[names(prescribe201701)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjan17 <- read_csv("gp-reg-pat-prac-lsoa-all-jan17.csv")
names(gpusersjan17)[names(gpusersjan17)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjan17 <- merge(gpusersjan17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjan17[-c(1:5,7,8)], gpusersjan17["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="ALL_PATIENTS"] <- "total_patients"
# 
# prescribe201701 <- merge(gpusersjan17, prescribe201701, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201701 <- merge(prescribe201701, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201701$itemsper <- prescribe201701$ITEMS*(prescribe201701$ALL_PATIENTS/prescribe201701$total_patients)
# prescribe201701$nicper <- prescribe201701$NIC*(prescribe201701$ALL_PATIENTS/prescribe201701$total_patients)
# prescribe201701$actcostper <- prescribe201701$`ACT COST`*(prescribe201701$ALL_PATIENTS/prescribe201701$total_patients)
# prescribe201701$quantityper <- prescribe201701$QUANTITY*(prescribe201701$ALL_PATIENTS/prescribe201701$total_patients)
# 
# prescribe201701 <- prescribe201701[-c(2:13)]
# 
# prescribe201701 <- aggregate(prescribe201701[-c(1,2)], by=list(factor(prescribe201701$BUASD11CD), factor(prescribe201701$Druggroup)), sum)
# 
# names(prescribe201701)[names(prescribe201701)=="Group.1"] <- "BUASD11CD"
# names(prescribe201701)[names(prescribe201701)=="Group.2"] <- "Druggroup"
# prescribe201701$PERIOD <- 201701
# 
# prescription <- rbind(prescription, prescribe201701)
# 
buagppop$PERIOD <- 201701


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201612 <- read_csv("prescribemaster201612.csv")
# prescribe201612 <- prescribe201612[-c(1)]
# names(prescribe201612)[names(prescribe201612)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjan17 <- read_csv("gp-reg-pat-prac-lsoa-all-jan17.csv")
names(gpusersjan17)[names(gpusersjan17)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjan17 <- merge(gpusersjan17, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjan17[-c(1:5,7,8)], gpusersjan17["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="ALL_PATIENTS"] <- "total_patients"
# 
# prescribe201612 <- merge(gpusersjan17, prescribe201612, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201612 <- merge(prescribe201612, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201612$itemsper <- prescribe201612$ITEMS*(prescribe201612$ALL_PATIENTS/prescribe201612$total_patients)
# prescribe201612$nicper <- prescribe201612$NIC*(prescribe201612$ALL_PATIENTS/prescribe201612$total_patients)
# prescribe201612$actcostper <- prescribe201612$`ACT COST`*(prescribe201612$ALL_PATIENTS/prescribe201612$total_patients)
# prescribe201612$quantityper <- prescribe201612$QUANTITY*(prescribe201612$ALL_PATIENTS/prescribe201612$total_patients)
# 
# prescribe201612 <- prescribe201612[-c(2:13)]
# 
# prescribe201612 <- aggregate(prescribe201612[-c(1,2)], by=list(factor(prescribe201612$BUASD11CD), factor(prescribe201612$Druggroup)), sum)
# 
# names(prescribe201612)[names(prescribe201612)=="Group.1"] <- "BUASD11CD"
# names(prescribe201612)[names(prescribe201612)=="Group.2"] <- "Druggroup"
# prescribe201612$PERIOD <- 201612
# 
# prescription <- rbind(prescription, prescribe201612)
# 
# 
buagppop$PERIOD <- 201612


populationgps <- rbind(populationgps, buagppop)

# prescribe201611 <- read_csv("prescribemaster201611.csv")
# prescribe201611 <- prescribe201611[-c(1)]
# names(prescribe201611)[names(prescribe201611)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct16 <- read_csv("gp-reg-pat-prac-lsoa-all-oct16.csv")
names(gpusersoct16)[names(gpusersoct16)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct16 <- merge(gpusersoct16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct16[-c(1:5,7,8)], gpusersoct16["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201611 <- merge(gpusersoct16, prescribe201611, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201611 <- merge(prescribe201611, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201611$itemsper <- prescribe201611$ITEMS*(prescribe201611$`All Patients`/prescribe201611$total_patients)
# prescribe201611$nicper <- prescribe201611$NIC*(prescribe201611$`All Patients`/prescribe201611$total_patients)
# prescribe201611$actcostper <- prescribe201611$`ACT COST`*(prescribe201611$`All Patients`/prescribe201611$total_patients)
# prescribe201611$quantityper <- prescribe201611$QUANTITY*(prescribe201611$`All Patients`/prescribe201611$total_patients)
# 
# prescribe201611 <- prescribe201611[-c(2:13)]
# 
# prescribe201611 <- aggregate(prescribe201611[-c(1,2)], by=list(factor(prescribe201611$BUASD11CD), factor(prescribe201611$Druggroup)), sum)
# 
# names(prescribe201611)[names(prescribe201611)=="Group.1"] <- "BUASD11CD"
# names(prescribe201611)[names(prescribe201611)=="Group.2"] <- "Druggroup"
# prescribe201611$PERIOD <- 201611
# 
# prescription <- rbind(prescription, prescribe201611)
# 
buagppop$PERIOD <- 201611


populationgps <- rbind(populationgps, buagppop)

# 
# 
# 
# prescribe201609 <- read_csv("prescribemaster201609.csv")
# prescribe201609 <- prescribe201609[-c(1)]
# names(prescribe201609)[names(prescribe201609)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct16 <- read_csv("gp-reg-pat-prac-lsoa-all-oct16.csv")
names(gpusersoct16)[names(gpusersoct16)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct16 <- merge(gpusersoct16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct16[-c(1:5,7,8)], gpusersoct16["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201609 <- merge(gpusersoct16, prescribe201609, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201609 <- merge(prescribe201609, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201609$itemsper <- prescribe201609$ITEMS*(prescribe201609$`All Patients`/prescribe201609$total_patients)
# prescribe201609$nicper <- prescribe201609$NIC*(prescribe201609$`All Patients`/prescribe201609$total_patients)
# prescribe201609$actcostper <- prescribe201609$`ACT COST`*(prescribe201609$`All Patients`/prescribe201609$total_patients)
# prescribe201609$quantityper <- prescribe201609$QUANTITY*(prescribe201609$`All Patients`/prescribe201609$total_patients)
# 
# prescribe201609 <- prescribe201609[-c(2:13)]
# 
# prescribe201609 <- aggregate(prescribe201609[-c(1,2)], by=list(factor(prescribe201609$BUASD11CD), factor(prescribe201609$Druggroup)), sum)
# 
# names(prescribe201609)[names(prescribe201609)=="Group.1"] <- "BUASD11CD"
# names(prescribe201609)[names(prescribe201609)=="Group.2"] <- "Druggroup"
# prescribe201609$PERIOD <- 201609
# 
# prescription <- rbind(prescription, prescribe201609)
# 
# 
buagppop$PERIOD <- 201609


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201610 <- read_csv("prescribemaster201610.csv")
# prescribe201610 <- prescribe201610[-c(1)]
# names(prescribe201610)[names(prescribe201610)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct16 <- read_csv("gp-reg-pat-prac-lsoa-all-oct16.csv")
names(gpusersoct16)[names(gpusersoct16)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct16 <- merge(gpusersoct16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct16[-c(1:5,7,8)], gpusersoct16["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201610 <- merge(gpusersoct16, prescribe201610, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201610 <- merge(prescribe201610, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201610$itemsper <- prescribe201610$ITEMS*(prescribe201610$`All Patients`/prescribe201610$total_patients)
# prescribe201610$nicper <- prescribe201610$NIC*(prescribe201610$`All Patients`/prescribe201610$total_patients)
# prescribe201610$actcostper <- prescribe201610$`ACT COST`*(prescribe201610$`All Patients`/prescribe201610$total_patients)
# prescribe201610$quantityper <- prescribe201610$QUANTITY*(prescribe201610$`All Patients`/prescribe201610$total_patients)
# 
# prescribe201610 <- prescribe201610[-c(2:13)]
# 
# prescribe201610 <- aggregate(prescribe201610[-c(1,2)], by=list(factor(prescribe201610$BUASD11CD), factor(prescribe201610$Druggroup)), sum)
# 
# names(prescribe201610)[names(prescribe201610)=="Group.1"] <- "BUASD11CD"
# names(prescribe201610)[names(prescribe201610)=="Group.2"] <- "Druggroup"
# prescribe201610$PERIOD <- 201610
# 
# prescription <- rbind(prescription, prescribe201610)
# 
# 
buagppop$PERIOD <- 201610


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201608 <- read_csv("prescribemaster201608.csv")
# prescribe201608 <- prescribe201608[-c(1)]
# names(prescribe201608)[names(prescribe201608)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul16 <- read_csv("gp-reg-pat-prac-lsoa-all-jul16.csv")
names(gpusersjul16)[names(gpusersjul16)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul16 <- merge(gpusersjul16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul16[-c(1:5,7,8)], gpusersjul16["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201608 <- merge(gpusersjul16, prescribe201608, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201608 <- merge(prescribe201608, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201608$itemsper <- prescribe201608$ITEMS*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# prescribe201608$nicper <- prescribe201608$NIC*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# prescribe201608$actcostper <- prescribe201608$`ACT COST`*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# prescribe201608$quantityper <- prescribe201608$QUANTITY*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# 
# prescribe201608 <- prescribe201608[-c(2:13)]
# 
# prescribe201608 <- aggregate(prescribe201608[-c(1,2)], by=list(factor(prescribe201608$BUASD11CD), factor(prescribe201608$Druggroup)), sum)
# 
# names(prescribe201608)[names(prescribe201608)=="Group.1"] <- "BUASD11CD"
# names(prescribe201608)[names(prescribe201608)=="Group.2"] <- "Druggroup"
# prescribe201608$PERIOD <- 201608
# 
# prescription <- rbind(prescription, prescribe201608)
# 
# 
buagppop$PERIOD <- 201608


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201608 <- read_csv("prescribemaster201608.csv")
# prescribe201608 <- prescribe201608[-c(1)]
# names(prescribe201608)[names(prescribe201608)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul16 <- read_csv("gp-reg-pat-prac-lsoa-all-jul16.csv")
names(gpusersjul16)[names(gpusersjul16)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul16 <- merge(gpusersjul16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul16[-c(1:5,7,8)], gpusersjul16["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201608 <- merge(gpusersjul16, prescribe201608, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201608 <- merge(prescribe201608, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201608$itemsper <- prescribe201608$ITEMS*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# prescribe201608$nicper <- prescribe201608$NIC*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# prescribe201608$actcostper <- prescribe201608$`ACT COST`*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# prescribe201608$quantityper <- prescribe201608$QUANTITY*(prescribe201608$`All Patients`/prescribe201608$total_patients)
# 
# prescribe201608 <- prescribe201608[-c(2:13)]
# 
# prescribe201608 <- aggregate(prescribe201608[-c(1,2)], by=list(factor(prescribe201608$BUASD11CD), factor(prescribe201608$Druggroup)), sum)
# 
# names(prescribe201608)[names(prescribe201608)=="Group.1"] <- "BUASD11CD"
# names(prescribe201608)[names(prescribe201608)=="Group.2"] <- "Druggroup"
# prescribe201608$PERIOD <- 201608
# 
# prescription <- rbind(prescription, prescribe201608)
# 
buagppop$PERIOD <- 201608


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201607 <- read_csv("prescribemaster201607.csv")
# prescribe201607 <- prescribe201607[-c(1)]
# names(prescribe201607)[names(prescribe201607)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul16 <- read_csv("gp-reg-pat-prac-lsoa-all-jul16.csv")
names(gpusersjul16)[names(gpusersjul16)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul16 <- merge(gpusersjul16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul16[-c(1:5,7,8)], gpusersjul16["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201607 <- merge(gpusersjul16, prescribe201607, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201607 <- merge(prescribe201607, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201607$itemsper <- prescribe201607$ITEMS*(prescribe201607$`All Patients`/prescribe201607$total_patients)
# prescribe201607$nicper <- prescribe201607$NIC*(prescribe201607$`All Patients`/prescribe201607$total_patients)
# prescribe201607$actcostper <- prescribe201607$`ACT COST`*(prescribe201607$`All Patients`/prescribe201607$total_patients)
# prescribe201607$quantityper <- prescribe201607$QUANTITY*(prescribe201607$`All Patients`/prescribe201607$total_patients)
# 
# prescribe201607 <- prescribe201607[-c(2:13)]
# 
# prescribe201607 <- aggregate(prescribe201607[-c(1,2)], by=list(factor(prescribe201607$BUASD11CD), factor(prescribe201607$Druggroup)), sum)
# 
# names(prescribe201607)[names(prescribe201607)=="Group.1"] <- "BUASD11CD"
# names(prescribe201607)[names(prescribe201607)=="Group.2"] <- "Druggroup"
# prescribe201607$PERIOD <- 201607
# 
# prescription <- rbind(prescription, prescribe201607)
# 
buagppop$PERIOD <- 201607


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201606 <- read_csv("prescribemaster201606.csv")
# prescribe201606 <- prescribe201606[-c(1)]
# names(prescribe201606)[names(prescribe201606)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul16 <- read_csv("gp-reg-pat-prac-lsoa-all-jul16.csv")
names(gpusersjul16)[names(gpusersjul16)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul16 <- merge(gpusersjul16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul16[-c(1:5,7,8)], gpusersjul16["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201606 <- merge(gpusersjul16, prescribe201606, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201606 <- merge(prescribe201606, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201606$itemsper <- prescribe201606$ITEMS*(prescribe201606$`All Patients`/prescribe201606$total_patients)
# prescribe201606$nicper <- prescribe201606$NIC*(prescribe201606$`All Patients`/prescribe201606$total_patients)
# prescribe201606$actcostper <- prescribe201606$`ACT COST`*(prescribe201606$`All Patients`/prescribe201606$total_patients)
# prescribe201606$quantityper <- prescribe201606$QUANTITY*(prescribe201606$`All Patients`/prescribe201606$total_patients)
# 
# prescribe201606 <- prescribe201606[-c(2:13)]
# 
# prescribe201606 <- aggregate(prescribe201606[-c(1,2)], by=list(factor(prescribe201606$BUASD11CD), factor(prescribe201606$Druggroup)), sum)
# 
# names(prescribe201606)[names(prescribe201606)=="Group.1"] <- "BUASD11CD"
# names(prescribe201606)[names(prescribe201606)=="Group.2"] <- "Druggroup"
# prescribe201606$PERIOD <- 201606
# 
# prescription <- rbind(prescription, prescribe201606)
# 
buagppop$PERIOD <- 201606


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201605 <- read_csv("prescribemaster201605.csv")
# prescribe201605 <- prescribe201605[-c(1)]
# names(prescribe201605)[names(prescribe201605)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr16 <- read_csv("gp-reg-pat-prac-lsoa-all-apr16.csv")
names(gpusersapr16)[names(gpusersapr16)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr16 <- merge(gpusersapr16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr16[-c(1:5,7,8)], gpusersapr16["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201605 <- merge(gpusersapr16, prescribe201605, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201605 <- merge(prescribe201605, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201605$itemsper <- prescribe201605$ITEMS*(prescribe201605$`All Patients`/prescribe201605$total_patients)
# prescribe201605$nicper <- prescribe201605$NIC*(prescribe201605$`All Patients`/prescribe201605$total_patients)
# prescribe201605$actcostper <- prescribe201605$`ACT COST`*(prescribe201605$`All Patients`/prescribe201605$total_patients)
# prescribe201605$quantityper <- prescribe201605$QUANTITY*(prescribe201605$`All Patients`/prescribe201605$total_patients)
# 
# prescribe201605 <- prescribe201605[-c(2:13)]
# 
# prescribe201605 <- aggregate(prescribe201605[-c(1,2)], by=list(factor(prescribe201605$BUASD11CD), factor(prescribe201605$Druggroup)), sum)
# 
# names(prescribe201605)[names(prescribe201605)=="Group.1"] <- "BUASD11CD"
# names(prescribe201605)[names(prescribe201605)=="Group.2"] <- "Druggroup"
# prescribe201605$PERIOD <- 201605
# 
# prescription <- rbind(prescription, prescribe201605)
# 
buagppop$PERIOD <- 201605


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201604 <- read_csv("prescribemaster201604.csv")
# prescribe201604 <- prescribe201604[-c(1)]
# names(prescribe201604)[names(prescribe201604)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr16 <- read_csv("gp-reg-pat-prac-lsoa-all-apr16.csv")
names(gpusersapr16)[names(gpusersapr16)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr16 <- merge(gpusersapr16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr16[-c(1:5,7,8)], gpusersapr16["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201604 <- merge(gpusersapr16, prescribe201604, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201604 <- merge(prescribe201604, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201604$itemsper <- prescribe201604$ITEMS*(prescribe201604$`All Patients`/prescribe201604$total_patients)
# prescribe201604$nicper <- prescribe201604$NIC*(prescribe201604$`All Patients`/prescribe201604$total_patients)
# prescribe201604$actcostper <- prescribe201604$`ACT COST`*(prescribe201604$`All Patients`/prescribe201604$total_patients)
# prescribe201604$quantityper <- prescribe201604$QUANTITY*(prescribe201604$`All Patients`/prescribe201604$total_patients)
# 
# prescribe201604 <- prescribe201604[-c(2:13)]
# 
# prescribe201604 <- aggregate(prescribe201604[-c(1,2)], by=list(factor(prescribe201604$BUASD11CD), factor(prescribe201604$Druggroup)), sum)
# 
# names(prescribe201604)[names(prescribe201604)=="Group.1"] <- "BUASD11CD"
# names(prescribe201604)[names(prescribe201604)=="Group.2"] <- "Druggroup"
# prescribe201604$PERIOD <- 201604
# 
# prescription <- rbind(prescription, prescribe201604)
# 
# 
buagppop$PERIOD <- 201604


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201603 <- read_csv("prescribemaster201603.csv")
# prescribe201603 <- prescribe201603[-c(1)]
# names(prescribe201603)[names(prescribe201603)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr16 <- read_csv("gp-reg-pat-prac-lsoa-all-apr16.csv")
names(gpusersapr16)[names(gpusersapr16)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr16 <- merge(gpusersapr16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr16[-c(1:5,7,8)], gpusersapr16["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201603 <- merge(gpusersapr16, prescribe201603, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201603 <- merge(prescribe201603, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201603$itemsper <- prescribe201603$ITEMS*(prescribe201603$`All Patients`/prescribe201603$total_patients)
# prescribe201603$nicper <- prescribe201603$NIC*(prescribe201603$`All Patients`/prescribe201603$total_patients)
# prescribe201603$actcostper <- prescribe201603$`ACT COST`*(prescribe201603$`All Patients`/prescribe201603$total_patients)
# prescribe201603$quantityper <- prescribe201603$QUANTITY*(prescribe201603$`All Patients`/prescribe201603$total_patients)
# 
# prescribe201603 <- prescribe201603[-c(2:13)]
# 
# prescribe201603 <- aggregate(prescribe201603[-c(1,2)], by=list(factor(prescribe201603$BUASD11CD), factor(prescribe201603$Druggroup)), sum)
# 
# names(prescribe201603)[names(prescribe201603)=="Group.1"] <- "BUASD11CD"
# names(prescribe201603)[names(prescribe201603)=="Group.2"] <- "Druggroup"
# prescribe201603$PERIOD <- 201603
# 
# prescription <- rbind(prescription, prescribe201603)
# 
# 
buagppop$PERIOD <- 201603


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201602 <- read_csv("prescribemaster201602.csv")
# prescribe201602 <- prescribe201602[-c(1)]
# names(prescribe201602)[names(prescribe201602)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjan16 <- read_csv("gp-reg-pat-prac-lsoa-all-jan16.csv")
names(gpusersjan16)[names(gpusersjan16)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjan16 <- merge(gpusersjan16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjan16[-c(1:5,7,8)], gpusersjan16["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201602 <- merge(gpusersjan16, prescribe201602, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201602 <- merge(prescribe201602, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201602$itemsper <- prescribe201602$ITEMS*(prescribe201602$`All Patients`/prescribe201602$total_patients)
# prescribe201602$nicper <- prescribe201602$NIC*(prescribe201602$`All Patients`/prescribe201602$total_patients)
# prescribe201602$actcostper <- prescribe201602$`ACT COST`*(prescribe201602$`All Patients`/prescribe201602$total_patients)
# prescribe201602$quantityper <- prescribe201602$QUANTITY*(prescribe201602$`All Patients`/prescribe201602$total_patients)
# 
# prescribe201602 <- prescribe201602[-c(2:13)]
# 
# prescribe201602 <- aggregate(prescribe201602[-c(1,2)], by=list(factor(prescribe201602$BUASD11CD), factor(prescribe201602$Druggroup)), sum)
# 
# names(prescribe201602)[names(prescribe201602)=="Group.1"] <- "BUASD11CD"
# names(prescribe201602)[names(prescribe201602)=="Group.2"] <- "Druggroup"
# prescribe201602$PERIOD <- 201602
# 
# prescription <- rbind(prescription, prescribe201602)
# 
# 
buagppop$PERIOD <- 201602


populationgps <- rbind(populationgps, buagppop)

# prescribe201512 <- read_csv("prescribemaster201512.csv")
# prescribe201512 <- prescribe201512[-c(1)]
# names(prescribe201512)[names(prescribe201512)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjan16 <- read_csv("gp-reg-pat-prac-lsoa-all-jan16.csv")
names(gpusersjan16)[names(gpusersjan16)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjan16 <- merge(gpusersjan16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjan16[-c(1:5,7,8)], gpusersjan16["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201512 <- merge(gpusersjan16, prescribe201512, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201512 <- merge(prescribe201512, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201512$itemsper <- prescribe201512$ITEMS*(prescribe201512$`All Patients`/prescribe201512$total_patients)
# prescribe201512$nicper <- prescribe201512$NIC*(prescribe201512$`All Patients`/prescribe201512$total_patients)
# prescribe201512$actcostper <- prescribe201512$`ACT COST`*(prescribe201512$`All Patients`/prescribe201512$total_patients)
# prescribe201512$quantityper <- prescribe201512$QUANTITY*(prescribe201512$`All Patients`/prescribe201512$total_patients)
# 
# prescribe201512 <- prescribe201512[-c(2:13)]
# 
# prescribe201512 <- aggregate(prescribe201512[-c(1,2)], by=list(factor(prescribe201512$BUASD11CD), factor(prescribe201512$Druggroup)), sum)
# 
# names(prescribe201512)[names(prescribe201512)=="Group.1"] <- "BUASD11CD"
# names(prescribe201512)[names(prescribe201512)=="Group.2"] <- "Druggroup"
# prescribe201512$PERIOD <- 201512
# 
# prescription <- rbind(prescription, prescribe201512)


buagppop$PERIOD <- 201512


populationgps <- rbind(populationgps, buagppop)

# prescribe201601 <- read_csv("prescribemaster201601.csv")
# prescribe201601 <- prescribe201601[-c(1)]
# names(prescribe201601)[names(prescribe201601)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjan16 <- read_csv("gp-reg-pat-prac-lsoa-all-jan16.csv")
names(gpusersjan16)[names(gpusersjan16)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjan16 <- merge(gpusersjan16, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjan16[-c(1:5,7,8)], gpusersjan16["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201601 <- merge(gpusersjan16, prescribe201601, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201601 <- merge(prescribe201601, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201601$itemsper <- prescribe201601$ITEMS*(prescribe201601$`All Patients`/prescribe201601$total_patients)
# prescribe201601$nicper <- prescribe201601$NIC*(prescribe201601$`All Patients`/prescribe201601$total_patients)
# prescribe201601$actcostper <- prescribe201601$`ACT COST`*(prescribe201601$`All Patients`/prescribe201601$total_patients)
# prescribe201601$quantityper <- prescribe201601$QUANTITY*(prescribe201601$`All Patients`/prescribe201601$total_patients)
# 
# prescribe201601 <- prescribe201601[-c(2:13)]
# 
# prescribe201601 <- aggregate(prescribe201601[-c(1,2)], by=list(factor(prescribe201601$BUASD11CD), factor(prescribe201601$Druggroup)), sum)
# 
# names(prescribe201601)[names(prescribe201601)=="Group.1"] <- "BUASD11CD"
# names(prescribe201601)[names(prescribe201601)=="Group.2"] <- "Druggroup"
# prescribe201601$PERIOD <- 201601
# 
# prescription <- rbind(prescription, prescribe201601)
# 
# 
# 
buagppop$PERIOD <- 201601


populationgps <- rbind(populationgps, buagppop)

# prescribe201511 <- read_csv("prescribemaster201511.csv")
# prescribe201511 <- prescribe201511[-c(1)]
# names(prescribe201511)[names(prescribe201511)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct15 <- read_csv("gp-reg-pat-prac-lsoa-all-oct15.csv")
names(gpusersoct15)[names(gpusersoct15)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct15 <- merge(gpusersoct15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct15[-c(1:5,7,8)], gpusersoct15["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201511 <- merge(gpusersoct15, prescribe201511, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201511 <- merge(prescribe201511, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201511$itemsper <- prescribe201511$ITEMS*(prescribe201511$`All Patients`/prescribe201511$total_patients)
# prescribe201511$nicper <- prescribe201511$NIC*(prescribe201511$`All Patients`/prescribe201511$total_patients)
# prescribe201511$actcostper <- prescribe201511$`ACT COST`*(prescribe201511$`All Patients`/prescribe201511$total_patients)
# prescribe201511$quantityper <- prescribe201511$QUANTITY*(prescribe201511$`All Patients`/prescribe201511$total_patients)
# 
# prescribe201511 <- prescribe201511[-c(2:13)]
# 
# prescribe201511 <- aggregate(prescribe201511[-c(1,2)], by=list(factor(prescribe201511$BUASD11CD), factor(prescribe201511$Druggroup)), sum)
# 
# names(prescribe201511)[names(prescribe201511)=="Group.1"] <- "BUASD11CD"
# names(prescribe201511)[names(prescribe201511)=="Group.2"] <- "Druggroup"
# prescribe201511$PERIOD <- 201511
# 
# prescription <- rbind(prescription, prescribe201511)
# 
buagppop$PERIOD <- 201511


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201509 <- read_csv("prescribemaster201509.csv")
# prescribe201509 <- prescribe201509[-c(1)]
# names(prescribe201509)[names(prescribe201509)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct15 <- read_csv("gp-reg-pat-prac-lsoa-all-oct15.csv")
names(gpusersoct15)[names(gpusersoct15)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct15 <- merge(gpusersoct15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct15[-c(1:5,7,8)], gpusersoct15["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201509 <- merge(gpusersoct15, prescribe201509, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201509 <- merge(prescribe201509, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201509$itemsper <- prescribe201509$ITEMS*(prescribe201509$`All Patients`/prescribe201509$total_patients)
# prescribe201509$nicper <- prescribe201509$NIC*(prescribe201509$`All Patients`/prescribe201509$total_patients)
# prescribe201509$actcostper <- prescribe201509$`ACT COST`*(prescribe201509$`All Patients`/prescribe201509$total_patients)
# prescribe201509$quantityper <- prescribe201509$QUANTITY*(prescribe201509$`All Patients`/prescribe201509$total_patients)
# 
# prescribe201509 <- prescribe201509[-c(2:13)]
# 
# prescribe201509 <- aggregate(prescribe201509[-c(1,2)], by=list(factor(prescribe201509$BUASD11CD), factor(prescribe201509$Druggroup)), sum)
# 
# names(prescribe201509)[names(prescribe201509)=="Group.1"] <- "BUASD11CD"
# names(prescribe201509)[names(prescribe201509)=="Group.2"] <- "Druggroup"
# prescribe201509$PERIOD <- 201509
# 
# prescription <- rbind(prescription, prescribe201509)
# 
# 
buagppop$PERIOD <- 201509


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201510 <- read_csv("prescribemaster201510.csv")
# prescribe201510 <- prescribe201510[-c(1)]
# names(prescribe201510)[names(prescribe201510)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct15 <- read_csv("gp-reg-pat-prac-lsoa-all-oct15.csv")
names(gpusersoct15)[names(gpusersoct15)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct15 <- merge(gpusersoct15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct15[-c(1:5,7,8)], gpusersoct15["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201510 <- merge(gpusersoct15, prescribe201510, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201510 <- merge(prescribe201510, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201510$itemsper <- prescribe201510$ITEMS*(prescribe201510$`All Patients`/prescribe201510$total_patients)
# prescribe201510$nicper <- prescribe201510$NIC*(prescribe201510$`All Patients`/prescribe201510$total_patients)
# prescribe201510$actcostper <- prescribe201510$`ACT COST`*(prescribe201510$`All Patients`/prescribe201510$total_patients)
# prescribe201510$quantityper <- prescribe201510$QUANTITY*(prescribe201510$`All Patients`/prescribe201510$total_patients)
# 
# prescribe201510 <- prescribe201510[-c(2:13)]
# 
# prescribe201510 <- aggregate(prescribe201510[-c(1,2)], by=list(factor(prescribe201510$BUASD11CD), factor(prescribe201510$Druggroup)), sum)
# 
# names(prescribe201510)[names(prescribe201510)=="Group.1"] <- "BUASD11CD"
# names(prescribe201510)[names(prescribe201510)=="Group.2"] <- "Druggroup"
# prescribe201510$PERIOD <- 201510
# 
# prescription <- rbind(prescription, prescribe201510)
# 
# 
buagppop$PERIOD <- 201510


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201508 <- read_csv("prescribemaster201508.csv")
# prescribe201508 <- prescribe201508[-c(1)]
# names(prescribe201508)[names(prescribe201508)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul15 <- read_csv("gp-reg-pat-prac-lsoa-all-jul15.csv")
names(gpusersjul15)[names(gpusersjul15)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul15 <- merge(gpusersjul15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul15[-c(1:5,7,8)], gpusersjul15["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201508 <- merge(gpusersjul15, prescribe201508, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201508 <- merge(prescribe201508, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201508$itemsper <- prescribe201508$ITEMS*(prescribe201508$`All Patients`/prescribe201508$total_patients)
# prescribe201508$nicper <- prescribe201508$NIC*(prescribe201508$`All Patients`/prescribe201508$total_patients)
# prescribe201508$actcostper <- prescribe201508$`ACT COST`*(prescribe201508$`All Patients`/prescribe201508$total_patients)
# prescribe201508$quantityper <- prescribe201508$QUANTITY*(prescribe201508$`All Patients`/prescribe201508$total_patients)
# 
# prescribe201508 <- prescribe201508[-c(2:13)]
# 
# prescribe201508 <- aggregate(prescribe201508[-c(1,2)], by=list(factor(prescribe201508$BUASD11CD), factor(prescribe201508$Druggroup)), sum)
# 
# names(prescribe201508)[names(prescribe201508)=="Group.1"] <- "BUASD11CD"
# names(prescribe201508)[names(prescribe201508)=="Group.2"] <- "Druggroup"
# prescribe201508$PERIOD <- 201508
# 
# prescription <- rbind(prescription, prescribe201508)
# 
buagppop$PERIOD <- 201508


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201506 <- read_csv("prescribemaster201506.csv")
# prescribe201506 <- prescribe201506[-c(1)]
# names(prescribe201506)[names(prescribe201506)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul15 <- read_csv("gp-reg-pat-prac-lsoa-all-jul15.csv")
names(gpusersjul15)[names(gpusersjul15)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul15 <- merge(gpusersjul15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul15[-c(1:5,7,8)], gpusersjul15["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201506 <- merge(gpusersjul15, prescribe201506, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201506 <- merge(prescribe201506, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201506$itemsper <- prescribe201506$ITEMS*(prescribe201506$`All Patients`/prescribe201506$total_patients)
# prescribe201506$nicper <- prescribe201506$NIC*(prescribe201506$`All Patients`/prescribe201506$total_patients)
# prescribe201506$actcostper <- prescribe201506$`ACT COST`*(prescribe201506$`All Patients`/prescribe201506$total_patients)
# prescribe201506$quantityper <- prescribe201506$QUANTITY*(prescribe201506$`All Patients`/prescribe201506$total_patients)
# 
# prescribe201506 <- prescribe201506[-c(2:13)]
# 
# prescribe201506 <- aggregate(prescribe201506[-c(1,2)], by=list(factor(prescribe201506$BUASD11CD), factor(prescribe201506$Druggroup)), sum)
# 
# names(prescribe201506)[names(prescribe201506)=="Group.1"] <- "BUASD11CD"
# names(prescribe201506)[names(prescribe201506)=="Group.2"] <- "Druggroup"
# prescribe201506$PERIOD <- 201506
# 
# prescription <- rbind(prescription, prescribe201506)
# 
buagppop$PERIOD <- 201506


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201507 <- read_csv("prescribemaster201507.csv")
# prescribe201507 <- prescribe201507[-c(1)]
# names(prescribe201507)[names(prescribe201507)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul15 <- read_csv("gp-reg-pat-prac-lsoa-all-jul15.csv")
names(gpusersjul15)[names(gpusersjul15)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul15 <- merge(gpusersjul15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul15[-c(1:5,7,8)], gpusersjul15["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201507 <- merge(gpusersjul15, prescribe201507, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201507 <- merge(prescribe201507, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201507$itemsper <- prescribe201507$ITEMS*(prescribe201507$`All Patients`/prescribe201507$total_patients)
# prescribe201507$nicper <- prescribe201507$NIC*(prescribe201507$`All Patients`/prescribe201507$total_patients)
# prescribe201507$actcostper <- prescribe201507$`ACT COST`*(prescribe201507$`All Patients`/prescribe201507$total_patients)
# prescribe201507$quantityper <- prescribe201507$QUANTITY*(prescribe201507$`All Patients`/prescribe201507$total_patients)
# 
# prescribe201507 <- prescribe201507[-c(2:13)]
# 
# prescribe201507 <- aggregate(prescribe201507[-c(1,2)], by=list(factor(prescribe201507$BUASD11CD), factor(prescribe201507$Druggroup)), sum)
# 
# names(prescribe201507)[names(prescribe201507)=="Group.1"] <- "BUASD11CD"
# names(prescribe201507)[names(prescribe201507)=="Group.2"] <- "Druggroup"
# prescribe201507$PERIOD <- 201507
# 
# prescription <- rbind(prescription, prescribe201507)
# 
buagppop$PERIOD <- 201507


populationgps <- rbind(populationgps, buagppop)

# prescribe201607 <- prescribe201607[-c(3)]
# 
# prescribe201505 <- read_csv("prescribemaster201505.csv")
# prescribe201505 <- prescribe201505[-c(1)]
# names(prescribe201505)[names(prescribe201505)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr15 <- read_csv("gp-reg-pat-prac-lsoa-all-apr15.csv")
names(gpusersapr15)[names(gpusersapr15)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr15 <- merge(gpusersapr15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr15[-c(1:5,7,8)], gpusersapr15["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201505 <- merge(gpusersapr15, prescribe201505, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201505 <- merge(prescribe201505, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201505$itemsper <- prescribe201505$ITEMS*(prescribe201505$`All Patients`/prescribe201505$total_patients)
# prescribe201505$nicper <- prescribe201505$NIC*(prescribe201505$`All Patients`/prescribe201505$total_patients)
# prescribe201505$actcostper <- prescribe201505$`ACT COST`*(prescribe201505$`All Patients`/prescribe201505$total_patients)
# prescribe201505$quantityper <- prescribe201505$QUANTITY*(prescribe201505$`All Patients`/prescribe201505$total_patients)
# 
# prescribe201505 <- prescribe201505[-c(2:13)]
# 
# prescribe201505 <- aggregate(prescribe201505[-c(1,2)], by=list(factor(prescribe201505$BUASD11CD), factor(prescribe201505$Druggroup)), sum)
# 
# names(prescribe201505)[names(prescribe201505)=="Group.1"] <- "BUASD11CD"
# names(prescribe201505)[names(prescribe201505)=="Group.2"] <- "Druggroup"
# prescribe201505$PERIOD <- 201505
# 
# prescription <- rbind(prescription, prescribe201505)
# 
# 
buagppop$PERIOD <- 201505


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201504 <- read_csv("prescribemaster201504.csv")
# prescribe201504 <- prescribe201504[-c(1)]
# names(prescribe201504)[names(prescribe201504)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr15 <- read_csv("gp-reg-pat-prac-lsoa-all-apr15.csv")
names(gpusersapr15)[names(gpusersapr15)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr15 <- merge(gpusersapr15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr15[-c(1:5,7,8)], gpusersapr15["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201504 <- merge(gpusersapr15, prescribe201504, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201504 <- merge(prescribe201504, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201504$itemsper <- prescribe201504$ITEMS*(prescribe201504$`All Patients`/prescribe201504$total_patients)
# prescribe201504$nicper <- prescribe201504$NIC*(prescribe201504$`All Patients`/prescribe201504$total_patients)
# prescribe201504$actcostper <- prescribe201504$`ACT COST`*(prescribe201504$`All Patients`/prescribe201504$total_patients)
# prescribe201504$quantityper <- prescribe201504$QUANTITY*(prescribe201504$`All Patients`/prescribe201504$total_patients)
# 
# prescribe201504 <- prescribe201504[-c(2:13)]
# 
# prescribe201504 <- aggregate(prescribe201504[-c(1,2)], by=list(factor(prescribe201504$BUASD11CD), factor(prescribe201504$Druggroup)), sum)
# 
# names(prescribe201504)[names(prescribe201504)=="Group.1"] <- "BUASD11CD"
# names(prescribe201504)[names(prescribe201504)=="Group.2"] <- "Druggroup"
# prescribe201504$PERIOD <- 201504
# 
# prescription <- rbind(prescription, prescribe201504)
# 
# 
buagppop$PERIOD <- 201504


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201503 <- read_csv("prescribemaster201503.csv")
# prescribe201503 <- prescribe201503[-c(1)]
# names(prescribe201503)[names(prescribe201503)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr15 <- read_csv("gp-reg-pat-prac-lsoa-all-apr15.csv")
names(gpusersapr15)[names(gpusersapr15)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr15 <- merge(gpusersapr15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr15[-c(1:5,7,8)], gpusersapr15["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201503 <- merge(gpusersapr15, prescribe201503, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201503 <- merge(prescribe201503, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201503$itemsper <- prescribe201503$ITEMS*(prescribe201503$`All Patients`/prescribe201503$total_patients)
# prescribe201503$nicper <- prescribe201503$NIC*(prescribe201503$`All Patients`/prescribe201503$total_patients)
# prescribe201503$actcostper <- prescribe201503$`ACT COST`*(prescribe201503$`All Patients`/prescribe201503$total_patients)
# prescribe201503$quantityper <- prescribe201503$QUANTITY*(prescribe201503$`All Patients`/prescribe201503$total_patients)
# 
# prescribe201503 <- prescribe201503[-c(2:13)]
# 
# prescribe201503 <- aggregate(prescribe201503[-c(1,2)], by=list(factor(prescribe201503$BUASD11CD), factor(prescribe201503$Druggroup)), sum)
# 
# names(prescribe201503)[names(prescribe201503)=="Group.1"] <- "BUASD11CD"
# names(prescribe201503)[names(prescribe201503)=="Group.2"] <- "Druggroup"
# prescribe201503$PERIOD <- 201503
# 
# prescription <- rbind(prescription, prescribe201503)
# 
# 
buagppop$PERIOD <- 201503


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201502 <- read_csv("prescribemaster201502.csv")
# prescribe201502 <- prescribe201502[-c(1)]
# names(prescribe201502)[names(prescribe201502)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjan15 <- read_csv("gp-reg-pat-prac-lsoa-all-jan15.csv")
names(gpusersjan15)[names(gpusersjan15)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjan15 <- merge(gpusersjan15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjan15[-c(1:5,7,8)], gpusersjan15["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201502 <- merge(gpusersjan15, prescribe201502, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201502 <- merge(prescribe201502, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201502$itemsper <- prescribe201502$ITEMS*(prescribe201502$`All Patients`/prescribe201502$total_patients)
# prescribe201502$nicper <- prescribe201502$NIC*(prescribe201502$`All Patients`/prescribe201502$total_patients)
# prescribe201502$actcostper <- prescribe201502$`ACT COST`*(prescribe201502$`All Patients`/prescribe201502$total_patients)
# prescribe201502$quantityper <- prescribe201502$QUANTITY*(prescribe201502$`All Patients`/prescribe201502$total_patients)
# 
# prescribe201502 <- prescribe201502[-c(2:13)]
# 
# prescribe201502 <- aggregate(prescribe201502[-c(1,2)], by=list(factor(prescribe201502$BUASD11CD), factor(prescribe201502$Druggroup)), sum)
# 
# names(prescribe201502)[names(prescribe201502)=="Group.1"] <- "BUASD11CD"
# names(prescribe201502)[names(prescribe201502)=="Group.2"] <- "Druggroup"
# prescribe201502$PERIOD <- 201502
# 
# prescription <- rbind(prescription, prescribe201502)
# 
# 
# 
buagppop$PERIOD <- 201502


populationgps <- rbind(populationgps, buagppop)

# 
# 
# 
# prescribe201501 <- read_csv("prescribemaster201501.csv")
# prescribe201501 <- prescribe201501[-c(1)]
# names(prescribe201501)[names(prescribe201501)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjan15 <- read_csv("gp-reg-pat-prac-lsoa-all-jan15.csv")
names(gpusersjan15)[names(gpusersjan15)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjan15 <- merge(gpusersjan15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjan15[-c(1:5,7,8)], gpusersjan15["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201501 <- merge(gpusersjan15, prescribe201501, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201501 <- merge(prescribe201501, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201501$itemsper <- prescribe201501$ITEMS*(prescribe201501$`All Patients`/prescribe201501$total_patients)
# prescribe201501$nicper <- prescribe201501$NIC*(prescribe201501$`All Patients`/prescribe201501$total_patients)
# prescribe201501$actcostper <- prescribe201501$`ACT COST`*(prescribe201501$`All Patients`/prescribe201501$total_patients)
# prescribe201501$quantityper <- prescribe201501$QUANTITY*(prescribe201501$`All Patients`/prescribe201501$total_patients)
# 
# prescribe201501 <- prescribe201501[-c(2:13)]
# 
# prescribe201501 <- aggregate(prescribe201501[-c(1,2)], by=list(factor(prescribe201501$BUASD11CD), factor(prescribe201501$Druggroup)), sum)
# 
# names(prescribe201501)[names(prescribe201501)=="Group.1"] <- "BUASD11CD"
# names(prescribe201501)[names(prescribe201501)=="Group.2"] <- "Druggroup"
# prescribe201501$PERIOD <- 201501
# 
# prescription <- rbind(prescription, prescribe201501)
# 
# 
buagppop$PERIOD <- 201501


populationgps <- rbind(populationgps, buagppop)

# 
# 
# 
# 
# prescribe201412 <- read_csv("prescribemaster201412.csv")
# prescribe201412 <- prescribe201412[-c(1)]
# names(prescribe201412)[names(prescribe201412)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjan15 <- read_csv("gp-reg-pat-prac-lsoa-all-jan15.csv")
names(gpusersjan15)[names(gpusersjan15)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjan15 <- merge(gpusersjan15, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjan15[-c(1:5,7,8)], gpusersjan15["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201412 <- merge(gpusersjan15, prescribe201412, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201412 <- merge(prescribe201412, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201412$itemsper <- prescribe201412$ITEMS*(prescribe201412$`All Patients`/prescribe201412$total_patients)
# prescribe201412$nicper <- prescribe201412$NIC*(prescribe201412$`All Patients`/prescribe201412$total_patients)
# prescribe201412$actcostper <- prescribe201412$`ACT COST`*(prescribe201412$`All Patients`/prescribe201412$total_patients)
# prescribe201412$quantityper <- prescribe201412$QUANTITY*(prescribe201412$`All Patients`/prescribe201412$total_patients)
# 
# prescribe201412 <- prescribe201412[-c(2:13)]
# 
# prescribe201412 <- aggregate(prescribe201412[-c(1,2)], by=list(factor(prescribe201412$BUASD11CD), factor(prescribe201412$Druggroup)), sum)
# 
# names(prescribe201412)[names(prescribe201412)=="Group.1"] <- "BUASD11CD"
# names(prescribe201412)[names(prescribe201412)=="Group.2"] <- "Druggroup"
# prescribe201412$PERIOD <- 201412
# 
# prescription <- rbind(prescription, prescribe201412)
# 
# 
buagppop$PERIOD <- 201412


populationgps <- rbind(populationgps, buagppop)

# 
# 
# 
# 
# prescribe201411 <- read_csv("prescribemaster201411.csv")
# prescribe201411 <- prescribe201411[-c(1)]
# names(prescribe201411)[names(prescribe201411)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct14 <- read_csv("gp-reg-pat-prac-lsoa-all-oct14.csv")
names(gpusersoct14)[names(gpusersoct14)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct14 <- merge(gpusersoct14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct14[-c(1:5,7,8)], gpusersoct14["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201411 <- merge(gpusersoct14, prescribe201411, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201411 <- merge(prescribe201411, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201411$itemsper <- prescribe201411$ITEMS*(prescribe201411$`All Patients`/prescribe201411$total_patients)
# prescribe201411$nicper <- prescribe201411$NIC*(prescribe201411$`All Patients`/prescribe201411$total_patients)
# prescribe201411$actcostper <- prescribe201411$`ACT COST`*(prescribe201411$`All Patients`/prescribe201411$total_patients)
# prescribe201411$quantityper <- prescribe201411$QUANTITY*(prescribe201411$`All Patients`/prescribe201411$total_patients)
# 
# prescribe201411 <- prescribe201411[-c(2:13)]
# 
# prescribe201411 <- aggregate(prescribe201411[-c(1,2)], by=list(factor(prescribe201411$BUASD11CD), factor(prescribe201411$Druggroup)), sum)
# 
# names(prescribe201411)[names(prescribe201411)=="Group.1"] <- "BUASD11CD"
# names(prescribe201411)[names(prescribe201411)=="Group.2"] <- "Druggroup"
# prescribe201411$PERIOD <- 201411
# 
# prescription <- rbind(prescription, prescribe201411)
# 
# 
buagppop$PERIOD <- 201411


populationgps <- rbind(populationgps, buagppop)

# 
# 
# 
# prescribe201410 <- read_csv("prescribemaster201410.csv")
# prescribe201410 <- prescribe201410[-c(1)]
# names(prescribe201410)[names(prescribe201410)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct14 <- read_csv("gp-reg-pat-prac-lsoa-all-oct14.csv")
names(gpusersoct14)[names(gpusersoct14)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct14 <- merge(gpusersoct14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct14[-c(1:5,7,8)], gpusersoct14["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201410 <- merge(gpusersoct14, prescribe201410, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201410 <- merge(prescribe201410, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201410$itemsper <- prescribe201410$ITEMS*(prescribe201410$`All Patients`/prescribe201410$total_patients)
# prescribe201410$nicper <- prescribe201410$NIC*(prescribe201410$`All Patients`/prescribe201410$total_patients)
# prescribe201410$actcostper <- prescribe201410$`ACT COST`*(prescribe201410$`All Patients`/prescribe201410$total_patients)
# prescribe201410$quantityper <- prescribe201410$QUANTITY*(prescribe201410$`All Patients`/prescribe201410$total_patients)
# 
# prescribe201410 <- prescribe201410[-c(2:13)]
# 
# prescribe201410 <- aggregate(prescribe201410[-c(1,2)], by=list(factor(prescribe201410$BUASD11CD), factor(prescribe201410$Druggroup)), sum)
# 
# names(prescribe201410)[names(prescribe201410)=="Group.1"] <- "BUASD11CD"
# names(prescribe201410)[names(prescribe201410)=="Group.2"] <- "Druggroup"
# prescribe201410$PERIOD <- 201410
# 
# prescription <- rbind(prescription, prescribe201410)
# 
# 
# 
buagppop$PERIOD <- 201410

populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201409 <- read_csv("prescribemaster201409.csv")
# prescribe201409 <- prescribe201409[-c(1)]
# names(prescribe201409)[names(prescribe201409)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersoct14 <- read_csv("gp-reg-pat-prac-lsoa-all-oct14.csv")
names(gpusersoct14)[names(gpusersoct14)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersoct14 <- merge(gpusersoct14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersoct14[-c(1:5,7,8)], gpusersoct14["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201409 <- merge(gpusersoct14, prescribe201409, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201409 <- merge(prescribe201409, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201409$itemsper <- prescribe201409$ITEMS*(prescribe201409$`All Patients`/prescribe201409$total_patients)
# prescribe201409$nicper <- prescribe201409$NIC*(prescribe201409$`All Patients`/prescribe201409$total_patients)
# prescribe201409$actcostper <- prescribe201409$`ACT COST`*(prescribe201409$`All Patients`/prescribe201409$total_patients)
# prescribe201409$quantityper <- prescribe201409$QUANTITY*(prescribe201409$`All Patients`/prescribe201409$total_patients)
# 
# prescribe201409 <- prescribe201409[-c(2:13)]
# 
# prescribe201409 <- aggregate(prescribe201409[-c(1,2)], by=list(factor(prescribe201409$BUASD11CD), factor(prescribe201409$Druggroup)), sum)
# 
# names(prescribe201409)[names(prescribe201409)=="Group.1"] <- "BUASD11CD"
# names(prescribe201409)[names(prescribe201409)=="Group.2"] <- "Druggroup"
# prescribe201409$PERIOD <- 201409
# 
# prescription <- rbind(prescription, prescribe201409)
# 
# 
# 
buagppop$PERIOD <- 201409


populationgps <- rbind(populationgps, buagppop)

# 
# 
# 
# prescribe201408 <- read_csv("prescribemaster201408.csv")
# prescribe201408 <- prescribe201408[-c(1)]
# names(prescribe201408)[names(prescribe201408)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul14 <- read_csv("gp-reg-pat-prac-lsoa-all-jul14.csv")
names(gpusersjul14)[names(gpusersjul14)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul14 <- merge(gpusersjul14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul14[-c(1:5,7,8)], gpusersjul14["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201408 <- merge(gpusersjul14, prescribe201408, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201408 <- merge(prescribe201408, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201408$itemsper <- prescribe201408$ITEMS*(prescribe201408$`All Patients`/prescribe201408$total_patients)
# prescribe201408$nicper <- prescribe201408$NIC*(prescribe201408$`All Patients`/prescribe201408$total_patients)
# prescribe201408$actcostper <- prescribe201408$`ACT COST`*(prescribe201408$`All Patients`/prescribe201408$total_patients)
# prescribe201408$quantityper <- prescribe201408$QUANTITY*(prescribe201408$`All Patients`/prescribe201408$total_patients)
# 
# prescribe201408 <- prescribe201408[-c(2:13)]
# 
# prescribe201408 <- aggregate(prescribe201408[-c(1,2)], by=list(factor(prescribe201408$BUASD11CD), factor(prescribe201408$Druggroup)), sum)
# 
# names(prescribe201408)[names(prescribe201408)=="Group.1"] <- "BUASD11CD"
# names(prescribe201408)[names(prescribe201408)=="Group.2"] <- "Druggroup"
# prescribe201408$PERIOD <- 201408
# 
# prescription <- rbind(prescription, prescribe201408)
# 
# 
buagppop$PERIOD <- 201408


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201407 <- read_csv("prescribemaster201407.csv")
# prescribe201407 <- prescribe201407[-c(1)]
# names(prescribe201407)[names(prescribe201407)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul14 <- read_csv("gp-reg-pat-prac-lsoa-all-jul14.csv")
names(gpusersjul14)[names(gpusersjul14)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul14 <- merge(gpusersjul14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul14[-c(1:5,7,8)], gpusersjul14["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201407 <- merge(gpusersjul14, prescribe201407, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201407 <- merge(prescribe201407, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201407$itemsper <- prescribe201407$ITEMS*(prescribe201407$`All Patients`/prescribe201407$total_patients)
# prescribe201407$nicper <- prescribe201407$NIC*(prescribe201407$`All Patients`/prescribe201407$total_patients)
# prescribe201407$actcostper <- prescribe201407$`ACT COST`*(prescribe201407$`All Patients`/prescribe201407$total_patients)
# prescribe201407$quantityper <- prescribe201407$QUANTITY*(prescribe201407$`All Patients`/prescribe201407$total_patients)
# 
# prescribe201407 <- prescribe201407[-c(2:13)]
# 
# prescribe201407 <- aggregate(prescribe201407[-c(1,2)], by=list(factor(prescribe201407$BUASD11CD), factor(prescribe201407$Druggroup)), sum)
# 
# names(prescribe201407)[names(prescribe201407)=="Group.1"] <- "BUASD11CD"
# names(prescribe201407)[names(prescribe201407)=="Group.2"] <- "Druggroup"
# prescribe201407$PERIOD <- 201407
# 
# prescription <- rbind(prescription, prescribe201407)
# 
# 
buagppop$PERIOD <- 201407


populationgps <- rbind(populationgps, buagppop)

# 
# 
# 
# 
# prescribe201406 <- read_csv("prescribemaster201406.csv")
# prescribe201406 <- prescribe201406[-c(1)]
# names(prescribe201406)[names(prescribe201406)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersjul14 <- read_csv("gp-reg-pat-prac-lsoa-all-jul14.csv")
names(gpusersjul14)[names(gpusersjul14)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersjul14 <- merge(gpusersjul14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersjul14[-c(1:5,7,8)], gpusersjul14["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201406 <- merge(gpusersjul14, prescribe201406, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201406 <- merge(prescribe201406, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201406$itemsper <- prescribe201406$ITEMS*(prescribe201406$`All Patients`/prescribe201406$total_patients)
# prescribe201406$nicper <- prescribe201406$NIC*(prescribe201406$`All Patients`/prescribe201406$total_patients)
# prescribe201406$actcostper <- prescribe201406$`ACT COST`*(prescribe201406$`All Patients`/prescribe201406$total_patients)
# prescribe201406$quantityper <- prescribe201406$QUANTITY*(prescribe201406$`All Patients`/prescribe201406$total_patients)
# 
# prescribe201406 <- prescribe201406[-c(2:13)]
# 
# prescribe201406 <- aggregate(prescribe201406[-c(1,2)], by=list(factor(prescribe201406$BUASD11CD), factor(prescribe201406$Druggroup)), sum)
# 
# names(prescribe201406)[names(prescribe201406)=="Group.1"] <- "BUASD11CD"
# names(prescribe201406)[names(prescribe201406)=="Group.2"] <- "Druggroup"
# prescribe201406$PERIOD <- 201406
# 
# prescription <- rbind(prescription, prescribe201406)
# 
# 
buagppop$PERIOD <- 201406


populationgps <- rbind(populationgps, buagppop)

# 
# 
# 
# prescribe201405 <- read_csv("prescribemaster201405.csv")
# prescribe201405 <- prescribe201405[-c(1)]
# names(prescribe201405)[names(prescribe201405)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr14 <- read_csv("gp-reg-pat-prac-lsoa-all-apr14.csv")
names(gpusersapr14)[names(gpusersapr14)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr14 <- merge(gpusersapr14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr14[-c(1:5,7,8)], gpusersapr14["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201405 <- merge(gpusersapr14, prescribe201405, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201405 <- merge(prescribe201405, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201405$itemsper <- prescribe201405$ITEMS*(prescribe201405$`All Patients`/prescribe201405$total_patients)
# prescribe201405$nicper <- prescribe201405$NIC*(prescribe201405$`All Patients`/prescribe201405$total_patients)
# prescribe201405$actcostper <- prescribe201405$`ACT COST`*(prescribe201405$`All Patients`/prescribe201405$total_patients)
# prescribe201405$quantityper <- prescribe201405$QUANTITY*(prescribe201405$`All Patients`/prescribe201405$total_patients)
# 
# prescribe201405 <- prescribe201405[-c(2:13)]
# 
# prescribe201405 <- aggregate(prescribe201405[-c(1,2)], by=list(factor(prescribe201405$BUASD11CD), factor(prescribe201405$Druggroup)), sum)
# 
# names(prescribe201405)[names(prescribe201405)=="Group.1"] <- "BUASD11CD"
# names(prescribe201405)[names(prescribe201405)=="Group.2"] <- "Druggroup"
# prescribe201405$PERIOD <- 201405
# 
# prescription <- rbind(prescription, prescribe201405)
# 
# 
buagppop$PERIOD <- 201405


populationgps <- rbind(populationgps, buagppop)

# 
# 
# prescribe201404 <- read_csv("prescribemaster201404.csv")
# prescribe201404 <- prescribe201404[-c(1)]
# names(prescribe201404)[names(prescribe201404)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr14 <- read_csv("gp-reg-pat-prac-lsoa-all-apr14.csv")
names(gpusersapr14)[names(gpusersapr14)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr14 <- merge(gpusersapr14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr14[-c(1:5,7,8)], gpusersapr14["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201404 <- merge(gpusersapr14, prescribe201404, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201404 <- merge(prescribe201404, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201404$itemsper <- prescribe201404$ITEMS*(prescribe201404$`All Patients`/prescribe201404$total_patients)
# prescribe201404$nicper <- prescribe201404$NIC*(prescribe201404$`All Patients`/prescribe201404$total_patients)
# prescribe201404$actcostper <- prescribe201404$`ACT COST`*(prescribe201404$`All Patients`/prescribe201404$total_patients)
# prescribe201404$quantityper <- prescribe201404$QUANTITY*(prescribe201404$`All Patients`/prescribe201404$total_patients)
# 
# prescribe201404 <- prescribe201404[-c(2:13)]
# 
# prescribe201404 <- aggregate(prescribe201404[-c(1,2)], by=list(factor(prescribe201404$BUASD11CD), factor(prescribe201404$Druggroup)), sum)
# 
# names(prescribe201404)[names(prescribe201404)=="Group.1"] <- "BUASD11CD"
# names(prescribe201404)[names(prescribe201404)=="Group.2"] <- "Druggroup"
# prescribe201404$PERIOD <- 201404
# 
# prescription <- rbind(prescription, prescribe201404)
# 
buagppop$PERIOD <- 201404


populationgps <- rbind(populationgps, buagppop)

# 
# prescribe201403 <- read_csv("prescribemaster201403.csv")
# prescribe201403 <- prescribe201403[-c(1)]
# names(prescribe201403)[names(prescribe201403)=="PRACTICE"] <- "PRACTICE_CODE"
gpusersapr14 <- read_csv("gp-reg-pat-prac-lsoa-all-apr14.csv")
names(gpusersapr14)[names(gpusersapr14)=="LSOA_CODE"] <- "LSOA11CD"
# 
gpusersapr14 <- merge(gpusersapr14, lsoalookup, by="LSOA11CD", all.x=TRUE)
# 
buagppop <- aggregate(gpusersapr14[-c(1:5,7,8)], gpusersapr14["BUASD11CD"], sum)
names(buagppop)[names(buagppop)=="All Patients"] <- "total_patients"
# 
# prescribe201403 <- merge(gpusersapr14, prescribe201403, by="PRACTICE_CODE", all.x=TRUE)
# prescribe201403 <- merge(prescribe201403, buagppop, by="BUASD11CD", all.x=TRUE)
# 
# prescribe201403$itemsper <- prescribe201403$ITEMS*(prescribe201403$`All Patients`/prescribe201403$total_patients)
# prescribe201403$nicper <- prescribe201403$NIC*(prescribe201403$`All Patients`/prescribe201403$total_patients)
# prescribe201403$actcostper <- prescribe201403$`ACT COST`*(prescribe201403$`All Patients`/prescribe201403$total_patients)
# prescribe201403$quantityper <- prescribe201403$QUANTITY*(prescribe201403$`All Patients`/prescribe201403$total_patients)
# 
# prescribe201403 <- prescribe201403[-c(2:13)]
# 
# prescribe201403 <- aggregate(prescribe201403[-c(1,2)], by=list(factor(prescribe201403$BUASD11CD), factor(prescribe201403$Druggroup)), sum)
# 
# names(prescribe201403)[names(prescribe201403)=="Group.1"] <- "BUASD11CD"
# names(prescribe201403)[names(prescribe201403)=="Group.2"] <- "Druggroup"
# prescribe201403$PERIOD <- 201403
# 
# prescription <- rbind(prescription, prescribe201403)
# 
buagppop$PERIOD <- 201403


populationgps <- rbind(populationgps, buagppop)

populationgps$PERIOD <- factor(populationgps$PERIOD)
prescription$PERIOD <- factor(prescription$PERIOD)



pleasepretty <- merge( populationgps,prescription, by=c("BUASD11CD", "PERIOD"), all.x=TRUE)

pleasepretty2 <- merge( populationgps,prescription, by=c("BUASD11CD", "PERIOD"))
pleasepretty3 <- merge( populationgps,prescription, by=c("BUASD11CD", "PERIOD"), all.y=TRUE)

write.csv(pleasepretty, "C:\\Users\\bengo\\OneDrive\\Documents\\prescriptionattemtp2.csv")
write.csv(pleasepretty2, "C:\\Users\\bengo\\OneDrive\\Documents\\prescriptionattempt3.csv")
write.csv(pleasepretty3, "C:\\Users\\bengo\\OneDrive\\Documents\\prescriptionattempt4.csv")
#####prescription start here######

prescriptionmaster <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\prescriptionattemtp2.csv")
# Townhealthmaster <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\Townhealthmaster.csv")


prescriptionmaster <- prescriptionmaster[-c(1)]

options(scipen=999)


prescriptiontowns <- merge(prescriptionmaster, Townhealthmaster, by="BUASD11CD", all.x=TRUE)

prescriptiontowns <- prescriptiontowns[complete.cases(prescriptiontowns$BUASD11NM),]

prescriptiontowns$itemsperperson <- prescriptiontowns$itemsper/(prescriptiontowns$total_patients/1000)
prescriptiontowns$nicperperson <- prescriptiontowns$nicper/(prescriptiontowns$total_patients/1000)
prescriptiontowns$actcostperperson <- prescriptiontowns$actcostper/(prescriptiontowns$total_patients/1000)
prescriptiontowns$quantityperperson <- prescriptiontowns$quantityper/(prescriptiontowns$total_patients/1000)

#####prescriptionplots#####
####prescription sii####
#####substancedep####

siisubstance201403 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201403"))
coeffs <- coefficients(siisubstance201403)
siisubstance201403 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- data.frame(PERIOD=201403, sii=siisubstance201403)


siisubstance201404 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201404"))
coeffs <- coefficients(siisubstance201404)
siisubstance201404 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201404, sii=siisubstance201404))


siisubstance201405 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201405"))
coeffs <- coefficients(siisubstance201405)
siisubstance201405 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201405, sii=siisubstance201405))


siisubstance201406 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201406"))
coeffs <- coefficients(siisubstance201406)
siisubstance201406 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201406, sii=siisubstance201406))


siisubstance201407 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201407"))
coeffs <- coefficients(siisubstance201407)
siisubstance201407 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201407, sii=siisubstance201407))


siisubstance201408 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201408"))
coeffs <- coefficients(siisubstance201408)
siisubstance201408 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201408, sii=siisubstance201408))


siisubstance201409 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201409"))
coeffs <- coefficients(siisubstance201409)
siisubstance201409 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201409, sii=siisubstance201409))


siisubstance201410 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201410"))
coeffs <- coefficients(siisubstance201410)
siisubstance201410 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201410, sii=siisubstance201410))


siisubstance201411 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201411"))
coeffs <- coefficients(siisubstance201411)
siisubstance201411 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201411, sii=siisubstance201411))


siisubstance201412 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201412"))
coeffs <- coefficients(siisubstance201412)
siisubstance201412 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201412, sii=siisubstance201412))


siisubstance201501 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201501"))
coeffs <- coefficients(siisubstance201501)
siisubstance201501 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201501, sii=siisubstance201501))


siisubstance201502 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201502"))
coeffs <- coefficients(siisubstance201502)
siisubstance201502 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201502, sii=siisubstance201502))


siisubstance201503 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201503"))
coeffs <- coefficients(siisubstance201503)
siisubstance201503 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201503, sii=siisubstance201503))


siisubstance201504 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201504"))
coeffs <- coefficients(siisubstance201504)
siisubstance201504 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201504, sii=siisubstance201504))


siisubstance201505 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201505"))
coeffs <- coefficients(siisubstance201505)
siisubstance201505 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201505, sii=siisubstance201505))


siisubstance201506 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201506"))
coeffs <- coefficients(siisubstance201506)
siisubstance201506 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201506, sii=siisubstance201506))


siisubstance201507 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201507"))
coeffs <- coefficients(siisubstance201507)
siisubstance201507 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201507, sii=siisubstance201507))


siisubstance201508 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201508"))
coeffs <- coefficients(siisubstance201508)
siisubstance201508 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201508, sii=siisubstance201508))


siisubstance201509 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201509"))
coeffs <- coefficients(siisubstance201509)
siisubstance201509 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201509, sii=siisubstance201509))


siisubstance201510 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201510"))
coeffs <- coefficients(siisubstance201510)
siisubstance201510 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201510, sii=siisubstance201510))


siisubstance201511 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201511"))
coeffs <- coefficients(siisubstance201511)
siisubstance201511 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201511, sii=siisubstance201511))


siisubstance201512 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201512"))
coeffs <- coefficients(siisubstance201512)
siisubstance201512 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201512, sii=siisubstance201512))


siisubstance201601 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201601"))
coeffs <- coefficients(siisubstance201601)
siisubstance201601 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201601, sii=siisubstance201601))


siisubstance201602 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201602"))
coeffs <- coefficients(siisubstance201602)
siisubstance201602 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201602, sii=siisubstance201602))


siisubstance201603 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201603"))
coeffs <- coefficients(siisubstance201603)
siisubstance201603 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201603, sii=siisubstance201603))


siisubstance201604 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201604"))
coeffs <- coefficients(siisubstance201604)
siisubstance201604 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201604, sii=siisubstance201604))


siisubstance201605 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201605"))
coeffs <- coefficients(siisubstance201605)
siisubstance201605 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201605, sii=siisubstance201605))


siisubstance201606 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201606"))
coeffs <- coefficients(siisubstance201606)
siisubstance201606 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201606, sii=siisubstance201606))


siisubstance201607 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201607"))
coeffs <- coefficients(siisubstance201607)
siisubstance201607 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201607, sii=siisubstance201607))


siisubstance201608 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201608"))
coeffs <- coefficients(siisubstance201608)
siisubstance201608 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201608, sii=siisubstance201608))


siisubstance201609 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201609"))
coeffs <- coefficients(siisubstance201609)
siisubstance201609 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201609, sii=siisubstance201609))


siisubstance201610 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201610"))
coeffs <- coefficients(siisubstance201610)
siisubstance201610 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201610, sii=siisubstance201610))


siisubstance201611 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201611"))
coeffs <- coefficients(siisubstance201611)
siisubstance201611 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201611, sii=siisubstance201611))


siisubstance201612 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201612"))
coeffs <- coefficients(siisubstance201612)
siisubstance201612 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201612, sii=siisubstance201612))


siisubstance201701 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201701"))
coeffs <- coefficients(siisubstance201701)
siisubstance201701 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201701, sii=siisubstance201701))


siisubstance201702 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201702"))
coeffs <- coefficients(siisubstance201702)
siisubstance201702 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201702, sii=siisubstance201702))


siisubstance201703 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201703"))
coeffs <- coefficients(siisubstance201703)
siisubstance201703 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201703, sii=siisubstance201703))


siisubstance201704 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201704"))
coeffs <- coefficients(siisubstance201704)
siisubstance201704 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201704, sii=siisubstance201704))


siisubstance201705 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201705"))
coeffs <- coefficients(siisubstance201705)
siisubstance201705 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201705, sii=siisubstance201705))


siisubstance201706 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201706"))
coeffs <- coefficients(siisubstance201706)
siisubstance201706 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201706, sii=siisubstance201706))


siisubstance201707 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201707"))
coeffs <- coefficients(siisubstance201707)
siisubstance201707 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201707, sii=siisubstance201707))


siisubstance201708 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201708"))
coeffs <- coefficients(siisubstance201708)
siisubstance201708 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201708, sii=siisubstance201708))


siisubstance201709 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201709"))
coeffs <- coefficients(siisubstance201709)
siisubstance201709 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201709, sii=siisubstance201709))


siisubstance201710 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201710"))
coeffs <- coefficients(siisubstance201710)
siisubstance201710 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201710, sii=siisubstance201710))


siisubstance201711 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201711"))
coeffs <- coefficients(siisubstance201711)
siisubstance201711 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201711, sii=siisubstance201711))


siisubstance201712 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201712"))
coeffs <- coefficients(siisubstance201712)
siisubstance201712 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201712, sii=siisubstance201712))


siisubstance201801 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201801"))
coeffs <- coefficients(siisubstance201801)
siisubstance201801 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201801, sii=siisubstance201801))


siisubstance201802 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201802"))
coeffs <- coefficients(siisubstance201802)
siisubstance201802 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201802, sii=siisubstance201802))


siisubstance201803 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201803"))
coeffs <- coefficients(siisubstance201803)
siisubstance201803 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201803, sii=siisubstance201803))


siisubstance201804 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201804"))
coeffs <- coefficients(siisubstance201804)
siisubstance201804 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201804, sii=siisubstance201804))


siisubstance201805 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201805"))
coeffs <- coefficients(siisubstance201805)
siisubstance201805 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201805, sii=siisubstance201805))


siisubstance201806 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201806"))
coeffs <- coefficients(siisubstance201806)
siisubstance201806 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201806, sii=siisubstance201806))


siisubstance201807 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201807"))
coeffs <- coefficients(siisubstance201807)
siisubstance201807 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201807, sii=siisubstance201807))


siisubstance201808 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201808"))
coeffs <- coefficients(siisubstance201808)
siisubstance201808 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201808, sii=siisubstance201808))




siisubstance201809 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201809"))
coeffs <- coefficients(siisubstance201809)
siisubstance201809 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201809, sii=siisubstance201809))




siisubstance201810 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Anti"& PERIOD=="201810"))
coeffs <- coefficients(siisubstance201810)
siisubstance201810 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201810, sii=siisubstance201810))




siisubstance201811 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201811"))
coeffs <- coefficients(siisubstance201811)
siisubstance201811 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201811, sii=siisubstance201811))




siisubstance201812 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201812"))
coeffs <- coefficients(siisubstance201812)
siisubstance201812 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201812, sii=siisubstance201812))




siisubstance201901 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201901"))
coeffs <- coefficients(siisubstance201901)
siisubstance201901 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201901, sii=siisubstance201901))




siisubstance201902 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201902"))
coeffs <- coefficients(siisubstance201902)
siisubstance201902 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201902, sii=siisubstance201902))




siisubstance201903 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201903"))
coeffs <- coefficients(siisubstance201903)
siisubstance201903 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201903, sii=siisubstance201903))




siisubstance201904 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201904"))
coeffs <- coefficients(siisubstance201904)
siisubstance201904 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201904, sii=siisubstance201904))




siisubstance201905 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201905"))
coeffs <- coefficients(siisubstance201905)
siisubstance201905 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201905, sii=siisubstance201905))




siisubstance201906 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201906"))
coeffs <- coefficients(siisubstance201906)
siisubstance201906 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201906, sii=siisubstance201906))




siisubstance201907 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201907"))
coeffs <- coefficients(siisubstance201907)
siisubstance201907 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201907, sii=siisubstance201907))




siisubstance201908 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201908"))
coeffs <- coefficients(siisubstance201908)
siisubstance201908 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201908, sii=siisubstance201908))




siisubstance201909 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201909"))
coeffs <- coefficients(siisubstance201909)
siisubstance201909 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201909, sii=siisubstance201909))




siisubstance201910 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201910"))
coeffs <- coefficients(siisubstance201910)
siisubstance201910 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201910, sii=siisubstance201910))




siisubstance201911 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201911"))
coeffs <- coefficients(siisubstance201911)
siisubstance201911 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201911, sii=siisubstance201911))




siisubstance201912 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="SubstanceDep"& PERIOD=="201912"))
coeffs <- coefficients(siisubstance201912)
siisubstance201912 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
substancesii <- rbind(substancesii, data.frame(PERIOD=201912, sii=siisubstance201912))

substancesii <- substancesii[order(substancesii$PERIOD),]
substancesii$PERIOD <- factor(substancesii$PERIOD)
substancesii$group <- 1


substancesiiplot <- ggplot(substancesii, aes(x=PERIOD, y=sii, group = group))+
  theme_light()+
  geom_smooth(method="loess", se=FALSE)+
  geom_point()+
  labs(x = "Date", y = "Slope Index of Inequality", title = "Ineqality in Substance Addiction Drug Prescription")+
  scale_x_discrete(breaks=c("201403","201501", "201601", "201701", "201801", "201901"), labels = c("March 2014", "2015", "2016", "2017", "2018", "2019"))
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "substancesiiplot.png", plot=substancesiiplot, width=8, height=5, dpi=600)


#####antideppression####

siiantidepressant201403 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201403"))
coeffs <- coefficients(siiantidepressant201403)
siiantidepressant201403 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- data.frame(PERIOD=201403, sii=siiantidepressant201403)


siiantidepressant201404 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201404"))
coeffs <- coefficients(siiantidepressant201404)
siiantidepressant201404 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201404, sii=siiantidepressant201404))


siiantidepressant201405 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201405"))
coeffs <- coefficients(siiantidepressant201405)
siiantidepressant201405 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201405, sii=siiantidepressant201405))


siiantidepressant201406 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201406"))
coeffs <- coefficients(siiantidepressant201406)
siiantidepressant201406 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201406, sii=siiantidepressant201406))


siiantidepressant201407 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201407"))
coeffs <- coefficients(siiantidepressant201407)
siiantidepressant201407 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201407, sii=siiantidepressant201407))


siiantidepressant201408 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201408"))
coeffs <- coefficients(siiantidepressant201408)
siiantidepressant201408 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201408, sii=siiantidepressant201408))


siiantidepressant201409 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201409"))
coeffs <- coefficients(siiantidepressant201409)
siiantidepressant201409 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201409, sii=siiantidepressant201409))


siiantidepressant201410 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201410"))
coeffs <- coefficients(siiantidepressant201410)
siiantidepressant201410 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201410, sii=siiantidepressant201410))


siiantidepressant201411 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201411"))
coeffs <- coefficients(siiantidepressant201411)
siiantidepressant201411 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201411, sii=siiantidepressant201411))


siiantidepressant201412 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201412"))
coeffs <- coefficients(siiantidepressant201412)
siiantidepressant201412 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201412, sii=siiantidepressant201412))


siiantidepressant201501 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201501"))
coeffs <- coefficients(siiantidepressant201501)
siiantidepressant201501 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201501, sii=siiantidepressant201501))


siiantidepressant201502 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201502"))
coeffs <- coefficients(siiantidepressant201502)
siiantidepressant201502 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201502, sii=siiantidepressant201502))


siiantidepressant201503 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201503"))
coeffs <- coefficients(siiantidepressant201503)
siiantidepressant201503 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201503, sii=siiantidepressant201503))


siiantidepressant201504 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201504"))
coeffs <- coefficients(siiantidepressant201504)
siiantidepressant201504 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201504, sii=siiantidepressant201504))


siiantidepressant201505 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201505"))
coeffs <- coefficients(siiantidepressant201505)
siiantidepressant201505 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201505, sii=siiantidepressant201505))


siiantidepressant201506 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201506"))
coeffs <- coefficients(siiantidepressant201506)
siiantidepressant201506 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201506, sii=siiantidepressant201506))


siiantidepressant201507 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201507"))
coeffs <- coefficients(siiantidepressant201507)
siiantidepressant201507 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201507, sii=siiantidepressant201507))


siiantidepressant201508 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201508"))
coeffs <- coefficients(siiantidepressant201508)
siiantidepressant201508 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201508, sii=siiantidepressant201508))


siiantidepressant201509 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201509"))
coeffs <- coefficients(siiantidepressant201509)
siiantidepressant201509 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201509, sii=siiantidepressant201509))


siiantidepressant201510 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201510"))
coeffs <- coefficients(siiantidepressant201510)
siiantidepressant201510 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201510, sii=siiantidepressant201510))


siiantidepressant201511 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201511"))
coeffs <- coefficients(siiantidepressant201511)
siiantidepressant201511 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201511, sii=siiantidepressant201511))


siiantidepressant201512 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201512"))
coeffs <- coefficients(siiantidepressant201512)
siiantidepressant201512 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201512, sii=siiantidepressant201512))


siiantidepressant201601 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201601"))
coeffs <- coefficients(siiantidepressant201601)
siiantidepressant201601 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201601, sii=siiantidepressant201601))


siiantidepressant201602 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201602"))
coeffs <- coefficients(siiantidepressant201602)
siiantidepressant201602 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201602, sii=siiantidepressant201602))


siiantidepressant201603 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201603"))
coeffs <- coefficients(siiantidepressant201603)
siiantidepressant201603 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201603, sii=siiantidepressant201603))


siiantidepressant201604 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201604"))
coeffs <- coefficients(siiantidepressant201604)
siiantidepressant201604 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201604, sii=siiantidepressant201604))


siiantidepressant201605 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201605"))
coeffs <- coefficients(siiantidepressant201605)
siiantidepressant201605 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201605, sii=siiantidepressant201605))


siiantidepressant201606 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201606"))
coeffs <- coefficients(siiantidepressant201606)
siiantidepressant201606 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201606, sii=siiantidepressant201606))


siiantidepressant201607 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201607"))
coeffs <- coefficients(siiantidepressant201607)
siiantidepressant201607 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201607, sii=siiantidepressant201607))


siiantidepressant201608 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201608"))
coeffs <- coefficients(siiantidepressant201608)
siiantidepressant201608 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201608, sii=siiantidepressant201608))


siiantidepressant201609 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201609"))
coeffs <- coefficients(siiantidepressant201609)
siiantidepressant201609 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201609, sii=siiantidepressant201609))


siiantidepressant201610 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201610"))
coeffs <- coefficients(siiantidepressant201610)
siiantidepressant201610 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201610, sii=siiantidepressant201610))


siiantidepressant201611 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201611"))
coeffs <- coefficients(siiantidepressant201611)
siiantidepressant201611 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201611, sii=siiantidepressant201611))


siiantidepressant201612 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201612"))
coeffs <- coefficients(siiantidepressant201612)
siiantidepressant201612 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201612, sii=siiantidepressant201612))


siiantidepressant201701 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201701"))
coeffs <- coefficients(siiantidepressant201701)
siiantidepressant201701 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201701, sii=siiantidepressant201701))


siiantidepressant201702 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201702"))
coeffs <- coefficients(siiantidepressant201702)
siiantidepressant201702 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201702, sii=siiantidepressant201702))


siiantidepressant201703 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201703"))
coeffs <- coefficients(siiantidepressant201703)
siiantidepressant201703 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201703, sii=siiantidepressant201703))


siiantidepressant201704 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201704"))
coeffs <- coefficients(siiantidepressant201704)
siiantidepressant201704 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201704, sii=siiantidepressant201704))


siiantidepressant201705 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201705"))
coeffs <- coefficients(siiantidepressant201705)
siiantidepressant201705 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201705, sii=siiantidepressant201705))


siiantidepressant201706 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201706"))
coeffs <- coefficients(siiantidepressant201706)
siiantidepressant201706 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201706, sii=siiantidepressant201706))


siiantidepressant201707 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201707"))
coeffs <- coefficients(siiantidepressant201707)
siiantidepressant201707 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201707, sii=siiantidepressant201707))


siiantidepressant201708 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201708"))
coeffs <- coefficients(siiantidepressant201708)
siiantidepressant201708 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201708, sii=siiantidepressant201708))


siiantidepressant201709 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201709"))
coeffs <- coefficients(siiantidepressant201709)
siiantidepressant201709 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201709, sii=siiantidepressant201709))


siiantidepressant201710 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201710"))
coeffs <- coefficients(siiantidepressant201710)
siiantidepressant201710 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201710, sii=siiantidepressant201710))


siiantidepressant201711 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201711"))
coeffs <- coefficients(siiantidepressant201711)
siiantidepressant201711 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201711, sii=siiantidepressant201711))


siiantidepressant201712 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201712"))
coeffs <- coefficients(siiantidepressant201712)
siiantidepressant201712 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201712, sii=siiantidepressant201712))


siiantidepressant201801 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201801"))
coeffs <- coefficients(siiantidepressant201801)
siiantidepressant201801 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201801, sii=siiantidepressant201801))


siiantidepressant201802 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201802"))
coeffs <- coefficients(siiantidepressant201802)
siiantidepressant201802 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201802, sii=siiantidepressant201802))


siiantidepressant201803 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201803"))
coeffs <- coefficients(siiantidepressant201803)
siiantidepressant201803 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201803, sii=siiantidepressant201803))


siiantidepressant201804 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201804"))
coeffs <- coefficients(siiantidepressant201804)
siiantidepressant201804 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201804, sii=siiantidepressant201804))


siiantidepressant201805 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201805"))
coeffs <- coefficients(siiantidepressant201805)
siiantidepressant201805 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201805, sii=siiantidepressant201805))


siiantidepressant201806 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201806"))
coeffs <- coefficients(siiantidepressant201806)
siiantidepressant201806 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201806, sii=siiantidepressant201806))


siiantidepressant201807 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201807"))
coeffs <- coefficients(siiantidepressant201807)
siiantidepressant201807 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201807, sii=siiantidepressant201807))


siiantidepressant201808 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201808"))
coeffs <- coefficients(siiantidepressant201808)
siiantidepressant201808 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201808, sii=siiantidepressant201808))




siiantidepressant201809 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201809"))
coeffs <- coefficients(siiantidepressant201809)
siiantidepressant201809 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201809, sii=siiantidepressant201809))




siiantidepressant201810 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201810"))
coeffs <- coefficients(siiantidepressant201810)
siiantidepressant201810 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201810, sii=siiantidepressant201810))




siiantidepressant201811 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201811"))
coeffs <- coefficients(siiantidepressant201811)
siiantidepressant201811 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201811, sii=siiantidepressant201811))




siiantidepressant201812 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201812"))
coeffs <- coefficients(siiantidepressant201812)
siiantidepressant201812 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201812, sii=siiantidepressant201812))




siiantidepressant201901 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201901"))
coeffs <- coefficients(siiantidepressant201901)
siiantidepressant201901 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201901, sii=siiantidepressant201901))




siiantidepressant201902 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201902"))
coeffs <- coefficients(siiantidepressant201902)
siiantidepressant201902 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201902, sii=siiantidepressant201902))




siiantidepressant201903 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201903"))
coeffs <- coefficients(siiantidepressant201903)
siiantidepressant201903 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201903, sii=siiantidepressant201903))




siiantidepressant201904 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201904"))
coeffs <- coefficients(siiantidepressant201904)
siiantidepressant201904 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201904, sii=siiantidepressant201904))




siiantidepressant201905 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201905"))
coeffs <- coefficients(siiantidepressant201905)
siiantidepressant201905 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201905, sii=siiantidepressant201905))




siiantidepressant201906 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201906"))
coeffs <- coefficients(siiantidepressant201906)
siiantidepressant201906 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201906, sii=siiantidepressant201906))




siiantidepressant201907 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201907"))
coeffs <- coefficients(siiantidepressant201907)
siiantidepressant201907 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201907, sii=siiantidepressant201907))




siiantidepressant201908 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201908"))
coeffs <- coefficients(siiantidepressant201908)
siiantidepressant201908 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201908, sii=siiantidepressant201908))




siiantidepressant201909 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201909"))
coeffs <- coefficients(siiantidepressant201909)
siiantidepressant201909 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201909, sii=siiantidepressant201909))




siiantidepressant201910 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201910"))
coeffs <- coefficients(siiantidepressant201910)
siiantidepressant201910 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201910, sii=siiantidepressant201910))




siiantidepressant201911 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201911"))
coeffs <- coefficients(siiantidepressant201911)
siiantidepressant201911 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201911, sii=siiantidepressant201911))




siiantidepressant201912 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Antidepressant"& PERIOD=="201912"))
coeffs <- coefficients(siiantidepressant201912)
siiantidepressant201912 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
antidepressantsii <- rbind(antidepressantsii, data.frame(PERIOD=201912, sii=siiantidepressant201912))

antidepressantsii <- antidepressantsii[order(antidepressantsii$PERIOD),]
antidepressantsii$PERIOD <- factor(antidepressantsii$PERIOD)
antidepressantsii$group <- 1


antidepressantsiiplot <- ggplot(antidepressantsii, aes(x=PERIOD, y=sii, group = group))+
  theme_light()+
  geom_smooth(method="loess", se=FALSE)+
  geom_point()+
  labs(x = "Date", y = "Slope Index of Inequality", title = "Ineqality in Antidepressant Drug Prescription")+
  scale_x_discrete(breaks=c("201403","201501", "201601", "201701", "201801", "201901"), labels = c("March 2014", "2015", "2016", "2017", "2018", "2019"))
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "antidepressantsiiplot.png", plot=antidepressantsiiplot, width=8, height=5, dpi=600)


#####Alcohol####

siiAlcohol201403 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201403"))
coeffs <- coefficients(siiAlcohol201403)
siiAlcohol201403 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- data.frame(PERIOD=201403, sii=siiAlcohol201403)


siiAlcohol201404 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201404"))
coeffs <- coefficients(siiAlcohol201404)
siiAlcohol201404 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201404, sii=siiAlcohol201404))


siiAlcohol201405 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201405"))
coeffs <- coefficients(siiAlcohol201405)
siiAlcohol201405 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201405, sii=siiAlcohol201405))


siiAlcohol201406 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201406"))
coeffs <- coefficients(siiAlcohol201406)
siiAlcohol201406 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201406, sii=siiAlcohol201406))


siiAlcohol201407 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201407"))
coeffs <- coefficients(siiAlcohol201407)
siiAlcohol201407 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201407, sii=siiAlcohol201407))


siiAlcohol201408 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201408"))
coeffs <- coefficients(siiAlcohol201408)
siiAlcohol201408 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201408, sii=siiAlcohol201408))


siiAlcohol201409 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201409"))
coeffs <- coefficients(siiAlcohol201409)
siiAlcohol201409 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201409, sii=siiAlcohol201409))


siiAlcohol201410 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201410"))
coeffs <- coefficients(siiAlcohol201410)
siiAlcohol201410 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201410, sii=siiAlcohol201410))


siiAlcohol201411 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201411"))
coeffs <- coefficients(siiAlcohol201411)
siiAlcohol201411 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201411, sii=siiAlcohol201411))


siiAlcohol201412 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201412"))
coeffs <- coefficients(siiAlcohol201412)
siiAlcohol201412 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201412, sii=siiAlcohol201412))


siiAlcohol201501 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201501"))
coeffs <- coefficients(siiAlcohol201501)
siiAlcohol201501 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201501, sii=siiAlcohol201501))


siiAlcohol201502 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201502"))
coeffs <- coefficients(siiAlcohol201502)
siiAlcohol201502 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201502, sii=siiAlcohol201502))


siiAlcohol201503 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201503"))
coeffs <- coefficients(siiAlcohol201503)
siiAlcohol201503 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201503, sii=siiAlcohol201503))


siiAlcohol201504 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201504"))
coeffs <- coefficients(siiAlcohol201504)
siiAlcohol201504 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201504, sii=siiAlcohol201504))


siiAlcohol201505 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201505"))
coeffs <- coefficients(siiAlcohol201505)
siiAlcohol201505 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201505, sii=siiAlcohol201505))


siiAlcohol201506 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201506"))
coeffs <- coefficients(siiAlcohol201506)
siiAlcohol201506 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201506, sii=siiAlcohol201506))


siiAlcohol201507 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201507"))
coeffs <- coefficients(siiAlcohol201507)
siiAlcohol201507 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201507, sii=siiAlcohol201507))


siiAlcohol201508 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201508"))
coeffs <- coefficients(siiAlcohol201508)
siiAlcohol201508 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201508, sii=siiAlcohol201508))


siiAlcohol201509 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201509"))
coeffs <- coefficients(siiAlcohol201509)
siiAlcohol201509 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201509, sii=siiAlcohol201509))


siiAlcohol201510 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201510"))
coeffs <- coefficients(siiAlcohol201510)
siiAlcohol201510 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201510, sii=siiAlcohol201510))


siiAlcohol201511 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201511"))
coeffs <- coefficients(siiAlcohol201511)
siiAlcohol201511 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201511, sii=siiAlcohol201511))


siiAlcohol201512 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201512"))
coeffs <- coefficients(siiAlcohol201512)
siiAlcohol201512 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201512, sii=siiAlcohol201512))


siiAlcohol201601 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201601"))
coeffs <- coefficients(siiAlcohol201601)
siiAlcohol201601 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201601, sii=siiAlcohol201601))


siiAlcohol201602 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201602"))
coeffs <- coefficients(siiAlcohol201602)
siiAlcohol201602 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201602, sii=siiAlcohol201602))


siiAlcohol201603 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201603"))
coeffs <- coefficients(siiAlcohol201603)
siiAlcohol201603 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201603, sii=siiAlcohol201603))


siiAlcohol201604 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201604"))
coeffs <- coefficients(siiAlcohol201604)
siiAlcohol201604 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201604, sii=siiAlcohol201604))


siiAlcohol201605 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201605"))
coeffs <- coefficients(siiAlcohol201605)
siiAlcohol201605 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201605, sii=siiAlcohol201605))


siiAlcohol201606 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201606"))
coeffs <- coefficients(siiAlcohol201606)
siiAlcohol201606 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201606, sii=siiAlcohol201606))


siiAlcohol201607 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201607"))
coeffs <- coefficients(siiAlcohol201607)
siiAlcohol201607 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201607, sii=siiAlcohol201607))


siiAlcohol201608 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201608"))
coeffs <- coefficients(siiAlcohol201608)
siiAlcohol201608 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201608, sii=siiAlcohol201608))


siiAlcohol201609 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201609"))
coeffs <- coefficients(siiAlcohol201609)
siiAlcohol201609 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201609, sii=siiAlcohol201609))


siiAlcohol201610 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201610"))
coeffs <- coefficients(siiAlcohol201610)
siiAlcohol201610 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201610, sii=siiAlcohol201610))


siiAlcohol201611 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201611"))
coeffs <- coefficients(siiAlcohol201611)
siiAlcohol201611 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201611, sii=siiAlcohol201611))


siiAlcohol201612 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201612"))
coeffs <- coefficients(siiAlcohol201612)
siiAlcohol201612 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201612, sii=siiAlcohol201612))


siiAlcohol201701 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201701"))
coeffs <- coefficients(siiAlcohol201701)
siiAlcohol201701 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201701, sii=siiAlcohol201701))


siiAlcohol201702 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201702"))
coeffs <- coefficients(siiAlcohol201702)
siiAlcohol201702 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201702, sii=siiAlcohol201702))


siiAlcohol201703 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201703"))
coeffs <- coefficients(siiAlcohol201703)
siiAlcohol201703 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201703, sii=siiAlcohol201703))


siiAlcohol201704 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201704"))
coeffs <- coefficients(siiAlcohol201704)
siiAlcohol201704 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201704, sii=siiAlcohol201704))


siiAlcohol201705 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201705"))
coeffs <- coefficients(siiAlcohol201705)
siiAlcohol201705 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201705, sii=siiAlcohol201705))


siiAlcohol201706 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201706"))
coeffs <- coefficients(siiAlcohol201706)
siiAlcohol201706 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201706, sii=siiAlcohol201706))


siiAlcohol201707 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201707"))
coeffs <- coefficients(siiAlcohol201707)
siiAlcohol201707 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201707, sii=siiAlcohol201707))


siiAlcohol201708 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201708"))
coeffs <- coefficients(siiAlcohol201708)
siiAlcohol201708 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201708, sii=siiAlcohol201708))


siiAlcohol201709 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201709"))
coeffs <- coefficients(siiAlcohol201709)
siiAlcohol201709 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201709, sii=siiAlcohol201709))


siiAlcohol201710 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201710"))
coeffs <- coefficients(siiAlcohol201710)
siiAlcohol201710 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201710, sii=siiAlcohol201710))


siiAlcohol201711 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201711"))
coeffs <- coefficients(siiAlcohol201711)
siiAlcohol201711 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201711, sii=siiAlcohol201711))


siiAlcohol201712 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201712"))
coeffs <- coefficients(siiAlcohol201712)
siiAlcohol201712 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201712, sii=siiAlcohol201712))


siiAlcohol201801 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201801"))
coeffs <- coefficients(siiAlcohol201801)
siiAlcohol201801 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201801, sii=siiAlcohol201801))


siiAlcohol201802 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201802"))
coeffs <- coefficients(siiAlcohol201802)
siiAlcohol201802 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201802, sii=siiAlcohol201802))


siiAlcohol201803 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201803"))
coeffs <- coefficients(siiAlcohol201803)
siiAlcohol201803 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201803, sii=siiAlcohol201803))


siiAlcohol201804 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201804"))
coeffs <- coefficients(siiAlcohol201804)
siiAlcohol201804 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201804, sii=siiAlcohol201804))


siiAlcohol201805 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201805"))
coeffs <- coefficients(siiAlcohol201805)
siiAlcohol201805 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201805, sii=siiAlcohol201805))


siiAlcohol201806 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201806"))
coeffs <- coefficients(siiAlcohol201806)
siiAlcohol201806 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201806, sii=siiAlcohol201806))


siiAlcohol201807 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201807"))
coeffs <- coefficients(siiAlcohol201807)
siiAlcohol201807 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201807, sii=siiAlcohol201807))


siiAlcohol201808 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201808"))
coeffs <- coefficients(siiAlcohol201808)
siiAlcohol201808 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201808, sii=siiAlcohol201808))




siiAlcohol201809 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201809"))
coeffs <- coefficients(siiAlcohol201809)
siiAlcohol201809 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201809, sii=siiAlcohol201809))




siiAlcohol201810 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201810"))
coeffs <- coefficients(siiAlcohol201810)
siiAlcohol201810 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201810, sii=siiAlcohol201810))




siiAlcohol201811 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201811"))
coeffs <- coefficients(siiAlcohol201811)
siiAlcohol201811 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201811, sii=siiAlcohol201811))




siiAlcohol201812 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201812"))
coeffs <- coefficients(siiAlcohol201812)
siiAlcohol201812 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201812, sii=siiAlcohol201812))




siiAlcohol201901 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201901"))
coeffs <- coefficients(siiAlcohol201901)
siiAlcohol201901 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201901, sii=siiAlcohol201901))




siiAlcohol201902 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201902"))
coeffs <- coefficients(siiAlcohol201902)
siiAlcohol201902 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201902, sii=siiAlcohol201902))




siiAlcohol201903 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201903"))
coeffs <- coefficients(siiAlcohol201903)
siiAlcohol201903 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201903, sii=siiAlcohol201903))




siiAlcohol201904 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201904"))
coeffs <- coefficients(siiAlcohol201904)
siiAlcohol201904 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201904, sii=siiAlcohol201904))




siiAlcohol201905 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201905"))
coeffs <- coefficients(siiAlcohol201905)
siiAlcohol201905 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201905, sii=siiAlcohol201905))




siiAlcohol201906 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201906"))
coeffs <- coefficients(siiAlcohol201906)
siiAlcohol201906 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201906, sii=siiAlcohol201906))




siiAlcohol201907 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201907"))
coeffs <- coefficients(siiAlcohol201907)
siiAlcohol201907 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201907, sii=siiAlcohol201907))




siiAlcohol201908 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201908"))
coeffs <- coefficients(siiAlcohol201908)
siiAlcohol201908 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201908, sii=siiAlcohol201908))




siiAlcohol201909 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201909"))
coeffs <- coefficients(siiAlcohol201909)
siiAlcohol201909 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201909, sii=siiAlcohol201909))




siiAlcohol201910 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201910"))
coeffs <- coefficients(siiAlcohol201910)
siiAlcohol201910 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201910, sii=siiAlcohol201910))




siiAlcohol201911 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201911"))
coeffs <- coefficients(siiAlcohol201911)
siiAlcohol201911 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201911, sii=siiAlcohol201911))




siiAlcohol201912 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Alcohol"& PERIOD=="201912"))
coeffs <- coefficients(siiAlcohol201912)
siiAlcohol201912 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Alcoholsii <- rbind(Alcoholsii, data.frame(PERIOD=201912, sii=siiAlcohol201912))

Alcoholsii <- Alcoholsii[order(Alcoholsii$PERIOD),]
Alcoholsii$PERIOD <- factor(Alcoholsii$PERIOD)
Alcoholsii$group <- 1


Alcoholsiiplot <- ggplot(Alcoholsii, aes(x=PERIOD, y=sii, group = group))+
  theme_light()+
  geom_smooth(method="loess", se=FALSE)+
  geom_point()+
  labs(x = "Date", y = "Slope Index of Inequality", title = "Ineqality in Alcohol-addiction Drug Prescription")+
  scale_x_discrete(breaks=c("201403","201501", "201601", "201701", "201801", "201901"), labels = c("March 2014", "2015", "2016", "2017", "2018", "2019"))
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Alcoholsiiplot.png", plot=Alcoholsiiplot, width=8, height=5, dpi=600)



#####Bronchodilators####

siiBronchodilators201403 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201403"))
coeffs <- coefficients(siiBronchodilators201403)
siiBronchodilators201403 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- data.frame(PERIOD=201403, sii=siiBronchodilators201403)


siiBronchodilators201404 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201404"))
coeffs <- coefficients(siiBronchodilators201404)
siiBronchodilators201404 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201404, sii=siiBronchodilators201404))


siiBronchodilators201405 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201405"))
coeffs <- coefficients(siiBronchodilators201405)
siiBronchodilators201405 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201405, sii=siiBronchodilators201405))


siiBronchodilators201406 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201406"))
coeffs <- coefficients(siiBronchodilators201406)
siiBronchodilators201406 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201406, sii=siiBronchodilators201406))


siiBronchodilators201407 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201407"))
coeffs <- coefficients(siiBronchodilators201407)
siiBronchodilators201407 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201407, sii=siiBronchodilators201407))


siiBronchodilators201408 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201408"))
coeffs <- coefficients(siiBronchodilators201408)
siiBronchodilators201408 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201408, sii=siiBronchodilators201408))


siiBronchodilators201409 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201409"))
coeffs <- coefficients(siiBronchodilators201409)
siiBronchodilators201409 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201409, sii=siiBronchodilators201409))


siiBronchodilators201410 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201410"))
coeffs <- coefficients(siiBronchodilators201410)
siiBronchodilators201410 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201410, sii=siiBronchodilators201410))


siiBronchodilators201411 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201411"))
coeffs <- coefficients(siiBronchodilators201411)
siiBronchodilators201411 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201411, sii=siiBronchodilators201411))


siiBronchodilators201412 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201412"))
coeffs <- coefficients(siiBronchodilators201412)
siiBronchodilators201412 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201412, sii=siiBronchodilators201412))


siiBronchodilators201501 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201501"))
coeffs <- coefficients(siiBronchodilators201501)
siiBronchodilators201501 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201501, sii=siiBronchodilators201501))


siiBronchodilators201502 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201502"))
coeffs <- coefficients(siiBronchodilators201502)
siiBronchodilators201502 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201502, sii=siiBronchodilators201502))


siiBronchodilators201503 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201503"))
coeffs <- coefficients(siiBronchodilators201503)
siiBronchodilators201503 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201503, sii=siiBronchodilators201503))


siiBronchodilators201504 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201504"))
coeffs <- coefficients(siiBronchodilators201504)
siiBronchodilators201504 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201504, sii=siiBronchodilators201504))


siiBronchodilators201505 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201505"))
coeffs <- coefficients(siiBronchodilators201505)
siiBronchodilators201505 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201505, sii=siiBronchodilators201505))


siiBronchodilators201506 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201506"))
coeffs <- coefficients(siiBronchodilators201506)
siiBronchodilators201506 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201506, sii=siiBronchodilators201506))


siiBronchodilators201507 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201507"))
coeffs <- coefficients(siiBronchodilators201507)
siiBronchodilators201507 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201507, sii=siiBronchodilators201507))


siiBronchodilators201508 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201508"))
coeffs <- coefficients(siiBronchodilators201508)
siiBronchodilators201508 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201508, sii=siiBronchodilators201508))


siiBronchodilators201509 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201509"))
coeffs <- coefficients(siiBronchodilators201509)
siiBronchodilators201509 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201509, sii=siiBronchodilators201509))


siiBronchodilators201510 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201510"))
coeffs <- coefficients(siiBronchodilators201510)
siiBronchodilators201510 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201510, sii=siiBronchodilators201510))


siiBronchodilators201511 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201511"))
coeffs <- coefficients(siiBronchodilators201511)
siiBronchodilators201511 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201511, sii=siiBronchodilators201511))


siiBronchodilators201512 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201512"))
coeffs <- coefficients(siiBronchodilators201512)
siiBronchodilators201512 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201512, sii=siiBronchodilators201512))


siiBronchodilators201601 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201601"))
coeffs <- coefficients(siiBronchodilators201601)
siiBronchodilators201601 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201601, sii=siiBronchodilators201601))


siiBronchodilators201602 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201602"))
coeffs <- coefficients(siiBronchodilators201602)
siiBronchodilators201602 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201602, sii=siiBronchodilators201602))


siiBronchodilators201603 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201603"))
coeffs <- coefficients(siiBronchodilators201603)
siiBronchodilators201603 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201603, sii=siiBronchodilators201603))


siiBronchodilators201604 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201604"))
coeffs <- coefficients(siiBronchodilators201604)
siiBronchodilators201604 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201604, sii=siiBronchodilators201604))


siiBronchodilators201605 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201605"))
coeffs <- coefficients(siiBronchodilators201605)
siiBronchodilators201605 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201605, sii=siiBronchodilators201605))


siiBronchodilators201606 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201606"))
coeffs <- coefficients(siiBronchodilators201606)
siiBronchodilators201606 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201606, sii=siiBronchodilators201606))


siiBronchodilators201607 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201607"))
coeffs <- coefficients(siiBronchodilators201607)
siiBronchodilators201607 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201607, sii=siiBronchodilators201607))


siiBronchodilators201608 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201608"))
coeffs <- coefficients(siiBronchodilators201608)
siiBronchodilators201608 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201608, sii=siiBronchodilators201608))


siiBronchodilators201609 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201609"))
coeffs <- coefficients(siiBronchodilators201609)
siiBronchodilators201609 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201609, sii=siiBronchodilators201609))


siiBronchodilators201610 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201610"))
coeffs <- coefficients(siiBronchodilators201610)
siiBronchodilators201610 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201610, sii=siiBronchodilators201610))


siiBronchodilators201611 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201611"))
coeffs <- coefficients(siiBronchodilators201611)
siiBronchodilators201611 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201611, sii=siiBronchodilators201611))


siiBronchodilators201612 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201612"))
coeffs <- coefficients(siiBronchodilators201612)
siiBronchodilators201612 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201612, sii=siiBronchodilators201612))


siiBronchodilators201701 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201701"))
coeffs <- coefficients(siiBronchodilators201701)
siiBronchodilators201701 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201701, sii=siiBronchodilators201701))


siiBronchodilators201702 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201702"))
coeffs <- coefficients(siiBronchodilators201702)
siiBronchodilators201702 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201702, sii=siiBronchodilators201702))


siiBronchodilators201703 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201703"))
coeffs <- coefficients(siiBronchodilators201703)
siiBronchodilators201703 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201703, sii=siiBronchodilators201703))


siiBronchodilators201704 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201704"))
coeffs <- coefficients(siiBronchodilators201704)
siiBronchodilators201704 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201704, sii=siiBronchodilators201704))


siiBronchodilators201705 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201705"))
coeffs <- coefficients(siiBronchodilators201705)
siiBronchodilators201705 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201705, sii=siiBronchodilators201705))


siiBronchodilators201706 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201706"))
coeffs <- coefficients(siiBronchodilators201706)
siiBronchodilators201706 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201706, sii=siiBronchodilators201706))


siiBronchodilators201707 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201707"))
coeffs <- coefficients(siiBronchodilators201707)
siiBronchodilators201707 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201707, sii=siiBronchodilators201707))


siiBronchodilators201708 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201708"))
coeffs <- coefficients(siiBronchodilators201708)
siiBronchodilators201708 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201708, sii=siiBronchodilators201708))


siiBronchodilators201709 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201709"))
coeffs <- coefficients(siiBronchodilators201709)
siiBronchodilators201709 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201709, sii=siiBronchodilators201709))


siiBronchodilators201710 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201710"))
coeffs <- coefficients(siiBronchodilators201710)
siiBronchodilators201710 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201710, sii=siiBronchodilators201710))


siiBronchodilators201711 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201711"))
coeffs <- coefficients(siiBronchodilators201711)
siiBronchodilators201711 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201711, sii=siiBronchodilators201711))


siiBronchodilators201712 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201712"))
coeffs <- coefficients(siiBronchodilators201712)
siiBronchodilators201712 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201712, sii=siiBronchodilators201712))


siiBronchodilators201801 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201801"))
coeffs <- coefficients(siiBronchodilators201801)
siiBronchodilators201801 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201801, sii=siiBronchodilators201801))


siiBronchodilators201802 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201802"))
coeffs <- coefficients(siiBronchodilators201802)
siiBronchodilators201802 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201802, sii=siiBronchodilators201802))


siiBronchodilators201803 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201803"))
coeffs <- coefficients(siiBronchodilators201803)
siiBronchodilators201803 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201803, sii=siiBronchodilators201803))


siiBronchodilators201804 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201804"))
coeffs <- coefficients(siiBronchodilators201804)
siiBronchodilators201804 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201804, sii=siiBronchodilators201804))


siiBronchodilators201805 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201805"))
coeffs <- coefficients(siiBronchodilators201805)
siiBronchodilators201805 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201805, sii=siiBronchodilators201805))


siiBronchodilators201806 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201806"))
coeffs <- coefficients(siiBronchodilators201806)
siiBronchodilators201806 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201806, sii=siiBronchodilators201806))


siiBronchodilators201807 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201807"))
coeffs <- coefficients(siiBronchodilators201807)
siiBronchodilators201807 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201807, sii=siiBronchodilators201807))


siiBronchodilators201808 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201808"))
coeffs <- coefficients(siiBronchodilators201808)
siiBronchodilators201808 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201808, sii=siiBronchodilators201808))




siiBronchodilators201809 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201809"))
coeffs <- coefficients(siiBronchodilators201809)
siiBronchodilators201809 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201809, sii=siiBronchodilators201809))




siiBronchodilators201810 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201810"))
coeffs <- coefficients(siiBronchodilators201810)
siiBronchodilators201810 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201810, sii=siiBronchodilators201810))




siiBronchodilators201811 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201811"))
coeffs <- coefficients(siiBronchodilators201811)
siiBronchodilators201811 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201811, sii=siiBronchodilators201811))




siiBronchodilators201812 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201812"))
coeffs <- coefficients(siiBronchodilators201812)
siiBronchodilators201812 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201812, sii=siiBronchodilators201812))




siiBronchodilators201901 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201901"))
coeffs <- coefficients(siiBronchodilators201901)
siiBronchodilators201901 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201901, sii=siiBronchodilators201901))




siiBronchodilators201902 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201902"))
coeffs <- coefficients(siiBronchodilators201902)
siiBronchodilators201902 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201902, sii=siiBronchodilators201902))




siiBronchodilators201903 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201903"))
coeffs <- coefficients(siiBronchodilators201903)
siiBronchodilators201903 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201903, sii=siiBronchodilators201903))




siiBronchodilators201904 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201904"))
coeffs <- coefficients(siiBronchodilators201904)
siiBronchodilators201904 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201904, sii=siiBronchodilators201904))




siiBronchodilators201905 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201905"))
coeffs <- coefficients(siiBronchodilators201905)
siiBronchodilators201905 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201905, sii=siiBronchodilators201905))




siiBronchodilators201906 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201906"))
coeffs <- coefficients(siiBronchodilators201906)
siiBronchodilators201906 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201906, sii=siiBronchodilators201906))




siiBronchodilators201907 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201907"))
coeffs <- coefficients(siiBronchodilators201907)
siiBronchodilators201907 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201907, sii=siiBronchodilators201907))




siiBronchodilators201908 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201908"))
coeffs <- coefficients(siiBronchodilators201908)
siiBronchodilators201908 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201908, sii=siiBronchodilators201908))




siiBronchodilators201909 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201909"))
coeffs <- coefficients(siiBronchodilators201909)
siiBronchodilators201909 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201909, sii=siiBronchodilators201909))




siiBronchodilators201910 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201910"))
coeffs <- coefficients(siiBronchodilators201910)
siiBronchodilators201910 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201910, sii=siiBronchodilators201910))




siiBronchodilators201911 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201911"))
coeffs <- coefficients(siiBronchodilators201911)
siiBronchodilators201911 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201911, sii=siiBronchodilators201911))




siiBronchodilators201912 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Bronchodilators"& PERIOD=="201912"))
coeffs <- coefficients(siiBronchodilators201912)
siiBronchodilators201912 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Bronchodilatorssii <- rbind(Bronchodilatorssii, data.frame(PERIOD=201912, sii=siiBronchodilators201912))

Bronchodilatorssii <- Bronchodilatorssii[order(Bronchodilatorssii$PERIOD),]
Bronchodilatorssii$PERIOD <- factor(Bronchodilatorssii$PERIOD)
Bronchodilatorssii$group <- 1


Bronchodilatorssiiplot <- ggplot(Bronchodilatorssii, aes(x=PERIOD, y=sii, group = group))+
  theme_light()+
  geom_smooth(method="loess", se=FALSE)+
  geom_point()+
  labs(x = "Date", y = "Slope Index of Inequality", title = "Ineqality in Bronchodilators Prescription")+
  scale_x_discrete(breaks=c("201403","201501", "201601", "201701", "201801", "201901"), labels = c("March 2014", "2015", "2016", "2017", "2018", "2019"))
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Bronchodilatorssiiplot.png", plot=Bronchodilatorssiiplot, width=8, height=5, dpi=600)



#####Dementia####

siiDementia201403 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201403"))
coeffs <- coefficients(siiDementia201403)
siiDementia201403 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- data.frame(PERIOD=201403, sii=siiDementia201403)


siiDementia201404 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201404"))
coeffs <- coefficients(siiDementia201404)
siiDementia201404 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201404, sii=siiDementia201404))


siiDementia201405 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201405"))
coeffs <- coefficients(siiDementia201405)
siiDementia201405 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201405, sii=siiDementia201405))


siiDementia201406 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201406"))
coeffs <- coefficients(siiDementia201406)
siiDementia201406 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201406, sii=siiDementia201406))


siiDementia201407 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201407"))
coeffs <- coefficients(siiDementia201407)
siiDementia201407 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201407, sii=siiDementia201407))


siiDementia201408 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201408"))
coeffs <- coefficients(siiDementia201408)
siiDementia201408 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201408, sii=siiDementia201408))


siiDementia201409 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201409"))
coeffs <- coefficients(siiDementia201409)
siiDementia201409 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201409, sii=siiDementia201409))


siiDementia201410 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201410"))
coeffs <- coefficients(siiDementia201410)
siiDementia201410 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201410, sii=siiDementia201410))


siiDementia201411 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201411"))
coeffs <- coefficients(siiDementia201411)
siiDementia201411 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201411, sii=siiDementia201411))


siiDementia201412 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201412"))
coeffs <- coefficients(siiDementia201412)
siiDementia201412 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201412, sii=siiDementia201412))


siiDementia201501 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201501"))
coeffs <- coefficients(siiDementia201501)
siiDementia201501 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201501, sii=siiDementia201501))


siiDementia201502 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201502"))
coeffs <- coefficients(siiDementia201502)
siiDementia201502 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201502, sii=siiDementia201502))


siiDementia201503 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201503"))
coeffs <- coefficients(siiDementia201503)
siiDementia201503 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201503, sii=siiDementia201503))


siiDementia201504 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201504"))
coeffs <- coefficients(siiDementia201504)
siiDementia201504 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201504, sii=siiDementia201504))


siiDementia201505 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201505"))
coeffs <- coefficients(siiDementia201505)
siiDementia201505 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201505, sii=siiDementia201505))


siiDementia201506 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201506"))
coeffs <- coefficients(siiDementia201506)
siiDementia201506 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201506, sii=siiDementia201506))


siiDementia201507 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201507"))
coeffs <- coefficients(siiDementia201507)
siiDementia201507 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201507, sii=siiDementia201507))


siiDementia201508 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201508"))
coeffs <- coefficients(siiDementia201508)
siiDementia201508 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201508, sii=siiDementia201508))


siiDementia201509 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201509"))
coeffs <- coefficients(siiDementia201509)
siiDementia201509 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201509, sii=siiDementia201509))


siiDementia201510 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201510"))
coeffs <- coefficients(siiDementia201510)
siiDementia201510 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201510, sii=siiDementia201510))


siiDementia201511 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201511"))
coeffs <- coefficients(siiDementia201511)
siiDementia201511 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201511, sii=siiDementia201511))


siiDementia201512 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201512"))
coeffs <- coefficients(siiDementia201512)
siiDementia201512 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201512, sii=siiDementia201512))


siiDementia201601 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201601"))
coeffs <- coefficients(siiDementia201601)
siiDementia201601 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201601, sii=siiDementia201601))


siiDementia201602 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201602"))
coeffs <- coefficients(siiDementia201602)
siiDementia201602 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201602, sii=siiDementia201602))


siiDementia201603 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201603"))
coeffs <- coefficients(siiDementia201603)
siiDementia201603 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201603, sii=siiDementia201603))


siiDementia201604 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201604"))
coeffs <- coefficients(siiDementia201604)
siiDementia201604 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201604, sii=siiDementia201604))


siiDementia201605 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201605"))
coeffs <- coefficients(siiDementia201605)
siiDementia201605 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201605, sii=siiDementia201605))


siiDementia201606 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201606"))
coeffs <- coefficients(siiDementia201606)
siiDementia201606 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201606, sii=siiDementia201606))


siiDementia201607 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201607"))
coeffs <- coefficients(siiDementia201607)
siiDementia201607 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201607, sii=siiDementia201607))


siiDementia201608 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201608"))
coeffs <- coefficients(siiDementia201608)
siiDementia201608 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201608, sii=siiDementia201608))


siiDementia201609 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201609"))
coeffs <- coefficients(siiDementia201609)
siiDementia201609 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201609, sii=siiDementia201609))


siiDementia201610 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201610"))
coeffs <- coefficients(siiDementia201610)
siiDementia201610 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201610, sii=siiDementia201610))


siiDementia201611 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201611"))
coeffs <- coefficients(siiDementia201611)
siiDementia201611 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201611, sii=siiDementia201611))


siiDementia201612 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201612"))
coeffs <- coefficients(siiDementia201612)
siiDementia201612 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201612, sii=siiDementia201612))


siiDementia201701 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201701"))
coeffs <- coefficients(siiDementia201701)
siiDementia201701 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201701, sii=siiDementia201701))


siiDementia201702 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201702"))
coeffs <- coefficients(siiDementia201702)
siiDementia201702 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201702, sii=siiDementia201702))


siiDementia201703 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201703"))
coeffs <- coefficients(siiDementia201703)
siiDementia201703 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201703, sii=siiDementia201703))


siiDementia201704 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201704"))
coeffs <- coefficients(siiDementia201704)
siiDementia201704 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201704, sii=siiDementia201704))


siiDementia201705 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201705"))
coeffs <- coefficients(siiDementia201705)
siiDementia201705 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201705, sii=siiDementia201705))


siiDementia201706 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201706"))
coeffs <- coefficients(siiDementia201706)
siiDementia201706 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201706, sii=siiDementia201706))


siiDementia201707 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201707"))
coeffs <- coefficients(siiDementia201707)
siiDementia201707 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201707, sii=siiDementia201707))


siiDementia201708 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201708"))
coeffs <- coefficients(siiDementia201708)
siiDementia201708 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201708, sii=siiDementia201708))


siiDementia201709 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201709"))
coeffs <- coefficients(siiDementia201709)
siiDementia201709 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201709, sii=siiDementia201709))


siiDementia201710 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201710"))
coeffs <- coefficients(siiDementia201710)
siiDementia201710 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201710, sii=siiDementia201710))


siiDementia201711 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201711"))
coeffs <- coefficients(siiDementia201711)
siiDementia201711 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201711, sii=siiDementia201711))


siiDementia201712 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201712"))
coeffs <- coefficients(siiDementia201712)
siiDementia201712 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201712, sii=siiDementia201712))


siiDementia201801 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201801"))
coeffs <- coefficients(siiDementia201801)
siiDementia201801 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201801, sii=siiDementia201801))


siiDementia201802 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201802"))
coeffs <- coefficients(siiDementia201802)
siiDementia201802 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201802, sii=siiDementia201802))


siiDementia201803 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201803"))
coeffs <- coefficients(siiDementia201803)
siiDementia201803 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201803, sii=siiDementia201803))


siiDementia201804 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201804"))
coeffs <- coefficients(siiDementia201804)
siiDementia201804 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201804, sii=siiDementia201804))


siiDementia201805 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201805"))
coeffs <- coefficients(siiDementia201805)
siiDementia201805 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201805, sii=siiDementia201805))


siiDementia201806 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201806"))
coeffs <- coefficients(siiDementia201806)
siiDementia201806 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201806, sii=siiDementia201806))


siiDementia201807 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201807"))
coeffs <- coefficients(siiDementia201807)
siiDementia201807 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201807, sii=siiDementia201807))


siiDementia201808 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201808"))
coeffs <- coefficients(siiDementia201808)
siiDementia201808 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201808, sii=siiDementia201808))




siiDementia201809 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201809"))
coeffs <- coefficients(siiDementia201809)
siiDementia201809 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201809, sii=siiDementia201809))




siiDementia201810 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201810"))
coeffs <- coefficients(siiDementia201810)
siiDementia201810 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201810, sii=siiDementia201810))




siiDementia201811 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201811"))
coeffs <- coefficients(siiDementia201811)
siiDementia201811 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201811, sii=siiDementia201811))




siiDementia201812 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201812"))
coeffs <- coefficients(siiDementia201812)
siiDementia201812 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201812, sii=siiDementia201812))




siiDementia201901 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201901"))
coeffs <- coefficients(siiDementia201901)
siiDementia201901 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201901, sii=siiDementia201901))




siiDementia201902 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201902"))
coeffs <- coefficients(siiDementia201902)
siiDementia201902 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201902, sii=siiDementia201902))




siiDementia201903 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201903"))
coeffs <- coefficients(siiDementia201903)
siiDementia201903 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201903, sii=siiDementia201903))




siiDementia201904 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201904"))
coeffs <- coefficients(siiDementia201904)
siiDementia201904 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201904, sii=siiDementia201904))




siiDementia201905 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201905"))
coeffs <- coefficients(siiDementia201905)
siiDementia201905 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201905, sii=siiDementia201905))




siiDementia201906 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201906"))
coeffs <- coefficients(siiDementia201906)
siiDementia201906 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201906, sii=siiDementia201906))




siiDementia201907 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201907"))
coeffs <- coefficients(siiDementia201907)
siiDementia201907 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201907, sii=siiDementia201907))




siiDementia201908 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201908"))
coeffs <- coefficients(siiDementia201908)
siiDementia201908 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201908, sii=siiDementia201908))




siiDementia201909 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201909"))
coeffs <- coefficients(siiDementia201909)
siiDementia201909 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201909, sii=siiDementia201909))




siiDementia201910 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201910"))
coeffs <- coefficients(siiDementia201910)
siiDementia201910 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201910, sii=siiDementia201910))




siiDementia201911 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201911"))
coeffs <- coefficients(siiDementia201911)
siiDementia201911 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201911, sii=siiDementia201911))




siiDementia201912 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Dementia"& PERIOD=="201912"))
coeffs <- coefficients(siiDementia201912)
siiDementia201912 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Dementiasii <- rbind(Dementiasii, data.frame(PERIOD=201912, sii=siiDementia201912))

Dementiasii <- Dementiasii[order(Dementiasii$PERIOD),]
Dementiasii$PERIOD <- factor(Dementiasii$PERIOD)
Dementiasii$group <- 1


Dementiasiiplot <- ggplot(Dementiasii, aes(x=PERIOD, y=sii, group = group))+
  theme_light()+
  geom_smooth(method="loess", se=FALSE)+
  geom_point()+
  labs(x = "Date", y = "Slope Index of Inequality", title = "Ineqality in Dementia Drug Prescription")+
  scale_x_discrete(breaks=c("201403","201501", "201601", "201701", "201801", "201901"), labels = c("March 2014", "2015", "2016", "2017", "2018", "2019"))
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Dementiasiiplot.png", plot=Dementiasiiplot, width=8, height=5, dpi=600)



#####Diabetes####

siiDiabetes201403 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201403"))
coeffs <- coefficients(siiDiabetes201403)
siiDiabetes201403 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- data.frame(PERIOD=201403, sii=siiDiabetes201403)


siiDiabetes201404 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201404"))
coeffs <- coefficients(siiDiabetes201404)
siiDiabetes201404 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201404, sii=siiDiabetes201404))


siiDiabetes201405 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201405"))
coeffs <- coefficients(siiDiabetes201405)
siiDiabetes201405 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201405, sii=siiDiabetes201405))


siiDiabetes201406 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201406"))
coeffs <- coefficients(siiDiabetes201406)
siiDiabetes201406 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201406, sii=siiDiabetes201406))


siiDiabetes201407 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201407"))
coeffs <- coefficients(siiDiabetes201407)
siiDiabetes201407 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201407, sii=siiDiabetes201407))


siiDiabetes201408 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201408"))
coeffs <- coefficients(siiDiabetes201408)
siiDiabetes201408 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201408, sii=siiDiabetes201408))


siiDiabetes201409 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201409"))
coeffs <- coefficients(siiDiabetes201409)
siiDiabetes201409 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201409, sii=siiDiabetes201409))


siiDiabetes201410 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201410"))
coeffs <- coefficients(siiDiabetes201410)
siiDiabetes201410 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201410, sii=siiDiabetes201410))


siiDiabetes201411 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201411"))
coeffs <- coefficients(siiDiabetes201411)
siiDiabetes201411 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201411, sii=siiDiabetes201411))


siiDiabetes201412 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201412"))
coeffs <- coefficients(siiDiabetes201412)
siiDiabetes201412 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201412, sii=siiDiabetes201412))


siiDiabetes201501 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201501"))
coeffs <- coefficients(siiDiabetes201501)
siiDiabetes201501 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201501, sii=siiDiabetes201501))


siiDiabetes201502 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201502"))
coeffs <- coefficients(siiDiabetes201502)
siiDiabetes201502 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201502, sii=siiDiabetes201502))


siiDiabetes201503 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201503"))
coeffs <- coefficients(siiDiabetes201503)
siiDiabetes201503 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201503, sii=siiDiabetes201503))


siiDiabetes201504 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201504"))
coeffs <- coefficients(siiDiabetes201504)
siiDiabetes201504 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201504, sii=siiDiabetes201504))


siiDiabetes201505 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201505"))
coeffs <- coefficients(siiDiabetes201505)
siiDiabetes201505 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201505, sii=siiDiabetes201505))


siiDiabetes201506 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201506"))
coeffs <- coefficients(siiDiabetes201506)
siiDiabetes201506 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201506, sii=siiDiabetes201506))


siiDiabetes201507 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201507"))
coeffs <- coefficients(siiDiabetes201507)
siiDiabetes201507 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201507, sii=siiDiabetes201507))


siiDiabetes201508 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201508"))
coeffs <- coefficients(siiDiabetes201508)
siiDiabetes201508 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201508, sii=siiDiabetes201508))


siiDiabetes201509 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201509"))
coeffs <- coefficients(siiDiabetes201509)
siiDiabetes201509 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201509, sii=siiDiabetes201509))


siiDiabetes201510 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201510"))
coeffs <- coefficients(siiDiabetes201510)
siiDiabetes201510 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201510, sii=siiDiabetes201510))


siiDiabetes201511 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201511"))
coeffs <- coefficients(siiDiabetes201511)
siiDiabetes201511 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201511, sii=siiDiabetes201511))


siiDiabetes201512 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201512"))
coeffs <- coefficients(siiDiabetes201512)
siiDiabetes201512 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201512, sii=siiDiabetes201512))


siiDiabetes201601 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201601"))
coeffs <- coefficients(siiDiabetes201601)
siiDiabetes201601 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201601, sii=siiDiabetes201601))


siiDiabetes201602 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201602"))
coeffs <- coefficients(siiDiabetes201602)
siiDiabetes201602 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201602, sii=siiDiabetes201602))


siiDiabetes201603 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201603"))
coeffs <- coefficients(siiDiabetes201603)
siiDiabetes201603 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201603, sii=siiDiabetes201603))


siiDiabetes201604 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201604"))
coeffs <- coefficients(siiDiabetes201604)
siiDiabetes201604 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201604, sii=siiDiabetes201604))


siiDiabetes201605 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201605"))
coeffs <- coefficients(siiDiabetes201605)
siiDiabetes201605 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201605, sii=siiDiabetes201605))


siiDiabetes201606 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201606"))
coeffs <- coefficients(siiDiabetes201606)
siiDiabetes201606 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201606, sii=siiDiabetes201606))


siiDiabetes201607 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201607"))
coeffs <- coefficients(siiDiabetes201607)
siiDiabetes201607 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201607, sii=siiDiabetes201607))


siiDiabetes201608 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201608"))
coeffs <- coefficients(siiDiabetes201608)
siiDiabetes201608 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201608, sii=siiDiabetes201608))


siiDiabetes201609 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201609"))
coeffs <- coefficients(siiDiabetes201609)
siiDiabetes201609 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201609, sii=siiDiabetes201609))


siiDiabetes201610 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201610"))
coeffs <- coefficients(siiDiabetes201610)
siiDiabetes201610 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201610, sii=siiDiabetes201610))


siiDiabetes201611 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201611"))
coeffs <- coefficients(siiDiabetes201611)
siiDiabetes201611 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201611, sii=siiDiabetes201611))


siiDiabetes201612 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201612"))
coeffs <- coefficients(siiDiabetes201612)
siiDiabetes201612 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201612, sii=siiDiabetes201612))


siiDiabetes201701 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201701"))
coeffs <- coefficients(siiDiabetes201701)
siiDiabetes201701 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201701, sii=siiDiabetes201701))


siiDiabetes201702 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201702"))
coeffs <- coefficients(siiDiabetes201702)
siiDiabetes201702 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201702, sii=siiDiabetes201702))


siiDiabetes201703 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201703"))
coeffs <- coefficients(siiDiabetes201703)
siiDiabetes201703 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201703, sii=siiDiabetes201703))


siiDiabetes201704 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201704"))
coeffs <- coefficients(siiDiabetes201704)
siiDiabetes201704 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201704, sii=siiDiabetes201704))


siiDiabetes201705 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201705"))
coeffs <- coefficients(siiDiabetes201705)
siiDiabetes201705 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201705, sii=siiDiabetes201705))


siiDiabetes201706 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201706"))
coeffs <- coefficients(siiDiabetes201706)
siiDiabetes201706 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201706, sii=siiDiabetes201706))


siiDiabetes201707 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201707"))
coeffs <- coefficients(siiDiabetes201707)
siiDiabetes201707 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201707, sii=siiDiabetes201707))


siiDiabetes201708 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201708"))
coeffs <- coefficients(siiDiabetes201708)
siiDiabetes201708 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201708, sii=siiDiabetes201708))


siiDiabetes201709 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201709"))
coeffs <- coefficients(siiDiabetes201709)
siiDiabetes201709 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201709, sii=siiDiabetes201709))


siiDiabetes201710 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201710"))
coeffs <- coefficients(siiDiabetes201710)
siiDiabetes201710 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201710, sii=siiDiabetes201710))


siiDiabetes201711 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201711"))
coeffs <- coefficients(siiDiabetes201711)
siiDiabetes201711 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201711, sii=siiDiabetes201711))


siiDiabetes201712 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201712"))
coeffs <- coefficients(siiDiabetes201712)
siiDiabetes201712 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201712, sii=siiDiabetes201712))


siiDiabetes201801 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201801"))
coeffs <- coefficients(siiDiabetes201801)
siiDiabetes201801 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201801, sii=siiDiabetes201801))


siiDiabetes201802 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201802"))
coeffs <- coefficients(siiDiabetes201802)
siiDiabetes201802 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201802, sii=siiDiabetes201802))


siiDiabetes201803 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201803"))
coeffs <- coefficients(siiDiabetes201803)
siiDiabetes201803 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201803, sii=siiDiabetes201803))


siiDiabetes201804 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201804"))
coeffs <- coefficients(siiDiabetes201804)
siiDiabetes201804 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201804, sii=siiDiabetes201804))


siiDiabetes201805 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201805"))
coeffs <- coefficients(siiDiabetes201805)
siiDiabetes201805 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201805, sii=siiDiabetes201805))


siiDiabetes201806 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201806"))
coeffs <- coefficients(siiDiabetes201806)
siiDiabetes201806 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201806, sii=siiDiabetes201806))


siiDiabetes201807 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201807"))
coeffs <- coefficients(siiDiabetes201807)
siiDiabetes201807 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201807, sii=siiDiabetes201807))


siiDiabetes201808 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201808"))
coeffs <- coefficients(siiDiabetes201808)
siiDiabetes201808 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201808, sii=siiDiabetes201808))




siiDiabetes201809 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201809"))
coeffs <- coefficients(siiDiabetes201809)
siiDiabetes201809 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201809, sii=siiDiabetes201809))




siiDiabetes201810 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201810"))
coeffs <- coefficients(siiDiabetes201810)
siiDiabetes201810 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201810, sii=siiDiabetes201810))




siiDiabetes201811 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201811"))
coeffs <- coefficients(siiDiabetes201811)
siiDiabetes201811 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201811, sii=siiDiabetes201811))




siiDiabetes201812 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201812"))
coeffs <- coefficients(siiDiabetes201812)
siiDiabetes201812 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201812, sii=siiDiabetes201812))




siiDiabetes201901 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201901"))
coeffs <- coefficients(siiDiabetes201901)
siiDiabetes201901 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201901, sii=siiDiabetes201901))




siiDiabetes201902 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201902"))
coeffs <- coefficients(siiDiabetes201902)
siiDiabetes201902 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201902, sii=siiDiabetes201902))




siiDiabetes201903 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201903"))
coeffs <- coefficients(siiDiabetes201903)
siiDiabetes201903 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201903, sii=siiDiabetes201903))




siiDiabetes201904 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201904"))
coeffs <- coefficients(siiDiabetes201904)
siiDiabetes201904 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201904, sii=siiDiabetes201904))




siiDiabetes201905 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201905"))
coeffs <- coefficients(siiDiabetes201905)
siiDiabetes201905 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201905, sii=siiDiabetes201905))




siiDiabetes201906 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201906"))
coeffs <- coefficients(siiDiabetes201906)
siiDiabetes201906 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201906, sii=siiDiabetes201906))




siiDiabetes201907 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201907"))
coeffs <- coefficients(siiDiabetes201907)
siiDiabetes201907 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201907, sii=siiDiabetes201907))




siiDiabetes201908 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201908"))
coeffs <- coefficients(siiDiabetes201908)
siiDiabetes201908 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201908, sii=siiDiabetes201908))




siiDiabetes201909 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201909"))
coeffs <- coefficients(siiDiabetes201909)
siiDiabetes201909 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201909, sii=siiDiabetes201909))




siiDiabetes201910 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201910"))
coeffs <- coefficients(siiDiabetes201910)
siiDiabetes201910 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201910, sii=siiDiabetes201910))




siiDiabetes201911 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201911"))
coeffs <- coefficients(siiDiabetes201911)
siiDiabetes201911 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201911, sii=siiDiabetes201911))




siiDiabetes201912 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Diabetes"& PERIOD=="201912"))
coeffs <- coefficients(siiDiabetes201912)
siiDiabetes201912 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Diabetessii <- rbind(Diabetessii, data.frame(PERIOD=201912, sii=siiDiabetes201912))

Diabetessii <- Diabetessii[order(Diabetessii$PERIOD),]
Diabetessii$PERIOD <- factor(Diabetessii$PERIOD)
Diabetessii$group <- 1


Diabetessiiplot <- ggplot(Diabetessii, aes(x=PERIOD, y=sii, group = group))+
  theme_light()+
  geom_smooth(method="loess", se=FALSE)+
  geom_point()+
  labs(x = "Date", y = "Slope Index of Inequality", title = "Ineqality in Diabetes Drug Prescription")+
  scale_x_discrete(breaks=c("201403","201501", "201601", "201701", "201801", "201901"), labels = c("March 2014", "2015", "2016", "2017", "2018", "2019"))
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Diabetessiiplot.png", plot=Diabetessiiplot, width=8, height=5, dpi=600)




#####Nicotine####

siiNicotine201403 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201403"))
coeffs <- coefficients(siiNicotine201403)
siiNicotine201403 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- data.frame(PERIOD=201403, sii=siiNicotine201403)


siiNicotine201404 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201404"))
coeffs <- coefficients(siiNicotine201404)
siiNicotine201404 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201404, sii=siiNicotine201404))


siiNicotine201405 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201405"))
coeffs <- coefficients(siiNicotine201405)
siiNicotine201405 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201405, sii=siiNicotine201405))


siiNicotine201406 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201406"))
coeffs <- coefficients(siiNicotine201406)
siiNicotine201406 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201406, sii=siiNicotine201406))


siiNicotine201407 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201407"))
coeffs <- coefficients(siiNicotine201407)
siiNicotine201407 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201407, sii=siiNicotine201407))


siiNicotine201408 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201408"))
coeffs <- coefficients(siiNicotine201408)
siiNicotine201408 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201408, sii=siiNicotine201408))


siiNicotine201409 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201409"))
coeffs <- coefficients(siiNicotine201409)
siiNicotine201409 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201409, sii=siiNicotine201409))


siiNicotine201410 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201410"))
coeffs <- coefficients(siiNicotine201410)
siiNicotine201410 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201410, sii=siiNicotine201410))


siiNicotine201411 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201411"))
coeffs <- coefficients(siiNicotine201411)
siiNicotine201411 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201411, sii=siiNicotine201411))


siiNicotine201412 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201412"))
coeffs <- coefficients(siiNicotine201412)
siiNicotine201412 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201412, sii=siiNicotine201412))


siiNicotine201501 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201501"))
coeffs <- coefficients(siiNicotine201501)
siiNicotine201501 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201501, sii=siiNicotine201501))


siiNicotine201502 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201502"))
coeffs <- coefficients(siiNicotine201502)
siiNicotine201502 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201502, sii=siiNicotine201502))


siiNicotine201503 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201503"))
coeffs <- coefficients(siiNicotine201503)
siiNicotine201503 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201503, sii=siiNicotine201503))


siiNicotine201504 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201504"))
coeffs <- coefficients(siiNicotine201504)
siiNicotine201504 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201504, sii=siiNicotine201504))


siiNicotine201505 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201505"))
coeffs <- coefficients(siiNicotine201505)
siiNicotine201505 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201505, sii=siiNicotine201505))


siiNicotine201506 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201506"))
coeffs <- coefficients(siiNicotine201506)
siiNicotine201506 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201506, sii=siiNicotine201506))


siiNicotine201507 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201507"))
coeffs <- coefficients(siiNicotine201507)
siiNicotine201507 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201507, sii=siiNicotine201507))


siiNicotine201508 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201508"))
coeffs <- coefficients(siiNicotine201508)
siiNicotine201508 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201508, sii=siiNicotine201508))


siiNicotine201509 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201509"))
coeffs <- coefficients(siiNicotine201509)
siiNicotine201509 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201509, sii=siiNicotine201509))


siiNicotine201510 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201510"))
coeffs <- coefficients(siiNicotine201510)
siiNicotine201510 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201510, sii=siiNicotine201510))


siiNicotine201511 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201511"))
coeffs <- coefficients(siiNicotine201511)
siiNicotine201511 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201511, sii=siiNicotine201511))


siiNicotine201512 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201512"))
coeffs <- coefficients(siiNicotine201512)
siiNicotine201512 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201512, sii=siiNicotine201512))


siiNicotine201601 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201601"))
coeffs <- coefficients(siiNicotine201601)
siiNicotine201601 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201601, sii=siiNicotine201601))


siiNicotine201602 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201602"))
coeffs <- coefficients(siiNicotine201602)
siiNicotine201602 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201602, sii=siiNicotine201602))


siiNicotine201603 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201603"))
coeffs <- coefficients(siiNicotine201603)
siiNicotine201603 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201603, sii=siiNicotine201603))


siiNicotine201604 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201604"))
coeffs <- coefficients(siiNicotine201604)
siiNicotine201604 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201604, sii=siiNicotine201604))


siiNicotine201605 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201605"))
coeffs <- coefficients(siiNicotine201605)
siiNicotine201605 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201605, sii=siiNicotine201605))


siiNicotine201606 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201606"))
coeffs <- coefficients(siiNicotine201606)
siiNicotine201606 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201606, sii=siiNicotine201606))


siiNicotine201607 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201607"))
coeffs <- coefficients(siiNicotine201607)
siiNicotine201607 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201607, sii=siiNicotine201607))


siiNicotine201608 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201608"))
coeffs <- coefficients(siiNicotine201608)
siiNicotine201608 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201608, sii=siiNicotine201608))


siiNicotine201609 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201609"))
coeffs <- coefficients(siiNicotine201609)
siiNicotine201609 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201609, sii=siiNicotine201609))


siiNicotine201610 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201610"))
coeffs <- coefficients(siiNicotine201610)
siiNicotine201610 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201610, sii=siiNicotine201610))


siiNicotine201611 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201611"))
coeffs <- coefficients(siiNicotine201611)
siiNicotine201611 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201611, sii=siiNicotine201611))


siiNicotine201612 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201612"))
coeffs <- coefficients(siiNicotine201612)
siiNicotine201612 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201612, sii=siiNicotine201612))


siiNicotine201701 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201701"))
coeffs <- coefficients(siiNicotine201701)
siiNicotine201701 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201701, sii=siiNicotine201701))


siiNicotine201702 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201702"))
coeffs <- coefficients(siiNicotine201702)
siiNicotine201702 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201702, sii=siiNicotine201702))


siiNicotine201703 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201703"))
coeffs <- coefficients(siiNicotine201703)
siiNicotine201703 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201703, sii=siiNicotine201703))


siiNicotine201704 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201704"))
coeffs <- coefficients(siiNicotine201704)
siiNicotine201704 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201704, sii=siiNicotine201704))


siiNicotine201705 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201705"))
coeffs <- coefficients(siiNicotine201705)
siiNicotine201705 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201705, sii=siiNicotine201705))


siiNicotine201706 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201706"))
coeffs <- coefficients(siiNicotine201706)
siiNicotine201706 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201706, sii=siiNicotine201706))


siiNicotine201707 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201707"))
coeffs <- coefficients(siiNicotine201707)
siiNicotine201707 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201707, sii=siiNicotine201707))


siiNicotine201708 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201708"))
coeffs <- coefficients(siiNicotine201708)
siiNicotine201708 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201708, sii=siiNicotine201708))


siiNicotine201709 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201709"))
coeffs <- coefficients(siiNicotine201709)
siiNicotine201709 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201709, sii=siiNicotine201709))


siiNicotine201710 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201710"))
coeffs <- coefficients(siiNicotine201710)
siiNicotine201710 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201710, sii=siiNicotine201710))


siiNicotine201711 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201711"))
coeffs <- coefficients(siiNicotine201711)
siiNicotine201711 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201711, sii=siiNicotine201711))


siiNicotine201712 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201712"))
coeffs <- coefficients(siiNicotine201712)
siiNicotine201712 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201712, sii=siiNicotine201712))


siiNicotine201801 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201801"))
coeffs <- coefficients(siiNicotine201801)
siiNicotine201801 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201801, sii=siiNicotine201801))


siiNicotine201802 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201802"))
coeffs <- coefficients(siiNicotine201802)
siiNicotine201802 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201802, sii=siiNicotine201802))


siiNicotine201803 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201803"))
coeffs <- coefficients(siiNicotine201803)
siiNicotine201803 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201803, sii=siiNicotine201803))


siiNicotine201804 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201804"))
coeffs <- coefficients(siiNicotine201804)
siiNicotine201804 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201804, sii=siiNicotine201804))


siiNicotine201805 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201805"))
coeffs <- coefficients(siiNicotine201805)
siiNicotine201805 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201805, sii=siiNicotine201805))


siiNicotine201806 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201806"))
coeffs <- coefficients(siiNicotine201806)
siiNicotine201806 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201806, sii=siiNicotine201806))


siiNicotine201807 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201807"))
coeffs <- coefficients(siiNicotine201807)
siiNicotine201807 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201807, sii=siiNicotine201807))


siiNicotine201808 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201808"))
coeffs <- coefficients(siiNicotine201808)
siiNicotine201808 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201808, sii=siiNicotine201808))




siiNicotine201809 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201809"))
coeffs <- coefficients(siiNicotine201809)
siiNicotine201809 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201809, sii=siiNicotine201809))




siiNicotine201810 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201810"))
coeffs <- coefficients(siiNicotine201810)
siiNicotine201810 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201810, sii=siiNicotine201810))




siiNicotine201811 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201811"))
coeffs <- coefficients(siiNicotine201811)
siiNicotine201811 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201811, sii=siiNicotine201811))




siiNicotine201812 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201812"))
coeffs <- coefficients(siiNicotine201812)
siiNicotine201812 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201812, sii=siiNicotine201812))




siiNicotine201901 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201901"))
coeffs <- coefficients(siiNicotine201901)
siiNicotine201901 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201901, sii=siiNicotine201901))




siiNicotine201902 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201902"))
coeffs <- coefficients(siiNicotine201902)
siiNicotine201902 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201902, sii=siiNicotine201902))




siiNicotine201903 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201903"))
coeffs <- coefficients(siiNicotine201903)
siiNicotine201903 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201903, sii=siiNicotine201903))




siiNicotine201904 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201904"))
coeffs <- coefficients(siiNicotine201904)
siiNicotine201904 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201904, sii=siiNicotine201904))




siiNicotine201905 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201905"))
coeffs <- coefficients(siiNicotine201905)
siiNicotine201905 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201905, sii=siiNicotine201905))




siiNicotine201906 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201906"))
coeffs <- coefficients(siiNicotine201906)
siiNicotine201906 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201906, sii=siiNicotine201906))




siiNicotine201907 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201907"))
coeffs <- coefficients(siiNicotine201907)
siiNicotine201907 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201907, sii=siiNicotine201907))




siiNicotine201908 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201908"))
coeffs <- coefficients(siiNicotine201908)
siiNicotine201908 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201908, sii=siiNicotine201908))




siiNicotine201909 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201909"))
coeffs <- coefficients(siiNicotine201909)
siiNicotine201909 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201909, sii=siiNicotine201909))




siiNicotine201910 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201910"))
coeffs <- coefficients(siiNicotine201910)
siiNicotine201910 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201910, sii=siiNicotine201910))




siiNicotine201911 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201911"))
coeffs <- coefficients(siiNicotine201911)
siiNicotine201911 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201911, sii=siiNicotine201911))




siiNicotine201912 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Nicotine"& PERIOD=="201912"))
coeffs <- coefficients(siiNicotine201912)
siiNicotine201912 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Nicotinesii <- rbind(Nicotinesii, data.frame(PERIOD=201912, sii=siiNicotine201912))

Nicotinesii <- Nicotinesii[order(Nicotinesii$PERIOD),]
Nicotinesii$PERIOD <- factor(Nicotinesii$PERIOD)
Nicotinesii$group <- 1


Nicotinesiiplot <- ggplot(Nicotinesii, aes(x=PERIOD, y=sii, group = group))+
  theme_light()+
  geom_smooth(method="loess", se=FALSE)+
  geom_point()+
  labs(x = "Date", y = "Slope Index of Inequality", title = "Ineqality in Nicotine-addiction Drug Prescription")+
  scale_x_discrete(breaks=c("201403","201501", "201601", "201701", "201801", "201901"), labels = c("March 2014", "2015", "2016", "2017", "2018", "2019"))
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Nicotinesiiplot.png", plot=Nicotinesiiplot, width=8, height=5, dpi=600)







#####Opiod####

siiOpiod201403 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201403"))
coeffs <- coefficients(siiOpiod201403)
siiOpiod201403 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- data.frame(PERIOD=201403, sii=siiOpiod201403)


siiOpiod201404 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201404"))
coeffs <- coefficients(siiOpiod201404)
siiOpiod201404 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201404, sii=siiOpiod201404))


siiOpiod201405 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201405"))
coeffs <- coefficients(siiOpiod201405)
siiOpiod201405 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201405, sii=siiOpiod201405))


siiOpiod201406 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201406"))
coeffs <- coefficients(siiOpiod201406)
siiOpiod201406 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201406, sii=siiOpiod201406))


siiOpiod201407 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201407"))
coeffs <- coefficients(siiOpiod201407)
siiOpiod201407 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201407, sii=siiOpiod201407))


siiOpiod201408 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201408"))
coeffs <- coefficients(siiOpiod201408)
siiOpiod201408 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201408, sii=siiOpiod201408))


siiOpiod201409 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201409"))
coeffs <- coefficients(siiOpiod201409)
siiOpiod201409 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201409, sii=siiOpiod201409))


siiOpiod201410 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201410"))
coeffs <- coefficients(siiOpiod201410)
siiOpiod201410 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201410, sii=siiOpiod201410))


siiOpiod201411 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201411"))
coeffs <- coefficients(siiOpiod201411)
siiOpiod201411 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201411, sii=siiOpiod201411))


siiOpiod201412 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201412"))
coeffs <- coefficients(siiOpiod201412)
siiOpiod201412 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201412, sii=siiOpiod201412))


siiOpiod201501 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201501"))
coeffs <- coefficients(siiOpiod201501)
siiOpiod201501 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201501, sii=siiOpiod201501))


siiOpiod201502 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201502"))
coeffs <- coefficients(siiOpiod201502)
siiOpiod201502 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201502, sii=siiOpiod201502))


siiOpiod201503 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201503"))
coeffs <- coefficients(siiOpiod201503)
siiOpiod201503 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201503, sii=siiOpiod201503))


siiOpiod201504 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201504"))
coeffs <- coefficients(siiOpiod201504)
siiOpiod201504 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201504, sii=siiOpiod201504))


siiOpiod201505 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201505"))
coeffs <- coefficients(siiOpiod201505)
siiOpiod201505 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201505, sii=siiOpiod201505))


siiOpiod201506 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201506"))
coeffs <- coefficients(siiOpiod201506)
siiOpiod201506 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201506, sii=siiOpiod201506))


siiOpiod201507 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201507"))
coeffs <- coefficients(siiOpiod201507)
siiOpiod201507 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201507, sii=siiOpiod201507))


siiOpiod201508 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201508"))
coeffs <- coefficients(siiOpiod201508)
siiOpiod201508 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201508, sii=siiOpiod201508))


siiOpiod201509 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201509"))
coeffs <- coefficients(siiOpiod201509)
siiOpiod201509 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201509, sii=siiOpiod201509))


siiOpiod201510 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201510"))
coeffs <- coefficients(siiOpiod201510)
siiOpiod201510 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201510, sii=siiOpiod201510))


siiOpiod201511 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201511"))
coeffs <- coefficients(siiOpiod201511)
siiOpiod201511 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201511, sii=siiOpiod201511))


siiOpiod201512 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201512"))
coeffs <- coefficients(siiOpiod201512)
siiOpiod201512 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201512, sii=siiOpiod201512))


siiOpiod201601 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201601"))
coeffs <- coefficients(siiOpiod201601)
siiOpiod201601 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201601, sii=siiOpiod201601))


siiOpiod201602 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201602"))
coeffs <- coefficients(siiOpiod201602)
siiOpiod201602 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201602, sii=siiOpiod201602))


siiOpiod201603 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201603"))
coeffs <- coefficients(siiOpiod201603)
siiOpiod201603 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201603, sii=siiOpiod201603))


siiOpiod201604 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201604"))
coeffs <- coefficients(siiOpiod201604)
siiOpiod201604 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201604, sii=siiOpiod201604))


siiOpiod201605 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201605"))
coeffs <- coefficients(siiOpiod201605)
siiOpiod201605 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201605, sii=siiOpiod201605))


siiOpiod201606 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201606"))
coeffs <- coefficients(siiOpiod201606)
siiOpiod201606 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201606, sii=siiOpiod201606))


siiOpiod201607 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201607"))
coeffs <- coefficients(siiOpiod201607)
siiOpiod201607 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201607, sii=siiOpiod201607))


siiOpiod201608 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201608"))
coeffs <- coefficients(siiOpiod201608)
siiOpiod201608 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201608, sii=siiOpiod201608))


siiOpiod201609 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201609"))
coeffs <- coefficients(siiOpiod201609)
siiOpiod201609 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201609, sii=siiOpiod201609))


siiOpiod201610 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201610"))
coeffs <- coefficients(siiOpiod201610)
siiOpiod201610 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201610, sii=siiOpiod201610))


siiOpiod201611 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201611"))
coeffs <- coefficients(siiOpiod201611)
siiOpiod201611 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201611, sii=siiOpiod201611))


siiOpiod201612 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201612"))
coeffs <- coefficients(siiOpiod201612)
siiOpiod201612 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201612, sii=siiOpiod201612))


siiOpiod201701 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201701"))
coeffs <- coefficients(siiOpiod201701)
siiOpiod201701 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201701, sii=siiOpiod201701))


siiOpiod201702 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201702"))
coeffs <- coefficients(siiOpiod201702)
siiOpiod201702 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201702, sii=siiOpiod201702))


siiOpiod201703 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201703"))
coeffs <- coefficients(siiOpiod201703)
siiOpiod201703 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201703, sii=siiOpiod201703))


siiOpiod201704 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201704"))
coeffs <- coefficients(siiOpiod201704)
siiOpiod201704 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201704, sii=siiOpiod201704))


siiOpiod201705 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201705"))
coeffs <- coefficients(siiOpiod201705)
siiOpiod201705 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201705, sii=siiOpiod201705))


siiOpiod201706 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201706"))
coeffs <- coefficients(siiOpiod201706)
siiOpiod201706 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201706, sii=siiOpiod201706))


siiOpiod201707 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201707"))
coeffs <- coefficients(siiOpiod201707)
siiOpiod201707 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201707, sii=siiOpiod201707))


siiOpiod201708 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201708"))
coeffs <- coefficients(siiOpiod201708)
siiOpiod201708 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201708, sii=siiOpiod201708))


siiOpiod201709 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201709"))
coeffs <- coefficients(siiOpiod201709)
siiOpiod201709 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201709, sii=siiOpiod201709))


siiOpiod201710 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201710"))
coeffs <- coefficients(siiOpiod201710)
siiOpiod201710 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201710, sii=siiOpiod201710))


siiOpiod201711 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201711"))
coeffs <- coefficients(siiOpiod201711)
siiOpiod201711 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201711, sii=siiOpiod201711))


siiOpiod201712 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201712"))
coeffs <- coefficients(siiOpiod201712)
siiOpiod201712 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201712, sii=siiOpiod201712))


siiOpiod201801 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201801"))
coeffs <- coefficients(siiOpiod201801)
siiOpiod201801 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201801, sii=siiOpiod201801))


siiOpiod201802 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201802"))
coeffs <- coefficients(siiOpiod201802)
siiOpiod201802 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201802, sii=siiOpiod201802))


siiOpiod201803 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201803"))
coeffs <- coefficients(siiOpiod201803)
siiOpiod201803 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201803, sii=siiOpiod201803))


siiOpiod201804 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201804"))
coeffs <- coefficients(siiOpiod201804)
siiOpiod201804 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201804, sii=siiOpiod201804))


siiOpiod201805 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201805"))
coeffs <- coefficients(siiOpiod201805)
siiOpiod201805 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201805, sii=siiOpiod201805))


siiOpiod201806 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201806"))
coeffs <- coefficients(siiOpiod201806)
siiOpiod201806 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201806, sii=siiOpiod201806))


siiOpiod201807 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201807"))
coeffs <- coefficients(siiOpiod201807)
siiOpiod201807 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201807, sii=siiOpiod201807))


siiOpiod201808 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201808"))
coeffs <- coefficients(siiOpiod201808)
siiOpiod201808 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201808, sii=siiOpiod201808))




siiOpiod201809 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201809"))
coeffs <- coefficients(siiOpiod201809)
siiOpiod201809 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201809, sii=siiOpiod201809))




siiOpiod201810 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201810"))
coeffs <- coefficients(siiOpiod201810)
siiOpiod201810 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201810, sii=siiOpiod201810))




siiOpiod201811 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201811"))
coeffs <- coefficients(siiOpiod201811)
siiOpiod201811 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201811, sii=siiOpiod201811))




siiOpiod201812 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201812"))
coeffs <- coefficients(siiOpiod201812)
siiOpiod201812 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201812, sii=siiOpiod201812))




siiOpiod201901 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201901"))
coeffs <- coefficients(siiOpiod201901)
siiOpiod201901 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201901, sii=siiOpiod201901))




siiOpiod201902 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201902"))
coeffs <- coefficients(siiOpiod201902)
siiOpiod201902 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201902, sii=siiOpiod201902))




siiOpiod201903 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201903"))
coeffs <- coefficients(siiOpiod201903)
siiOpiod201903 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201903, sii=siiOpiod201903))




siiOpiod201904 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201904"))
coeffs <- coefficients(siiOpiod201904)
siiOpiod201904 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201904, sii=siiOpiod201904))




siiOpiod201905 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201905"))
coeffs <- coefficients(siiOpiod201905)
siiOpiod201905 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201905, sii=siiOpiod201905))




siiOpiod201906 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201906"))
coeffs <- coefficients(siiOpiod201906)
siiOpiod201906 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201906, sii=siiOpiod201906))




siiOpiod201907 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201907"))
coeffs <- coefficients(siiOpiod201907)
siiOpiod201907 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201907, sii=siiOpiod201907))




siiOpiod201908 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201908"))
coeffs <- coefficients(siiOpiod201908)
siiOpiod201908 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201908, sii=siiOpiod201908))




siiOpiod201909 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201909"))
coeffs <- coefficients(siiOpiod201909)
siiOpiod201909 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201909, sii=siiOpiod201909))




siiOpiod201910 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201910"))
coeffs <- coefficients(siiOpiod201910)
siiOpiod201910 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201910, sii=siiOpiod201910))




siiOpiod201911 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201911"))
coeffs <- coefficients(siiOpiod201911)
siiOpiod201911 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201911, sii=siiOpiod201911))




siiOpiod201912 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Opiod"& PERIOD=="201912"))
coeffs <- coefficients(siiOpiod201912)
siiOpiod201912 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Opiodsii <- rbind(Opiodsii, data.frame(PERIOD=201912, sii=siiOpiod201912))

Opiodsii <- Opiodsii[order(Opiodsii$PERIOD),]
Opiodsii$PERIOD <- factor(Opiodsii$PERIOD)
Opiodsii$group <- 1


Opiodsiiplot <- ggplot(Opiodsii, aes(x=PERIOD, y=sii, group = group))+
  theme_light()+
  geom_smooth(method="loess", se=FALSE)+
  geom_point()+
  labs(x = "Date", y = "Slope Index of Inequality", title = "Ineqality in Opiod-addiction Drug Prescription")+
  scale_x_discrete(breaks=c("201403","201501", "201601", "201701", "201801", "201901"), labels = c("March 2014", "2015", "2016", "2017", "2018", "2019"))
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Opiodsiiplot.png", plot=Opiodsiiplot, width=8, height=5, dpi=600)



#####Obesity####

siiObesity201403 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201403"))
coeffs <- coefficients(siiObesity201403)
siiObesity201403 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- data.frame(PERIOD=201403, sii=siiObesity201403)


siiObesity201404 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201404"))
coeffs <- coefficients(siiObesity201404)
siiObesity201404 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201404, sii=siiObesity201404))


siiObesity201405 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201405"))
coeffs <- coefficients(siiObesity201405)
siiObesity201405 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201405, sii=siiObesity201405))


siiObesity201406 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201406"))
coeffs <- coefficients(siiObesity201406)
siiObesity201406 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201406, sii=siiObesity201406))


siiObesity201407 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201407"))
coeffs <- coefficients(siiObesity201407)
siiObesity201407 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201407, sii=siiObesity201407))


siiObesity201408 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201408"))
coeffs <- coefficients(siiObesity201408)
siiObesity201408 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201408, sii=siiObesity201408))


siiObesity201409 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201409"))
coeffs <- coefficients(siiObesity201409)
siiObesity201409 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201409, sii=siiObesity201409))


siiObesity201410 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201410"))
coeffs <- coefficients(siiObesity201410)
siiObesity201410 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201410, sii=siiObesity201410))


siiObesity201411 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201411"))
coeffs <- coefficients(siiObesity201411)
siiObesity201411 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201411, sii=siiObesity201411))


siiObesity201412 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201412"))
coeffs <- coefficients(siiObesity201412)
siiObesity201412 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201412, sii=siiObesity201412))


siiObesity201501 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201501"))
coeffs <- coefficients(siiObesity201501)
siiObesity201501 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201501, sii=siiObesity201501))


siiObesity201502 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201502"))
coeffs <- coefficients(siiObesity201502)
siiObesity201502 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201502, sii=siiObesity201502))


siiObesity201503 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201503"))
coeffs <- coefficients(siiObesity201503)
siiObesity201503 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201503, sii=siiObesity201503))


siiObesity201504 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201504"))
coeffs <- coefficients(siiObesity201504)
siiObesity201504 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201504, sii=siiObesity201504))


siiObesity201505 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201505"))
coeffs <- coefficients(siiObesity201505)
siiObesity201505 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201505, sii=siiObesity201505))


siiObesity201506 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201506"))
coeffs <- coefficients(siiObesity201506)
siiObesity201506 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201506, sii=siiObesity201506))


siiObesity201507 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201507"))
coeffs <- coefficients(siiObesity201507)
siiObesity201507 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201507, sii=siiObesity201507))


siiObesity201508 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201508"))
coeffs <- coefficients(siiObesity201508)
siiObesity201508 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201508, sii=siiObesity201508))


siiObesity201509 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201509"))
coeffs <- coefficients(siiObesity201509)
siiObesity201509 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201509, sii=siiObesity201509))


siiObesity201510 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201510"))
coeffs <- coefficients(siiObesity201510)
siiObesity201510 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201510, sii=siiObesity201510))


siiObesity201511 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201511"))
coeffs <- coefficients(siiObesity201511)
siiObesity201511 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201511, sii=siiObesity201511))


siiObesity201512 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201512"))
coeffs <- coefficients(siiObesity201512)
siiObesity201512 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201512, sii=siiObesity201512))


siiObesity201601 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201601"))
coeffs <- coefficients(siiObesity201601)
siiObesity201601 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201601, sii=siiObesity201601))


siiObesity201602 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201602"))
coeffs <- coefficients(siiObesity201602)
siiObesity201602 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201602, sii=siiObesity201602))


siiObesity201603 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201603"))
coeffs <- coefficients(siiObesity201603)
siiObesity201603 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201603, sii=siiObesity201603))


siiObesity201604 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201604"))
coeffs <- coefficients(siiObesity201604)
siiObesity201604 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201604, sii=siiObesity201604))


siiObesity201605 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201605"))
coeffs <- coefficients(siiObesity201605)
siiObesity201605 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201605, sii=siiObesity201605))


siiObesity201606 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201606"))
coeffs <- coefficients(siiObesity201606)
siiObesity201606 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201606, sii=siiObesity201606))


siiObesity201607 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201607"))
coeffs <- coefficients(siiObesity201607)
siiObesity201607 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201607, sii=siiObesity201607))


siiObesity201608 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201608"))
coeffs <- coefficients(siiObesity201608)
siiObesity201608 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201608, sii=siiObesity201608))


siiObesity201609 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201609"))
coeffs <- coefficients(siiObesity201609)
siiObesity201609 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201609, sii=siiObesity201609))


siiObesity201610 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201610"))
coeffs <- coefficients(siiObesity201610)
siiObesity201610 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201610, sii=siiObesity201610))


siiObesity201611 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201611"))
coeffs <- coefficients(siiObesity201611)
siiObesity201611 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201611, sii=siiObesity201611))


siiObesity201612 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201612"))
coeffs <- coefficients(siiObesity201612)
siiObesity201612 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201612, sii=siiObesity201612))


siiObesity201701 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201701"))
coeffs <- coefficients(siiObesity201701)
siiObesity201701 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201701, sii=siiObesity201701))


siiObesity201702 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201702"))
coeffs <- coefficients(siiObesity201702)
siiObesity201702 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201702, sii=siiObesity201702))


siiObesity201703 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201703"))
coeffs <- coefficients(siiObesity201703)
siiObesity201703 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201703, sii=siiObesity201703))


siiObesity201704 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201704"))
coeffs <- coefficients(siiObesity201704)
siiObesity201704 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201704, sii=siiObesity201704))


siiObesity201705 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201705"))
coeffs <- coefficients(siiObesity201705)
siiObesity201705 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201705, sii=siiObesity201705))


siiObesity201706 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201706"))
coeffs <- coefficients(siiObesity201706)
siiObesity201706 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201706, sii=siiObesity201706))


siiObesity201707 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201707"))
coeffs <- coefficients(siiObesity201707)
siiObesity201707 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201707, sii=siiObesity201707))


siiObesity201708 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201708"))
coeffs <- coefficients(siiObesity201708)
siiObesity201708 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201708, sii=siiObesity201708))


siiObesity201709 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201709"))
coeffs <- coefficients(siiObesity201709)
siiObesity201709 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201709, sii=siiObesity201709))


siiObesity201710 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201710"))
coeffs <- coefficients(siiObesity201710)
siiObesity201710 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201710, sii=siiObesity201710))


siiObesity201711 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201711"))
coeffs <- coefficients(siiObesity201711)
siiObesity201711 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201711, sii=siiObesity201711))


siiObesity201712 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201712"))
coeffs <- coefficients(siiObesity201712)
siiObesity201712 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201712, sii=siiObesity201712))


siiObesity201801 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201801"))
coeffs <- coefficients(siiObesity201801)
siiObesity201801 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201801, sii=siiObesity201801))


siiObesity201802 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201802"))
coeffs <- coefficients(siiObesity201802)
siiObesity201802 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201802, sii=siiObesity201802))


siiObesity201803 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201803"))
coeffs <- coefficients(siiObesity201803)
siiObesity201803 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201803, sii=siiObesity201803))


siiObesity201804 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201804"))
coeffs <- coefficients(siiObesity201804)
siiObesity201804 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201804, sii=siiObesity201804))


siiObesity201805 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201805"))
coeffs <- coefficients(siiObesity201805)
siiObesity201805 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201805, sii=siiObesity201805))


siiObesity201806 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201806"))
coeffs <- coefficients(siiObesity201806)
siiObesity201806 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201806, sii=siiObesity201806))


siiObesity201807 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201807"))
coeffs <- coefficients(siiObesity201807)
siiObesity201807 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201807, sii=siiObesity201807))


siiObesity201808 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201808"))
coeffs <- coefficients(siiObesity201808)
siiObesity201808 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201808, sii=siiObesity201808))




siiObesity201809 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201809"))
coeffs <- coefficients(siiObesity201809)
siiObesity201809 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201809, sii=siiObesity201809))




siiObesity201810 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201810"))
coeffs <- coefficients(siiObesity201810)
siiObesity201810 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201810, sii=siiObesity201810))




siiObesity201811 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201811"))
coeffs <- coefficients(siiObesity201811)
siiObesity201811 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201811, sii=siiObesity201811))




siiObesity201812 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201812"))
coeffs <- coefficients(siiObesity201812)
siiObesity201812 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201812, sii=siiObesity201812))




siiObesity201901 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201901"))
coeffs <- coefficients(siiObesity201901)
siiObesity201901 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201901, sii=siiObesity201901))




siiObesity201902 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201902"))
coeffs <- coefficients(siiObesity201902)
siiObesity201902 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201902, sii=siiObesity201902))




siiObesity201903 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201903"))
coeffs <- coefficients(siiObesity201903)
siiObesity201903 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201903, sii=siiObesity201903))




siiObesity201904 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201904"))
coeffs <- coefficients(siiObesity201904)
siiObesity201904 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201904, sii=siiObesity201904))




siiObesity201905 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201905"))
coeffs <- coefficients(siiObesity201905)
siiObesity201905 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201905, sii=siiObesity201905))




siiObesity201906 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201906"))
coeffs <- coefficients(siiObesity201906)
siiObesity201906 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201906, sii=siiObesity201906))




siiObesity201907 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201907"))
coeffs <- coefficients(siiObesity201907)
siiObesity201907 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201907, sii=siiObesity201907))




siiObesity201908 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201908"))
coeffs <- coefficients(siiObesity201908)
siiObesity201908 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201908, sii=siiObesity201908))




siiObesity201909 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201909"))
coeffs <- coefficients(siiObesity201909)
siiObesity201909 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201909, sii=siiObesity201909))




siiObesity201910 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201910"))
coeffs <- coefficients(siiObesity201910)
siiObesity201910 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201910, sii=siiObesity201910))




siiObesity201911 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201911"))
coeffs <- coefficients(siiObesity201911)
siiObesity201911 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201911, sii=siiObesity201911))




siiObesity201912 <- lm(actcostperperson~imdrank, data=subset(prescriptiontowns, Druggroup=="Obesity"& PERIOD=="201912"))
coeffs <- coefficients(siiObesity201912)
siiObesity201912 = (coeffs[1] + coeffs[2]*1)- (coeffs[1] + coeffs[2]*1126)
Obesitysii <- rbind(Obesitysii, data.frame(PERIOD=201912, sii=siiObesity201912))

Obesitysii <- Obesitysii[order(Obesitysii$PERIOD),]
Obesitysii$PERIOD <- factor(Obesitysii$PERIOD)
Obesitysii$group <- 1


Obesitysiiplot <- ggplot(Obesitysii, aes(x=PERIOD, y=sii, group = group))+
  theme_light()+
  geom_smooth(method="loess", se=FALSE)+
  geom_point()+
  labs(x = "Date", y = "Slope Index of Inequality", title = "Ineqality in Obesity Drug Prescription")+
  scale_x_discrete(breaks=c("201403","201501", "201601", "201701", "201801", "201901"), labels = c("March 2014", "2015", "2016", "2017", "2018", "2019"))
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Obesitysiiplot.png", plot=Obesitysiiplot, width=8, height=5, dpi=600)





####prescription scatters####

antidepressantprescriptiontowns2019average <-  prescriptiontowns[which(prescriptiontowns$PERIOD>201900 &prescriptiontowns$Druggroup == "Antidepressant" ),]
 
antidepressantaverage <- aggregate(antidepressantprescriptiontowns2019average[-c(1:64, 66,67)], antidepressantprescriptiontowns2019average["BUASD11CD"], mean)
names(antidepressantaverage)[names(antidepressantaverage)=="nicperperson"] <- "yearlyaverage"
antidepressantprescriptiontowns2019average <- merge(antidepressantprescriptiontowns2019average, antidepressantaverage, by="BUASD11CD", all.x=TRUE)
antidepressantsample <- antidepressantprescriptiontowns2019average[which(antidepressantprescriptiontowns2019average$PERIOD==201912 & antidepressantprescriptiontowns2019average$yearlyaverage>1100),]



andidepressantdepplot <- ggplot(data = subset(antidepressantprescriptiontowns2019average, PERIOD == "201912" & Druggroup == "Antidepressant"), aes(x=imdrank, y=yearlyaverage))+
  geom_point(color="navyblue",size=1)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=antidepressantprescriptiontowns2019average %>% filter(PERIOD == "201912" & Druggroup == "Antidepressant"& yearlyaverage>1100),
                  aes(label=antidepressantsample$`Town Name`), size=3, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Cost of Antidepressant Prescriptions \n ( per 1000 registered patients, Average of Monthly Spend in 2019)", title = "Antidepressant Prescriptions")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))


ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Antidepressantdepplotnic.png", plot=andidepressantdepplot, width=8, height=5, dpi=600)



Obesityprescriptiontowns2019average <-  prescriptiontowns[which(prescriptiontowns$PERIOD>201900 &prescriptiontowns$Druggroup == "Obesity" ),]

Obesityaverage <- aggregate(Obesityprescriptiontowns2019average[-c(1:67, 69)], Obesityprescriptiontowns2019average["BUASD11CD"], mean)
names(Obesityaverage)[names(Obesityaverage)=="actcostperperson"] <- "yearlyaverage"
Obesityprescriptiontowns2019average <- merge(Obesityprescriptiontowns2019average, Obesityaverage, by="BUASD11CD", all.x=TRUE)
Obesitysample <- Obesityprescriptiontowns2019average[which(Obesityprescriptiontowns2019average$PERIOD==201912 & Obesityprescriptiontowns2019average$yearlyaverage>50),]



Obesitydepplot <- ggplot(data = subset(Obesityprescriptiontowns2019average, PERIOD == "201912" & Druggroup == "Obesity"), aes(x=imdrank, y=yearlyaverage))+
  geom_point(color="navyblue",size=1)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Obesityprescriptiontowns2019average %>% filter(PERIOD == "201912" & Druggroup == "Obesity"& yearlyaverage>50),
                  aes(label=Obesitysample$`Town Name`), size=3, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Cost of Obesity Prescriptions \n ( per 1000 registered patients, Average of Monthly Spend in 2019)", title = "Obesity Drug Prescriptions")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))


ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Obesitydepplot.png", plot=Obesitydepplot, width=8, height=5, dpi=600)

Diabetesprescriptiontowns2019average <-  prescriptiontowns[which(prescriptiontowns$PERIOD>201900 &prescriptiontowns$Druggroup == "Diabetes" ),]

Diabetesaverage <- aggregate(Diabetesprescriptiontowns2019average[-c(1:67, 69)], Diabetesprescriptiontowns2019average["BUASD11CD"], mean)
names(Diabetesaverage)[names(Diabetesaverage)=="actcostperperson"] <- "yearlyaverage"
Diabetesprescriptiontowns2019average <- merge(Diabetesprescriptiontowns2019average, Diabetesaverage, by="BUASD11CD", all.x=TRUE)
Diabetessample <- Diabetesprescriptiontowns2019average[which(Diabetesprescriptiontowns2019average$PERIOD==201912 & Diabetesprescriptiontowns2019average$yearlyaverage>7000),]



Diabetesdepplot <- ggplot(data = subset(Diabetesprescriptiontowns2019average, PERIOD == "201912" & Druggroup == "Diabetes"), aes(x=imdrank, y=yearlyaverage))+
  geom_point(color="navyblue",size=1)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Diabetesprescriptiontowns2019average %>% filter(PERIOD == "201912" & Druggroup == "Diabetes"& yearlyaverage>7000),
                  aes(label=Diabetessample$`Town Name`), size=3, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Cost of Diabetes Prescriptions \n ( per 1000 registered patients, Average of Monthly Spend in 2019)", title = "Diabetes Drug Prescriptions")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))


ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Diabetesdepplot.png", plot=Diabetesdepplot, width=8, height=5, dpi=600)

Dementiaprescriptiontowns2019average <-  prescriptiontowns[which(prescriptiontowns$PERIOD>201900 &prescriptiontowns$Druggroup == "Dementia" ),]
Dementiaprescriptiontowns2019average <- merge(Dementiaprescriptiontowns2019average, townclass, by="BUASD11CD", all.x=TRUE)
Dementiaprescriptiontowns2019average[is.na(Dementiaprescriptiontowns2019average)] <- 0
Dementiaprescriptiontowns2019average <- Dementiaprescriptiontowns2019average[which(Dementiaprescriptiontowns2019average$citytownclassification!="Core City (London)"), ]
Dementiaprescriptiontowns2019average <- Dementiaprescriptiontowns2019average[which(Dementiaprescriptiontowns2019average$citytownclassification!="Other City"), ]
Dementiaprescriptiontowns2019average <- Dementiaprescriptiontowns2019average[which(Dementiaprescriptiontowns2019average$citytownclassification!="Core City (outside London)"), ]
Dementiaprescriptiontowns2019average <- Dementiaprescriptiontowns2019average[which(Dementiaprescriptiontowns2019average$citytownclassification!="Village or Small Community"), ]
Dementiaprescriptiontowns2019average <- Dementiaprescriptiontowns2019average[which(Dementiaprescriptiontowns2019average$citytownclassification!="Village or Small Community in Conurbation"), ]


Dementiaaverage <- aggregate(Dementiaprescriptiontowns2019average[-c(1:68, 70:72)], Dementiaprescriptiontowns2019average["BUASD11CD"], mean)
names(Dementiaaverage)[names(Dementiaaverage)=="actcostperperson"] <- "yearlyaverage"
Dementiaprescriptiontowns2019average <- merge(Dementiaprescriptiontowns2019average, Dementiaaverage, by="BUASD11CD", all.x=TRUE)
Dementiasample <- Dementiaprescriptiontowns2019average[which(Dementiaprescriptiontowns2019average$PERIOD==201912 & Dementiaprescriptiontowns2019average$yearlyaverage>1000),]



Dementiadepplot <- ggplot(data = subset(Dementiaprescriptiontowns2019average, PERIOD == "201912" & Druggroup == "Dementia"), aes(x=imdrank, y=yearlyaverage))+
  geom_point(color="navyblue",size=1)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Dementiaprescriptiontowns2019average %>% filter(PERIOD == "201912" & Druggroup == "Dementia"& yearlyaverage>1000),
                  aes(label=Dementiasample$`Town Name`), size=3, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Cost of Dementia Prescriptions \n ( per 1000 registered patients, Average of Monthly Spend in 2019)", title = "Dementia Drug Prescriptions")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))


ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Dementiadepplot.png", plot=Dementiadepplot, width=8, height=5, dpi=600)

Opiodprescriptiontowns2019average <-  prescriptiontowns[which(prescriptiontowns$PERIOD>201900 &prescriptiontowns$Druggroup == "Opiod" ),]

Opiodaverage <- aggregate(Opiodprescriptiontowns2019average[-c(1:67, 69)], Opiodprescriptiontowns2019average["BUASD11CD"], mean)
names(Opiodaverage)[names(Opiodaverage)=="actcostperperson"] <- "yearlyaverage"
Opiodprescriptiontowns2019average <- merge(Opiodprescriptiontowns2019average, Opiodaverage, by="BUASD11CD", all.x=TRUE)
Opiodsample <- Opiodprescriptiontowns2019average[which(Opiodprescriptiontowns2019average$PERIOD==201912 & Opiodprescriptiontowns2019average$yearlyaverage>100),]



Opioddepplot <- ggplot(data = subset(Opiodprescriptiontowns2019average, PERIOD == "201912" & Druggroup == "Opiod"), aes(x=imdrank, y=yearlyaverage))+
  geom_point(color="navyblue",size=1)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Opiodprescriptiontowns2019average %>% filter(PERIOD == "201912" & Druggroup == "Opiod"& yearlyaverage>100),
                  aes(label=Opiodsample$`Town Name`), size=3, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Cost of Opiod Prescriptions \n ( per 1000 registered patients, Average of Monthly Spend in 2019)", title = "Opiod-addiction Drug Prescriptions")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))


ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Opioddepplot.png", plot=Opioddepplot, width=8, height=5, dpi=600)
Opiodclosedepplot <- ggplot(data = subset(Opiodprescriptiontowns2019average, PERIOD == "201912" & Druggroup == "Opiod"), aes(x=imdrank, y=yearlyaverage))+
  geom_point(color="navyblue",size=1)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Opiodprescriptiontowns2019average %>% filter(PERIOD == "201912" & Druggroup == "Opiod"& yearlyaverage>100),
                  aes(label=Opiodsample$`Town Name`), size=3, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Cost of Opiod Prescriptions \n ( per 1000 registered patients, Average of Monthly Spend in 2019)", title = "Opiod-addiction Drug Prescriptions")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  scale_y_continuous(limits=c(0,50))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))


ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Opiodclosedepplot.png", plot=Opiodclosedepplot, width=8, height=5, dpi=600)

Nicotineprescriptiontowns2019average <-  prescriptiontowns[which(prescriptiontowns$PERIOD>201900 &prescriptiontowns$Druggroup == "Nicotine" ),]

Nicotineaverage <- aggregate(Nicotineprescriptiontowns2019average[-c(1:67, 69)], Nicotineprescriptiontowns2019average["BUASD11CD"], mean)
names(Nicotineaverage)[names(Nicotineaverage)=="actcostperperson"] <- "yearlyaverage"
Nicotineprescriptiontowns2019average <- merge(Nicotineprescriptiontowns2019average, Nicotineaverage, by="BUASD11CD", all.x=TRUE)
Nicotinesample <- Nicotineprescriptiontowns2019average[which(Nicotineprescriptiontowns2019average$PERIOD==201912 & Nicotineprescriptiontowns2019average$yearlyaverage>150),]



Nicotinedepplot <- ggplot(data = subset(Nicotineprescriptiontowns2019average, PERIOD == "201912" & Druggroup == "Nicotine"), aes(x=imdrank, y=yearlyaverage))+
  geom_point(color="navyblue",size=1)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Nicotineprescriptiontowns2019average %>% filter(PERIOD == "201912" & Druggroup == "Nicotine"& yearlyaverage>150),
                  aes(label=Nicotinesample$`Town Name`), size=3, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Cost of Nicotine Prescriptions \n ( per 1000 registered patients, Average of Monthly Spend in 2019)", title = "Nicotine-addiction Drug Prescriptions")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))


ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Nicotinedepplot.png", plot=Nicotinedepplot, width=8, height=5, dpi=600)

Alcoholprescriptiontowns2019average <-  prescriptiontowns[which(prescriptiontowns$PERIOD>201900 &prescriptiontowns$Druggroup == "Alcohol" ),]

Alcoholaverage <- aggregate(Alcoholprescriptiontowns2019average[-c(1:67, 69)], Alcoholprescriptiontowns2019average["BUASD11CD"], mean)
names(Alcoholaverage)[names(Alcoholaverage)=="actcostperperson"] <- "yearlyaverage"
Alcoholprescriptiontowns2019average <- merge(Alcoholprescriptiontowns2019average, Alcoholaverage, by="BUASD11CD", all.x=TRUE)
Alcoholsample <- Alcoholprescriptiontowns2019average[which(Alcoholprescriptiontowns2019average$PERIOD==201912 & Alcoholprescriptiontowns2019average$yearlyaverage>30),]



Alcoholdepplot <- ggplot(data = subset(Alcoholprescriptiontowns2019average, PERIOD == "201912" & Druggroup == "Alcohol"), aes(x=imdrank, y=yearlyaverage))+
  geom_point(color="navyblue",size=1)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Alcoholprescriptiontowns2019average %>% filter(PERIOD == "201912" & Druggroup == "Alcohol"& yearlyaverage>30),
                  aes(label=Alcoholsample$`Town Name`), size=3, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Cost of Alcohol Prescriptions \n ( per 1000 registered patients, Average of Monthly Spend in 2019)", title = "Alcohol-addiction drug Prescriptions")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))


ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Alcoholdepplot.png", plot=Alcoholdepplot, width=8, height=5, dpi=600)

Bronchodilatorsprescriptiontowns2019average <-  prescriptiontowns[which(prescriptiontowns$PERIOD>201900 &prescriptiontowns$Druggroup == "Bronchodilators" ),]

Bronchodilatorsaverage <- aggregate(Bronchodilatorsprescriptiontowns2019average[-c(1:67, 69)], Bronchodilatorsprescriptiontowns2019average["BUASD11CD"], mean)
names(Bronchodilatorsaverage)[names(Bronchodilatorsaverage)=="actcostperperson"] <- "yearlyaverage"
Bronchodilatorsprescriptiontowns2019average <- merge(Bronchodilatorsprescriptiontowns2019average, Bronchodilatorsaverage, by="BUASD11CD", all.x=TRUE)
Bronchodilatorssample <- Bronchodilatorsprescriptiontowns2019average[which(Bronchodilatorsprescriptiontowns2019average$PERIOD==201912 & Bronchodilatorsprescriptiontowns2019average$yearlyaverage>2),]



Bronchodilatorsdepplot <- ggplot(data = subset(Bronchodilatorsprescriptiontowns2019average, PERIOD == "201912" & Druggroup == "Bronchodilators"), aes(x=imdrank, y=yearlyaverage))+
  geom_point(color="navyblue",size=1)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Bronchodilatorsprescriptiontowns2019average %>% filter(PERIOD == "201912" & Druggroup == "Bronchodilators"& yearlyaverage>2),
                  aes(label=Bronchodilatorssample$`Town Name`), size=3, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Cost of Bronchodilators Prescriptions \n ( per 1000 registered patients, Average of Monthly Spend in 2019)", title = "Bronchodilators Prescriptions")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))


ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Bronchodilatorsdepplot.png", plot=Bronchodilatorsdepplot, width=8, height=5, dpi=600)

Bronchodilatorsclosedepplot <- ggplot(data = subset(Bronchodilatorsprescriptiontowns2019average, PERIOD == "201912" & Druggroup == "Bronchodilators"), aes(x=imdrank, y=yearlyaverage))+
  geom_point(color="navyblue",size=1)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=Bronchodilatorsprescriptiontowns2019average %>% filter(PERIOD == "201912" & Druggroup == "Bronchodilators"& yearlyaverage>2),
                  aes(label=Bronchodilatorssample$`Town Name`), size=3, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Cost of Bronchodilators Prescriptions \n ( per 1000 registered patients, Average of Monthly Spend in 2019)", title = "Bronchodilators Prescriptions")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  scale_y_continuous(limits = c(0,1))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))


ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "Bronchodilatorsclosedepplot.png", plot=Bronchodilatorsclosedepplot, width=8, height=5, dpi=600)


SubstanceDepprescriptiontowns2019average <-  prescriptiontowns[which(prescriptiontowns$PERIOD>201900 &prescriptiontowns$Druggroup == "SubstanceDep" ),]

SubstanceDepaverage <- aggregate(SubstanceDepprescriptiontowns2019average[-c(1:67, 69)], SubstanceDepprescriptiontowns2019average["BUASD11CD"], mean)
names(SubstanceDepaverage)[names(SubstanceDepaverage)=="actcostperperson"] <- "yearlyaverage"
SubstanceDepprescriptiontowns2019average <- merge(SubstanceDepprescriptiontowns2019average, SubstanceDepaverage, by="BUASD11CD", all.x=TRUE)
SubstanceDepsample <- SubstanceDepprescriptiontowns2019average[which(SubstanceDepprescriptiontowns2019average$PERIOD==201912 & SubstanceDepprescriptiontowns2019average$yearlyaverage>200),]



SubstanceDepdepplot <- ggplot(data = subset(SubstanceDepprescriptiontowns2019average, PERIOD == "201912" & Druggroup == "SubstanceDep"), aes(x=imdrank, y=yearlyaverage))+
  geom_point(color="navyblue",size=1)+
  theme_light()+
  geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
  geom_text_repel(data=SubstanceDepprescriptiontowns2019average %>% filter(PERIOD == "201912" & Druggroup == "SubstanceDep"& yearlyaverage>200),
                  aes(label=SubstanceDepsample$`Town Name`), size=3, color="black")+
  labs(x = "Multiple Deprivation Rank (2019)", y = "Cost of SubstanceDep Prescriptions \n ( per 1000 registered patients, Average of Monthly Spend in 2019)", title = "All Substance Dependence Drug Prescriptions")+
  scale_x_continuous(breaks=c(1,1126), labels = c("Most Deprived Town", "Least Deprived Town"))+
  theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))


ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "SubstanceDepdepplot.png", plot=SubstanceDepdepplot, width=8, height=5, dpi=600)






####biggest movers####

####antidepressantchange####

firstantidepressant <- prescriptiontowns[which(prescriptiontowns$PERIOD==201403 & prescriptiontowns$Druggroup=="Antidepressant"),]
lastantidepressant <- prescriptiontowns[which(prescriptiontowns$PERIOD==201912 & prescriptiontowns$Druggroup=="Antidepressant"),]

names(firstantidepressant)[names(firstantidepressant)=="actcostperperson"] <- "first"
names(lastantidepressant)[names(lastantidepressant)=="actcostperperson"] <- "last"

firstantidepressant <- firstantidepressant[-c(2:67,69)]
lastantidepressant <- lastantidepressant[-c(2:67,69)]

antidepressantchange <- merge(firstantidepressant, lastantidepressant, by="BUASD11CD")

antidepressantchange$antidepressantchange <- antidepressantchange$first-antidepressantchange$last

antidepressantchange <- antidepressantchange[-c(2,3)]

prescriptiontowns <- merge(prescriptiontowns, antidepressantchange, by="BUASD11CD", all.x=TRUE)




####Bronchodilatorschange####

firstBronchodilators <- prescriptiontowns[which(prescriptiontowns$PERIOD==201403 & prescriptiontowns$Druggroup=="Bronchodilators"),]
lastBronchodilators <- prescriptiontowns[which(prescriptiontowns$PERIOD==201912 & prescriptiontowns$Druggroup=="Bronchodilators"),]

names(firstBronchodilators)[names(firstBronchodilators)=="actcostperperson"] <- "first"
names(lastBronchodilators)[names(lastBronchodilators)=="actcostperperson"] <- "last"

firstBronchodilators <- firstBronchodilators[-c(2:67,69,70)]
lastBronchodilators <- lastBronchodilators[-c(2:67,69,70)]

Bronchodilatorschange <- merge(firstBronchodilators, lastBronchodilators, by="BUASD11CD")

Bronchodilatorschange$Bronchodilatorschange <- Bronchodilatorschange$first-Bronchodilatorschange$last

Bronchodilatorschange <- Bronchodilatorschange[-c(2,3)]

prescriptiontowns <- merge(prescriptiontowns, Bronchodilatorschange, by="BUASD11CD", all.x=TRUE)



####Alcoholchange####

firstAlcohol <- prescriptiontowns[which(prescriptiontowns$PERIOD==201403 & prescriptiontowns$Druggroup=="Alcohol"),]
lastAlcohol <- prescriptiontowns[which(prescriptiontowns$PERIOD==201912 & prescriptiontowns$Druggroup=="Alcohol"),]

names(firstAlcohol)[names(firstAlcohol)=="actcostperperson"] <- "first"
names(lastAlcohol)[names(lastAlcohol)=="actcostperperson"] <- "last"

firstAlcohol <- firstAlcohol[-c(2:67,69,70,71)]
lastAlcohol <- lastAlcohol[-c(2:67,69,70,71)]

Alcoholchange <- merge(firstAlcohol, lastAlcohol, by="BUASD11CD")

Alcoholchange$Alcoholchange <- Alcoholchange$first-Alcoholchange$last

Alcoholchange <- Alcoholchange[-c(2,3)]

prescriptiontowns <- merge(prescriptiontowns, Alcoholchange, by="BUASD11CD", all.x=TRUE)



####SubstanceDepchange####

firstSubstanceDep <- prescriptiontowns[which(prescriptiontowns$PERIOD==201403 & prescriptiontowns$Druggroup=="SubstanceDep"),]
lastSubstanceDep <- prescriptiontowns[which(prescriptiontowns$PERIOD==201912 & prescriptiontowns$Druggroup=="SubstanceDep"),]

names(firstSubstanceDep)[names(firstSubstanceDep)=="actcostperperson"] <- "first"
names(lastSubstanceDep)[names(lastSubstanceDep)=="actcostperperson"] <- "last"

firstSubstanceDep <- firstSubstanceDep[-c(2:67,69,70,71,72)]
lastSubstanceDep <- lastSubstanceDep[-c(2:67,69,70,71,72)]

SubstanceDepchange <- merge(firstSubstanceDep, lastSubstanceDep, by="BUASD11CD")

SubstanceDepchange$SubstanceDepchange <- SubstanceDepchange$first-SubstanceDepchange$last

SubstanceDepchange <- SubstanceDepchange[-c(2,3)]

prescriptiontowns <- merge(prescriptiontowns, SubstanceDepchange, by="BUASD11CD", all.x=TRUE)



####Nicotinechange####

firstNicotine <- prescriptiontowns[which(prescriptiontowns$PERIOD==201403 & prescriptiontowns$Druggroup=="Nicotine"),]
lastNicotine <- prescriptiontowns[which(prescriptiontowns$PERIOD==201912 & prescriptiontowns$Druggroup=="Nicotine"),]

names(firstNicotine)[names(firstNicotine)=="actcostperperson"] <- "first"
names(lastNicotine)[names(lastNicotine)=="actcostperperson"] <- "last"

firstNicotine <- firstNicotine[-c(2:67,69,70,71,72,73)]
lastNicotine <- lastNicotine[-c(2:67,69,70,71,72,73)]

Nicotinechange <- merge(firstNicotine, lastNicotine, by="BUASD11CD")

Nicotinechange$Nicotinechange <- Nicotinechange$first-Nicotinechange$last

Nicotinechange <- Nicotinechange[-c(2,3)]

prescriptiontowns <- merge(prescriptiontowns, Nicotinechange, by="BUASD11CD", all.x=TRUE)



####Opiodchange####

firstOpiod <- prescriptiontowns[which(prescriptiontowns$PERIOD==201403 & prescriptiontowns$Druggroup=="Opiod"),]
lastOpiod <- prescriptiontowns[which(prescriptiontowns$PERIOD==201912 & prescriptiontowns$Druggroup=="Opiod"),]

names(firstOpiod)[names(firstOpiod)=="actcostperperson"] <- "first"
names(lastOpiod)[names(lastOpiod)=="actcostperperson"] <- "last"

firstOpiod <- firstOpiod[-c(2:67,69,70,71,72,73,74)]
lastOpiod <- lastOpiod[-c(2:67,69,70,71,72,73,74)]

Opiodchange <- merge(firstOpiod, lastOpiod, by="BUASD11CD")

Opiodchange$Opiodchange <- Opiodchange$first-Opiodchange$last

Opiodchange <- Opiodchange[-c(2,3)]

prescriptiontowns <- merge(prescriptiontowns, Opiodchange, by="BUASD11CD", all.x=TRUE)



####Obesitychange####

firstObesity <- prescriptiontowns[which(prescriptiontowns$PERIOD==201403 & prescriptiontowns$Druggroup=="Obesity"),]
lastObesity <- prescriptiontowns[which(prescriptiontowns$PERIOD==201912 & prescriptiontowns$Druggroup=="Obesity"),]

names(firstObesity)[names(firstObesity)=="actcostperperson"] <- "first"
names(lastObesity)[names(lastObesity)=="actcostperperson"] <- "last"

firstObesity <- firstObesity[-c(2:67,69,70,71,72,73,74,75)]
lastObesity <- lastObesity[-c(2:67,69,70,71,72,73,74,75)]

Obesitychange <- merge(firstObesity, lastObesity, by="BUASD11CD")

Obesitychange$Obesitychange <- Obesitychange$first-Obesitychange$last

Obesitychange <- Obesitychange[-c(2,3)]

prescriptiontowns <- merge(prescriptiontowns, Obesitychange, by="BUASD11CD", all.x=TRUE)



####Dementiachange####

firstDementia <- prescriptiontowns[which(prescriptiontowns$PERIOD==201403 & prescriptiontowns$Druggroup=="Dementia"),]
lastDementia <- prescriptiontowns[which(prescriptiontowns$PERIOD==201912 & prescriptiontowns$Druggroup=="Dementia"),]

names(firstDementia)[names(firstDementia)=="actcostperperson"] <- "first"
names(lastDementia)[names(lastDementia)=="actcostperperson"] <- "last"

firstDementia <- firstDementia[-c(2:67,69,70,71,72,73,74,75,76)]
lastDementia <- lastDementia[-c(2:67,69,70,71,72,73,74,75,76)]

Dementiachange <- merge(firstDementia, lastDementia, by="BUASD11CD")

Dementiachange$Dementiachange <- Dementiachange$first-Dementiachange$last

Dementiachange <- Dementiachange[-c(2,3)]

prescriptiontowns <- merge(prescriptiontowns, Dementiachange, by="BUASD11CD", all.x=TRUE)



####Diabeteschange####

firstDiabetes <- prescriptiontowns[which(prescriptiontowns$PERIOD==201403 & prescriptiontowns$Druggroup=="Diabetes"),]
lastDiabetes <- prescriptiontowns[which(prescriptiontowns$PERIOD==201912 & prescriptiontowns$Druggroup=="Diabetes"),]

names(firstDiabetes)[names(firstDiabetes)=="actcostperperson"] <- "first"
names(lastDiabetes)[names(lastDiabetes)=="actcostperperson"] <- "last"

firstDiabetes <- firstDiabetes[-c(2:67,69,70,71,72,73,74,75,76,77)]
lastDiabetes <- lastDiabetes[-c(2:67,69,70,71,72,73,74,75,76,77)]




####changeplots####
prescriptiontowns <- prescriptiontowns[order(prescriptiontowns$PERIOD),]
prescriptiontowns$PERIOD <- factor(prescriptiontowns$PERIOD)
prescriptiontowns$group <- 1

antidepressant <- prescriptiontowns[which(prescriptiontowns$Druggroup=="Antidepressant"),]

antidepressant <- merge(antidepressant, townclass, by="BUASD11CD", all.x=TRUE)
antidepressant[is.na(antidepressant)] <- 0
antidepressant <- antidepressant[which(antidepressant$citytownclassification!="Core City (London)"), ]
antidepressant <- antidepressant[which(antidepressant$citytownclassification!="Other City"), ]
antidepressant <- antidepressant[which(antidepressant$citytownclassification!="Core City (outside London)"), ]
antidepressant <- antidepressant[which(antidepressant$citytownclassification!="Village or Small Community"), ]
antidepressant <- antidepressant[which(antidepressant$citytownclassification!="Village or Small Community in Conurbation"), ]


newimdrank <-  antidepressant[!duplicated(antidepressant$BUASD11CD),]
newimdrank <- newimdrank[order(newimdrank$imdrank),]

newimdrank$newimdrank <- 1:nrow(newimdrank)
newimdrank <- newimdrank[-c(2:71)]
antidepressant <- merge(antidepressant, newimdrank, by="BUASD11CD", all.x=TRUE)

antidepressantchangeplot <- ggplot(data = antidepressant, aes(x=PERIOD, y=nicperperson, group=group))+
  theme_light()+
  stat_summary(fun.y=mean, aes(group=group), geom="line", colour="blue", size=2) +
  stat_summary(data=antidepressant %>% filter(imdrank>1008 ), fun.y=mean, aes(group=group), geom="line", colour="lightblue", size=2) +
  stat_summary(data=antidepressant %>% filter(imdrank<101 ), fun.y=mean, aes(group=group), geom="line", colour="navyblue", size=2) +
  labs(x = "Date", y = "Spend on Prescriptions ( per 1000 registered patients)", title = "Examples of Changes in Antidepressant Prescriptions")+
  scale_x_discrete(breaks=c("201403","201501", "201601", "201701", "201801", "201901"), labels = c("March 2014", "2015", "2016", "2017", "2018", "2019"))+
  annotate("text",label = "100 least deprived towns", x = 8, y=530, colour="lightblue", size=3)+
  annotate("text",label = "100 most deprived towns", x = 8, y=240, colour="navyblue", size=3)+
  annotate("text", label = "Town Average", x = 8, y=400, colour="blue", size=3)


  
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "antidepressantchangeplotnic.png", plot=antidepressantchangeplot, width=8, height=5, dpi=600)

antidepressantchangesalealtrinplot <- ggplot(data = antidepressant, aes(x=PERIOD, y=actcostperperson, group=group))+
  theme_light()+
  # stat_summary(data=antidepressant %>% filter(`Town Name`=="Stretford" ),fun.y=mean, aes(group=group), geom="line", colour="blue", size=2) +
  stat_summary(data=antidepressant %>% filter(`Town Name`=="Altrincham" ), fun.y=mean, aes(group=group), geom="line", colour="blue", size=2) +
  stat_summary(data=antidepressant %>% filter(`Town Name`=="Sale" ), fun.y=mean, aes(group=group), geom="line", colour="navyblue", size=2) +
  labs(x = "Date", y = "Spend on Prescriptions ( per 1000 registered patients)", title = "Changes in Antidepressant Prescriptions")+
  scale_x_discrete(breaks=c("201403","201501", "201601", "201701", "201801", "201901"), labels = c("March 2014", "2015", "2016", "2017", "2018", "2019"))+
  annotate("text",label = "Altrincham", x = 8, y=100, colour="blue", size=3)+
  annotate("text",label = "Sale", x = 8, y=30, colour="navyblue", size=3)



ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "antidepressantchangesalealtrinplot.png", plot=antidepressantchangesalealtrinplot, width=8, height=5, dpi=600)


Diabeteschange <- merge(firstDiabetes, lastDiabetes, by="BUASD11CD")

Diabeteschange$Diabeteschange <- Diabeteschange$first-Diabeteschange$last

Diabeteschange <- Diabeteschange[-c(2,3)]

prescriptiontowns <- merge(prescriptiontowns, Diabeteschange, by="BUASD11CD", all.x=TRUE)


#####coronaplot####


over70 <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\seventyplus.csv")
over70 <- merge(over70, lsoalookup, by="LSOA11CD", all.x=TRUE)

over70 <- aggregate(over70[-c(1,4,5)], over70["BUASD11CD"], sum)
over70$over70per <- (over70$seventyplus/ over70$`All Ages`)*100 

over70 <- over70[-c(2,3)]
hosptravel <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\traveltimehospital.csv")
hosptravel <- merge(hosptravel, lsoalookup, by="LSOA11CD", all.x=TRUE)
travelpop <- aggregate(hosptravel[-c(1,3,4,5,6)], hosptravel["BUASD11CD"], sum)
names(travelpop)[names(travelpop)=="Hosp_pop"] <- "tottravelpop"
hosptravel <- merge(hosptravel, travelpop, by="BUASD11CD", all.x=TRUE)

hosptravel$publictransporttravelper <- hosptravel$HospPTt*(hosptravel$Hosp_pop/hosptravel$tottravelpop)

hosptravel$cartravelper <- hosptravel$HospCart*(hosptravel$Hosp_pop/hosptravel$tottravelpop)
hosptravel <- aggregate(hosptravel[-c(1:7)], hosptravel["BUASD11CD"], sum)


coronadata <- merge(hosptravel, over70, by="BUASD11CD", all.x=TRUE)

coronadata <- merge(coronadata, townname, by="BUASD11CD", all.x=TRUE )
coronadata <- merge(coronadata, townclass, by="BUASD11CD", all.x=TRUE)
coronadata[is.na(coronadata)] <- 0
coronadata <- coronadata[which(coronadata$citytownclassification!="Core City (London)"), ]
coronadata <- coronadata[which(coronadata$citytownclassification!="Other City"), ]
coronadata <- coronadata[which(coronadata$citytownclassification!="Core City (outside London)"), ]
coronadata <- coronadata[which(coronadata$citytownclassification!="Village or Small Community"), ]
coronadata <- coronadata[which(coronadata$citytownclassification!="Village or Small Community in Conurbation"), ]
buapop <- Townhealthmaster[-c(2:6, 8:57)]
coronadata <- merge(coronadata, buapop, by="BUASD11CD", all.x=TRUE)
coronadata <- coronadata[complete.cases(coronadata$lsoa18popbestfit), ]

coronadata <- coronadata %>% mutate(oldandfarcar = ifelse(coronadata$over70per>25 & coronadata$cartravelper>30,  1, 0))
coronadata <- coronadata %>% mutate(oldandfarpt = ifelse(coronadata$over70per>25 & coronadata$publictransporttravelper>60,  1, 0))

coronadata$oldandfarcar <- factor(coronadata$oldandfarcar)
coronadata$oldandfarpt <- factor(coronadata$oldandfarpt)

oldandfarcarsample <- coronadata[which(coronadata$oldandfarcar==1),]
oldandfarptsample <- coronadata[which(coronadata$oldandfarpt==1),]



coronaplotcar <- ggplot(coronadata, aes(x=over70per, y=cartravelper))+
  geom_point(color="navyblue", aes(alpha= oldandfarcar, size=oldandfarcar))+
  theme_light()+
  geom_text_repel(data=coronadata %>% filter(oldandfarcar==1),
                  aes(label=oldandfarcarsample$`Town Name`), size=2, color="black")+
  labs(x = "Percentage aged over 70 Years Old", y = "Travel Time to nearest Hospital via Car", title = "Town Age and Hospital Accessability")+
  scale_alpha_discrete(range = c(0.25, 1))+
  scale_y_continuous(limits=c(0,50))+
  scale_size_discrete(range = c(1,1.25))+
  theme(legend.position =  "none")
#ggsave("coronaplotcar.png", plot=coronaplotcar, width=8, height=5, dpi=600)
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "coronaplotcar.png", plot=coronaplotcar, width=8, height=5, dpi=600)

coronaplotpt <- ggplot(coronadata, aes(x=over70per, y=publictransporttravelper))+
  geom_point(color="navyblue", aes(alpha= oldandfarpt, size=oldandfarpt))+
  theme_light()+
  geom_text_repel(data=coronadata %>% filter(oldandfarpt==1),
                  aes(label=oldandfarptsample$`Town Name`), size=2, color="black")+
  labs(x = "Percentage aged over 70 Years Old", y = "Travel Time to nearest Hospital via Public Transport", title = "Town Age and Hospital Accessability")+
  scale_alpha_discrete(range = c(0.25, 1))+
  scale_y_continuous(limits=c(0,100))+
  scale_size_discrete(range = c(1,1.25))+
  theme(legend.position =  "none")
#ggsave("coronaplotcar.png", plot=coronaplotcar, width=8, height=5, dpi=600)
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "coronaplotpt.png", plot=coronaplotpt, width=8, height=5, dpi=600)


####towncitysmokingpregnancy####

townclassla <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\townclasslad.csv")
smokingpregnant <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\smokingwhilstpregnantla.csv")
townclassla <- townclassla[!duplicated(townclassla),]
smokingpregnant <- smokingpregnant[!duplicated(smokingpregnant),]
townclassla <- townclassla[complete.cases(townclassla$townclass), ]


smokingpregnanttown <- merge(smokingpregnant, townclassla ,by="LADCD", all.x=TRUE)

smokingpregnanttown <- smokingpregnanttown[order(smokingpregnanttown$`Time period`),]
smokingpregnanttown$PERIOD <- factor(smokingpregnanttown$`Time period`)
smokingpregnanttown$group <- 1
  
  spokingpregnanttowncity <- ggplot(data = smokingpregnanttown, aes(x= PERIOD, y=Value, group=group))+
  theme_light()+
  stat_summary(data=smokingpregnanttown %>% filter(townclass == "Village or smaller"), fun.y=mean, aes(group=group), geom="line", colour="blue", size=1.5) +
  labs(x = "Date", y = "Smoking at time of delivery (%)", title = "Smoking during Pregnancy")+
  scale_x_discrete(breaks=c("2010/11","2011/12", "2012/13", "2013/14", "2014/15", "2015/16", "2016/17", "2017/18", "2018/19"), labels = c("2011","2012","2013","2014", "2015", "2016", "2017", "2018", "2019"))+
  stat_summary(data=smokingpregnanttown %>% filter(townclass == "Core City"|townclass == "Other City"), fun.y=mean, aes(group=group), geom="line", colour="navyblue", size=1.5) +
  stat_summary(data=smokingpregnanttown %>% filter(townclass == "Large Town"|townclass == "Medium Town"|townclass == "Small Town"), fun.y=mean, aes(group=group), geom="line", colour="lightblue", size=1.5)+
  annotate("text",label = "Towns", x = 2, y=15.3, colour="lightblue", size=6)+
  annotate("text",label = "Villages", x = 2, y=13.7, colour="blue", size=6)+
  annotate("text", label = "Cities", x = 2, y=10.5, colour="navyblue", size=6)
  ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "spokingpregnanttowncity.png", plot=spokingpregnanttowncity, width=8, height=5, dpi=600)
  

  
  townclassla <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\townclasslad.csv")
  smokingprevalence <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\smokingprevalence.csv")
  townclassla <- townclassla[!duplicated(townclassla),]
  smokingprevalence <- smokingprevalence[!duplicated(smokingprevalence),]
  townclassla <- townclassla[complete.cases(townclassla$townclass), ]
  
  
  smokingprevalencetown <- merge(smokingprevalence, townclassla ,by="LADCD", all.x=TRUE)
  
  smokingprevalencetown <- smokingprevalencetown[order(smokingprevalencetown$`Time period`),]
  smokingprevalencetown$PERIOD <- factor(smokingprevalencetown$`Time period`)
  smokingprevalencetown$group <- 1
  
  spokingprevalencetowncity <- ggplot(data = smokingprevalencetown, aes(x= PERIOD, y=Value, group=group))+
    theme_light()+
    stat_summary(data=smokingprevalencetown %>% filter(townclass == "Village or smaller"), fun.y=mean, aes(group=group), geom="line", colour="blue", size=1.5) +
    labs(x = "Date", y = "Current Smokers (%)", title = "Smoking Prevalence")+
    scale_x_discrete(breaks=c("2011","2012", "2013", "2014", "2015", "2016", "2017", "2018"), labels = c("2011","2012","2013","2014", "2015", "2016", "2017", "2018"))+
    stat_summary(data=smokingprevalencetown %>% filter(townclass == "Core City"|townclass == "Other City"), fun.y=mean, aes(group=group), geom="line", colour="navyblue", size=1.5) +
    stat_summary(data=smokingprevalencetown %>% filter(townclass == "Large Town"|townclass == "Medium Town"|townclass == "Small Town"), fun.y=mean, aes(group=group), geom="line", colour="lightblue", size=1.5)+
    annotate("text",label = "Towns", x = 2, y=21, colour="lightblue", size=6)+
    annotate("text",label = "Villages", x = 2, y=18.8, colour="blue", size=6)+
    annotate("text", label = "Cities", x = 2, y=22.1, colour="navyblue", size=6)
  ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "spokingprevalencetowncity.png", plot=spokingprevalencetowncity, width=8, height=5, dpi=600)
  
####towncityle####
  
  
  townclassla <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\townclasslad.csv")
  lale <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\lale.csv")
  townclassla <- townclassla[!duplicated(townclassla),]
  lale <- lale[!duplicated(lale),]
  townclassla <- townclassla[complete.cases(townclassla$townclass), ]
  lale <- lale[complete.cases(lale$Value), ]
  malelale <- lale[which(lale$Sex=="Male"), ]
  femalelale <- lale[which(lale$Sex=="Female"), ]
  
  femalealetown <- merge(femalelale, townclassla ,by="LADCD", all.x=TRUE)
  
  malealetown <- merge(malelale, townclassla ,by="LADCD", all.x=TRUE)
  
  femalealetown <- femalealetown[order(femalealetown$`Time period`),]
  femalealetown$PERIOD <- factor(femalealetown$`Time period`)
  femalealetown$group <- 1
  
  femalealetowncity <- ggplot(data = femalealetown, aes(x= PERIOD, y=Value, group=group))+
    theme_light()+
    # stat_summary(data=femalealetown %>% filter(townclass == "Village or smaller"), fun.y=mean, aes(group=group), geom="line", colour="blue", size=1.5) +
    # scale_x_discrete(breaks=c("2001 - 03","2002 - 04", "2003 - 05", "2004 - 06", "2005 - 07", "2006 - 08", "2007 - 09", "2008 - 10", "2009 - 11", "2010 - 12", "2011 - 13", "2012 - 14", "2013 - 15", "2014 - 16", "2015 - 17", "2016 - 18"), labels = c("2003","2004","2005","2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018"))+
    theme(axis.text.x = element_text(angle = 45, hjust = 1))+
    labs(x = "Date", y = "Life Expectancy at Birth", title = "The Closing Gap in Life Expectancy between Towns and Cities")+
    stat_summary(data=femalealetown %>% filter(townclass == "Core City"|townclass == "Other City"), fun.y=mean, aes(group=group), geom="line", colour="navyblue", size=1.5) +
    stat_summary(data=femalealetown %>% filter(townclass == "Large Town"|townclass == "Medium Town"|townclass == "Small Town"), fun.y=mean, aes(group=group), geom="line", colour="lightblue", size=1.5)+
    stat_summary(data=malealetown %>% filter(townclass == "Core City"|townclass == "Other City"), fun.y=mean, aes(group=group), geom="line", linetype="dashed", colour="navyblue", size=1.5) +
    stat_summary(data=malealetown %>% filter(townclass == "Large Town"|townclass == "Medium Town"|townclass == "Small Town"), fun.y=mean, aes(group=group), geom="line",linetype="dashed", colour="lightblue", size=1.5)+
    annotate("text",label = "Towns", x = 2, y=81.6, colour="lightblue", size=6)+
    annotate("text",label = "Towns", x = 2, y=77.2, colour="lightblue", size=6)+ 
    annotate("text", label = "Female Life Expectancy", x = 5, y=82.5, colour="black", size=4, angle = 15)+
    annotate("text", label = "Male Life Expectancy", x = 5, y=78.5, colour="black", size=4, angle = 15)+
    annotate("text", label = "Cities", x = 2, y=80.2, colour="navyblue", size=6)+
    annotate("text", label = "Cities", x = 2, y=75.3, colour="navyblue", size=6)
  
  ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "letowncity3.png", plot=femalealetowncity, width=8, height=5, dpi=600)
  
  malealetown <- malealetown[order(malealetown$`Time period`),]
  malealetown$PERIOD <- factor(malealetown$`Time period`)
  malealetown$group <- 1
  malealetowncity <- ggplot(data = malealetown, aes(x= PERIOD, y=Value, group=group))+
    theme_light()+
    stat_summary(data=malealetown %>% filter(townclass == "Village or smaller"), fun.y=mean, aes(group=group), geom="line", colour="blue", size=1.5) +
    labs(x = "Date", y = "Male Life Expectancy at Birth", title = "Male Life Expectancy in Villages, Towns and Cities")+
    scale_x_discrete(breaks=c("2001 - 03","2002 - 04", "2003 - 05", "2004 - 06", "2005 - 07", "2006 - 08", "2007 - 09", "2008 - 10", "2009 - 11", "2010 - 12", "2011 - 13", "2012 - 14", "2013 - 15", "2014 - 16", "2015 - 17", "2016 - 18"), labels = c("2003","2004","2005","2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018"))+
    stat_summary(data=malealetown %>% filter(townclass == "Core City"|townclass == "Other City"), fun.y=mean, aes(group=group), geom="line", colour="navyblue", size=1.5) +
    stat_summary(data=malealetown %>% filter(townclass == "Large Town"|townclass == "Medium Town"|townclass == "Small Town"), fun.y=mean, aes(group=group), geom="line", colour="lightblue", size=1.5)+
    annotate("text",label = "Towns", x = 2, y=77.2, colour="lightblue", size=6)+
    annotate("text",label = "Villages", x = 2, y=78.4, colour="blue", size=6)+
    annotate("text", label = "Cities", x = 2, y=75.3, colour="navyblue", size=6)
  ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "malealetowncity.png", plot=malealetowncity, width=8, height=5, dpi=600)
  
  ####towncitysuicide####
  
  
  townclassla <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\townclasslad.csv")
  lasuicide <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\lasuicides.csv")
  townclassla <- townclassla[!duplicated(townclassla),]
  lasuicide <- lasuicide[!duplicated(lasuicide),]
  townclassla <- townclassla[compsuicidete.cases(townclassla$townclass), ]
  lasuicide <- lasuicide[compsuicidete.cases(lasuicide$Value), ]
  malesuicide <- lasuicide[which(lasuicide$Sex=="Male"), ]
  femalesuicide <- lasuicide[which(lasuicide$Sex=="Female"), ]
  
  femalesuicide <- merge(femalesuicide, townclassla ,by="LADCD", all.x=TRUE)
  
  malesuicide <- merge(malesuicide, townclassla ,by="LADCD", all.x=TRUE)
  
  femalesuicide <- femalesuicide[order(femalesuicide$`Time period`),]
  femalesuicide$PERIOD <- factor(femalesuicide$`Time period`)
  femalesuicide$group <- 1
  
  femalesuicideplot <- ggplot(data = femalesuicide, aes(x= PERIOD, y=Value, group=group))+
    theme_light()+
    stat_summary(data=femalesuicide %>% filter(townclass == "Village or smaller"), fun.y=mean, aes(group=group), geom="line", colour="blue", size=1.5) +
    # scasuicide_x_discrete(breaks=c("2001 - 03","2002 - 04", "2003 - 05", "2004 - 06", "2005 - 07", "2006 - 08", "2007 - 09", "2008 - 10", "2009 - 11", "2010 - 12", "2011 - 13", "2012 - 14", "2013 - 15", "2014 - 16", "2015 - 17", "2016 - 18"), labels = c("2003","2004","2005","2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018"))+
    theme(axis.text.x = element_text(angle = 45, hjust = 1))+
    labs(x = "Date", y = "Female Suicide Rate\n(Suicides per 100,000 popultation - age standardised)", title = "Female Suicide Rate in Villages, Towns and Cities")+
    stat_summary(data=femalesuicide %>% filter(townclass == "Core City"|townclass == "Other City"), fun.y=mean, aes(group=group), geom="line", colour="navyblue", size=1.5) +
    stat_summary(data=femalesuicide %>% filter(townclass == "Large Town"|townclass == "Medium Town"|townclass == "Small Town"), fun.y=mean, aes(group=group), geom="line", colour="lightblue", size=1.5)+
    annotate("text",label = "Towns", x = 2, y=6.8, colour="lightblue", size=6)+
    annotate("text",label = "Villages", x = 2, y=6.48, colour="blue", size=6)+
    annotate("text", label = "Cities", x = 2, y=5.78, colour="navyblue", size=6)
  ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "femalesuicideplot.png", plot=femalesuicideplot, width=8, height=5, dpi=600)
  
  malesuicide <- malesuicide[order(malesuicide$`Time period`),]
  malesuicide$PERIOD <- factor(malesuicide$`Time period`)
  malesuicide$group <- 1
  malesuicideplot <- ggplot(data = malesuicide, aes(x= PERIOD, y=Value, group=group))+
    theme_light()+
    stat_summary(data=malesuicide %>% filter(townclass == "Village or smaller"), fun.y=mean, aes(group=group), geom="line", colour="blue", size=1.5) +
    labs(x = "Date", y = "Male Suicide Rate\n(Suicides per 100,000 population - age standardised)", title = "Male Suicide Rate in Villages, Towns and Cities")+
    # scasuicide_x_discrete(breaks=c("2001 - 03","2002 - 04", "2003 - 05", "2004 - 06", "2005 - 07", "2006 - 08", "2007 - 09", "2008 - 10", "2009 - 11", "2010 - 12", "2011 - 13", "2012 - 14", "2013 - 15", "2014 - 16", "2015 - 17", "2016 - 18"), labels = c("2003","2004","2005","2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018"))+
    theme(axis.text.x = element_text(angle = 45, hjust = 1))+
    stat_summary(data=malesuicide %>% filter(townclass == "Core City"|townclass == "Other City"), fun.y=mean, aes(group=group), geom="line", colour="navyblue", size=1.5) +
    stat_summary(data=malesuicide %>% filter(townclass == "Large Town"|townclass == "Medium Town"|townclass == "Small Town"), fun.y=mean, aes(group=group), geom="line", colour="lightblue", size=1.5)+
    annotate("text",label = "Towns", x = 2, y=16.5, colour="lightblue", size=6)+
    annotate("text",label = "Villages", x = 2, y=15.8, colour="blue", size=6)+
    annotate("text", label = "Cities", x = 2.2, y=16.3, colour="navyblue", size=6)
  ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "malesuicideplot.png", plot=malesuicideplot, width=8, height=5, dpi=600)
  
  ####towncityselfharm####
  
  
  townclassla <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\townclasslad.csv")
  laselfharm <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\selfharmla.csv")
  townclassla <- townclassla[!duplicated(townclassla),]
  laselfharm <- laselfharm[!duplicated(laselfharm),]
  townclassla <- townclassla[compselfharmte.cases(townclassla$townclass), ]
  laselfharm <- laselfharm[compselfharmte.cases(laselfharm$Value), ]
  maleselfharm <- laselfharm[which(laselfharm$Sex=="Male"), ]
  femaleselfharm <- laselfharm[which(laselfharm$Sex=="Female"), ]
  
  femaleselfharm <- merge(femaleselfharm, townclassla ,by="LADCD", all.x=TRUE)
  
  maleselfharm <- merge(maleselfharm, townclassla ,by="LADCD", all.x=TRUE)
  
  femaleselfharm <- femaleselfharm[order(femaleselfharm$`Time period`),]
  femaleselfharm$PERIOD <- factor(femaleselfharm$`Time period`)
  femaleselfharm$group <- 1
  
  femaleselfharmplot <- ggplot(data = femaleselfharm, aes(x= PERIOD, y=Value, group=group))+
    theme_light()+
    stat_summary(data=femaleselfharm %>% filter(townclass == "Village or smaller"), fun.y=mean, aes(group=group), geom="line", colour="blue", size=1.5) +
    # scaselfharm_x_discrete(breaks=c("2001 - 03","2002 - 04", "2003 - 05", "2004 - 06", "2005 - 07", "2006 - 08", "2007 - 09", "2008 - 10", "2009 - 11", "2010 - 12", "2011 - 13", "2012 - 14", "2013 - 15", "2014 - 16", "2015 - 17", "2016 - 18"), labels = c("2003","2004","2005","2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018"))+
    theme(axis.text.x = element_text(angle = 45, hjust = 1))+
    labs(x = "Date", y = "Female Hospitalisations for Intentional Self Harm\n(per 100,000 popultation - age standardised)", title = "Female Hospitalisations for Self Harm in Villages, Towns and Cities")+
    stat_summary(data=femaleselfharm %>% filter(townclass == "Core City"|townclass == "Other City"), fun.y=mean, aes(group=group), geom="line", colour="navyblue", size=1.5) +
    stat_summary(data=femaleselfharm %>% filter(townclass == "Large Town"|townclass == "Medium Town"|townclass == "Small Town"), fun.y=mean, aes(group=group), geom="line", colour="lightblue", size=1.5)+
    annotate("text",label = "Towns", x = 2, y=250, colour="lightblue", size=6)+
    annotate("text",label = "Villages", x = 2, y=225, colour="blue", size=6)+
    annotate("text", label = "Cities", x = 2, y=207, colour="navyblue", size=6)
  ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "femaleselfharmplot.png", plot=femaleselfharmplot, width=8, height=5, dpi=600)
  
  maleselfharm <- maleselfharm[order(maleselfharm$`Time period`),]
  maleselfharm$PERIOD <- factor(maleselfharm$`Time period`)
  maleselfharm$group <- 1
  maleselfharmplot <- ggplot(data = maleselfharm, aes(x= PERIOD, y=Value, group=group))+
    theme_light()+
    stat_summary(data=maleselfharm %>% filter(townclass == "Village or smaller"), fun.y=mean, aes(group=group), geom="line", colour="blue", size=1.5) +
    labs(x = "Date", y = "Male Hospitalisations for Intentional Self Harm\n(per 100,000 popultation - age standardised)", title = "Male Hospitalisations for Self Harm in Villages, Towns and Cities")+
    # scaselfharm_x_discrete(breaks=c("2001 - 03","2002 - 04", "2003 - 05", "2004 - 06", "2005 - 07", "2006 - 08", "2007 - 09", "2008 - 10", "2009 - 11", "2010 - 12", "2011 - 13", "2012 - 14", "2013 - 15", "2014 - 16", "2015 - 17", "2016 - 18"), labels = c("2003","2004","2005","2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018"))+
    theme(axis.text.x = element_text(angle = 45, hjust = 1))+
    stat_summary(data=maleselfharm %>% filter(townclass == "Core City"|townclass == "Other City"), fun.y=mean, aes(group=group), geom="line", colour="navyblue", size=1.5) +
    stat_summary(data=maleselfharm %>% filter(townclass == "Large Town"|townclass == "Medium Town"|townclass == "Small Town"), fun.y=mean, aes(group=group), geom="line", colour="lightblue", size=1.5)+
    annotate("text",label = "Towns", x = 2, y=178, colour="lightblue", size=6)+
    annotate("text",label = "Villages", x = 2, y=131, colour="blue", size=6)+
    annotate("text", label = "Cities", x = 2, y=155, colour="navyblue", size=6)
  ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "maleselfharmplot.png", plot=maleselfharmplot, width=8, height=5, dpi=600)
  
  
####prescriptiongraphs for jones####
  
  
  antidepressantprescriptiontowns2019average <-  prescriptiontowns[which(prescriptiontowns$PERIOD>201900 &prescriptiontowns$Druggroup == "Antidepressant" ),]
  
  antidepressantaverage <- aggregate(antidepressantprescriptiontowns2019average[-c(1:67, 69)], antidepressantprescriptiontowns2019average["BUASD11CD"], mean)
  names(antidepressantaverage)[names(antidepressantaverage)=="actcostperperson"] <- "yearlyaverage"
  antidepressantprescriptiontowns2019average <- merge(antidepressantprescriptiontowns2019average, antidepressantaverage, by="BUASD11CD", all.x=TRUE)
  antidepressantsample <- antidepressantprescriptiontowns2019average[which(antidepressantprescriptiontowns2019average$PERIOD==201912 & antidepressantprescriptiontowns2019average$yearlyaverage>1100),]
  
  # selfharm <- Townhealthmaster[-c(2:29, 31:60)]
  # antidepressantprescriptiontowns2019average <- merge(antidepressantprescriptiontowns2019average, selfharm, by="BUASD11CD", all.x=TRUE)
  # 
  antidepressantprescriptiontowns2019average <- merge(antidepressantprescriptiontowns2019average, townclass, by="BUASD11CD", all.x=TRUE)
  antidepressantprescriptiontowns2019average[is.na(antidepressantprescriptiontowns2019average)] <- 0
  
  antidepressantprescriptiontowns2019average <- antidepressantprescriptiontowns2019average[which(antidepressantprescriptiontowns2019average$citytownclassification!="Core City (London)"), ]
  antidepressantprescriptiontowns2019average <- antidepressantprescriptiontowns2019average[which(antidepressantprescriptiontowns2019average$citytownclassification!="Other City"), ]
  antidepressantprescriptiontowns2019average <- antidepressantprescriptiontowns2019average[which(antidepressantprescriptiontowns2019average$citytownclassification!="Core City (outside London)"), ]
  antidepressantprescriptiontowns2019average <- antidepressantprescriptiontowns2019average[which(antidepressantprescriptiontowns2019average$citytownclassification!="Village or Small Community"), ]
  antidepressantprescriptiontowns2019average <- antidepressantprescriptiontowns2019average[which(antidepressantprescriptiontowns2019average$citytownclassification!="Village or Small Community in Conurbation"), ]
  
  
  newimdrank <-  antidepressantprescriptiontowns2019average[!duplicated(antidepressantprescriptiontowns2019average$BUASD11CD),]
  newimdrank <- newimdrank[order(newimdrank$imdrank),]
  
  newimdrank$newimdrank <- 1:nrow(newimdrank)
  newimdrank <- newimdrank[-c(2:71)]
  antidepressantprescriptiontowns2019average <- merge(antidepressantprescriptiontowns2019average, newimdrank, by="BUASD11CD", all.x=TRUE)
  

  
  
  
  
  andidepressantselfharmplot <- ggplot(data = subset(antidepressantprescriptiontowns2019average, PERIOD == "201912" & Druggroup == "Antidepressant"), aes(x=selfharm, y=yearlyaverage))+
    geom_point(color="navyblue",size=1)+
    theme_light()+
    geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
    labs(x = "Hospital Stays for Self Harm (Standardised Admission Ratio, 2013/14-2017/18)", y = "Cost of Antidepressant Prescriptions \n ( per 1000 registered patients, Average of Monthly Spend in 2019)", title = "Antidepressant Prescriptions and Hospital stays for Self Harm")
  ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "andidepressantselfharmplotnic2.png", plot=andidepressantselfharmplot, width=8, height=5, dpi=600)
  
####greenspaces and toilets####
  
  # buasd <-  readOGR("C:\\Users\\bengo\\OneDrive\\Documents\\", "buasd11")
  # list.files('C:\\Users\\bengo\\OneDrive\\Documents\\', pattern='\\.shp$')
  buasd <- shapefile("C:\\Users\\bengo\\OneDrive\\Documents\\buasd11.shp")
  bua <- shapefile("C:\\Users\\bengo\\OneDrive\\Documents\\bua11.shp")
  bua <- bua[which(bua$has_sd=="N"),]
  bua <- bua[-c(6)]
  names(bua)[names(bua)=="bua11cd"] <- "buasd11cd"
  names(bua)[names(bua)=="bua11nm"] <- "buasd11nm"
  names(bua)[names(bua)=="bua_id"] <- "buasd_id"
  names(bua)[names(bua)=="sd_count"] <- "bua_id"
  names(bua)[names(bua)=="urban_bua"] <- "sd_type"
  
  buasd <- rbind(bua, buasd)
  proj4string(buasd) <- crs("+init=epsg:27700")
  
  
  recreation1912 <- read_delim("recreation1912.csv", 
                               "|", escape_double = FALSE, col_types = cols(pointx_class = col_double()), 
                               trim_ws = TRUE)
  commons <- recreation1912[which(recreation1912$pointx_class==3180252|recreation1912$pointx_class==3180253|recreation1912$pointx_class==3180814), ]
  commons <- subset(commons, "feature_easting" != "" | "feature_northing" != "")
  commons$poi_ID <- 1:nrow(commons)
  coords <- cbind(Easting = as.numeric(as.character(commons$feature_easting)),
                  Northing = as.numeric(as.character(commons$feature_northing)))
  commonssp <- SpatialPointsDataFrame(coords, data = data.frame(commons$name,
                                                              commons$poi_ID), proj4string = CRS("+init=epsg:27700"))
  
  commonssp <- spTransform(commonssp, CRS("+init=epsg:4326"))
  
 
  commonssp@data$Long <- coordinates(commonssp)[, 1]
  commonssp@data$Lat <- coordinates(commonssp)[, 2]
  
  
  
 
  
  commonsspcent <- SpatialPointsDataFrame(gCentroid(commonssp, byid=TRUE), commonssp@data, match.ID=FALSE)
  
  
  commonsz <- as.ppp(commonsspcent)
  buasdcent <- SpatialPointsDataFrame(gCentroid(buasd, byid=TRUE), buasd@data, match.ID=FALSE)
  buasdz <- as.ppp(buasdcent)
  buasd$distance <- nncross(buasdz, commonsz, what="dist", k=1)
  buasd$which <- nncross(buasdz, commonsz, what="which", k=1)
  
  
  buasdcent2 <- buasdcent
  commonscent2 <- commonscent
    
 buasdcent2coords <-  latlong2grid(buasdcent@coords)
 aaaaaa <-  latlong2grid(commonsspcent@coords)
 
commonssp@data$Long <- coordinates(aaaaaa)[, 1]
 commonssp@data$Lat <- coordinates(aaaaaa)[, 2]
 
 buasd@data$Long <- coordinates(buasdcent2coords)[, 1]
 buasd@data$Lat <- coordinates(buasdcent2coords)[, 2]
 
 
 coords <- cbind(Easting = as.numeric(as.character(commonssp$Long)),
                 Northing = as.numeric(as.character(commonssp$Lat)))
 
 
 commonssp <- SpatialPointsDataFrame(coords, data = data.frame(commons$name,
                                                               commons$poi_ID), proj4string = CRS("+init=epsg:27700"))
 
 coords <- cbind(Easting = as.numeric(as.character(buasd$Long)),
                 Northing = as.numeric(as.character(buasd$Lat)))
 
 
 buasdcent <- SpatialPointsDataFrame(coords, data = data.frame(buasd$buasd11nm,
                                                               buasd$buasd11cd), proj4string = CRS("+init=epsg:27700"))
 commonsz <- as.ppp(commonssp)
 buasdz <- as.ppp(buasdcent)
 buasd$distance <- nncross(buasdz, commonsz, what="dist", k=1)
 
 
  # commons <- over(buasd, geometry(commonssp), returnList = TRUE)
  # commons <- sapply(commons, length)
  # commons <- spCbind(buasd, commons)
  # commonscent <- SpatialPointsDataFrame(gCentroid(commons, byid=TRUE), commons@data, match.ID=FALSE)

 
 distancetocommonspark <- as.data.frame(buasd[-c(1,2,4:11,13,14,15)])
 
 names(distancetocommonspark)[names(distancetocommonspark)=="buasd11cd"] <- "BUASD11CD"
 
####greenspace per person####
 
 buasd <- shapefile("C:\\Users\\bengo\\OneDrive\\Documents\\buasd11.shp")
 bua <- shapefile("C:\\Users\\bengo\\OneDrive\\Documents\\bua11.shp")
 bua <- bua[which(bua$has_sd=="N"),]
 bua <- bua[-c(6)]
 names(bua)[names(bua)=="bua11cd"] <- "buasd11cd"
 names(bua)[names(bua)=="bua11nm"] <- "buasd11nm"
 names(bua)[names(bua)=="bua_id"] <- "buasd_id"
 names(bua)[names(bua)=="sd_count"] <- "bua_id"
 names(bua)[names(bua)=="urban_bua"] <- "sd_type"
 
 buasd <- rbind(bua, buasd)
 proj4string(buasd) <- crs("+init=epsg:4326")
 
 
 recreation1912 <- read_delim("C:\\Users\\bengo\\OneDrive\\Documents\\recreation1912.csv", 
                              "|", escape_double = FALSE, col_types = cols(pointx_class = col_double()), 
                              trim_ws = TRUE)
 commons <- recreation1912[which(recreation1912$pointx_class==3180252|recreation1912$pointx_class==3180253|recreation1912$pointx_class==3180814), ]
 commons <- subset(commons, "feature_easting" != "" | "feature_northing" != "")
 commons$poi_ID <- 1:nrow(commons)
 coords <- cbind(Easting = as.numeric(as.character(commons$feature_easting)),
                 Northing = as.numeric(as.character(commons$feature_northing)))
 commonssp <- SpatialPointsDataFrame(coords, data = data.frame(commons$name,
                                                               commons$poi_ID), proj4string = CRS("+init=epsg:27700"))
 
 commonssp <- spTransform(commonssp, CRS("+init=epsg:4326"))
 
 commons <- over(buasd, geometry(commonssp), returnList = TRUE)
 
 commons <- sapply(commons, length)
 commons <- spCbind(buasd, commons)
 
 commons <- as.data.frame(commons[-c(1,2,4:11)])
 
 names(commons)[names(commons)=="buasd11cd"] <- "BUASD11CD"
 
 
 Townhealthmaster <- merge(Townhealthmaster, commons, by="BUASD11CD", all.x=TRUE)
 Townhealthmaster$commonsper <- Townhealthmaster$commons/(Townhealthmaster$lsoa18popbestfit/1000)
 
 playplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=commonsper))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Multiple Deprivation Rank (2019)", y = "Playground Density (n per 1000 population)", title = "Access to Playgrounds and Town Deprivation")+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "playplot.png", plot=playplot, width=8, height=5, dpi=600)
 
 Townhealthmaster <- Townhealthmaster %>% mutate(commonsfact=ifelse(Townhealthmaster$commons>0, 1, 0))
 
 
 
 Townhealthmaster$commonsfact <- factor( Townhealthmaster$commonsfact)
 

 maybe <- glm(commonsfact~coviddeaths, data=Townhealthmaster, family = "binomial")
 
 w<- plot_model(maybe ,type = "pred",  terms = c("coviddeaths"), title = "Predicted Probability of a Town-based park", axis.title = c( "Multiple Deprivation Rank", "Probability of Green Space in a Town"))+
   geom_line(colour="navyblue",linetype = "solid", size=2)+
   theme_minimal()+
   scale_fill_manual("navyblue")+
   scale_color_manual("navyblue")+
   geom_ribbon(aes(ymin=conf.low, ymax=conf.high), linetype=2, alpha=0.1, fill = "blue", colour="blue", size=1)+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprved\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 
 maybe <- glm(commonsfact~percovid, data=Townhealthmaster, family = "binomial")
 
 w<- plot_model(maybe ,type = "pred",  terms = c("percovid"), title = "Predicted Probability of a Town-based park", axis.title = c( "Multiple Deprivation Rank", "Probability of Green Space in a Town"))+
   geom_line(colour="navyblue",linetype = "solid", size=2)+
   theme_minimal()+
   scale_fill_manual("navyblue")+
   scale_color_manual("navyblue")+
   geom_ribbon(aes(ymin=conf.low, ymax=conf.high), linetype=2, alpha=0.1, fill = "blue", colour="blue", size=1)+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprved\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 
 maybe <- glm(commonsfact~covidperpop, data=Townhealthmaster, family = "binomial")
 
 w<- plot_model(maybe ,type = "pred",  terms = c("covidperpop"), title = "Predicted Probability of a Town-based park", axis.title = c( "Multiple Deprivation Rank", "Probability of Green Space in a Town"))+
   geom_line(colour="navyblue",linetype = "solid", size=2)+
   theme_minimal()+
   scale_fill_manual("navyblue")+
   scale_color_manual("navyblue")+
   geom_ribbon(aes(ymin=conf.low, ymax=conf.high), linetype=2, alpha=0.1, fill = "blue", colour="blue", size=1)+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprved\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 
 a <- glm(commonsfact~imdrank, data=Townhealthmaster, family = "binomial")
 
 w<- plot_model(a ,type = "pred",  terms = c("imdrank"), title = "Predicted Probability of a Town-based park", axis.title = c( "Multiple Deprivation Rank", "Probability of Green Space in a Town"))+
     geom_line(colour="navyblue",linetype = "solid", size=2)+
     theme_minimal()+
     scale_fill_manual("navyblue")+
     scale_color_manual("navyblue")+
     geom_ribbon(aes(ymin=conf.low, ymax=conf.high), linetype=2, alpha=0.1, fill = "blue", colour="blue", size=1)+
     scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprved\nTown", "Least Deprived\nTown"))+
     theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
    
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "greenspaceintown.png", plot=w, width=8, height=5, dpi=600)

 
  Townhealthmaster$perverygoodhealth <-  Townhealthmaster$perverygoodhealth*100

  b<- glm(commonsfact~perverygoodhealth, data=Townhealthmaster, family = "binomial")
z<- plot_model(b ,type = "pred",  terms = c("perverygoodhealth"), title = "Predicted Probability of a Town-based park", axis.title = c( "Self Reported Health\n(Percentage reporting 'Very Good' General Health, 2011)", "Probability of Green Space in a Town"))+
  geom_line(colour="navyblue",linetype = "solid", size=2)+
  geom_point(alpha=0.5)+
  theme_minimal()+
  scale_fill_manual("navyblue")+
  scale_color_manual("navyblue")+
  geom_ribbon(aes(ymin=conf.low, ymax=conf.high), linetype=2, alpha=0.1, fill = "blue", colour="blue", size=1)

ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "greenspaceintownhealth.png", plot=z, width=8, height=5, dpi=600)


 
  #####greenspaceplot####
 
 
 Townhealthmaster <- merge(Townhealthmaster, distancetocommonspark, by="BUASD11CD", all.x=TRUE)

 Townhealthmaster <- merge(Townhealthmaster, townclass, by="BUASD11CD", all.x=TRUE)
 Townhealthmaster[is.na(Townhealthmaster)] <- 0
 Townhealthmaster <- Townhealthmaster[which(Townhealthmaster$citytownclassification!="Core City (London)"), ]
 Townhealthmaster <- Townhealthmaster[which(Townhealthmaster$citytownclassification!="Other City"), ]
 Townhealthmaster <- Townhealthmaster[which(Townhealthmaster$citytownclassification!="Core City (outside London)"), ]
 Townhealthmaster <- Townhealthmaster[which(Townhealthmaster$citytownclassification!="Village or Small Community"), ]
 Townhealthmaster <- Townhealthmaster[which(Townhealthmaster$citytownclassification!="Village or Small Community in Conurbation"), ]
 
 greendepplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=distance))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Multiple Deprivation Rank (2019)", y = "Distance from a park/ commons centre (~km)", title = "Access to Green Spaces and Town Deprivation")+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "greendepplot.png", plot=greendepplot, width=8, height=5, dpi=600)
 
 greenselfharmplot <- ggplot(Townhealthmaster, aes(x=selfharm, y=distance))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Hospital Stays for Self Harm (Standardised Admission Ratio, 2013/14-2017/18)", y = "Distance from a park/ commons centre (~km)", title = "Access to Green Spaces and Hospitalisations for Self Harm")
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "greenselfharmplot.png", plot=greenselfharmplot, width=8, height=5, dpi=600)
 
 
 
 ####playgroundsperperson####
 
 
 
 buasd <- shapefile("C:\\Users\\bengo\\OneDrive\\Documents\\buasd11.shp")
 bua <- shapefile("C:\\Users\\bengo\\OneDrive\\Documents\\bua11.shp")
 bua <- bua[which(bua$has_sd=="N"),]
 bua <- bua[-c(6)]
 names(bua)[names(bua)=="bua11cd"] <- "buasd11cd"
 names(bua)[names(bua)=="bua11nm"] <- "buasd11nm"
 names(bua)[names(bua)=="bua_id"] <- "buasd_id"
 names(bua)[names(bua)=="sd_count"] <- "bua_id"
 names(bua)[names(bua)=="urban_bua"] <- "sd_type"
 
 buasd <- rbind(bua, buasd)
 proj4string(buasd) <- crs("+init=epsg:4326")
 
 
 recreation1912 <- read_delim("recreation1912.csv", 
                              "|", escape_double = FALSE, col_types = cols(pointx_class = col_double()), 
                              trim_ws = TRUE)
 play <- recreation1912[which(recreation1912$pointx_class==3180255), ]
 play <- subset(play, "feature_easting" != "" | "feature_northing" != "")
 play$poi_ID <- 1:nrow(play)
 coords <- cbind(Easting = as.numeric(as.character(play$feature_easting)),
                 Northing = as.numeric(as.character(play$feature_northing)))
 playsp <- SpatialPointsDataFrame(coords, data = data.frame(play$name,
                                                               play$poi_ID), proj4string = CRS("+init=epsg:27700"))

 
 playsp <- spTransform(playsp, CRS("+init=epsg:4326"))
 


 play <- over(buasd, geometry(playsp), returnList = TRUE)
 
 play <- sapply(play, length)
 play <- spCbind(buasd, play)

 play <- as.data.frame(play[-c(1,2,4:11)])
 
 names(play)[names(play)=="buasd11cd"] <- "BUASD11CD"
 
 
 Townhealthmaster <- merge(Townhealthmaster, play, by="BUASD11CD", all.x=TRUE)
 Townhealthmaster$playper <- Townhealthmaster$play/(Townhealthmaster$lsoa18popbestfit/1000)
 
 playplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=playper))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Multiple Deprivation Rank (2019)", y = "Playground Density (n per 1000 population)", title = "Access to Playgrounds and Town Deprivation")+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "playplot.png", plot=playplot, width=8, height=5, dpi=600)
 
 greenselfharmplot <- ggplot(Townhealthmaster, aes(x=selfharm, y=playper))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Hospital Stays for Self Harm (Standardised Admission Ratio, 2013/14-2017/18)", y = "Distance from a park/ commons centre (~km)", title = "Access to Green Spaces and Hospitalisations for Self Harm")
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "greenselfharmplot.png", plot=greenselfharmplot, width=8, height=5, dpi=600)
 
 
 
 ####fastfood####
 
 
 
 buasd <- shapefile("C:\\Users\\bengo\\OneDrive\\Documents\\buasd11.shp")
 bua <- shapefile("C:\\Users\\bengo\\OneDrive\\Documents\\bua11.shp")
 bua <- bua[which(bua$has_sd=="N"),]
 bua <- bua[-c(6)]
 names(bua)[names(bua)=="bua11cd"] <- "buasd11cd"
 names(bua)[names(bua)=="bua11nm"] <- "buasd11nm"
 names(bua)[names(bua)=="bua_id"] <- "buasd_id"
 names(bua)[names(bua)=="sd_count"] <- "bua_id"
 names(bua)[names(bua)=="urban_bua"] <- "sd_type"
 
 buasd <- rbind(bua, buasd)
 proj4string(buasd) <- crs("+init=epsg:4326")
 
 
 fastfood <- read_delim("fastfooddec19.csv", 
                              "|", escape_double = FALSE, col_types = cols(pointx_class = col_double()), 
                              trim_ws = TRUE)
 fastfood <- fastfood[which(fastfood$pointx_class==1020018), ]
 fastfood <- subset(fastfood, "feature_easting" != "" | "feature_northing" != "")
 fastfood$poi_ID <- 1:nrow(fastfood)
 coords <- cbind(Easting = as.numeric(as.character(fastfood$feature_easting)),
                 Northing = as.numeric(as.character(fastfood$feature_northing)))
 fastfoodsp <- SpatialPointsDataFrame(coords, data = data.frame(fastfood$name,
                                                            fastfood$poi_ID), proj4string = CRS("+init=epsg:27700"))
 
 
 fastfoodsp <- spTransform(fastfoodsp, CRS("+init=epsg:4326"))
 
 
 
 fastfood <- over(buasd, geometry(fastfoodsp), returnList = TRUE)
 
 fastfood <- sapply(fastfood, length)
 fastfood <- spCbind(buasd, fastfood)
 
 fastfood <- as.data.frame(fastfood[-c(1,2,4:11)])
 
 names(fastfood)[names(fastfood)=="buasd11cd"] <- "BUASD11CD"
 
 
 Townhealthmaster <- merge(Townhealthmaster, fastfood, by="BUASD11CD", all.x=TRUE)
 Townhealthmaster$fastfoodper <- Townhealthmaster$fastfood/(Townhealthmaster$lsoa18popbestfit/1000)
 
 fastfoodplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=fastfoodper))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Multiple Deprivation Rank (2019)", y = "Fast Food Shops\n(N per 1000 population)", title = "Fast Food Shops and Town Deprivation")+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "fastfoodplot.png", plot=fastfoodplot, width=8, height=5, dpi=600)
 
 foodobesityplot <- ggplot(Townhealthmaster, aes(x=Obesechildrenyear6per, y=fastfoodper))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Obesity at Year 6 (%, 2015/16-2017/18)", y = "Fast Food Shops\n(N per 1000 population)", title = "Fast Food Density and Child Obesity")
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "foodobesityplot.png", plot=foodobesityplot, width=8, height=5, dpi=600)
 
 
 ####toilets####
 
 
 
 buasd <- shapefile("C:\\Users\\bengo\\OneDrive\\Documents\\buasd11.shp")
 bua <- shapefile("C:\\Users\\bengo\\OneDrive\\Documents\\bua11.shp")
 bua <- bua[which(bua$has_sd=="N"),]
 bua <- bua[-c(6)]
 names(bua)[names(bua)=="bua11cd"] <- "buasd11cd"
 names(bua)[names(bua)=="bua11nm"] <- "buasd11nm"
 names(bua)[names(bua)=="bua_id"] <- "buasd_id"
 names(bua)[names(bua)=="sd_count"] <- "bua_id"
 names(bua)[names(bua)=="urban_bua"] <- "sd_type"
 
 buasd <- rbind(bua, buasd)
 proj4string(buasd) <- crs("+init=epsg:4326")
 
 
 loos <- read_delim("C:\\Users\\bengo\\OneDrive\\Documents\\infrdec19.csv", 
                        "|", escape_double = FALSE, col_types = cols(pointx_class = col_double()), 
                        trim_ws = TRUE)
 loos <- loos[which(loos$pointx_class==6340461), ]
 loos <- subset(loos, "feature_easting" != "" | "feature_northing" != "")
 loos$poi_ID <- 1:nrow(loos)
 coords <- cbind(Easting = as.numeric(as.character(loos$feature_easting)),
                 Northing = as.numeric(as.character(loos$feature_northing)))
 loossp <- SpatialPointsDataFrame(coords, data = data.frame(loos$name,
                                                                loos$poi_ID), proj4string = CRS("+init=epsg:27700"))
 
 
 loossp <- spTransform(loossp, CRS("+init=epsg:4326"))
 
 
 
 loos <- over(buasd, geometry(loossp), returnList = TRUE)
 
 loos <- sapply(loos, length)
 loos <- spCbind(buasd, loos)
 
 loos <- as.data.frame(loos[-c(1,2,4:11)])
 
 names(loos)[names(loos)=="buasd11cd"] <- "BUASD11CD"
 
 
 Townhealthmaster <- merge(Townhealthmaster, loos, by="BUASD11CD", all.x=TRUE)
 Townhealthmaster$loosper <- Townhealthmaster$loos/(Townhealthmaster$lsoa18popbestfit/1000)
 
 loosplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=loosper))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Multiple Deprivation Rank (2019)", y = "Public Toilets\n(N per 1000 population)", title = "Public Toilets and Town Deprivation")+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "loosplot.png", plot=loosplot, width=8, height=5, dpi=600)
 
 loohleplot <- ggplot(Townhealthmaster, aes(x=hlefemale, y=loosper))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Healthy Life Expectancy at Birth (Female, 2009-13)", y = "Public Toilets\n(N per 1000 population)", title = "Public Toilet Density and Healthy Life Expectancy")
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "loohleplot.png", plot=loohleplot, width=8, height=5, dpi=600)
 
 
 over70 <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\seventyplus.csv")
 over70 <- merge(over70, lsoalookup, by="LSOA11CD", all.x=TRUE)
 
 over70 <- aggregate(over70[-c(1,4,5)], over70["BUASD11CD"], sum)
 over70$over70per <- (over70$seventyplus/ over70$`All Ages`)*100 
 
 over70 <- over70[-c(2,3)]
 
 
 Townhealthmaster <- merge(Townhealthmaster, over70, by="BUASD11CD", all.x=TRUE)
 
 loooldplot <- ggplot(Townhealthmaster, aes(x=over70per, y=loosper))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Percentage of the Population Aged over 70", y = "Public Toilets\n(N per 1000 population)", title = "Public Toilet Density and Older Populations")
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "loooldplot.png", plot=loooldplot, width=8, height=5, dpi=600)

 Townhealthmaster <- Townhealthmaster %>% mutate(oldanddep = ifelse(Townhealthmaster$over70per>25 & Townhealthmaster$imdrank<301,  1, 0))

 Townhealthmaster$oldanddep <- factor(Townhealthmaster$oldanddep)

 oldanddepsample <- Townhealthmaster[which(Townhealthmaster$oldanddep==1),]
  
 olddepplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=over70per))+
   geom_point(colour="navyblue", aes(alpha= oldanddep, size=oldanddep))+
   theme_light()+
   geom_text_repel(data=Townhealthmaster %>% filter(oldanddep==1),
                   aes(label=oldanddepsample$`Town Name`), size=2, color="black")+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Multiple Deprivation Rank (2019)", y = "Percentage of the Population Aged over 70", title = "Town Age and Town Deprivation")+
   scale_size_discrete(range = c(1,1.25))+
   scale_alpha_discrete(range = c(0.25, 1))+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
   theme(legend.position =  "none")
 
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "olddepplot.png", plot=olddepplot, width=8, height=5, dpi=600)
 
 ####hipfracture data####
 
 hip <- MSOAdatabua[which(MSOAdatabua$`Indicator Name`=="Emergency hospital admissions for hip fracture in persons 65 years and over, standardised admission ratio"), ]
 hippartial<- hip[-c(1:26, 29)]
 hippartial <- aggregate(hippartial[-2], hippartial["BUASD11CD"], sum)
 names(hippartial)[names(hippartial)=="partialdata"] <- "partialdatahip"
 hip <- hip[complete.cases(hip$Value),]
 hip <- hip[-c(1:12, 16:26, 29)]
 
 hippop <- hip[-c(1:4)]
 hippop <- aggregate(hippop[-c(1)], hippop["BUASD11CD"], sum)
 names(hippop)[names(hippop)=="msoa18pop"] <- "msoa18popbestfit"
 
 
 
 hip <- merge(hip, hippop, by="BUASD11CD", all.x=TRUE)
 hip$hip <- hip$Value*(hip$msoa18pop/hip$msoa18popbestfit)
 hip$lower95hip <- hip$`Lower CI 95.0 limit`*(hip$msoa18pop/hip$msoa18popbestfit)
 hip$upper95hip <- hip$`Upper CI 95.0 limit`*(hip$msoa18pop/hip$msoa18popbestfit)
 hip <- hip[-c(2:7)]
 hip <- aggregate(hip[-c(1)], hip["BUASD11CD"], sum)
 hip <- merge(hip,hippartial, by="BUASD11CD", all.x=TRUE )
 hip <- hip[-c(6)]
 
 Townhealthmaster <- merge(Townhealthmaster, hip, by="BUASD11CD", all.x=TRUE)
 
 
 hiplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=hip))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Multiple Deprivation Rank (2019)", y = "Emergency hospital admissions for hip fracture\nin persons 65 years and over\n(standardised admission ratio)", title = "Hip Fracture Hospitalisations and Town Deprivation")+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "hiplot.png", plot=hiplot, width=8, height=5, dpi=600)
 
 hiplotage <- ggplot(Townhealthmaster, aes(x=over70per, y=hip))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Percentage aged over 70 Years Old", y = "Emergency hospital admissions for hip fracture\nin persons 65 years and over\n(standardised admission ratio)", title = "Hip Fracture Hospitalisations and Old Age Population")
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "hiplotage.png", plot=hiplotage, width=8, height=5, dpi=600)
 
 selfharmdepplo <- ggplot(Townhealthmaster, aes(x=imdrank, y=selfharm))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Multiple Deprivation Rank (2019)", y = "Hospital Stays for Self Harm\n(Standardised Admission Ratio, 2013/14-2017/18)", title = "Number of Hospital Admissions for Self Harm and Town Deprivation")
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "selfharmdepplo.png", plot=selfharmdepplo, width=8, height=5, dpi=600)
 
obesitydepplo <- ggplot(Townhealthmaster, aes(x=imdrank, y=Obesechildrenyear6per))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Multiple Deprivation Rank (2019)", y = "Child Obesity at Year 6\n(%, 2015/16-2017/18)", title = "Child Obesity at Year 6 and Town Deprivation")
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "obesitydepplo.png", plot=obesitydepplo, width=8, height=5, dpi=600)
 
 alcoholdepplo <- ggplot(Townhealthmaster, aes(x=imdrank, y=alcohol))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Multiple Deprivation Rank (2019)", y = "Hospital Stays for Alcohol-related Harm (broad definiton)\n(Standardised Admission Ratio, 2013/14-2017/18)", title = "Number of Hospital Admissions for Alcohol-related Harm and Town Deprivation")
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "alcoholdepplo.png", plot=alcoholdepplo, width=8, height=5, dpi=600)
 
 lnugcancerdepplo <- ggplot(Townhealthmaster, aes(x=imdrank, y=lungcancer))+
   geom_point(colour="navyblue", alpha=0.5, size=2)+
   theme_light()+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Multiple Deprivation Rank (2019)", y = "Incidence of Lung Cancer\n(Standardised Incidence Ratio, 2012-16)", title = "Lung Cancer Incidence and Town Deprivation")
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "lnugcancerdepplo.png", plot=lnugcancerdepplo, width=8, height=5, dpi=600)
 
 
 ####improvementindex buasd####
 
 ##index of decline##
 
 engpop01 <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\lsoapop01.csv")
 engpop11 <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\lsoapop11.csv")
 engyoung01 <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\lsoapop01.csv")
 engyoung11 <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\lsoapop11.csv")
 engbus10 <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\lsoa10bus.csv")
 engbus18 <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\lsoa16bus.csv")
 engdegree01 <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\lsoa01qual.csv")
 engdegree11 <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\lsoa11qual.csv")
 engemp01 <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\lsoaemp01.csv")
 engemp11 <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\lsoaemp11.csv")
 lsoatolsoa <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\lsoa01tolsoa11.csv")
 
 
 engyoung01$young01 <- (engyoung01$`Age 15`+engyoung01$`Age 16 to 17`+engyoung01$`Age 18 to 19`)
 engyoung11$young11 <- (engyoung11$`Age 15`+engyoung11$`Age 16 to 17`+engyoung11$`Age 18 to 19`)
 
 engyoung11 <- engyoung11[-c(3,4,5)]
 engyoung01 <- engyoung01[-c(3,4,5)]
 
 engdegree01$degree01 <- (engdegree01$`Highest level of qualification: Level 3 qualifications`+engdegree01$`Highest level of qualification: Level 4 qualifications and above`)
 engdegree11$degree11 <- (engdegree11$`Highest level of qualification: Level 3 qualifications`+engdegree11$`Highest level of qualification: Level 4 qualifications and above`)
 
 engdegree11 <- engdegree11[-c(3,4)]
 engdegree01 <- engdegree01[-c(3,4)]
 
 
 
 engpop01 <- engpop01[-c(3,4,5)]
 engpop11 <- engpop11[-c(3,4,5)]
 
 engpop01 <- merge(engpop01, lsoatolsoa, by="LSOA01CD", all.x=TRUE)
 engyoung01 <- merge(engyoung01, lsoatolsoa, by="LSOA01CD", all.x=TRUE)
 engdegree01 <- merge(engdegree01, lsoatolsoa, by="LSOA01CD", all.x=TRUE)
 engemp01 <- merge(engemp01, lsoatolsoa, by="LSOA01CD", all.x=TRUE)
 
 
 engpop01 <- engpop01[-c(1)]
 engyoung01 <- engyoung01[-c(1)]
 engdegree01 <- engdegree01[-c(1)]
 engemp01 <- engemp01[-c(1)]
 
 names(engemp01)[names(engemp01)=="All usual residents aged 16 to 74"] <- "pop01"
 names(engemp11)[names(engemp11)=="All usual residents aged 16 to 74"] <- "pop11"
 names(engemp01)[names(engemp01)=="Economically active: In employment"] <- "emp01"
 names(engemp11)[names(engemp11)=="Economically active: In employment"] <- "emp11"
 names(engpop01)[names(engpop01)=="All usual residents"] <- "pop01"
 names(engpop11)[names(engpop11)=="All usual residents"] <- "pop11"
 names(engyoung01)[names(engyoung01)=="All usual residents"] <- "pop01"
 names(engyoung11)[names(engyoung11)=="All usual residents"] <- "pop11"
 names(engdegree01)[names(engdegree01)=="All people aged 16-74"] <- "pop01"
 names(engdegree11)[names(engdegree11)=="All categories: Highest level of qualification"] <- "pop11"
 names(engbus10)[names(engbus10)=="LSOA01CD"] <- "LSOA11CD"
 
 
 engyoung <- merge(engyoung01, engyoung11, by="LSOA11CD", all.x=TRUE)
 engyoung <- merge(engyoung, lsoalookup, by="LSOA11CD", all.x=TRUE)
 engyoung <- aggregate(engyoung[-c(1,6,7)], engyoung["BUASD11CD"], sum)
 engyoung$young01per <- (engyoung$young01/engyoung$pop01)*100
 engyoung$young11per <- (engyoung$young11/engyoung$pop11)*100
 engyoung$youngchange <- engyoung$young11per-engyoung$young01per
 engyoung <- engyoung[-c(2,3,4,5)]
 
 engdegree <- merge(engdegree01, engdegree11, by="LSOA11CD", all.x=TRUE)
 engdegree <- merge(engdegree, lsoalookup, by="LSOA11CD", all.x=TRUE)
 engdegree <- aggregate(engdegree[-c(1,6,7)], engdegree["BUASD11CD"], sum)
 engdegree$degree01per <- (engdegree$degree01/engdegree$pop01)*100
 engdegree$degree11per <- (engdegree$degree11/engdegree$pop11)*100
 engdegree$degreechange <- engdegree$degree11per-engdegree$degree01per
 engdegree <- engdegree[-c(2,3,4,5)]
 
 engemp <- merge(engemp01, engemp11, by="LSOA11CD", all.x=TRUE)
 engemp <- merge(engemp, lsoalookup, by="LSOA11CD", all.x=TRUE)
 engemp <- aggregate(engemp[-c(1,6,7)], engemp["BUASD11CD"], sum)
 engemp$emp01per <- (engemp$emp01/engemp$pop01)*100
 engemp$emp11per <- (engemp$emp11/engemp$pop11)*100
 engemp$empchange <- engemp$emp11per-engemp$emp01per
 engemp <- engemp[-c(2,3,4,5)]
 
    
 engpop <- merge(engpop01, engpop11, by="LSOA11CD", all.x=TRUE)
 engpop$popchange <- engpop$pop11-engpop$pop01
 engpop <- merge(engpop, lsoalookup, by="LSOA11CD", all.x=TRUE)
 engpop <- aggregate(engpop[-c(1,5,6)], engpop["BUASD11CD"], sum)
 
 engbus <- merge(engbus10, engbus18, by="LSOA11CD", all.x=TRUE)
 names(engbus)[names(engbus)=="buscount"] <- "buscount10"
 names(engbus)[names(engbus)=="LSOA11CD"] <- "MSOA11CD"
 
 engbus$buschange <- engbus$buscount16-engbus$buscount10
 engbus <- merge(engbus, msoalookup, by="MSOA11CD", all.x=TRUE)
 engbus <- aggregate(engbus[-c(1,5,6)], engbus["BUASD11CD"], sum)
 

 
 
 
 indexdecline <- merge(engemp, engyoung, by="BUASD11CD")
 indexdecline <- merge(indexdecline, engbus, by="BUASD11CD")
 indexdecline <- merge(indexdecline, engpop, by="BUASD11CD")
 indexdecline <- merge(indexdecline, engdegree, by="BUASD11CD")
 
 
 indexdecline <- merge(indexdecline, towns, by="BUASD11CD", all.x=TRUE)
 
 indexdecline <- indexdecline[complete.cases(indexdecline$BUASD11NM),]

 indexdeclinestandardised<- indexdecline %>% 
   psycho::standardize() 
 
 indexdeclinestandardised <- indexdeclinestandardised %>% dplyr::rename_all(paste0, "standardised")
 names(indexdeclinestandardised)[names(indexdeclinestandardised)=="BUASD11CDstandardised"] <- "BUASD11CD"
 


 indexdecline <- merge(indexdecline, indexdeclinestandardised, by="BUASD11CD")
 
 indexdecline$growth <- indexdecline$empchangestandardised + indexdecline$youngchangestandardised + indexdecline$buschangestandardised + indexdecline$popchangestandardised +indexdecline$degreechangestandardised

 #####quickindexdeclineplots####
 
 
 indexonly <- indexdecline[c(1,34)]
 
 Townhealthmaster <- merge(Townhealthmaster, indexonly, by="BUASD11CD", all.x=TRUE)
 
 obesityyr6depplot <- ggplot(Townhealthmaster, aes(x=growth, y=percovid))+
   geom_point(color="navyblue", alpha=0.5, size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   # geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
   #                 aes(label=towndealsample$`Town Name`), size=2, color="black")+
   labs(x = "Improvement Index", y = "Obesity at Year 6 (%, 2015/16-2017/18)", title = "Child Obesity at Year 6 and Town Economic Improvement")+
   scale_x_continuous(breaks=c(-10,0,14.5), labels = c("Most Declining Town","English Average" ,"Most Improving Town"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 
 obesityyr6depplot <- ggplot(Townhealthmaster, aes(x=growth, y=over70per))+
   geom_point(color="navyblue", alpha=0.5, size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   # geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
   #                 aes(label=towndealsample$`Town Name`), size=2, color="black")+
   labs(x = "Improvement Index", y = "Obesity at Year 6 (%, 2015/16-2017/18)", title = "Child Obesity at Year 6 and Town Economic Improvement")+
   scale_x_continuous(breaks=c(-10,0,14.5), labels = c("Most Declining Town","English Average" ,"Most Improving Town"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 #ggsave("Figure17health.png", plot=obesityyr6depplot, width=14, height=8, dpi=600)
 
 hlefemaledepplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=hlefemale))+
   geom_point(color="navyblue", alpha=0.5,size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Multiple Deprivation Rank (2019)", y = "Healthy Life Expectancy at Birth\n(Female, 2009-13)", title = "Female Healthy Life Expectancy and Town Deprivation")+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   scale_y_continuous(limits = c(50,80))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "hlefemale.png", plot=hlefemaledepplot, width=14, height=8, dpi=600)
 
 hlemaledepplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=hlemale))+
   geom_point(color="navyblue", alpha=0.5,size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   labs(x = "Multiple Deprivation Rank (2019)", y = "Healthy Life Expectancy at Birth\n(Male, 2009-13)", title = "Male Healthy Life Expectancy and Town Deprivation")+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   scale_y_continuous(limits = c(50,80))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "hlemale.png", plot=hlemaledepplot, width=14, height=8, dpi=600)
 
 
 
 
 #####housingcoronaplot####
 
 
 loneparents <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\lineparentdetails.csv")
 loneparent <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\loneparents.csv")
 loneparents <- merge(loneparents, loneparent, by="LSOA11CD", all.x=TRUE)
 loneparents <- loneparents[-c(7)]
 
 loneparents <- merge(loneparents, lsoalookup, by="LSOA11CD", all.x=TRUE)
 
 loneparents <- aggregate(loneparents[-c(1,7,8)], loneparents["BUASD11CD"], sum)
 loneparents$loneparentper <- (loneparents$`All lone parent housholds with dependent children`/ loneparents$`All categories: Household composition`)*100 
 loneparents$femaleper <- (loneparents$`Female lone parent: Total`/ loneparents$`All lone parent housholds with dependent children`)*100 
 loneparents$unempperper <- (loneparents$`Lone parent not in employment: Total` / loneparents$`All lone parent housholds with dependent children`)*100 
 
 loneparents <- loneparents[-c(2,3,4,5,6)]
 Townhealthmaster <- merge(Townhealthmaster, loneparents, by="BUASD11CD", all.x=TRUE)

 Townhealthmaster <- Townhealthmaster %>% mutate(lone = ifelse(Townhealthmaster$loneparentper>12,  1, 0))

 Townhealthmaster$lone <- factor(Townhealthmaster$lone)

 lonesample <- Townhealthmaster[which(Townhealthmaster$lone==1),]

 
 
 coronaloneplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=loneparentper))+
   geom_point(color="navyblue", aes(alpha= lone, size=lone))+
   theme_light()+
   geom_text_repel(data=Townhealthmaster %>% filter(lone==1),
                   aes(label=lonesample$`Town Name`), size=2, color="black")+
   labs(x = "Deprivation Rank", y = "Households Occupied by Lone Parent\nwith Dependent Children (%)", title = "Lone Parents with Dependent children")+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   scale_alpha_discrete(range = c(0.25, 1))+
   scale_size_discrete(range = c(1,1.25))+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
      theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
   theme(legend.position =  "none")
 #ggsave("coronaplotcar.png", plot=coronaplotcar, width=8, height=5, dpi=600)
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "coronaloneplot.png", plot=coronaloneplot, width=8, height=5, dpi=600)
 
 coronaloneunempplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=unempperper))+
   geom_point(color="navyblue", alpha=0.5, size=2)+
   theme_light()+
      labs(x = "Deprivation Rank", y = "Lone Parent Households which are Unmployed (%)", title = "Unemployment in Lone Parent Households")+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
    scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
   theme(legend.position =  "none")
 #ggsave("coronaplotcar.png", plot=coronaplotcar, width=8, height=5, dpi=600)
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "coronaloneunempplot.png", plot=coronaloneunempplot, width=8, height=5, dpi=600)
 
 coronalonegenderplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=femaleper))+
   geom_point(color="navyblue", alpha=0.5, size=2)+
   theme_light()+
   labs(x = "Deprivation Rank", y = "Lone Parent Households with Female Parent (%)", title = "Percentage of Lone Parent Households with Female Parent")+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))+
   theme(legend.position =  "none")
 #ggsave("coronaplotcar.png", plot=coronaplotcar, width=8, height=5, dpi=600)
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "coronalonegenderplot.png", plot=coronalonegenderplot, width=8, height=5, dpi=600)
 
 subvgooddepplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=perverygoodhealth))+
   geom_point(color="navyblue", alpha=0.5 ,size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   # geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
   #                 aes(label=towndealsample$`Town Name`), size=2, color="black")+
    labs(x = "Multiple Deprivation Rank (2019)", y = "Respondants reporting 'Very Good Health' (%, 2011)", title = "Subjectively 'Very Good' Health and Town Deprivation")+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "subvgooddepplot.png", plot=subvgooddepplot, width=8, height=5, dpi=600)
 
 
 ####best and worst maps####
 
 
 buasd <- shapefile("C:\\Users\\bengo\\OneDrive\\Documents\\buasd11.shp")
 bua <- shapefile("C:\\Users\\bengo\\OneDrive\\Documents\\bua11.shp")
 bua <- bua[which(bua$has_sd=="N"),]
 bua <- bua[-c(6)]
 names(bua)[names(bua)=="bua11cd"] <- "buasd11cd"
 names(bua)[names(bua)=="bua11nm"] <- "buasd11nm"
 names(bua)[names(bua)=="bua_id"] <- "buasd_id"
 names(bua)[names(bua)=="sd_count"] <- "bua_id"
 names(bua)[names(bua)=="urban_bua"] <- "sd_type"
 
 buasd <- rbind(bua, buasd)
 proj4string(buasd) <- crs("+init=epsg:4326")
 
 
 Townhealthmaster <-Townhealthmaster %>% mutate(hlepicks = ifelse(Townhealthmaster$hlefemale <= 56.55, "Lowest Healthy Life Expectancy", ifelse(Townhealthmaster$hlefemale >= 73.02, "Highest Healthy Life Expectancy",  NA)))
 
 Townhlesample <- Townhealthmaster[complete.cases(Townhealthmaster$hlepicks),]
 names(Townhlesample)[names(Townhlesample)=="BUASD11CD"] <- "buasd11cd"
 
 
 Townhlesample <-merge(buasd, Townhlesample, by="buasd11cd")
 Townhlesample <-Townhlesample[c(1,72)]
 
 Townhlesample <- sp.na.omit(Townhlesample)
 
 
 Townhlesample <- spTransform(Townhlesample, CRS("+init=epsg:4326"))
 Townhlesample <- SpatialPointsDataFrame(gCentroid(Townhlesample, byid=TRUE), Townhlesample@data, match.ID=FALSE)
 Townhlesample$hlepicks <- factor(Townhlesample$hlepicks)
 
 
 getColorp <- function(Townhlesample) {
   sapply(Townhlesample$hlepicks, function(hlepicks) {
     if(hlepicks == "Lowest Healthy Life Expectancy") {
       "red"
     }  else {
       "pink"
     } })
 }
 
 icons <- awesomeIcons(
   icon = 'ios-close',
   iconColor = 'black',
   library = 'ion',
   markerColor = getColorp(Townhlesample))
 
 mymap <- leaflet(data=Townhlesample) %>%
   addTiles() %>%  
   setView(lng=-1.82, lat=53, zoom=7) 
 mymap <- addAwesomeMarkers(mymap, icon = icons, data=Townhlesample, labelOptions = labelOptions(noHide = T))%>%
   addLegend(
     position = "bottomright",
     colors = c("red", "pink"),
     labels = c("Lowest Healthy Life Expectancy", "Highest Healthy Life Expectancy"), opacity = 1,
     title = "Longest and Shortest Healthy Life Expectancies")
 mapshot(mymap, file="hlemap.png", zoom=20, vwidth=740, vheight=920)  
 
 
 
 
 Townhealthmaster <-Townhealthmaster %>% mutate(selfharmpicks = ifelse(Townhealthmaster$selfharm <= 41.85, "Lowest Self-Harm Hospitalisation Rates", ifelse(Townhealthmaster$selfharm >= 209.49, "Highest Self-Harm Hospitalisation Rates",  NA)))
 
 Townselfharmsample <- Townhealthmaster[complete.cases(Townhealthmaster$selfharmpicks),]
 names(Townselfharmsample)[names(Townselfharmsample)=="BUASD11CD"] <- "buasd11cd"
 
 
 Townselfharmsample <-merge(buasd, Townselfharmsample, by="buasd11cd")
 Townselfharmsample <-Townselfharmsample[c(1,73)]
 
 Townselfharmsample <- sp.na.omit(Townselfharmsample)
 
 
 Townselfharmsample <- spTransform(Townselfharmsample, CRS("+init=epsg:4326"))
 Townselfharmsample <- SpatialPointsDataFrame(gCentroid(Townselfharmsample, byid=TRUE), Townselfharmsample@data, match.ID=FALSE)
 Townselfharmsample$selfharmpicks <- factor(Townselfharmsample$selfharmpicks)
 
 
 getColorp <- function(Townselfharmsample) {
   sapply(Townselfharmsample$selfharmpicks, function(selfharmpicks) {
     if(selfharmpicks == "Highest Self-Harm Hospitalisation Rates") {
       "red"
     }  else {
       "pink"
     } })
 }
 
 icons <- awesomeIcons(
   icon = 'ios-close',
   iconColor = 'black',
   library = 'ion',
   markerColor = getColorp(Townselfharmsample))
 
 mymap <- leaflet(data=Townselfharmsample) %>%
   addTiles() %>%  
   setView(lng=-1.82, lat=53, zoom=7) 
 mymap <- addAwesomeMarkers(mymap, icon = icons, data=Townselfharmsample, labelOptions = labelOptions(noHide = T))%>%
   addLegend(
     position = "bottomright",
     colors = c("red", "pink"),
     labels = c("Highest Self-Harm Hospitalisation Rates", "Lowest Self-Harm Hospitalisation Rates"), opacity = 1,
     title = "Highest and Lowest Self-Harm Hospitalisation Rates")
 mapshot(mymap, file="selfharmmap.png", zoom=20, vwidth=740, vheight=920)  
 
 
 
 
 Townhealthmaster <-Townhealthmaster %>% mutate(obesepicks = ifelse(Townhealthmaster$Obesechildrenyear6per <= 9.2, "Lowest Child Obesity Rates", ifelse(Townhealthmaster$Obesechildrenyear6per >= 26.89105, "Highest Child Obesity Rates",  NA)))
 
 Townsobesesample <- Townhealthmaster[complete.cases(Townhealthmaster$obesepicks),]
 names(Townsobesesample)[names(Townsobesesample)=="BUASD11CD"] <- "buasd11cd"
 
 
 Townsobesesample <-merge(buasd, Townsobesesample, by="buasd11cd")
 Townsobesesample <-Townsobesesample[c(1,74)]
 
 Townsobesesample <- sp.na.omit(Townsobesesample)
 
 
 Townsobesesample <- spTransform(Townsobesesample, CRS("+init=epsg:4326"))
 Townsobesesample <- SpatialPointsDataFrame(gCentroid(Townsobesesample, byid=TRUE), Townsobesesample@data, match.ID=FALSE)
 Townsobesesample$obesepicks <- factor(Townsobesesample$obesepicks)
 
 
 getColorp <- function(Townsobesesample) {
   sapply(Townsobesesample$obesepicks, function(obesepicks) {
     if(obesepicks == "Highest Child Obesity Rates") {
       "red"
     }  else {
       "pink"
     } })
 }
 
 icons <- awesomeIcons(
   icon = 'ios-close',
   iconColor = 'black',
   library = 'ion',
   markerColor = getColorp(Townsobesesample))
 
 mymap <- leaflet(data=Townsobesesample) %>%
   addTiles() %>%  
   setView(lng=-1.82, lat=53, zoom=7) 
 mymap <- addAwesomeMarkers(mymap, icon = icons, data=Townsobesesample, labelOptions = labelOptions(noHide = T))%>%
   addLegend(
     position = "bottomright",
     colors = c("red", "pink"),
     labels = c("Highest Child Obesity Rates", "Lowest Child Obesity Rates"), opacity = 1,
     title = "Highest and Lowest Child Obesity Rates")
 mapshot(mymap, file="obesitymap.png", zoom=20, vwidth=740, vheight=920)  
 
 
 
 Townhealthmaster <-Townhealthmaster %>% mutate(alcoholpicks = ifelse(Townhealthmaster$alcohol <= 59.1, "Lowest Alcohol-related Hospitalisation Rates", ifelse(Townhealthmaster$alcohol >= 153.5, "Highest Alcohol-related Hospitalisation Rates",  NA)))
 
 Townsalcoholsample <- Townhealthmaster[complete.cases(Townhealthmaster$alcoholpicks),]
 names(Townsalcoholsample)[names(Townsalcoholsample)=="BUASD11CD"] <- "buasd11cd"
 
 
 Townsalcoholsample <-merge(buasd, Townsalcoholsample, by="buasd11cd")
 Townsalcoholsample <-Townsalcoholsample[c(1,77)]
 
 Townsalcoholsample <- sp.na.omit(Townsalcoholsample)
 
 
 Townsalcoholsample <- spTransform(Townsalcoholsample, CRS("+init=epsg:4326"))
 Townsalcoholsample <- SpatialPointsDataFrame(gCentroid(Townsalcoholsample, byid=TRUE), Townsalcoholsample@data, match.ID=FALSE)
 Townsalcoholsample$alcoholpicks <- factor(Townsalcoholsample$alcoholpicks)
 
 
 getColorp <- function(Townsalcoholsample) {
   sapply(Townsalcoholsample$alcoholpicks, function(alcoholpicks) {
     if(alcoholpicks == "Highest Alcohol-related Hospitalisation Rates") {
       "red"
     }  else {
       "pink"
     } })
 }
 
 icons <- awesomeIcons(
   icon = 'ios-close',
   iconColor = 'black',
   library = 'ion',
   markerColor = getColorp(Townsalcoholsample))
 
 mymap <- leaflet(data=Townsalcoholsample) %>%
   addTiles() %>%  
   setView(lng=-1.82, lat=53, zoom=7) 
 mymap <- addAwesomeMarkers(mymap, icon = icons, data=Townsalcoholsample, labelOptions = labelOptions(noHide = T))%>%
   addLegend(
     position = "bottomright",
     colors = c("red", "pink"),
     labels = c("Highest Alcohol-related Hospitalisation Rates", "Lowest Alcohol-related Hospitalisation Rates"), opacity = 1,
     title = "Highest and Lowest Alcohol-related Hospitalisation Rates")
 mapshot(mymap, file="alcoholmap.png", zoom=20, vwidth=740, vheight=920)  
 
 
 
 
 
 Townhealthmaster <-Townhealthmaster %>% mutate(covidpicks = ifelse(Townhealthmaster$covidperpop >= 10, 1,ifelse(Townhealthmaster$allperpop >= 30, 2,ifelse(Townhealthmaster$percovid >= 40, 3,   NA))))
 
 Towncovidsample <- Townhealthmaster[complete.cases(Townhealthmaster$covidpicks),]
 names(Towncovidsample)[names(Towncovidsample)=="BUASD11CD"] <- "buasd11cd"
 
 
 Towncovidsample <-merge(buasd, Towncovidsample, by="buasd11cd")
 Towncovidsample <-Towncovidsample[c(1,75)]
 
 Towncovidsample <- sp.na.omit(Towncovidsample)
 
 
 Towncovidsample <- spTransform(Towncovidsample, CRS("+init=epsg:4326"))
 Towncovidsample <- SpatialPointsDataFrame(gCentroid(Towncovidsample, byid=TRUE), Towncovidsample@data, match.ID=FALSE)
 Towncovidsample$covidpicks <- factor(Towncovidsample$covidpicks)
 
 
 getColorp <- function(Towncovidsample) {
   sapply(Towncovidsample$covidpicks, function(covidpicks) {
     if(covidpicks == 1) {
       "red"
     } else if(covidpicks == 2) {
       "pink"
     } else {
       "purple"
     } })
 }
   
 icons <- awesomeIcons(
   icon = 'ios-close',
   iconColor = 'black',
   library = 'ion',
   markerColor = getColorp(Towncovidsample))
 
 mymap <- leaflet(data=Towncovidsample) %>%
   addTiles() %>%  
   setView(lng=-1.82, lat=53, zoom=7) 
 mymap <- addAwesomeMarkers(mymap, icon = icons, data=Towncovidsample, labelOptions = labelOptions(noHide = T))%>%
   addLegend(
    position = "bottomright",
   colors = c("red", "pink", "purple"),
   labels = c("Worst towns for COVID deaths", "Worst Towns for all Deaths", "Highest % of deaths due to COVID"), opacity = 1,
   title = "1st March to 17th of April")
 mapshot(mymap, file="covidmaptry3.png", zoom=20, vwidth=740, vheight=920)  
 
 
 
 
 
 
 
 ####coviddeaths####
 
 
 coviddeaths <- read_csv("C:\\Users\\bengo\\OneDrive\\Documents\\coviddeaths.csv")
 names(coviddeaths)[names(coviddeaths)=="COVID-19"] <- "coviddeaths"
 coviddeaths <- merge(coviddeaths, msoalookup, by="MSOA11CD", all.x=TRUE)
 coviddeaths <- aggregate(coviddeaths[-c(1,4,5,6)], coviddeaths["BUASD11CD"], sum)
 
 Townhealthmaster <- merge(Townhealthmaster, coviddeaths, by="BUASD11CD", all.x=TRUE)
 Townhealthmaster$percovid <- (Townhealthmaster$coviddeaths/ Townhealthmaster$`All causes`)*100 
 Townhealthmaster$covidperpop  <- (Townhealthmaster$coviddeaths/ Townhealthmaster$msoa18popbestfit)*10000
 Townhealthmaster$allperpop  <- (Townhealthmaster$`All causes`/ Townhealthmaster$msoa18popbestfit)*10000
 
 
 
 
 coviddeathsplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=coviddeaths))+
   geom_point(color="navyblue", alpha=0.5 ,size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   # geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
   #                 aes(label=towndealsample$`Town Name`), size=2, color="black")+
   labs(x = "Multiple Deprivation Rank (2019)", y = "Respondants reporting 'Very Good Health' (%, 2011)", title = "Subjectively 'Very Good' Health and Town Deprivation")+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "coviddeathsplot.png", plot=coviddeathsplot, width=8, height=5, dpi=600)
 
 totaldeathsplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=Townhealthmaster$`All causes`))+
   geom_point(color="navyblue", alpha=0.5 ,size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   # geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
   #                 aes(label=towndealsample$`Town Name`), size=2, color="black")+
   labs(x = "Multiple Deprivation Rank (2019)", y = "All Recorded Deaths (1 March - 17 April 2020)", title = "All Deaths during Lockdown and Town Deprivation")+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "totaldeathsplot.png", plot=totaldeathsplot, width=8, height=5, dpi=600)
 
 covidperplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=percovid))+
   geom_point(color="navyblue", alpha=0.5 ,size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   # geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
   #                 aes(label=towndealsample$`Town Name`), size=2, color="black")+
   labs(x = "Multiple Deprivation Rank (2019)", y = "Covid Deaths as a Percentage of all Deaths (1 March - 17 April 2020)", title = "Percentage of All Deaths during Lockdown which are due to COVID-19")+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "covidperplot.png", plot=covidperplot, width=8, height=5, dpi=600)
 
 coviddeathsperplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=covidperpop))+
   geom_point(color="navyblue", alpha=0.5 ,size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   # geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
   #                 aes(label=towndealsample$`Town Name`), size=2, color="black")+
   labs(x = "Multiple Deprivation Rank (2019)", y = "COVID-19 Deaths (Per 10,000 population, 1 March - 17 April 2020)", title = "COVID-19 Deaths and Town Deprivation")+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "coviddeathsperplot.png", plot=coviddeathsperplot, width=8, height=5, dpi=600)
 
 totaldeathsperplot <- ggplot(Townhealthmaster, aes(x=imdrank, y=allperpop))+
   geom_point(color="navyblue", alpha=0.5 ,size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   # geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
   #                 aes(label=towndealsample$`Town Name`), size=2, color="black")+
   labs(x = "Multiple Deprivation Rank (2019)", y = "All Recorded Deaths (Per 10,000 population, 1 March - 17 April 2020)", title = "All Deaths during Lockdown and Town Deprivation")+
   scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
   theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "totaldeathsperplot.png", plot=totaldeathsperplot, width=8, height=5, dpi=600)
 
 
covidandhealthplot <- ggplot(Townhealthmaster, aes(x=perverygoodhealth, y=covidperpop))+
   geom_point(color="navyblue", alpha=0.5 ,size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   # geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
   #                 aes(label=towndealsample$`Town Name`), size=2, color="black")+
   labs(x = "Percentage reporting 'very good' General Health (2011)", y = "All Recorded COVID-19 Deaths (Per 10,000 population, 1 March - 17 April 2020)", title = "All COVID Deaths and Self-reported Health")
   #scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
  # theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "covidandhealthplot.png", plot=covidandhealthplot, width=8, height=5, dpi=600)
 
 
 
 ###distancetocity####
 bua <- shapefile("C:\\Users\\bengo\\OneDrive\\Documents\\bua11.shp")
 names(bua)[names(bua)=="bua11cd"] <- "BUA11CD"
 popbua <- read_csv("ewpop16.csv")
 citybua <- merge(bua, popbua, by="bua11nm")
 citybua <- citybua[which(citybua$poplsoa>175000), ]
 citycent <- SpatialPointsDataFrame(gCentroid(citybua, byid=TRUE), citybua@data, match.ID=FALSE)
 ucityz <- as.ppp(citycent)
 
 buasd <- shapefile("C:\\Users\\bengo\\OneDrive\\Documents\\buasd11.shp")
 bua <- shapefile("C:\\Users\\bengo\\OneDrive\\Documents\\bua11.shp")
 bua <- bua[which(bua$has_sd=="N"),]
 bua <- bua[-c(6)]
 names(bua)[names(bua)=="bua11cd"] <- "buasd11cd"
 names(bua)[names(bua)=="bua11nm"] <- "buasd11nm"
 names(bua)[names(bua)=="bua_id"] <- "buasd_id"
 names(bua)[names(bua)=="sd_count"] <- "bua_id"
 names(bua)[names(bua)=="urban_bua"] <- "sd_type"
 
 buasd <- rbind(bua, buasd)
 proj4string(buasd) <- crs("+init=epsg:4326")
 
 
 Townhealthmasteronly <-Townhealthmaster[c(1,2)] 
 names(Townhealthmasteronly)[names(Townhealthmasteronly)=="BUASD11CD"] <- "buasd11cd"
 
 
 Townhealthmasteronly <-merge(buasd, Townhealthmasteronly, by="buasd11cd")
 Townhealthmasteronly <-Townhealthmasteronly[c(1,12)]
 
 Townhealthmasteronly <- sp.na.omit(Townhealthmasteronly)
 
 
 
 uktowncent <- SpatialPointsDataFrame(gCentroid(Townhealthmasteronly, byid=TRUE), Townhealthmasteronly@data, match.ID=FALSE)
 uktownz <- as.ppp(uktowncent)
 uktowncent$distance <- nncross(uktownz, ucityz, what="dist", k=1)
 
 
 distance <- as.data.frame(uktowncent[c(1,3)])
 
 distance <- distance[-c(3,4)]
 names(distance)[names(distance)=="buasd11cd"] <- "BUASD11CD"
 Townhealthmaster <- merge(Townhealthmaster, distance, by="BUASD11CD", all.x=TRUE)
 
 
 covidanddistanceplot <- ggplot(Townhealthmaster, aes(x=distance, y=covidperpop))+
   geom_point(color="navyblue", alpha=0.5 ,size=2)+
   theme_light()+
   geom_smooth(method=lm, color="red", fill="#69b3a2", se=TRUE)+
   # geom_text_repel(data=Townhealthmaster %>% filter(towndeal=="Town Deal"),
   #                 aes(label=towndealsample$`Town Name`), size=2, color="black")+
   labs(x = "Distance from town centre to city/ large connurbation", y = "All Recorded COVID-19 Deaths (Per 10,000 population, 1 March - 17 April 2020)", title = "All COVID Deaths and distance to a city")
 #scale_x_continuous(breaks=c(1,1108), labels = c("Most Deprived\nTown", "Least Deprived\nTown"))+
 # theme(axis.line.x = element_line(arrow = arrow(length = unit(3, 'mm'), ends='both')))
 ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "covidanddistanceplot.png", plot=covidanddistanceplot, width=8, height=5, dpi=600)
 
 ####covid for deprived and affleunt####
 
 Townhealthmaster <-Townhealthmaster %>% mutate(deprivedgroup = ifelse(Townhealthmaster$imdrank <= 100, "Most Deprived",ifelse(Townhealthmaster$imdrank >= 1009, "Least Deprived", NA)))
 Townhealthmaster$deprivedgroup <- factor(Townhealthmaster$deprivedgroup)
 Townhealthmaster$one <- 1
 Townhealthmaster$one <- factor(Townhealthmaster$one)
 
hundreddeptowngraph <- ggplot(data=subset(Townhealthmaster, !is.na(deprivedgroup)), aes(x=one, y=covidperpop, fill=deprivedgroup))+
  geom_bar(position=position_dodge(), stat="summary",  fun.y = "mean")+
  theme_light()+
  labs(x = "Towns", y = "Mean Recorded COVID-19 Deaths\n(Per 10,000 population, 1 March - 17 April 2020)", title = "COVID Deaths in the Most and Least Deprived Towns", fill = "Town Group")+
  theme(axis.text.x=element_blank())+
  scale_fill_manual( values=c("navyblue", "lightblue"))
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "hundreddeptowngraph.png", plot=hundreddeptowngraph, width=6, height=5, dpi=600)



Townhealthmaster <-Townhealthmaster %>% mutate(deprivedgroup10 = ifelse(Townhealthmaster$imdrank <= 10, "Most Deprived",ifelse(Townhealthmaster$imdrank >= 1099, "Least Deprived", NA)))
Townhealthmaster$deprivedgroup <- factor(Townhealthmaster$deprivedgroup)
Townhealthmaster$one <- 1
Townhealthmaster$one <- factor(Townhealthmaster$one)

tendeptowngraph <- ggplot(data=subset(Townhealthmaster, !is.na(deprivedgroup10)), aes(x=one, y=covidperpop, fill=deprivedgroup10))+
  geom_bar(position=position_dodge(), stat="summary",  fun.y = "mean")+
  theme_light()+
  labs(x = "Towns", y = "Mean Recorded COVID-19 Deaths\n(Per 10,000 population, 1 March - 17 April 2020)", title = "COVID Deaths in the Most and Leats Deprived Towns", fill = "Town Group")+
  theme(axis.text.x=element_blank())+
  scale_fill_manual( values=c("navyblue", "lightblue"))
ggsave(path = "C:\\Users\\bengo\\OneDrive\\Documents\\", filename = "tendeptowngraph.png", plot=tendeptowngraph, width=6, height=5, dpi=600)


 






